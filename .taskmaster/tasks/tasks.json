{
  "version": "1.0.0",
  "tags": {
    "master": {
      "name": "master",
      "description": "qiflow-ai迁移到mksaas主任务线",
      "createdAt": "2025-01-01T15:40:00Z",
      "updatedAt": "2025-01-02T12:00:00Z",
      "tasks": [
        {
          "id": "1",
          "title": "架构分析阶段",
          "description": "分析现有系统架构和制定迁移策略",
          "details": "全面分析qiflow-ai和mksaas的技术架构，制定详细的迁移计划",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "1.1",
              "title": "分析qiflow-ai现有架构",
              "description": "深入分析qiflow-ai的架构和功能模块",
              "details": "1. 扫描qiflow-ai目录结构\n2. 识别核心功能模块（八字计算、风水分析、AI解读等）\n3. 分析技术栈和依赖包\n4. 记录API接口和数据模型\n5. 创建架构文档",
              "status": "done"
            },
            {
              "id": "1.2",
              "title": "分析mksaas模版结构",
              "description": "理解mksaas框架和集成点",
              "details": "1. 分析mksaas的目录结构\n2. 理解认证系统集成方式\n3. 研究支付系统接口\n4. 了解营销模块功能\n5. 记录可复用的组件和服务",
              "status": "done"
            },
            {
              "id": "1.3",
              "title": "制定文件映射计划",
              "description": "创建详细的文件迁移映射表",
              "details": "1. 创建源文件到目标文件的映射表\n2. 识别需要合并的文件\n3. 标记需要重构的模块\n4. 制定命名规范转换规则",
              "status": "done"
            },
            {
              "id": "1.4",
              "title": "识别技术冲突点",
              "description": "发现并记录潜在的技术问题",
              "details": "1. 依赖包版本冲突分析\n2. 路由系统兼容性检查\n3. 状态管理方案对比\n4. API规范差异分析\n5. 创建风险清单",
              "status": "done"
            }
          ],
          "dependencies": []
        },
        {
          "id": "2",
          "title": "基础设施准备",
          "description": "准备迁移所需的基础环境和备份",
          "details": "设置迁移环境，备份重要数据，准备必要的配置",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "2.1",
              "title": "备份现有代码",
              "description": "创建完整的代码备份",
              "details": "1. 创建qiflow-ai完整备份\n2. 导出数据库快照\n3. 保存环境变量配置\n4. 记录当前版本号",
              "status": "done"
            },
            {
              "id": "2.2",
              "title": "创建迁移分支",
              "description": "设置Git分支策略",
              "details": "1. 创建migration分支\n2. 设置分支保护规则\n3. 配置CI/CD暂停\n4. 创建回滚点标记",
              "status": "done"
            },
            {
              "id": "2.3",
              "title": "准备环境变量",
              "description": "整合和配置环境变量",
              "details": "1. 合并两个项目的.env文件\n2. 解决变量名冲突\n3. 添加新的集成配置\n4. 创建.env.example模板",
              "status": "done"
            },
            {
              "id": "2.4",
              "title": "数据库迁移准备",
              "description": "准备数据库迁移方案",
              "details": "1. 设计统一的数据库schema\n2. 创建迁移脚本\n3. 准备数据转换规则\n4. 设置测试数据库",
              "status": "done"
            }
          ],
          "dependencies": [
            "1"
          ]
        },
        {
          "id": "3",
          "title": "核心功能迁移",
          "description": "迁移八字风水的核心业务逻辑",
          "details": "将所有核心算法和业务逻辑迁移到新架构",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "3.1",
              "title": "迁移八字计算引擎",
              "description": "迁移八字排盘和计算逻辑",
              "details": "1. 迁移八字排盘算法\n2. 迁移天干地支计算\n3. 迁移五行生克逻辑\n4. 迁移大运流年算法\n5. 创建单元测试",
              "status": "done"
            },
            {
              "id": "3.2",
              "title": "迁移风水分析模块",
              "description": "迁移玄空风水分析功能",
              "details": "1. 迁移飞星计算逻辑\n2. 迁移宫位分析算法\n3. 迁移风水布局建议\n4. 迁移罗盘功能\n5. 验证计算准确性",
              "status": "done"
            },
            {
              "id": "3.3",
              "title": "迁移AI解读功能",
              "description": "集成AI分析和解读服务",
              "details": "1. 迁移AI提示词模板\n2. 适配新的API调用方式\n3. 迁移解读结果处理\n4. 优化响应速度\n5. 添加错误处理",
              "status": "done"
            },
            {
              "id": "3.4",
              "title": "迁移PDF导出功能",
              "description": "迁移报告生成和导出功能",
              "details": "1. 迁移PDF模板\n2. 适配新的样式系统\n3. 迁移图表生成逻辑\n4. 测试导出功能\n5. 优化文件大小",
              "status": "done"
            },
            {
              "id": "3.5",
              "title": "迁移API接口",
              "description": "迁移所有API端点",
              "details": "1. 迁移到app/api目录\n2. 适配新的路由规范\n3. 统一错误处理\n4. 添加请求验证\n5. 更新API文档",
              "status": "done"
            }
          ],
          "dependencies": [
            "2"
          ]
        },
        {
          "id": "4",
          "title": "UI组件迁移",
          "description": "迁移和适配所有前端组件",
          "details": "将UI组件迁移到新架构并统一设计风格",
          "status": "done",
          "priority": "medium",
          "subtasks": [
            {
              "id": "4.1",
              "title": "迁移页面组件",
              "description": "迁移所有页面到app目录",
              "details": "1. 迁移首页\n2. 迁移八字分析页\n3. 迁移风水分析页\n4. 迁移个人中心页\n5. 迁移支付页面",
              "status": "done"
            },
            {
              "id": "4.2",
              "title": "适配布局系统",
              "description": "集成到mksaas布局框架",
              "details": "1. 适配导航栏\n2. 适配侧边栏\n3. 适配页脚\n4. 统一页面容器\n5. 响应式适配",
              "status": "done"
            },
            {
              "id": "4.3",
              "title": "统一设计风格",
              "description": "统一UI风格和主题",
              "details": "1. 迁移到Shadcn UI\n2. 统一颜色方案\n3. 统一字体样式\n4. 统一间距规范\n5. 创建主题配置",
              "status": "done"
            },
            {
              "id": "4.4",
              "title": "迁移自定义组件",
              "description": "迁移特定的八字风水组件",
              "details": "1. 迁移八字盘组件\n2. 迁移罗盘组件\n3. 迁移运势图表\n4. 迁移飞星图组件\n5. 优化组件性能",
              "status": "done"
            }
          ],
          "dependencies": [
            "3"
          ]
        },
        {
          "id": "5",
          "title": "系统集成",
          "description": "集成mksaas的核心系统功能",
          "details": "将八字风水功能与mksaas基础设施深度集成",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "5.1",
              "title": "集成认证系统",
              "description": "接入mksaas用户认证",
              "details": "1. 集成登录注册流程\n2. 适配会话管理\n3. 迁移用户数据\n4. 设置权限控制\n5. 添加SSO支持",
              "status": "done"
            },
            {
              "id": "5.2",
              "title": "集成支付系统",
              "description": "接入支付和计费功能",
              "details": "1. 配置支付网关\n2. 设置计费规则（aiChat=5,deepInterpretation=30,bazi=10,xuankong=20,pdfExport=5）\n3. 创建订单系统\n4. 添加余额管理\n5. 实现三级降级策略",
              "status": "done"
            },
            {
              "id": "5.3",
              "title": "集成营销功能",
              "description": "接入营销推广系统",
              "details": "1. 集成优惠券系统\n2. 添加推荐奖励\n3. 配置活动管理\n4. 集成数据分析\n5. 设置A/B测试",
              "status": "done"
            },
            {
              "id": "5.4",
              "title": "集成权限管理",
              "description": "设置细粒度权限控制",
              "details": "1. 定义权限模型\n2. 设置功能权限\n3. 配置数据权限\n4. 添加角色管理\n5. 实现权限中间件",
              "status": "done"
            }
          ],
          "dependencies": [
            "4"
          ]
        },
        {
          "id": "6",
          "title": "数据迁移",
          "description": "迁移所有业务数据",
          "details": "安全地迁移用户数据和业务数据",
          "status": "done",
          "priority": "medium",
          "subtasks": [
            {
              "id": "6.1",
              "title": "用户数据迁移",
              "description": "迁移用户账户信息",
              "details": "1. 导出用户数据\n2. 数据格式转换\n3. 批量导入新库\n4. 验证数据完整性\n5. 处理重复数据",
              "status": "done"
            },
            {
              "id": "6.2",
              "title": "订单数据迁移",
              "description": "迁移历史订单记录",
              "details": "1. 导出订单数据\n2. 映射订单状态\n3. 转换支付记录\n4. 导入新系统\n5. 对账验证",
              "status": "done"
            },
            {
              "id": "6.3",
              "title": "配置数据迁移",
              "description": "迁移系统配置",
              "details": "1. 导出配置数据\n2. 合并配置项\n3. 更新配置格式\n4. 导入新系统\n5. 验证配置生效",
              "status": "done"
            }
          ],
          "dependencies": [
            "5"
          ]
        },
        {
          "id": "7",
          "title": "测试验证",
          "description": "全面测试迁移后的系统",
          "details": "确保所有功能正常运行，性能达标",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "7.1",
              "title": "功能测试",
              "description": "测试所有业务功能",
              "details": "1. 测试八字计算\n2. 测试风水分析\n3. 测试AI解读\n4. 测试PDF导出\n5. 测试支付流程",
              "status": "done"
            },
            {
              "id": "7.2",
              "title": "集成测试",
              "description": "测试系统集成点",
              "details": "1. 测试用户认证流程\n2. 测试支付集成\n3. 测试数据同步\n4. 测试权限控制\n5. 测试营销功能",
              "status": "done"
            },
            {
              "id": "7.3",
              "title": "性能测试",
              "description": "验证系统性能指标",
              "details": "1. 负载测试\n2. 压力测试\n3. 页面加载速度测试（<2秒）\n4. API响应时间测试\n5. 数据库查询优化",
              "status": "done"
            },
            {
              "id": "7.4",
              "title": "安全测试",
              "description": "进行安全漏洞扫描",
              "details": "1. SQL注入测试\n2. XSS测试\n3. CSRF测试\n4. 权限越权测试\n5. 敏感信息泄露检查",
              "status": "done"
            }
          ],
          "dependencies": [
            "6"
          ]
        },
        {
          "id": "8",
          "title": "部署上线",
          "description": "将迁移后的系统部署到生产环境",
          "details": "安全地部署新系统并监控运行状态",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "8.1",
              "title": "配置生产环境",
              "description": "准备生产环境配置",
              "details": "1. 配置服务器\n2. 设置域名\n3. 配置CDN\n4. 设置SSL证书\n5. 配置防火墙",
              "status": "done"
            },
            {
              "id": "8.2",
              "title": "灰度发布",
              "description": "实施灰度发布策略",
              "details": "1. 部署到预发布环境\n2. 5%流量切换\n3. 监控错误率\n4. 逐步增加流量\n5. 全量切换",
              "status": "done"
            },
            {
              "id": "8.3",
              "title": "监控配置",
              "description": "设置监控和告警",
              "details": "1. 配置日志收集\n2. 设置性能监控\n3. 配置错误告警\n4. 设置业务监控\n5. 创建监控面板",
              "status": "done"
            },
            {
              "id": "8.4",
              "title": "回滚方案",
              "description": "准备应急回滚计划",
              "details": "1. 创建回滚脚本\n2. 准备数据恢复方案\n3. 设置快速切换开关\n4. 制定回滚决策标准\n5. 演练回滚流程",
              "status": "done"
            }
          ],
          "dependencies": [
            "7"
          ]
        },
        {
          "id": "9",
          "title": "合规性检查",
          "description": "确保系统符合所有合规要求",
          "details": "实施必要的合规措施，保护用户隐私和数据安全",
          "status": "done",
          "priority": "high",
          "subtasks": [
            {
              "id": "9.1",
              "title": "实施18+年龄验证",
              "description": "添加年龄验证机制",
              "details": "1. 创建年龄验证页面\n2. 实施年龄检查中间件\n3. 添加年龄声明弹窗\n4. 记录验证日志",
              "status": "done"
            },
            {
              "id": "9.2",
              "title": "添加免责声明",
              "description": "完善法律免责声明",
              "details": "1. 创建服务条款页面\n2. 添加免责声明弹窗\n3. 强制用户同意流程\n4. 记录同意记录",
              "status": "done"
            },
            {
              "id": "9.3",
              "title": "隐私保护实施",
              "description": "实施GDPR和隐私保护",
              "details": "1. 创建隐私政策页面\n2. 实施数据最小化原则\n3. 添加Cookie同意管理\n4. 实施数据加密\n5. 创建DSAR处理流程",
              "status": "done"
            },
            {
              "id": "9.4",
              "title": "敏感主题过滤",
              "description": "实施内容审核机制",
              "details": "1. 创建敏感词库\n2. 实施内容过滤器\n3. 添加人工审核流程\n4. 设置拒答规则\n5. 记录审核日志",
              "status": "done"
            }
          ],
          "dependencies": [
            "5"
          ]
        },
        {
          "id": "10",
          "title": "文档和培训",
          "description": "创建完整的文档并进行知识传递",
          "details": "确保团队能够维护和运营新系统",
          "status": "done",
          "priority": "medium",
          "subtasks": [
            {
              "id": "10.1",
              "title": "技术文档编写",
              "description": "创建技术文档",
              "details": "1. 架构文档\n2. API文档\n3. 部署文档\n4. 运维手册\n5. 故障排查指南",
              "status": "done"
            },
            {
              "id": "10.2",
              "title": "用户手册编写",
              "description": "创建用户使用文档",
              "details": "1. 功能说明书\n2. 操作指南\n3. FAQ文档\n4. 视频教程\n5. 快速入门指南",
              "status": "done"
            },
            {
              "id": "10.3",
              "title": "团队培训",
              "description": "进行团队知识传递",
              "details": "1. 技术架构培训\n2. 运维培训\n3. 客服培训\n4. 营销团队培训\n5. 创建知识库",
              "status": "done"
            }
          ],
          "dependencies": [
            "8"
          ]
        }
      ]
    }
  },
  "migration-qiflow": {
    "tasks": [
      {
        "id": 1,
        "title": "C0 预检与建分支",
        "description": "记录工具链版本、创建迁移分支、输出基础目录树",
        "details": "- 输出 mksaas/artifacts/C0/{branch.txt, tooling.txt, tree.txt}\n- 创建分支 chore/migrate-qiflow-into-mksaas\n- 记录 pnpm/node 版本\n- 生成项目树概览",
        "testStrategy": "检查 artifacts/C0 生成文件是否存在且非空；分支存在；命令可重复执行",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 2,
        "title": "C1 结构盘点与映射",
        "description": "生成源/目标清单与 mapping.md",
        "details": "- 列出 qiflow-ai 源文件清单\n- 列出 src 目标目录结构\n- 生成静态映射表 mapping.md",
        "testStrategy": "确认 artifacts/C1/{source_files.txt,target_dirs.txt,mapping.md} 均存在且非空",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 3,
        "title": "C2 依赖与配置对齐（最小侵入）",
        "description": "收集依赖差异并仅迁移算法/可视化必要依赖",
        "details": "- 生成 deps.diff\n- pnpm install 并解决 peer 冲突（若有）\n- 执行 typecheck 并保存输出",
        "testStrategy": "安装成功无严重冲突；typecheck 输出记录 artifacts/C2/typecheck.txt",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 4,
        "title": "C3 数据库扩展（Drizzle 合并）",
        "description": "新增 qiflow 专属表并生成迁移",
        "details": "- 新建 src/db/schema-qiflow.ts\n- 合并导出至 src/db/index.ts\n- 生成并执行迁移",
        "testStrategy": "迁移成功，无 destructive；本地连接检查通过",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "创建 schema-qiflow.ts 并定义 4 张表",
            "description": "bazi_calculations/fengshui_analysis/pdf_audit/copyright_audit",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 2,
            "title": "合并导出到 src/db/index.ts",
            "description": "保留现有导出，追加 * from './schema-qiflow'",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 3,
            "title": "生成迁移并执行",
            "description": "pnpm db:generate && pnpm db:migrate；确保 .env 连接正确",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          },
          {
            "id": 4,
            "title": "连通性与回滚验证",
            "description": "drizzle studio/简单插入验证；如失败，回滚迁移",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 4
          }
        ]
      },
      {
        "id": 5,
        "title": "C4 认证/支付/i18n 接入点",
        "description": "扩展 Better Auth 钩子与定价常量，确认 i18n 目录",
        "details": "- 新建 src/lib/auth-qiflow.ts\n- 新建 src/config/qiflow-pricing.ts\n- 确认并创建 src/app/[locale] 路由节点",
        "testStrategy": "登录→Dashboard 可加载；Credits 组件可读取定价常量",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "新增定价常量 qiflow-pricing.ts",
            "description": "统一 aiChat/bazi/xuankong/deepInterpretation/pdfExport",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 2,
            "title": "认证扩展钩子 auth-qiflow.ts",
            "description": "onUserCreated 初始化档案与可选注册送分",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 3,
            "title": "确认 i18n [locale] 路由与 Dashboard",
            "description": "新页面归位到 src/app/[locale]/...；Dashboard 可加载",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          },
          {
            "id": 4,
            "title": "Credits 读取定价常量联调",
            "description": "展示与扣减入口读取 QIFLOW_PRICING",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 5
          }
        ]
      },
      {
        "id": 6,
        "title": "C5 核心业务迁移（算法/Actions/UI）",
        "description": "迁移八字/玄空算法、Server Actions、i18n 页面",
        "details": "- 拆分 qiflow-ai/lib → src/lib/qiflow/{bazi,xuankong,compass}\n- 新建 Actions：calculate-bazi/xuankong-analysis/compass-reading\n- 新建页面：/[locale]/analysis/{bazi,xuankong}",
        "testStrategy": "/zh/analysis/bazi 与 /zh/analysis/xuankong 200；触发一次计算入库",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "创建算法目录骨架",
            "description": "src/lib/qiflow/{bazi,xuankong,compass}/**",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 2,
            "title": "实现 Server Actions",
            "description": "calculate-bazi/xuankong-analysis/compass-reading（含最小 Zod 校验与入库）",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 3,
            "title": "前端 UI 三色联动与阈值常量",
            "description": "<0.4=红色拒答，0.4~0.7=黄色提示，≥0.7=绿色；常量集中管理",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 4,
            "title": "低置信度降级与手动输入兜底",
            "description": "置信度<0.4 强制拒答+原因；提供手动输入表单",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          },
          {
            "id": 5,
            "title": "校准引导 UX",
            "description": "0.7~0.9 提示用户进行罗盘校准与环境检查",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 6
          }
        ]
      },
      {
        "id": 7,
        "title": "C6 罗盘置信度与降级链路",
        "description": "实现罗盘置信度算法与 UI 三色联动及降级",
        "details": "- 新建 src/lib/qiflow/compass/confidence.ts\n- 置信度 <0.4 拒答并转手动输入；0.7~0.9 校准引导",
        "testStrategy": "低置信度触发降级与文案指引",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 8,
        "title": "C7 营销/漏斗与合规模块接线",
        "description": "确保营销页访问与合规模块接线",
        "details": "- 营销 (marketing) 页面可访问\n- AgeVerification/DisclaimerBar/敏感词拒答接入",
        "testStrategy": "未登录访问营销页正常；首次登录出现合规提示",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "验证营销页面可访问性",
            "description": "确保营销页面(/)、定价(/pricing)、博客等可正常访问",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 2,
            "title": "在QiFlow分析页面添加合规组件",
            "description": "在/analysis/bazi和/analysis/xuankong页面添加AgeVerification和DisclaimerBar",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 3,
            "title": "验证敏感词拒答接入完整性",
            "description": "确认所有Server Actions(calculate-bazi, xuankong-analysis, compass-reading)都集成了敏感词检测",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          },
          {
            "id": 4,
            "title": "测试未登录访问和首次登录提示",
            "description": "验证未登录用户可以访问营销页面，首次登录时显示合规提示",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 8
          }
        ]
      },
      {
        "id": 9,
        "title": "C8 观测/限流与计费一致性",
        "description": "埋点 trace 与启用速率限制/熔断；校验计费一致性",
        "details": "- 中间件或包装器埋点 traceId/latency/cost/coins\n- 开启速率限制/熔断策略\n- 抽查积分扣减与 UI 展示一致性",
        "testStrategy": "触发一次八字→日志含 trace/cost；余额正确扣减",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "中间件埋点与日志格式",
            "description": "traceId/latency/cost/coins 统一 JSON 输出与采样",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 2,
            "title": "速率限制与熔断配置",
            "description": "按 MKSaaS 既有策略启用限流与熔断，阈值可配",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          },
          {
            "id": 3,
            "title": "积分扣减一致性抽查",
            "description": "触发八字→检查 ledger/余额/前端显示一致性",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 9
          }
        ]
      },
      {
        "id": 10,
        "title": "C9 测试与冒烟",
        "description": "单测最小集与 E2E 冒烟、性能 Trace 与优化建议",
        "details": "- pnpm test:unit（bazi/xuankong/pricing）\n- E2E 冒烟：home→analysis→report→billing\n- 10s 性能 trace + 3~5 条建议",
        "testStrategy": "单测通过 & 冒烟无 5xx；生成 artifacts/C9/{trace, screenshots, suggestions}.md",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "单元测试最小集",
            "description": "bazi/xuankong/pricing 最小单测",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 2,
            "title": "E2E 冒烟脚本/手测 + 截图",
            "description": "home→analysis→report→billing，保存 screenshots",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          },
          {
            "id": 3,
            "title": "10s 性能 Trace 与 3~5 条建议",
            "description": "收集 10s trace 并给出优化建议清单",
            "details": "",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 10
          }
        ]
      },
      {
        "id": 11,
        "title": "C10 提交与差异报告",
        "description": "原子提交并生成差异报告",
        "details": "- git add/commit 分支提交\n- 输出 git diff --stat main...HEAD",
        "testStrategy": "分支提交完成，生成 artifacts/C10/diff.txt",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 12,
        "title": "回滚与风险验证",
        "description": "验证回滚路径与兜底链路",
        "details": "- 验证拒答与手动输入兜底\n- 验证分支回滚/撤销流程\n- 依赖冲突时的别名/局部锁版本策略",
        "testStrategy": "手动验证回滚成功；兜底链路可用；依赖冲突可收敛",
        "status": "done",
        "dependencies": [],
        "priority": "medium",
        "subtasks": [
          {
            "id": 1,
            "title": "数据库迁移回滚验证",
            "description": "验证Drizzle ORM数据库迁移的回滚路径",
            "details": "- 测试 drizzle-kit drop 命令\n- 验证迁移文件的降级SQL\n- 检查数据完整性和外键约束\n- 文档化回滚步骤和注意事项",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          },
          {
            "id": 2,
            "title": "Git分支回滚测试",
            "description": "验证Git代码回滚和分支恢复流程",
            "details": "- 测试 git revert 单个提交\n- 测试 git reset --hard 回滚到特定提交\n- 验证分支删除和重建\n- 文档化代码恢复的最佳实践",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          },
          {
            "id": 3,
            "title": "降级处理机制验证",
            "description": "测试已实现的兜底链路和降级处理",
            "details": "- 验证低置信度触发降级逻辑\n- 测试手动输入fallback功能\n- 检查拒答机制和错误提示\n- 验证校准引导UX流程\n- 确认所有降级路径可用",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          },
          {
            "id": 4,
            "title": "依赖冲突风险评估",
            "description": "评估依赖版本冲突并制定解决策略",
            "details": "- 分析当前依赖树和版本约束\n- 识别潜在的版本冲突点\n- 评估降级依赖版本的影响\n- 制定别名或局部锁版本策略\n- 文档化依赖冲突解决方案",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          },
          {
            "id": 5,
            "title": "回滚文档与应急预案",
            "description": "生成完整的回滚文档和应急响应预案",
            "details": "- 编写数据库回滚操作手册\n- 编写代码回滚SOP（标准操作流程）\n- 制定应急响应流程图\n- 识别关键风险点和应对措施\n- 创建回滚决策树和检查清单",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 12
          }
        ]
      }
    ],
    "metadata": {
      "created": "2025-10-01T17:01:54.730Z",
      "updated": "2025-10-02T05:29:59.420Z",
      "description": "qiflow→MKSaaS 迁移专用任务上下文"
    }
  }
}