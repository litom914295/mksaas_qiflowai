# 产品需求文档 (PRD) - 首页整合八字风水分析

## 1. 项目概述
将完整的八字风水分析功能整合到首页首屏，缩短用户旅程，提高转化率。用户无需跳转即可在首页完成信息输入、分析查看和后续咨询。

## 2. 核心目标
- **提高转化率**：减少用户操作步骤，从多页流程简化为单页体验
- **优化用户体验**：所见即所得，降低决策成本
- **增强粘性**：分析结果后立即提供 AI 风水大师对话入口

## 3. 功能需求

### 3.1 首页表单整合（首屏）
将以下表单元素移至首页：

#### 用户基本信息
- 出生日期选择器（年月日时）
- 性别选择（男/女）
- 历法选择（阳历/阴历）
- 出生城市选择（用于时区和地理坐标）

#### 房屋风水信息
- 房屋朝向选择（8个方位：东、南、西、北、东南、西南、东北、西北）
- 房屋建成年份（年份选择器）
- 可选：房屋楼层、户型等补充信息

#### 操作按钮
- 主操作按钮："开始分析"或"立即分析"
- 样式：突出、有吸引力的 CTA 按钮

### 3.2 分析结果展示（同页滚动或展开）
点击"开始分析"后，在首页下方展示：

#### 八字命理分析
- 四柱八字排盘
- 五行分析
- 喜用神
- 大运流年
- 性格特质
- 事业财运
- 婚姻感情
- 健康提示

#### 玄空风水分析
- 房屋风水格局
- 飞星盘（九宫飞星）
- 方位吉凶
- 风水建议
- 化解方案

#### 综合建议
- 八字与风水的结合分析
- 个性化改善建议

### 3.3 AI 风水大师对话框
在分析结果展示后，添加 AI 聊天入口：

#### 位置
- 建议在分析结果底部或侧边（移动端在底部，桌面端可悬浮）
- 以引导性文案吸引用户："想深入了解您的命理风水？点击咨询 AI 风水大师"

#### 功能
- 实时对话交互
- 基于用户的八字和风水数据提供个性化回答
- 支持追问和深度解读
- 消费积分/余额控制（aiChat=5 积分/次）

#### UX 四态
- Empty：初始状态，显示欢迎语和示例问题
- Loading：AI 思考中，显示动画
- Error：网络或服务错误，显示友好错误提示
- Limited：余额不足，显示充值引导

## 4. 技术要求

### 4.1 前端架构
- 使用 Next.js App Router
- 组件路径：`app/(routes)/page.tsx`（首页）
- 复用现有玄空风水分析组件，重构为首页子组件
- 响应式设计：移动优先（Mobile-first）

### 4.2 表单组件
- 使用 Shadcn UI + Radix UI
- 表单验证：Zod schema
- 状态管理：nuqs（URL 参数同步）+ useState（本地状态）
- 日期选择器：支持阴阳历转换
- 城市选择器：带搜索功能的下拉框

### 4.3 数据流
1. 用户填写表单 → 客户端验证
2. 提交到 Server Action（`app/actions/analyze.ts`）
3. 后端计算八字 + 玄空风水
4. 返回分析结果
5. 前端展示 + 滚动到结果区域
6. 显示 AI 对话入口

### 4.4 AI 对话集成
- API Route：`app/api/chat/route.ts`
- 使用流式响应（Streaming）
- 上下文管理：包含用户八字、风水数据
- 计费逻辑：每次对话消耗 5 积分

### 4.5 性能优化
- 表单组件懒加载（非关键）
- 分析结果使用 Suspense + Skeleton
- AI 对话框动态导入（next/dynamic）
- 图片优化（next/image）

## 5. 计费与合规

### 5.1 积分消耗
- 深度解读：30 积分
- 八字分析：10 积分
- 玄空风水：20 积分
- AI 对话：5 积分/次
- PDF 导出：5 积分

### 5.2 合规要求
- 18+ 年龄验证
- 免责声明展示
- 隐私政策链接
- DSAR（数据主体访问请求）支持
- 敏感主题拒答机制

## 6. 验收标准

### 6.1 功能验收
- [ ] 首页首屏包含完整表单
- [ ] 表单验证正确（必填项、格式校验）
- [ ] 点击分析后正确展示结果
- [ ] 结果区域包含八字 + 风水 + 综合建议
- [ ] AI 对话框正常交互
- [ ] 积分消耗正确
- [ ] 余额不足时显示充值引导

### 6.2 体验验收
- [ ] 移动端表单易用（大按钮、清晰标签）
- [ ] 加载状态友好（Skeleton、进度提示）
- [ ] 错误提示明确（表单错误、网络错误）
- [ ] 滚动平滑（分析完成后自动滚动到结果）
- [ ] AI 对话响应快速（流式输出）

### 6.3 性能验收
- [ ] LCP < 2.5s
- [ ] CLS < 0.1
- [ ] FID/INP < 100ms
- [ ] 首屏表单加载 < 1s

## 7. 设计要点

### 7.1 视觉层次
- 标题：突出"八字风水一站式分析"
- 表单：清晰分组（个人信息 | 房屋信息）
- 按钮：主色调、大尺寸、有 hover 效果
- 结果：卡片式布局，层次分明

### 7.2 交互反馈
- 表单输入：实时验证反馈
- 提交中：禁用按钮 + Loading 状态
- 分析完成：Toast 提示 + 平滑滚动
- AI 对话：打字机效果（流式输出）

### 7.3 引导文案
- 首屏：简洁有力的价值主张
- 表单说明：帮助提示（Tooltip）
- 结果解读：避免术语，通俗易懂
- AI 入口：好奇心驱动的引导语

## 8. 迁移计划

### 8.1 源页面识别
需要先查找并确认：
- 现有玄空风水分析页面的具体路径
- 相关表单组件的位置
- API Routes 和 Server Actions 的位置
- 八字和风水计算逻辑的位置

### 8.2 迁移步骤
1. 调研现有代码结构
2. 创建新的首页布局组件
3. 重构表单组件为模块化子组件
4. 将表单组件集成到首页
5. 调整布局和样式（首屏适配）
6. 集成分析结果展示逻辑
7. 添加 AI 对话框组件
8. 测试完整流程
9. 部署上线

### 8.3 风险控制
- 保留原页面作为备份（可通过 URL 访问）
- 分阶段灰度发布（10% → 50% → 100%）
- 监控转化率和错误率
- 准备回滚方案

## 9. 后续优化方向
- A/B 测试不同表单布局
- 智能推荐（基于历史数据）
- 社交分享功能
- 保存分析记录
- 会员订阅模式

---

## 附录：关键文件路径（待确认）
- 首页：`app/(routes)/page.tsx` 或 `app/page.tsx`
- 表单组件：待查找
- 分析 Action：待查找
- AI 聊天 API：待查找
- AI 聊天组件：待查找
- 类型定义：待查找
