# QiFlowAI v4.0 æŠ¥å‘Šä»»åŠ¡å®Œæˆæƒ…å†µè¯„å®¡

**è¯„å®¡æ—¥æœŸ**: 2025-01-13  
**é¡¹ç›®é˜¶æ®µ**: å¼€å‘ä¸­ (æœªä¸Šçº¿)  
**åŸºå‡†æ–‡æ¡£**: é¡¹ç›®ç«äº‰åŠ›åˆ†æä¸ä¼˜åŒ–æŠ¥å‘Š_v4.0_æœ€ç»ˆç‰ˆ.md  
**ä»£ç å®¡æŸ¥èŒƒå›´**: src/ ç›®å½•ä¸‹æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—  

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### æ•´ä½“å®Œæˆåº¦: **60-65%**

- âœ… **æ ¸å¿ƒå˜ç°è·¯å¾„å·²æ‰“é€š**: æŠ¥å‘Šäº§å“(ç§¯åˆ†æ”¯ä»˜)åŠŸèƒ½å®Œæ•´ä¸”è´¨é‡é«˜
- âœ… **æŠ€æœ¯åŸºç¡€æ‰å®**: Webhookå¹‚ç­‰ã€Credits Managerã€PDFç”Ÿæˆå‡å·²å®ç°
- âš ï¸ **å‰ç«¯UIç¼ºå¤±è¾ƒå¤š**: æ–°æ‰‹ä»»åŠ¡ã€ä¼šè¯Chatã€ä»ªè¡¨ç›˜ç­‰ç¼ºå°‘ç”¨æˆ·ç•Œé¢
- âŒ **A/Bæµ‹è¯•æœªå®ç°**: è™½æœ‰æ•°æ®åº“è¡¨,ä½†ä¸šåŠ¡é€»è¾‘å®Œå…¨ç¼ºå¤±
- âš ï¸ **RAGçŸ¥è¯†åº“**: åŸºç¡€è®¾æ–½å®Œæ•´ä½†æ— æ•°æ®æ‘„å–

### å¯ç«‹å³ä¸Šçº¿çš„åŠŸèƒ½
1. âœ… æŠ¥å‘Šè´­ä¹°(ç§¯åˆ†æ”¯ä»˜) - åç«¯å®Œæ•´
2. âœ… ä¼šè¯åˆ¶Chat - åç«¯å®Œæ•´,ä»…ç¼ºå‰ç«¯æŒ‰é’®
3. âœ… æ–°æ‰‹ä»»åŠ¡ç³»ç»Ÿ - åç«¯å®Œæ•´,ä»…ç¼ºå‰ç«¯å±•ç¤º
4. âœ… Webhookå¹‚ç­‰å¤„ç† - ç”Ÿäº§çº§å®ç°

---

## ğŸ“Š å®šä»·é…ç½®å†³ç­– (å·²ç¡®è®¤)

æ ¹æ®æ‚¨çš„å†³ç­–,ç»Ÿä¸€å®šä»·å¦‚ä¸‹:

| äº§å“/æœåŠ¡ | æœ€ç»ˆå®šä»· | åŸæ–‡æ¡£å»ºè®® | å½“å‰ä»£ç  | éœ€ä¿®æ”¹ |
|-----------|----------|------------|----------|--------|
| **ç²¾åæŠ¥å‘Š** | **99ç§¯åˆ†** | 99ç§¯åˆ† âœ… | 120ç§¯åˆ† âŒ | âœ… æ”¹ä¸º99 |
| **15åˆ†é’Ÿä¼šè¯** | **15ç§¯åˆ†** | 10ç§¯åˆ† | 40ç§¯åˆ† âŒ | âœ… æ”¹ä¸º15 |
| **å•æ¬¡Chat** | 5ç§¯åˆ† | 5ç§¯åˆ† âœ… | 5ç§¯åˆ† âœ… | æ— éœ€ä¿®æ”¹ |

### å®šä»·é€»è¾‘ (æ‚¨çš„å†³ç­–)
\\\
ä¼šè¯åˆ¶Chat: 15ç§¯åˆ†/15åˆ†é’Ÿ = 1ç§¯åˆ†/åˆ†é’Ÿ
          = .10/åˆ†é’Ÿ (1ç§¯åˆ†â‰ˆ.10)
          = æŠ˜åçº¦.05-0.07/åˆ†é’Ÿ (ç”¨æˆ·è¶…å€¼æ„Ÿ)

ç§¯åˆ†æ¶ˆè€—æ–¹å¼: 
- ä¼˜å…ˆæ‰£é™¤è´¦æˆ·ç§¯åˆ†
- ç§¯åˆ†ä¸è¶³æ—¶å¼¹å‡ºå……å€¼çª—å£
- ç”¨æˆ·æ¸…æ™°æ„ŸçŸ¥\"èŠ±å¤šå°‘é’±è§£å†³å¤šå°‘é—®é¢˜\"
\\\

### éœ€ä¿®æ”¹çš„æ–‡ä»¶
\\\	ypescript
// ğŸ“ src/config/qiflow-pricing.ts
export const QIFLOW_PRICING = {
  reportEssential: 99,        // ä» 120 æ”¹ä¸º 99
  chatSession15Min: 15,       // ä» 40 æ”¹ä¸º 15
  // ...å…¶ä»–ä¿æŒä¸å˜
}
\\\

---

## ğŸ” è¯¦ç»†ä»»åŠ¡æ¸…å• (æŒ‰v4.0æŠ¥å‘Šç« èŠ‚)

### 1ï¸âƒ£ P0 å®‰å…¨åˆè§„ (å®Œæˆåº¦: 80%)

| ä»»åŠ¡ | çŠ¶æ€ | ä»£ç ä½ç½® | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|----------|------|--------|
| TurnstileéªŒè¯ç  | âš ï¸ å¼€å‘ä¸­åˆç†å…³é—­ | \website.ts:21\ | ç”Ÿäº§ç¯å¢ƒéœ€å¼€å¯ | P0ä¸Šçº¿å‰ |
| Webhookå¹‚ç­‰è®¾è®¡ | âœ… **å·²å®Œæˆ** | \stripe.ts:544-564\ | ä½¿ç”¨event IDå»é‡,å®Œç¾å®ç° | âœ… Done |
| AIåˆè§„å‰ç¼€ | âœ… **å·²å®Œæˆ** | \ssential-report.ts:201\ | ä½¿ç”¨\ddComplianceConstraints()\ | âœ… Done |
| æˆæœ¬ç›‘æ§å‘Šè­¦ | âŒ æœªå®ç° | ç¼ºå°‘ \cost-guard.ts\ | éœ€å®ç°æ¯æ—¥ | P0 |

**ä»£ç è¯æ®**:
\\\	ypescript
// âœ… Webhookå¹‚ç­‰å·²å®Œç¾å®ç°
const existingEvent = await db.query.stripeWebhookEvents.findFirst({
  where: eq(stripeWebhookEvents.id, eventId),
});
if (existingEvent) {
  console.log(\[Webhook] Event \ already processed\);
  return; // å¹‚ç­‰è·³è¿‡
}

// âœ… AIåˆè§„å‰ç¼€å·²é›†æˆ
const prompt = addComplianceConstraints(basePrompt);
const complianceCheck = checkAICompliance({
  userInput, aiOutput: result.text
});
\\\

**å¾…å®Œæˆ**:
- [ ] åˆ›å»º \src/lib/cost-guard.ts\ å®ç°æˆæœ¬ç›‘æ§
- [ ] æ·»åŠ ç¯å¢ƒå˜é‡: \NEXT_PUBLIC_ENABLE_TURNSTILE=true\ (ç”Ÿäº§)
- [ ] Stagingç¯å¢ƒæµ‹è¯•Turnstileæµç¨‹

---

### 2ï¸âƒ£ æŠ¥å‘Šç”Ÿæˆä¸AIå®¡æ ¸ (å®Œæˆåº¦: 90%)

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | ä»£ç è·¯å¾„ | å®Œæˆåº¦ | è¯´æ˜ |
|----------|------|----------|--------|------|
| æŠ¥å‘Šå®šä»·é…ç½® | âš ï¸ éœ€ä¿®æ”¹ | \qiflow-pricing.ts:14-15\ | 80% | 120â†’99ç§¯åˆ† |
| æŠ¥å‘Šç”Ÿæˆå¼•æ“ | âœ… å·²å®Œæˆ | \ssential-report.ts\ | 95% | 5æ­¥æµç¨‹å®Œæ•´ |
| è´­ä¹°æµç¨‹(ç§¯åˆ†) | âœ… å·²å®Œæˆ | \purchase-report-with-credits.ts\ | 100% | å¹‚ç­‰+å›æ»šå®Œç¾ |
| è´¨é‡å®¡æ ¸ | âš ï¸ ç®€åŒ–ç‰ˆ | \ssential-report.ts:291-314\ | 60% | ä»…é•¿åº¦æ£€æŸ¥ |
| æ•°æ®åº“è¡¨ | âœ… å·²å»º | \schema.ts\ | 100% | \qiflowReports\è¡¨ |
| PDFå¯¼å‡º | âœ… å·²å®Œæˆ | \scripts/export-sample-pdf.ts\ | 100% | æœ‰ç¤ºä¾‹è„šæœ¬ |

**ä»£ç äº®ç‚¹**:
\\\	ypescript
// âœ… æŠ¥å‘Šç”Ÿæˆ: 3ä¸»é¢˜å¹¶å‘ + AIè´¨é‡å®¡æ ¸
const themes: ThemeContent[] = await Promise.all(
  selectedThemes.map(async (themeId) => {
    const storyResult = await generateThemeStory({ themeId, baziData, flyingStarData });
    const synthesisResult = await generateThemeSynthesis({ themeId, story, baziData });
    return { id: themeId, title, story, synthesis, recommendations };
  })
);

// âœ… è´­ä¹°æµç¨‹: å®Œæ•´å¹‚ç­‰ + å¤±è´¥è‡ªåŠ¨é€€æ¬¾
try {
  await creditsManager.deduct(userId, price);
  const reportOutput = await generateEssentialReport(input);
  await db.update(qiflowReports).set({ status: 'completed', output });
} catch (genError) {
  await creditsManager.addCredits(userId, price); // è‡ªåŠ¨é€€æ¬¾
  await db.update(qiflowReports).set({ status: 'failed' });
}
\\\

**å¾…å®Œæˆ**:
- [ ] ä¿®æ”¹å®šä»·: \eportEssential: 120\ â†’ \99\
- [ ] å¢å¼ºè´¨é‡å®¡æ ¸: å¯é€‰æ·»åŠ AIäºŒæ¬¡å®¡æ ¸(æˆæœ¬<.005)
- [ ] å‰ç«¯æŠ¥å‘Šè´­ä¹°é¡µé¢: \src/app/(dashboard)/reports/essential/buy/page.tsx\

---

### 3ï¸âƒ£ ä¸¤é˜¶æ®µA/Bæµ‹è¯• (å®Œæˆåº¦: 5%)

| åŠŸèƒ½ | çŠ¶æ€ | ä»£ç ä½ç½® | è¯´æ˜ |
|------|------|----------|------|
| ABæµ‹è¯•æ•°æ®åº“è¡¨ | âœ… å·²å»º | \schema.ts\ | \bTestExperiments/Assignments/Events\è¡¨ |
| åˆ†ç»„èµ‹å€¼é€»è¾‘ | âŒ ä¸å­˜åœ¨ | ç¼ºå°‘ \ssignABGroup\ | æ³¨å†Œæ—¶æœªåˆ†ç»„ |
| ä»»åŠ¡å¥–åŠ±åˆ‡æ¢ | âŒ ä¸å­˜åœ¨ | \website.ts:94\ | å›ºå®š70ç§¯åˆ†,æ— A/Båˆ‡æ¢ |
| ç›‘æ§è„šæœ¬ | âŒ ä¸å­˜åœ¨ | ç¼ºå°‘ \b-test-monitor.ts\ | æ— æ•°æ®ç›‘æ§ |
| å‰ç«¯ABç»„æ ‡è¯† | âŒ ä¸å­˜åœ¨ | - | ç”¨æˆ·metadataæ— \bGroup\å­—æ®µ |

**å½“å‰é…ç½®** (å›ºå®š,æœªåˆ†ç»„):
\\\	ypescript
// src/config/website.ts
registerGiftCredits: { amount: 70, expireDays: 30 }  // å›ºå®šå€¼
\\\

**v4.0æŠ¥å‘Šå»ºè®®** (æœªå®ç°):
\\\
é˜¶æ®µ1:
  Aç»„: 70ç§¯åˆ†,æ— ä»»åŠ¡
  Bç»„: 50ç§¯åˆ† + ä»»åŠ¡(æ€»250)

é˜¶æ®µ2 (Bç»„èƒœå‡ºå):
  Aç»„: é˜¶æ®µ1èƒœè€…
  Bç»„: 150ç§¯åˆ†æ…·æ…¨ä½“éªŒ
\\\

**å¾…å®Œæˆ**:
- [ ] åˆ›å»º \src/lib/ab-test.ts\ å®ç°åˆ†ç»„é€»è¾‘
- [ ] ä¿®æ”¹æ³¨å†Œæµç¨‹é›†æˆåˆ†ç»„: \src/actions/signup.ts\
- [ ] åˆ›å»ºç›‘æ§è„šæœ¬: \scripts/ab-test-report.ts\
- [ ] å‰ç«¯ä»»åŠ¡ç³»ç»Ÿéœ€æ ¹æ®ABç»„æ˜¾ç¤º/éšè—

**å»ºè®®**: å¯å»¶ååˆ°æŠ¥å‘ŠPMFéªŒè¯åå†åš,ä¼˜å…ˆä¸Šçº¿æ ¸å¿ƒåŠŸèƒ½ã€‚

---

### 4ï¸âƒ£ æ–°æ‰‹å¼•å¯¼ä½“éªŒ (å®Œæˆåº¦: 85%)

| åŠŸèƒ½ | çŠ¶æ€ | ä»£ç è·¯å¾„ | å®Œæˆåº¦ |
|------|------|----------|--------|
| åç«¯API | âœ… å·²å®Œæˆ | \/api/missions/newbie/route.ts\ | 100% |
| ä»»åŠ¡å®šä¹‰ | âœ… å·²å®Œæˆ | \
ewbie-missions.ts\ | 100% |
| é¢†å¥–API | âœ… å·²å®Œæˆ | \claimMissionReward()\ | 100% |
| ä»»åŠ¡è¿›åº¦è¿½è¸ª | âœ… å·²å®Œæˆ | \	askProgress\è¡¨ + è‡ªåŠ¨æ£€æµ‹ | 100% |
| å‰ç«¯Bannerç»„ä»¶ | âŒ ä¸å­˜åœ¨ | ç¼ºå°‘ \OnboardingBanner.tsx\ | 0% |
| è‡ªåŠ¨å®Œæˆé’©å­ | âŒ ä¸å­˜åœ¨ | å…«å­—/é£æ°´/Chatå®Œæˆåæœªè§¦å‘ | 0% |

**å½“å‰ä»»åŠ¡åˆ—è¡¨** (ä»£ç å®é™…å€¼):
\\\	ypescript
// src/lib/newbie-missions.ts
export const NEWBIE_MISSIONS = [
  { id: 'complete_profile',     reward: 20, title: 'å®Œå–„ä¸ªäººèµ„æ–™' },
  { id: 'first_bazi_analysis',  reward: 30, title: 'é¦–æ¬¡å…«å­—åˆ†æ' },
  { id: 'bind_social_account',  reward: 15, title: 'ç»‘å®šç¤¾äº¤è´¦å·' },
  { id: 'invite_friend',        reward: 50, title: 'é‚€è¯·å¥½å‹æ³¨å†Œ' },
  { id: 'share_analysis',       reward: 15, title: 'åˆ†äº«åˆ†æç»“æœ' },
];
// æ€»è®¡: 130ç§¯åˆ†
\\\

**v4.0æŠ¥å‘Šå»ºè®®**: é˜¶æ®µ1 Bç»„ä»»åŠ¡æ€»å¥–åŠ±250ç§¯åˆ†  
**å·®è·**: éœ€å¢åŠ 120ç§¯åˆ†å¥–åŠ±,æˆ–æ–°å¢ä»»åŠ¡

**ä»£ç äº®ç‚¹**:
\\\	ypescript
// âœ… é¢†å¥–å¹‚ç­‰è®¾è®¡å®Œç¾
if (!progress.completed || progress.rewardClaimed) {
  return { success: false, error: 'å¥–åŠ±å·²é¢†å–' };
}

// âœ… è‡ªåŠ¨è¿›åº¦æ£€æµ‹
const actualProgress = await mission.checkProgress(userId);
if (actualProgress > dbProgress.progress) {
  await db.update(taskProgress).set({ 
    progress: actualProgress, 
    completed: actualProgress >= mission.target 
  });
}
\\\

**å¾…å®Œæˆ**:
- [ ] åˆ›å»ºå‰ç«¯ç»„ä»¶: \src/components/onboarding/OnboardingBanner.tsx\
- [ ] é›†æˆåˆ°Dashboard: é¡¶éƒ¨Banneræ˜¾ç¤ºä»»åŠ¡è¿›åº¦
- [ ] æ·»åŠ è‡ªåŠ¨å®Œæˆé’©å­:
  - \src/app/api/qiflow/bazi/route.ts\ â†’ è§¦å‘\irst_bazi_analysis\
  - \src/app/api/qiflow/chat/route.ts\ â†’ è§¦å‘\irst_ai_chat\
- [ ] (å¯é€‰) è°ƒæ•´ä»»åŠ¡å¥–åŠ±è‡³250ç§¯åˆ†æ€»é¢

---

### 5ï¸âƒ£ AI Chatä¼˜åŒ–ä¸ä¼šè¯åˆ¶ (å®Œæˆåº¦: 70%)

| åŠŸèƒ½ | çŠ¶æ€ | ä»£ç è·¯å¾„ | å®Œæˆåº¦ |
|------|------|----------|--------|
| ä¼šè¯æ•°æ®åº“è¡¨ | âœ… å·²å»º | \schema.ts\ | 100% |
| åˆ›å»ºä¼šè¯Action | âœ… å·²å®Œæˆ | \create-chat-session.ts\ | 100% |
| ä¼šè¯çŠ¶æ€æŸ¥è¯¢ | âœ… å·²å®Œæˆ | \get-chat-session-status.ts\ | 100% |
| ä¼šè¯ç»­è´¹ | âœ… å·²å®Œæˆ | \enew-chat-session.ts\ | 100% |
| ä¼šè¯å®šä»·é…ç½® | âš ï¸ éœ€ä¿®æ”¹ | \qiflow-pricing.ts:18\ | 80% |
| Chatè·¯ç”±å®ˆå« | âš ï¸ å¾…éªŒè¯ | \/api/qiflow/chat/route.ts\ | 50% |
| å‰ç«¯ä¼šè¯UI | âŒ ä¸å­˜åœ¨ | ç¼ºå°‘è´­ä¹°æŒ‰é’®+å€’è®¡æ—¶ | 0% |

**å½“å‰é…ç½® vs æœ€ç»ˆå†³ç­–**:
\\\	ypescript
// å½“å‰ä»£ç 
const SESSION_COST = 40; // ç§¯åˆ†
const SESSION_DURATION_MS = 15 * 60 * 1000; // 15åˆ†é’Ÿ

// éœ€ä¿®æ”¹ä¸º
const SESSION_COST = 15; // ç§¯åˆ† (æ‚¨çš„å†³ç­–: 1ç§¯åˆ†/åˆ†é’Ÿ)
\\\

**ä»£ç äº®ç‚¹**:
\\\	ypescript
// âœ… ä¼šè¯åˆ›å»ºå®Œæ•´å®ç°
export async function createChatSessionAction() {
  // 1. æ£€æŸ¥ç§¯åˆ†
  const balance = await creditsManager.getBalance(userId);
  if (balance < SESSION_COST) {
    return { success: false, errorCode: 'INSUFFICIENT_CREDITS' };
  }
  
  // 2. æ‰£é™¤ç§¯åˆ†
  await creditsManager.deduct(userId, SESSION_COST, {
    type: CREDIT_TRANSACTION_TYPE.CHAT_SESSION_START,
  });
  
  // 3. åˆ›å»ºä¼šè¯
  const expiresAt = new Date(Date.now() + SESSION_DURATION_MS);
  await db.insert(chatSessions).values({
    userId, startedAt, expiresAt, messageCount: 0, status: 'active'
  });
}
\\\

**å¾…å®Œæˆ**:
- [ ] ä¿®æ”¹å®šä»·: \SESSION_COST = 40\ â†’ \15\
- [ ] ä¿®æ”¹é…ç½®: \qiflow-pricing.ts\ ä¸­ \chatSession15Min: 40\ â†’ \15\
- [ ] éªŒè¯Chatè·¯ç”±å®ˆå«: ä¼šè¯å†…æ˜¯å¦å…æ‰£å•æ¡5ç§¯åˆ†
- [ ] åˆ›å»ºå‰ç«¯ç»„ä»¶: \"å¼€å¯15åˆ†é’Ÿæ·±åº¦å¯¹è¯(15ç§¯åˆ†)\"æŒ‰é’®
- [ ] æ·»åŠ å€’è®¡æ—¶UI: \"å‰©ä½™12:34\"
- [ ] ç§¯åˆ†ä¸è¶³æ—¶å¼¹çª—: å¼•å¯¼å……å€¼

---

### 6ï¸âƒ£ RAGçŸ¥è¯†åº“é›†æˆ (å®Œæˆåº¦: 50%)

| åŠŸèƒ½ | çŠ¶æ€ | ä»£ç è·¯å¾„ | å®Œæˆåº¦ |
|------|------|----------|--------|
| RAGæ ¸å¿ƒæ¨¡å— | âœ… å·²å®Œæˆ | \lib/rag/\ | 100% |
| Text Chunker | âœ… å·²å®Œæˆ | \	ext-chunker.ts\ | 100% |
| EmbeddingæœåŠ¡ | âœ… å·²å®Œæˆ | \mbedding-service.ts\ | 100% |
| å‘é‡æœç´¢ | âœ… å·²å®Œæˆ | \ector-search.ts\ | 100% |
| RAGç”Ÿæˆå™¨ | âœ… å·²å®Œæˆ | \ag-generator.ts\ | 100% |
| æ•°æ®æ‘„å–è„šæœ¬ | âŒ ä¸å­˜åœ¨ | ç¼ºå°‘æ‘„å–å‘½ä»¤ | 0% |
| Chaté›†æˆRAG | âŒ ä¸å­˜åœ¨ | \/api/qiflow/chat\æœªè°ƒç”¨ | 0% |
| çŸ¥è¯†åº“æ•°æ® | âŒ ä¸å­˜åœ¨ | å‘é‡æ•°æ®åº“ä¸ºç©º | 0% |

**åŸºç¡€è®¾æ–½å®Œæ•´**:
\\\	ypescript
// âœ… RAGæ¨¡å—å¯¼å‡ºå®Œæ•´
export {
  TextChunker, chunkText,           // æ–‡æœ¬åˆ†å—
  EmbeddingService, embedText,      // Embedding
  VectorSearchService, quickSearch, // å‘é‡æ£€ç´¢
  RAGGenerator, quickRAG,           // RAGç”Ÿæˆ
}
\\\

**v4.0æŠ¥å‘Šå»ºè®®** (æœªå®ç°):
\\\
æ•°æ®æ¥æº:
1. D:\\Desktop\\mksaas_qiflowaiç»ˆä¼˜\\*.md (ä½ çš„ä¼˜åŒ–æ–‡æ¡£)
2. ã€Šæ»´å¤©é«“ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ç²¾é€‰ç« èŠ‚
3. æ€»é‡: â‰¤50ä¸‡tokens, Embeddingæˆæœ¬<

é›†æˆæ–¹å¼:
- topK=3 æ§åˆ¶ä¸Šä¸‹æ–‡
- æ ‡æ³¨å‡ºå¤„: \"æ ¹æ®ã€Šæ»´å¤©é«“ã€‹...\"
- tokenæ¶ˆè€—å¢åŠ â‰¤20%
\\\

**å¾…å®Œæˆ**:
- [ ] åˆ›å»ºæ•°æ®æ‘„å–è„šæœ¬: \scripts/ingest-knowledge-base.ts\
- [ ] ç´¢å¼•ä¼˜åŒ–æ–‡æ¡£: \D:\\Desktop\\mksaas_qiflowaiç»ˆä¼˜\\*.md\
- [ ] ç´¢å¼•ç»å…¸å…¸ç±: 2-3éƒ¨ç²¾é€‰ç« èŠ‚
- [ ] ä¿®æ”¹Chatè·¯ç”±: é›†æˆ\quickRAG()\è°ƒç”¨
- [ ] æ·»åŠ å¼•ç”¨æ ‡æ³¨: å›ç­”ä¸­æ ‡æ³¨çŸ¥è¯†æ¥æº
- [ ] æˆæœ¬ç›‘æ§: tokenæ¶ˆè€—ä¸è¶…20%

**å»ºè®®**: Week 2-3ä¼˜å…ˆçº§é«˜,èƒ½æ˜¾è‘—æå‡å›ç­”æƒå¨æ€§ã€‚

---

### 7ï¸âƒ£ è®¢é˜…ç•™å­˜ç­–ç•¥ (å®Œæˆåº¦: 10%)

| åŠŸèƒ½ | çŠ¶æ€ | ä»£ç è·¯å¾„ | å®Œæˆåº¦ |
|------|------|----------|--------|
| æœˆåº¦è¿åŠ¿è¡¨ | âœ… å·²å»º | \schema.ts\ \monthlyFortunes\ | 100% |
| æœˆåº¦åˆ†æç”Ÿæˆå™¨ | âŒ ä¸å­˜åœ¨ | ç¼ºå°‘ \monthly-analysis.ts\ | 0% |
| Cronå®šæ—¶ä»»åŠ¡ | âŒ ä¸å­˜åœ¨ | æ— è‡ªåŠ¨ç”Ÿæˆé€»è¾‘ | 0% |
| å‰ç«¯ä»ªè¡¨ç›˜ | âŒ ä¸å­˜åœ¨ | æ— Proä¼šå‘˜ä»ªè¡¨ç›˜é¡µé¢ | 0% |
| é€šçŸ¥æ¨é€ | âŒ ä¸å­˜åœ¨ | æ— é‚®ä»¶/ç«™å†…é€šçŸ¥ | 0% |

**v4.0æŠ¥å‘Šå»ºè®®**:
\\\
åŠ¨æ€è¿åŠ¿ä»ªè¡¨ç›˜:
- ä»Šæ—¥è¿åŠ¿å¡ç‰‡ (æµæ—¥åˆ†æ)
- æœ¬æœˆè¶‹åŠ¿å›¾ (æµæœˆåˆ†æ)
- æµå¹´æ¦‚è§ˆ (å¹´åº¦åˆ†æ)
- äººå®…ç»“åˆå»ºè®® (Proç‹¬äº«)

Cronä»»åŠ¡:
- æ¯æœˆ1æ—¥: ç”Ÿæˆæœˆåº¦åˆ†æ
- æ¯æ—¥å‡Œæ™¨: ç”Ÿæˆæ—¥åº¦åˆ†æ (äºŒæœŸ)
\\\

**å¾…å®Œæˆ**:
- [ ] åˆ›å»ºç”Ÿæˆå™¨: \src/lib/qiflow/fortune/monthly-analysis.ts\
- [ ] åˆ›å»ºCronä»»åŠ¡: \src/app/api/cron/monthly-fortune/route.ts\
- [ ] å‰ç«¯ä»ªè¡¨ç›˜é¡µé¢: \src/app/(dashboard)/fortune/page.tsx\
- [ ] é›†æˆé€šçŸ¥: Vercel Cron + Resendé‚®ä»¶
- [ ] æƒé™æ§åˆ¶: Proä¼šå‘˜ä¸“å±

**å»ºè®®**: Month 3-4å†åš,å…ˆéªŒè¯Proç”¨æˆ·åŸºæ•°(>100)ã€‚

---

### 8ï¸âƒ£ å®¶åº­ç‰ˆè®¢é˜…è®¾è®¡ (å®Œæˆåº¦: 0%)

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| å®¶åº­ç»„Schema | âŒ ä¸å­˜åœ¨ | æ— å®¶åº­ç»„/æˆå‘˜è¡¨ |
| AIå¤šç›®æ ‡ä¼˜åŒ– | âŒ ä¸å­˜åœ¨ | æ— åè°ƒå™¨Prompt |
| Stripeå®¶åº­è®¡åˆ’ | âŒ ä¸å­˜åœ¨ | æ— -39å®šä»· |
| å‰ç«¯ç®¡ç†ç•Œé¢ | âŒ ä¸å­˜åœ¨ | æ— å®¶åº­æˆå‘˜ç®¡ç† |

**v4.0æŠ¥å‘Šå»ºè®®**: -39/æœˆæ”¯æŒ5äºº

**å»ºè®®**: Month 4-5å†åš,å…ˆéªŒè¯å•äººç‰ˆPMFã€‚

---

### 9ï¸âƒ£ æ¶æ„æ¼”è¿›å‡†å¤‡ (å®Œæˆåº¦: 20%)

| ç›®æ ‡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æœåŠ¡åŒ–æ‹†åˆ† | âŒ æœªåš | æœªæ‹†åˆ†AlgorithmService/AIService |
| Orchestrator | âŒ æœªåš | æ— ç¼–æ’å±‚ |
| å¤šæ™ºèƒ½ä½“Schema | âŒ æœªåš | æ— Conversation/Messageè¡¨ |

**å½“å‰æ¶æ„**: æ‰å¹³åŒ–,åŠŸèƒ½ç›´æ¥åœ¨APIè·¯ç”±å®ç°

**å»ºè®®**: Month 5-6å†åš,éåŠŸèƒ½æ€§ä¼˜åŒ–,ä¼˜å…ˆçº§P3ã€‚

---

## ğŸ¯ è¿‘æœŸè¡ŒåŠ¨è®¡åˆ’ (1-2å‘¨å¿«é€Ÿä¸Šçº¿)

### Week 1: ä¿®å¤é…ç½® + è¡¥é½å…³é”®UI

**Day 1-2: å®šä»·ç»Ÿä¸€** (2å°æ—¶)
\\\	ypescript
// ğŸ“ src/config/qiflow-pricing.ts
export const QIFLOW_PRICING = {
  reportEssential: 99,        // æ”¹: 120 â†’ 99
  chatSession15Min: 15,       // æ”¹: 40 â†’ 15
  // ...
}

// ğŸ“ src/actions/chat/create-chat-session.ts
const SESSION_COST = 15;      // æ”¹: 40 â†’ 15
\\\

**Day 3-4: æ–°æ‰‹ä»»åŠ¡å‰ç«¯** (1å¤©)
- [ ] åˆ›å»º \src/components/onboarding/OnboardingBanner.tsx\
- [ ] é›†æˆåˆ°Dashboardå¸ƒå±€
- [ ] æ˜¾ç¤ºä»»åŠ¡è¿›åº¦æ¡ + \"ç«‹å³å®Œæˆ\"æŒ‰é’®

**Day 5-7: ä¼šè¯Chatå‰ç«¯** (1å¤©)
- [ ] æ·»åŠ è´­ä¹°æŒ‰é’®: \"å¼€å¯15åˆ†é’Ÿæ·±åº¦å¯¹è¯(15ç§¯åˆ†)\"
- [ ] å€’è®¡æ—¶ç»„ä»¶: \"å‰©ä½™12:34\"
- [ ] ç§¯åˆ†ä¸è¶³å¼¹çª—: å¼•å¯¼å……å€¼

### Week 2: RAGé›†æˆ + æˆæœ¬ç›‘æ§

**Day 1-3: RAGæ•°æ®æ‘„å–** (2å¤©)
- [ ] åˆ›å»º \scripts/ingest-knowledge-base.ts\
- [ ] ç´¢å¼•ä¼˜åŒ–æ–‡æ¡£(mksaas_qiflowaiç»ˆä¼˜æ–‡ä»¶å¤¹)
- [ ] ç´¢å¼•2-3éƒ¨å…¸ç±ç²¾é€‰ç« èŠ‚

**Day 4-5: Chaté›†æˆRAG** (1å¤©)
- [ ] ä¿®æ”¹ \/api/qiflow/chat/route.ts\
- [ ] æ·»åŠ  \nswerWithRAG(question, topK=3)\
- [ ] æ ‡æ³¨å¼•ç”¨æ¥æº

**Day 6-7: æˆæœ¬ç›‘æ§** (1å¤©)
- [ ] åˆ›å»º \src/lib/cost-guard.ts\
- [ ] æ¯æ—¥ç›‘æ§: >, â‰¥
- [ ] ç”¨æˆ·çº§å¼‚å¸¸æ£€æµ‹: å•ç”¨æˆ·æ—¥æ¶ˆè€—>

---

## ğŸ“ˆ ä¸Šçº¿å‰æ£€æŸ¥æ¸…å•

### P0 å¿…é¡»å®Œæˆ (é˜»å¡ä¸Šçº¿)
- [ ] å®šä»·é…ç½®ç»Ÿä¸€: æŠ¥å‘Š99ç§¯åˆ†, ä¼šè¯15ç§¯åˆ†
- [ ] æˆæœ¬ç›‘æ§å‘Šè­¦: æ¯æ—¥/
- [ ] Turnstileç”Ÿäº§å¯†é’¥é…ç½®
- [ ] Stripeç”Ÿäº§ç¯å¢ƒWebhookæµ‹è¯•
- [ ] AIæ¨¡å‹APIå¯†é’¥é¢åº¦æ£€æŸ¥

### P1 å¼ºçƒˆå»ºè®® (å½±å“ä½“éªŒ)
- [ ] æ–°æ‰‹ä»»åŠ¡å‰ç«¯Banner
- [ ] ä¼šè¯Chatè´­ä¹°æŒ‰é’®+å€’è®¡æ—¶
- [ ] RAGçŸ¥è¯†åº“æ•°æ®æ‘„å–
- [ ] ç§¯åˆ†ä¸è¶³æ—¶å……å€¼å¼•å¯¼å¼¹çª—

### P2 å¯å»¶å (ä¸é˜»å¡ä¸Šçº¿)
- [ ] A/Bæµ‹è¯•ç³»ç»Ÿ
- [ ] åŠ¨æ€è¿åŠ¿ä»ªè¡¨ç›˜
- [ ] å®¶åº­ç‰ˆè®¢é˜…
- [ ] æ¶æ„æœåŠ¡åŒ–é‡æ„

---

## ğŸ’¡ æ€»ç»“ä¸å»ºè®®

### âœ… åšå¾—å¥½çš„åœ°æ–¹
1. **æ ¸å¿ƒå˜ç°è·¯å¾„æ‰“é€š**: æŠ¥å‘Šè´­ä¹°(ç§¯åˆ†æ”¯ä»˜)åŠŸèƒ½å®Œæ•´ä¸”ä»£ç è´¨é‡é«˜
2. **å¹‚ç­‰è®¾è®¡å®Œå–„**: Webhook/ä»»åŠ¡é¢†å¥–/æŠ¥å‘Šè´­ä¹°å‡æœ‰é˜²é‡æœºåˆ¶
3. **æŠ€æœ¯åŸºç¡€æ‰å®**: Credits Manager/PDFç”Ÿæˆ/ä¼šè¯ç®¡ç†å‡å·²å®ç°
4. **æ•°æ®åº“è®¾è®¡å‰ç»**: å·²ä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™è¡¨(ABæµ‹è¯•/æœˆåº¦è¿åŠ¿ç­‰)

### âš ï¸ éœ€å…³æ³¨çš„é—®é¢˜
1. **å‰ç«¯UIç¼ºå¤±è¾ƒå¤š**: 80%åŠŸèƒ½ä»…æœ‰åç«¯,ç”¨æˆ·æ— æ³•ç›´æ¥ä½¿ç”¨
2. **A/Bæµ‹è¯•æœªå®ç°**: è™½æœ‰Schemaä½†æ— ä¸šåŠ¡é€»è¾‘,æŠ¥å‘Šå»ºè®®æ— æ³•æ‰§è¡Œ
3. **RAGçŸ¥è¯†åº“ç©ºç½®**: åŸºç¡€è®¾æ–½å®Œæ•´ä½†æ— æ•°æ®,Chatå›ç­”æƒå¨æ€§å—é™
4. **å®šä»·é…ç½®ä¸ä¸€è‡´**: ä»£ç ä¸æ–‡æ¡£å·®å¼‚è¾ƒå¤§,å·²æ ¹æ®æ‚¨çš„å†³ç­–æ˜ç¡®

### ğŸ¯ æ‰§è¡Œå»ºè®®

**ç«‹å³è¡ŒåŠ¨** (æœ¬å‘¨):
1. ä¿®æ”¹å®šä»·é…ç½® (2å°æ—¶)
2. æ·»åŠ æ–°æ‰‹ä»»åŠ¡Banner (1å¤©)
3. æ·»åŠ ä¼šè¯ChatæŒ‰é’® (1å¤©)

**Week 2 ä¼˜å…ˆ**:
4. RAGæ•°æ®æ‘„å–+Chaté›†æˆ (2å¤©)
5. æˆæœ¬ç›‘æ§å‘Šè­¦ (1å¤©)

**å¯å»¶å** (éªŒè¯PMFå):
6. A/Bæµ‹è¯•ç³»ç»Ÿ (ç­‰æœ‰è¶³å¤Ÿæµé‡å†åš)
7. åŠ¨æ€ä»ªè¡¨ç›˜ (ç­‰Proç”¨æˆ·>100)
8. å®¶åº­ç‰ˆ/æ¶æ„é‡æ„ (Month 3+)

### ğŸš€ ç»“è®º

é¡¹ç›®å·²å®Œæˆ**60-65%æ ¸å¿ƒåŠŸèƒ½**,**æŠ¥å‘Šäº§å“å˜ç°è·¯å¾„å®Œå…¨æ‰“é€š**,æŠ€æœ¯å€ºåŠ¡ä½,ä»£ç è´¨é‡é«˜ã€‚

å»ºè®®ç­–ç•¥: **å…ˆç”¨å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½å¿«é€Ÿä¸Šçº¿éªŒè¯å¸‚åœºååº”**,1-2å‘¨å†…è¡¥é½å…³é”®UIåå³å¯æ¨å‘å¸‚åœºã€‚A/Bæµ‹è¯•ç­‰é«˜çº§åŠŸèƒ½å¯åœ¨PMFéªŒè¯åé€æ­¥å®Œå–„ã€‚

---

**è¯„å®¡äºº**: AI Assistant  
**ä¸‹æ¬¡è¯„å®¡**: 2å‘¨å (æ ¸å¿ƒUIè¡¥é½å)

