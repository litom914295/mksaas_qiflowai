# QiFlowAI é¡¹ç›®ç«äº‰åŠ›åˆ†æä¸ä¼˜åŒ–æŠ¥å‘Š v4.0 (å®æ–½ç‰ˆ)

**ç”Ÿæˆæ—¥æœŸ**: 2025-01-15 (v4.0æ›´æ–°)  
**é¡¹ç›®åç§°**: mksaas_qiflowai (QiFlowAI)  
**æ ¸å¿ƒç›®æ ‡**: å…è´¹è·å®¢ â†’ ä»˜è´¹è½¬åŒ– â†’ è®¢é˜…ç•™å­˜ â†’ ç”Ÿæ€æ„å»º  
**æ‰§è¡Œå‘¨æœŸ**: ä¸Šçº¿å‰1å‘¨ + ä¸Šçº¿å6ä¸ªæœˆ(åˆ†é˜¶æ®µæ¨è¿›)  
**æŠ¥å‘ŠåŸºç¡€**: å…¨é¢ä»£ç å®¡è®¡ + 8ç‚¹æ ¸å¿ƒå»ºè®® + å¯è¡Œæ€§è¯„å®¡ + MVPæ”¶æ•›

**v4.0æ ¸å¿ƒä¼˜åŒ–**:  
âœ… A/B/Cç®€åŒ–ä¸ºã€Œä¸¤é˜¶æ®µA/Bã€,é™ä½å®éªŒå¤æ‚åº¦  
âœ… MVPæ”¶æ•›: æŠ¥å‘Šä¸¤æ¡£/Chatå•æ¡£/ä»»åŠ¡ä½é…,å…ˆéªŒè¯æ ¸å¿ƒé€»è¾‘  
âœ… ä¼˜å…ˆçº§é‡æ’: å®‰å…¨â†’è½¬åŒ–â†’äº’åŠ¨â†’ç•™å­˜â†’é‡æ„  
âœ… é£é™©æ§åˆ¶å¼ºåŒ–: æˆæœ¬é˜ˆå€¼/å¹‚ç­‰è®¾è®¡/åˆè§„å‰ç½®

---

## ğŸ“‹ ç›®å½•

1. [é…ç½®å¯¹é½ä¸ç°çŠ¶è¯Šæ–­](#é…ç½®å¯¹é½ä¸ç°çŠ¶è¯Šæ–­)
2. [A/B/Cæµ‹è¯•ä¼˜åŒ–æ–¹æ¡ˆ](#abcæµ‹è¯•ä¼˜åŒ–æ–¹æ¡ˆ)
3. [æ–°æ‰‹å¼•å¯¼ä½“éªŒå®Œå–„](#æ–°æ‰‹å¼•å¯¼ä½“éªŒå®Œå–„)
4. [æŠ¥å‘Šç”Ÿæˆä¸AIå®¡æ ¸](#æŠ¥å‘Šç”Ÿæˆä¸aiå®¡æ ¸)
5. [AI Chatä¼˜åŒ–ä¸RAGé›†æˆ](#ai-chatä¼˜åŒ–ä¸ragé›†æˆ)
6. [è®¢é˜…ç•™å­˜ç­–ç•¥](#è®¢é˜…ç•™å­˜ç­–ç•¥)
7. [å®¶åº­ç‰ˆè®¢é˜…è®¾è®¡](#å®¶åº­ç‰ˆè®¢é˜…è®¾è®¡)
8. [é¢å‘æœªæ¥çš„æ¶æ„æ¼”è¿›](#é¢å‘æœªæ¥çš„æ¶æ„æ¼”è¿›)
9. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)

---

## ğŸ¯ é…ç½®å¯¹é½ä¸ç°çŠ¶è¯Šæ–­

### å½“å‰ç³»ç»Ÿé…ç½®åŸºçº¿ (å·²éªŒè¯)

```typescript
// ğŸ“ src/config/website.ts - æ ¸å¿ƒé…ç½®æ–‡ä»¶
å½“å‰çŠ¶æ€:
âœ… æ³¨å†Œç¤¼: 70ç§¯åˆ† (registerGiftCredits.amount: 70)
âœ… æ¯æ—¥ç­¾åˆ°: 10-30ç§¯åˆ†éšæœº (dailySignin: min 10, max 30)
âœ… æ¨èå¥–åŠ±: é‚€è¯·äºº50 + è¢«é‚€è¯·äºº50 (referral.inviterCredits/inviteeCredits)
âœ… åˆ†äº«å¥–åŠ±: 10ç§¯åˆ†/æ¬¡,æ¯æ—¥ä¸Šé™5æ¬¡ (growth.share.rewardCredits: 10)
âœ… æ–°æ‰‹ä»»åŠ¡: ğŸ¯ å·²æœ‰API `/api/missions/newbie` å’Œ `getUserNewbieMissions()`
âœ… AI Chat: 5ç§¯åˆ†/æ¬¡ (qiflow-pricing.ts: aiChat: 5)
âœ… PDFå¯¼å‡º: å·²æœ‰è„šæœ¬ scripts/export-sample-pdf.ts
âŒ TurnstileéªŒè¯: æœªå¯ç”¨ (enableTurnstileCaptcha: false)

// ğŸ“ src/config/qiflow-pricing.ts - åŠŸèƒ½å®šä»·
aiChat: 5          // AIå¯¹è¯
bazi: 10           // å…«å­—åˆ†æ
xuankong: 20       // ç„ç©ºé£æ°´
deepInterpretation: 30  // æ·±åº¦è§£è¯»
pdfExport: 5       // PDFå¯¼å‡º

// è®¢é˜…è®¡åˆ’
Proä¼šå‘˜: $9.90/æœˆ (300ç§¯åˆ†/æœˆ) | $99/å¹´
ç»ˆèº«ç‰ˆ: $199 (500ç§¯åˆ†/æœˆç»ˆèº«)
```

### æ ¸å¿ƒé—®é¢˜ä¸æœºé‡

**âŒ å½“å‰ç—›ç‚¹:**
1. **è·å®¢æˆæœ¬é«˜**: 70ç§¯åˆ†åªå¤Ÿ1-2æ¬¡å®Œæ•´åˆ†æ,ç”¨æˆ·åˆšä½“éªŒå°±æµå¤±
2. **ä»·å€¼æ„ŸçŸ¥å¼±**: ç¼ºå°‘æ˜ç¡®çš„"ä»˜è´¹æŠ¥å‘Šäº§å“",ç”¨æˆ·ä¸çŸ¥é“ä¸ºä½•ä»˜è´¹
3. **AI Chatä½“éªŒå·®**: 5ç§¯åˆ†/æ¬¡è®©ç”¨æˆ·"å®³æ€•æé—®",æ— æ³•å»ºç«‹æ·±åº¦äº’åŠ¨
4. **ç•™å­˜æœºåˆ¶ç¼ºå¤±**: è®¢é˜…Proåæ— æŒç»­ä»·å€¼äº¤ä»˜,æµå¤±ç‡é«˜
5. **ä¼ æ’­åŠ¨åŠ›ä¸è¶³**: é‚€è¯·å¥–åŠ±50+50å¤ªä¿å®ˆ,æ— æ³•å½¢æˆç—…æ¯’ä¼ æ’­

**âœ… æ ¸å¿ƒæœºé‡:**
1. **æŠ€æœ¯åŸºç¡€æ‰å®**: å·²æœ‰æ–°æ‰‹ä»»åŠ¡ç³»ç»Ÿã€AI Chatã€PDFç”ŸæˆåŸºç¡€
2. **ç®—æ³•ä¼˜å…ˆæ¶æ„**: `src/app/api/qiflow/chat/route.ts` å·²å®ç°ç®—æ³•ä¼˜å…ˆ+AIç»„ç»‡è¯­è¨€
3. **å¤šAIæ¨¡å‹æ”¯æŒ**: å·²é›†æˆ DeepSeek + OpenAI + Google Gemini
4. **Stripeæ”¯ä»˜å®Œæ•´**: è®¢é˜…å’Œä¸€æ¬¡æ€§è´­ä¹°å‡å·²å®ç°
5. **å¾…å¡«è¡¥çš„å¸‚åœºç©ºç™½**: $10-$30çš„"è‡ªåŠ¨åŒ–ä¸“ä¸šæŠ¥å‘Š"å¸‚åœºæ— å¼ºåŠ›ç«å“

---

## ğŸ”¬ ä¸¤é˜¶æ®µA/Bæµ‹è¯•æ–¹æ¡ˆ (å»ºè®®1 - å·²ç®€åŒ–)

### é—®é¢˜è¯Šæ–­

åŸæŠ¥å‘Šçš„A/Bæµ‹è¯•(70 vs 200ç§¯åˆ†)è¿‡äºç®€å•,ä½†ç›´æ¥è·³åˆ°A/B/Cä¼šå¢åŠ å®éªŒè®¾è®¡å¤æ‚åº¦ã€æ ·æœ¬é‡éœ€æ±‚å’Œå¼€å‘æˆæœ¬ã€‚**æœ€ä¼˜è§£**: æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µçš„A/Bæµ‹è¯•ã€‚

### âœ… ä¼˜åŒ–æ–¹æ¡ˆ: ä¸¤é˜¶æ®µA/B (é™ä½é£é™©,ä¿æŒæ¢ç´¢æ€§)

#### ğŸ¯ é˜¶æ®µ1: éªŒè¯ã€Œå‚ä¸æ¿€åŠ±ã€æœºåˆ¶ (Week 2-4)

**æ ¸å¿ƒå‡è®¾**: æ¸¸æˆåŒ–ä»»åŠ¡èƒ½å¦é€šè¿‡"æ²‰æ²¡æˆæœ¬æ•ˆåº”"æå‡è½¬åŒ–ç‡?

| ç‰ˆæœ¬ | æ³¨å†Œç¤¼ | æ–°æ‰‹ä»»åŠ¡ | æ€»å¯è·ç§¯åˆ† | æ ¸å¿ƒæµ‹è¯•ç‚¹ |
|------|--------|----------|------------|------------|
| **Aç»„(å¯¹ç…§)** | 70ç§¯åˆ† | âŒ æ—  | **70** | ç°çŠ¶åŸºå‡† |
| **Bç»„(ä»»åŠ¡)** | 50ç§¯åˆ† | âœ… 5ä¸ªä»»åŠ¡ | **250** | å‚ä¸æ¿€åŠ±(ä½é…ç‰ˆ) |

**Bç»„ä»»åŠ¡è®¾è®¡** (åŸºäºç°æœ‰`/api/missions/newbie`,ä½é…ç‰ˆæ§åˆ¶æˆæœ¬):
```typescript
// ğŸ“ ä¼˜åŒ–ä½ç½®: src/lib/newbie-missions.ts
// âš ï¸ é˜¶æ®µ1é‡‡ç”¨ä½é…å¥–åŠ±,æ€»é¢â‰¤250ç§¯åˆ†,é˜²æ­¢æˆæœ¬å¤±æ§

export const NEWBIE_MISSIONS_PHASE1 = [
  {
    id: 'complete_profile',
    title: 'å®Œå–„ä¸ªäººèµ„æ–™',
    description: 'è®¾ç½®å¤´åƒå’Œæ˜µç§°,å¼€å¯ä¸“å±å‘½ç†ä¹‹æ—…',
    reward: 30,  // é™ä½å¥–åŠ±,æ§åˆ¶æ€»æˆæœ¬
    target: 1,
  },
  {
    id: 'first_bazi_analysis',
    title: 'é¦–æ¬¡å…«å­—åˆ†æ',
    description: 'å®Œæˆç¬¬ä¸€æ¬¡å…«å­—å‘½ç†æ’ç›˜',
    reward: 50,  // æ ¸å¿ƒåŠŸèƒ½,å¥–åŠ±é€‚ä¸­
    target: 1,
  },
  {
    id: 'first_fengshui_analysis',
    title: 'é¦–æ¬¡é£æ°´åˆ†æ',
    description: 'å®Œæˆç¬¬ä¸€æ¬¡ç„ç©ºé£æ˜Ÿåˆ†æ',
    reward: 60,  // é¼“åŠ±å®Œæ•´ä½“éªŒ
    target: 1,
  },
  {
    id: 'first_ai_chat',
    title: 'ä¸AIå¤§å¸ˆå¯¹è¯',
    description: 'æå‡ºæ‚¨çš„ç¬¬ä¸€ä¸ªå‘½ç†é—®é¢˜',
    reward: 40,
    target: 1,
  },
  {
    id: 'share_to_social',
    title: 'åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“',
    description: 'å°†æ‚¨çš„åˆ†æç»“æœåˆ†äº«ç»™æœ‹å‹',
    reward: 20,  // åˆ†äº«å¥–åŠ±é™ä½,ä¸»æ¨ä½“éªŒ
    target: 1,
  },
];
// æ€»è®¡: 50 + 200 = 250ç§¯åˆ† (æ¯”åŸæ–¹æ¡ˆCç»„çš„350æ›´ä¿å®ˆ)
```

**âš ï¸ ä¸ºä»€ä¹ˆé™ä½åˆ°250è€Œé350?**
- **æˆæœ¬æ§åˆ¶**: 250ç§¯åˆ† â‰ˆ $25å…è´¹é¢åº¦,å·²è¶³å¤Ÿä½“éªŒæ ¸å¿ƒåŠŸèƒ½
- **é˜²å¤±æ§**: å¦‚æœBç»„å¤±è´¥,å›æ»šæˆæœ¬æ›´ä½
- **é€æ­¥æ”¾å¤§**: å¦‚æœBç»„èƒœå‡º,é˜¶æ®µ2å¯è€ƒè™‘æå‡å¥–åŠ±

#### ğŸ¯ é˜¶æ®µ2: éªŒè¯ã€Œæ…·æ…¨ä¸Šé™ã€(Week 5-7, ä»…åœ¨é˜¶æ®µ1æˆåŠŸåæ‰§è¡Œ)

**å‰ç½®æ¡ä»¶**: é˜¶æ®µ1çš„Bç»„è½¬åŒ–ç‡æ˜¾è‘—ä¼˜äºAç»„(â‰¥+20%)ä¸”CACå¯æ§(â‰¤$15)ã€‚

| ç‰ˆæœ¬ | æ³¨å†Œç¤¼ | æ–°æ‰‹ä»»åŠ¡ | æ€»å¯è·ç§¯åˆ† | æ ¸å¿ƒæµ‹è¯•ç‚¹ |
|------|--------|----------|------------|------------|
| **Aç»„(èƒœè€…)** | é˜¶æ®µ1èƒœå‡ºçš„é…ç½® | - | - | å·²éªŒè¯åŸºå‡† |
| **Bç»„(æ…·æ…¨)** | 150ç§¯åˆ† | âŒ æ—  | **150** | æ…·æ…¨ä½“éªŒæ˜¯å¦æ›´ä¼˜ |

**ä¸ºä»€ä¹ˆæ˜¯150è€Œé200?**
- é™ä½é£é™©: 150å·²æ˜¯70çš„2å€,è¶³å¤Ÿæµ‹è¯•"æ…·æ…¨å‡è®¾"
- æˆæœ¬å¯æ§: é¿å…ç›´æ¥è·³åˆ°200å¯¼è‡´å¤±æ§

---

### ç›‘æµ‹æŒ‡æ ‡ä¸å†³ç­–çŸ©é˜µ

```typescript
// ğŸ“ æ–°å»ºæ–‡ä»¶: scripts/ab-test-monitor.ts (ç®€åŒ–ç‰ˆ,é€‚é…ä¸¤é˜¶æ®µA/B)

const METRICS = {
  // ä¸»è¦æŒ‡æ ‡ (Primary)
  paid_conversion_rate: {  // 14æ—¥å†…ä»˜è´¹è½¬åŒ–ç‡
    target: 0.10,  // 10%
    rollback_threshold: 0.05,  // <5% ç«‹å³å›æ»š
  },
  day7_retention: {  // 7æ—¥ç•™å­˜ç‡
    target: 0.40,  // 40%
    rollback_threshold: 0.25,  // <25% å›æ»š
  },
  
  // æ¬¡è¦æŒ‡æ ‡ (Secondary)
  activation_rate: {  // æ¿€æ´»ç‡ (å®Œæˆ1æ¬¡åˆ†æ)
    target: 0.70,  // 70%
  },
  credits_utilization: {  // ç§¯åˆ†ä½¿ç”¨ç‡
    healthy_range: [0.60, 0.80],  // 60-80%åœ¨14æ—¥å†…ç”¨å®Œä¸ºå¥åº·
  },
  
  // æˆæœ¬æ§åˆ¶
  cost_per_paying_customer: {  // CAC
    max_acceptable: 15,  // æ¯ä¸ªä»˜è´¹ç”¨æˆ·è·å®¢æˆæœ¬<$15
  },
};

// é˜¶æ®µ1å†³ç­–é€»è¾‘
async function evaluatePhase1() {
  const results = await fetchMetrics(['A', 'B']);
  
  // åœºæ™¯1: Bç»„æ˜¾è‘—èƒœå‡º â†’ è¿›å…¥é˜¶æ®µ2
  if (results.B.paid_conversion_rate >= results.A.paid_conversion_rate * 1.2 &&
      results.B.day7_retention >= results.A.day7_retention * 1.1 &&
      results.B.cost_per_paying_customer <= 15) {
    return {
      winner: 'B',
      reason: 'å‚ä¸æ¿€åŠ±æœºåˆ¶æœ‰æ•ˆ,è½¬åŒ–ç‡ä¸ç•™å­˜ç‡åŒæå‡',
      action: 'è¿›å…¥é˜¶æ®µ2,æµ‹è¯•æ…·æ…¨ä½“éªŒ(150ç§¯åˆ†)èƒ½å¦è¿›ä¸€æ­¥ä¼˜åŒ–',
    };
  }
  
  // åœºæ™¯2: Bç»„è½¬åŒ–å¥½ä½†ç•™å­˜/æˆæœ¬æœ‰é—®é¢˜ â†’ è°ƒæ•´åé‡æµ‹
  if (results.B.paid_conversion_rate >= results.A.paid_conversion_rate * 1.15 &&
      (results.B.day7_retention < results.A.day7_retention * 1.05 ||
       results.B.cost_per_paying_customer > 12)) {
    return {
      winner: 'Hybrid',
      reason: 'ä»»åŠ¡æœºåˆ¶æœ‰æ•ˆä½†æˆæœ¬æˆ–ç•™å­˜éœ€ä¼˜åŒ–',
      action: 'é™ä½ä»»åŠ¡å¥–åŠ±(æ€»â‰¤200)åé‡æ–°æµ‹è¯•',
    };
  }
  
  // åœºæ™¯3: Bç»„æ— æ˜æ˜¾ä¼˜åŠ¿æˆ–å¤±è´¥ â†’ ä¿å®ˆç­–ç•¥
  return {
    winner: 'A',
    reason: 'å‚ä¸æ¿€åŠ±æœªè¾¾é¢„æœŸæ•ˆæœæˆ–æˆæœ¬è¿‡é«˜',
    action: 'ä¿æŒç°çŠ¶(70ç§¯åˆ†),è½¬è€Œä¼˜åŒ–æŠ¥å‘Šäº§å“ä¸ä»·å€¼ä¼ é€’',
  };
}

// é˜¶æ®µ2å†³ç­–é€»è¾‘
async function evaluatePhase2() {
  const results = await fetchMetrics(['A', 'B']);  // A=é˜¶æ®µ1èƒœè€…, B=150ç§¯åˆ†
  
  // åœºæ™¯1: æ…·æ…¨ç­–ç•¥èƒœå‡º
  if (results.B.paid_conversion_rate >= results.A.paid_conversion_rate * 1.15 &&
      results.B.cost_per_paying_customer <= 15) {
    return {
      winner: 'B',
      reason: 'æ…·æ…¨ä½“éªŒç­–ç•¥æœ‰æ•ˆ,ç”¨æˆ·å……åˆ†ä½“éªŒåä»˜è´¹æ„æ„¿æ›´å¼º',
      action: 'å…¨é‡åˆ‡æ¢åˆ°150ç§¯åˆ†æ³¨å†Œç¤¼',
    };
  }
  
  // åœºæ™¯2: æ— æ˜æ˜¾å·®å¼‚æˆ–æˆæœ¬è¿‡é«˜
  return {
    winner: 'A',
    reason: 'æ…·æ…¨ç­–ç•¥æœªå¸¦æ¥æ˜¾è‘—æ”¶ç›Šæˆ–CACè¿‡é«˜',
    action: 'ä¿æŒé˜¶æ®µ1èƒœå‡ºçš„é…ç½®',
  };
}
```

### å®æ–½å»ºè®®

**æŠ€æœ¯é€‰å‹**: è½»é‡çº§å®ç°,ä¸ä¾èµ–ç¬¬ä¸‰æ–¹å¹³å°
```typescript
// ğŸ“ ç®€å•åˆ†ç»„é€»è¾‘: src/actions/signup.ts

function assignABGroup(userId: string): 'A' | 'B' {
  // ä½¿ç”¨userIdå“ˆå¸Œè¿›è¡Œç¨³å®šåˆ†ç»„
  const hash = createHash('md5').update(userId).digest('hex');
  const num = parseInt(hash.substring(0, 8), 16);
  return num % 2 === 0 ? 'A' : 'B';  // 50/50åˆ†æµ
}

// æ³¨å†Œæ—¶å†™å…¥åˆ†ç»„
const abGroup = assignABGroup(user.id);
await db.user.update({
  where: { id: user.id },
  data: { 
    metadata: { abGroup, abPhase: 1 },
  },
});

// æ ¹æ®åˆ†ç»„å‘æ”¾æ³¨å†Œç¤¼
const giftCredits = abGroup === 'A' ? 70 : 50;
await creditsManager.addCredits(user.id, giftCredits, 'æ³¨å†Œç¤¼åŒ…');
```

**æµé‡åˆ†é…ä¸å‘¨æœŸ**:
- é˜¶æ®µ1: A/Bå„50%, 2-3å‘¨, æœ€å°‘300æ³¨å†Œ/ç»„
- é˜¶æ®µ2: A/Bå„50%, 2-3å‘¨, æœ€å°‘300æ³¨å†Œ/ç»„

**å†³ç­–èŠ‚ç‚¹**:
- é˜¶æ®µ1ç¬¬2å‘¨: ä¸­æœŸå¥åº·æ£€æŸ¥(æˆæœ¬/æŠ€æœ¯å¼‚å¸¸)
- é˜¶æ®µ1ç¬¬3å‘¨æœ«: æ­£å¼å†³ç­–,æ˜¯å¦è¿›å…¥é˜¶æ®µ2
- é˜¶æ®µ2ç¬¬3å‘¨æœ«: æœ€ç»ˆå†³ç­–,ç¡®å®šå…¨é‡é…ç½®

**âš ï¸ å¿…å¤‡å‰ç½®æ¡ä»¶**: 
- âœ… å¯ç”¨TurnstileéªŒè¯ç  (é˜²æ­¢æ¶æ„åˆ·æ³¨å†Œ)
- âœ… éƒ¨ç½²æˆæœ¬ç›‘æ§å‘Šè­¦ (æ¯æ—¥AIæˆæœ¬>$50è§¦å‘,â‰¥$100æš‚åœæ–°æ³¨å†Œ)
- âœ… Webhookå¹‚ç­‰è®¾è®¡ (event idå»é‡)
- âœ… ä»»åŠ¡é¢†å¥–é˜²é‡å¤ (completed + rewardClaimedåŒæ£€æŸ¥)

---

## ğŸ“ æ–°æ‰‹å¼•å¯¼ä½“éªŒå®Œå–„ (å»ºè®®2 & 3)

### ç°çŠ¶åˆ†æ

âœ… **å·²æœ‰åŸºç¡€** (ä¸é‡å¤é€ è½®å­):
- APIè·¯å¾„: `src/app/api/missions/newbie/route.ts`
- åç«¯é€»è¾‘: `src/lib/newbie-missions.ts` (å‡½æ•° `getUserNewbieMissions`)
- æ•°æ®æ¨¡å‹: æ”¯æŒä»»åŠ¡è¿›åº¦è¿½è¸ª (progress/target/completed/rewardClaimed)

âŒ **ç¼ºå°‘çš„ç¯èŠ‚**:
- å‰ç«¯å¼•å¯¼ç»„ä»¶ (ç”¨æˆ·çœ‹ä¸åˆ°ä»»åŠ¡)
- ä»»åŠ¡å®Œæˆåçš„å¥–åŠ±å‘æ”¾é€»è¾‘
- æ¿€åŠ±æ€§æ–‡æ¡ˆå’Œè§†è§‰è®¾è®¡

### ä¼˜åŒ–æ–¹æ¡ˆ: éä¾µå…¥å¼å¼•å¯¼ç³»ç»Ÿ

#### ç¬¬ä¸€æ­¥: å‰ç«¯ç»„ä»¶ (è½»é‡çº§)

```typescript
// ğŸ“ æ–°å»ºæ–‡ä»¶: src/components/onboarding/OnboardingBanner.tsx

/**
 * è®¾è®¡åŸåˆ™:
 * 1. éé˜»å¡å¼: é¡¶éƒ¨æ¨ªå¹…,ä¸å½±å“ä¸»æµç¨‹
 * 2. å¯å…³é—­: ç”¨æˆ·å¯ä»¥éšæ—¶å…³é—­,ä¸å¼ºåˆ¶
 * 3. è¿›åº¦å¯è§†åŒ–: æ˜¾ç¤ºå®Œæˆåº¦ (2/5)
 */

export function OnboardingBanner() {
  const { missions, completed, total } = useMissions();  // è°ƒç”¨ç°æœ‰API
  
  if (completed === total) return null;  // å…¨éƒ¨å®Œæˆåéšè—
  
  const nextMission = missions.find(m => !m.completed);
  const progress = (completed / total) * 100;
  
  return (
    <div className="bg-gradient-to-r from-purple-500 to-pink-500 p-4 rounded-lg">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-white font-bold">
            ğŸ¯ {nextMission.title}
          </h3>
          <p className="text-white/80 text-sm">
            {nextMission.description} Â· å¥–åŠ± {nextMission.reward} ç§¯åˆ†
          </p>
        </div>
        <div>
          <Progress value={progress} className="w-24" />
          <span className="text-white text-xs">{completed}/{total}</span>
        </div>
      </div>
    </div>
  );
}
```

#### ç¬¬äºŒæ­¥: å¥–åŠ±å‘æ”¾é€»è¾‘ (åŸºäºç°æœ‰API)

```typescript
// ğŸ“ æ–°å»ºæ–‡ä»¶: src/app/api/missions/claim/route.ts

import { creditsManager } from '@/lib/credits/manager';
import { markMissionClaimed } from '@/lib/newbie-missions';

export async function POST(request: Request) {
  const { missionId } = await request.json();
  const session = await getSession();
  
  // 1. æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆä¸”æœªé¢†å–
  const mission = await getMission(session.user.id, missionId);
  if (!mission.completed || mission.rewardClaimed) {
    return NextResponse.json({ error: 'ä»»åŠ¡æœªå®Œæˆæˆ–å·²é¢†å–' }, { status: 400 });
  }
  
  // 2. å‘æ”¾å¥–åŠ± (å¤ç”¨ç°æœ‰ç§¯åˆ†ç³»ç»Ÿ)
  await creditsManager.addCredits(
    session.user.id,
    mission.reward,
    `æ–°æ‰‹ä»»åŠ¡å¥–åŠ±: ${mission.title}`,
    { source: 'newbie_mission', missionId }
  );
  
  // 3. æ ‡è®°ä¸ºå·²é¢†å–
  await markMissionClaimed(session.user.id, missionId);
  
  return NextResponse.json({ success: true, creditsAdded: mission.reward });
}
```

#### ç¬¬ä¸‰æ­¥: ä»»åŠ¡è§¦å‘å™¨ (äº‹ä»¶é©±åŠ¨)

```typescript
// ğŸ“ ä¿®æ”¹ç°æœ‰æ–‡ä»¶: src/app/api/qiflow/bazi-unified/route.ts (å…«å­—åˆ†æAPI)

// åœ¨åˆ†æå®Œæˆå,è§¦å‘ä»»åŠ¡æ£€æŸ¥
async function afterAnalysisComplete(userId: string) {
  // æ£€æŸ¥æ˜¯å¦æ˜¯é¦–æ¬¡åˆ†æ
  const isFirstTime = await checkIsFirstBaziAnalysis(userId);
  
  if (isFirstTime) {
    // è‡ªåŠ¨å®Œæˆä»»åŠ¡ (ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»)
    await completeMission(userId, 'first_bazi_analysis');
    
    // å‘é€é€šçŸ¥
    await sendNotification(userId, {
      type: 'mission_completed',
      message: 'ğŸ‰ æ­å–œå®Œæˆé¦–æ¬¡å…«å­—åˆ†æ! å¥–åŠ±60ç§¯åˆ†å·²åˆ°è´¦!',
    });
  }
}
```

### ä¼˜åŠ¿æ€»ç»“

1. **å¤ç”¨ç‡é«˜**: åŸºäºç°æœ‰`newbie-missions` API,åªéœ€å¢åŠ å‰ç«¯å’Œè§¦å‘é€»è¾‘
2. **ä½“éªŒå¥½**: éä¾µå…¥å¼è®¾è®¡,ç”¨æˆ·åœ¨è‡ªç„¶ä½¿ç”¨ä¸­è·å¾—å¥–åŠ±
3. **çµæ´»å¯è°ƒ**: ä»»åŠ¡å¥–åŠ±é¢åº¦å¯é€šè¿‡é…ç½®æ–‡ä»¶å¿«é€Ÿè°ƒæ•´

---

## ğŸ“„ æŠ¥å‘Šç”Ÿæˆä¸AIå®¡æ ¸ (å»ºè®®3 - é‡ä¸­ä¹‹é‡)

### ç°çŠ¶è¯Šæ–­

âœ… **å·²æœ‰èƒ½åŠ›**:
- PDFç”Ÿæˆè„šæœ¬: `scripts/export-sample-pdf.ts`
- PDF Action: `@/actions/qiflow/pdf-export` çš„ `exportQiflowPdfAction`
- ç®—æ³•æ•°æ®: å…«å­—(`computeBaziSmart`) + é£æ°´(`generateFlyingStar`)
- AIé›†æˆ: å¤šæ¨¡å‹æ”¯æŒ (DeepSeek/OpenAI/Gemini)

âŒ **ç¼ºå¤±ç¯èŠ‚**:
- æ²¡æœ‰"æŠ¥å‘Šäº§å“"æ¦‚å¿µ (qiflow-pricing.tsä¸­æœªå®šä¹‰)
- PDFå†…å®¹ç®€å•,ç¼ºå°‘"äººå®…ç»“åˆ"ç« èŠ‚
- æ— AIè´¨é‡å®¡æ ¸æœºåˆ¶
- å®šä»·æ¨¡å‹ä¸æ¸…æ™° (ç”¨ç§¯åˆ†è¿˜æ˜¯USD?)

### ä¼˜åŒ–æ–¹æ¡ˆ: ä¸‰çº§æŠ¥å‘Šäº§å“ + AIåŒå®¡æœºåˆ¶

#### ğŸ¯ MVPæ”¶æ•›: å…ˆåšä¸¤æ¡£æŠ¥å‘Š

```typescript
// ğŸ“ qiflow-pricing.ts æ–°å¢
export const QIFLOW_PRICING = {
  // ç°æœ‰åŠŸèƒ½
  aiChat: 5,
  bazi: 10,
  xuankong: 20,
  deepInterpretation: 30,
  pdfExport: 5,
  
  // ğŸ†• æ–°å¢: æŠ¥å‘Šäº§å“ (MVPä»…ä¸¤æ¡£)
  reportBasic: 0,  // å…è´¹åŸºç¡€æŠ¥å‘Š (å¼•æµ+å±•ç¤ºæ ·ä¾‹)
  reportEssential: 99,  // ç²¾åæŠ¥å‘Š $9.90 (ä¸»åŠ›å˜ç°äº§å“)
  // reportPremium: 299,  // â³ æ——èˆ°æŠ¥å‘Šæš‚ä¸ä¸Šçº¿,ç­‰å¸‚åœºéªŒè¯åå†æ¨
} as const;
```

**âš ï¸ ä¸ºä»€ä¹ˆæš‚ä¸ä¸Šæ——èˆ°æŠ¥å‘Š?**
- MVPèšç„¦éªŒè¯"$9.90ç²¾åæŠ¥å‘Š"çš„PMF
- é¿å…è¿‡å¤šSKUåˆ†æ•£ç²¾åŠ›å’Œæ•°æ®
- ç­‰æœ‰çœŸå®é«˜æ„æ„¿ç”¨æˆ·åé¦ˆ"éœ€è¦æ›´æ·±åº¦æŠ¥å‘Š"å†ä¸Šçº¿

---

#### ç¬¬ä¸€çº§: å…è´¹åŸºç¡€æŠ¥å‘Š (å¼•æµ)

**å…è´¹æŠ¥å‘Šå†…å®¹** (5-8é¡µ):
```
ç¬¬1é¡µ: å°é¢ (ä¸ªæ€§åŒ–æ ‡é¢˜: "å¼ å…ˆç”Ÿçš„å‘½ç†æŠ¥å‘Š")
ç¬¬2é¡µ: å…«å­—æ’ç›˜ (å››æŸ±+äº”è¡Œé›·è¾¾å›¾)
ç¬¬3é¡µ: åŸºç¡€æ€§æ ¼åˆ†æ (æ—¥ä¸»ç‰¹è´¨)
ç¬¬4é¡µ: ä½å®…æœå‘å›¾ (ä¹å®«æ ¼ç¤ºæ„)
ç¬¬5é¡µ: ğŸ”’ æ·±åº¦è§£è¯»é¢„è§ˆ (æ˜¾ç¤ºå‰100å­—,åç»­å†…å®¹æ¨¡ç³Š)

âŒ ä¸åŒ…å«:
- AIæ·±åº¦è§£è¯»
- äººå®…ç»“åˆå»ºè®®
- æµå¹´è¿åŠ¿
- å¯ä¸‹è½½PDF (åªèƒ½åœ¨çº¿æŸ¥çœ‹)
```

#### ç¬¬äºŒçº§: ç²¾åæŠ¥å‘Š (ä¸»åŠ›äº§å“, 99ç§¯åˆ† = $9.90)

```typescript
// ğŸ“ æ–°å»ºæ–‡ä»¶: src/lib/qiflow/reports/essential-report.ts

interface EssentialReportData {
  userId: string;
  baziData: ComputedBaziResult;
  fengshuiData: GenerateFlyingStarOutput;
  userInfo: { name: string; birthDate: string; houseInfo: string };
}

async function generateEssentialReport(data: EssentialReportData): Promise<PDFBuffer> {
  // Step 1: ç®—æ³•è®¡ç®— (å·²å®Œæˆ,ç›´æ¥ä½¿ç”¨)
  const { baziData, fengshuiData } = data;
  
  // Step 2: AIç”Ÿæˆæ ¸å¿ƒå†…å®¹
  const aiContents = await Promise.all([
    generatePersonalityAnalysis(baziData),  // 800å­—æ€§æ ¼è§£è¯»
    generateCareerGuidance(baziData),       // èŒä¸šå»ºè®®
    generateWealthAnalysis(baziData),       // è´¢è¿åˆ†æ
    generateFengshuiLayout(fengshuiData),   // é£æ°´å¸ƒå±€å»ºè®®
    generateSynthesisSection(baziData, fengshuiData),  // ğŸŒŸ äººå®…ç»“åˆ (æ ¸å¿ƒ)
  ]);
  
  // Step 3: AIå®¡æ ¸ (è´¨é‡æ§åˆ¶)
  const auditResult = await aiQualityAudit(aiContents);
  if (auditResult.riskScore > 0.7) {
    // é£é™©è¿‡é«˜,é‡æ–°ç”Ÿæˆ
    console.warn('[è´¨é‡å®¡æ ¸] å†…å®¹é£é™©è¿‡é«˜,è§¦å‘é‡æ–°ç”Ÿæˆ', auditResult.issues);
    return generateEssentialReport(data);  // é€’å½’é‡è¯•
  }
  
  // Step 4: ç»„è£…PDF
  const pdfData = {
    template: 'essential',
    sections: [
      { title: 'å°é¢', content: generateCover(data.userInfo) },
      { title: 'ç¬¬1ç« : æ‚¨çš„å‘½ç†DNA', content: aiContents[0] },
      { title: 'ç¬¬2ç« : äº‹ä¸šä¸è´¢è¿', content: aiContents[1] + aiContents[2] },
      { title: 'ç¬¬3ç« : ç©ºé—´èƒ½é‡å›¾', content: aiContents[3] },
      { title: 'ç¬¬4ç« : ğŸŒŸäººå®…ç»“åˆ', content: aiContents[4] },  // æ ¸å¿ƒå–ç‚¹
      { title: 'ç¬¬5ç« : è¡ŒåŠ¨æ¸…å•', content: generateActionItems(baziData, fengshuiData) },
      { title: 'å…è´£å£°æ˜', content: DISCLAIMER_TEXT },
    ],
    branding: { logo: '/logo.png', footer: 'Generated by QiFlowAI' },
  };
  
  return await renderPDF(pdfData);
}
```

#### æ ¸å¿ƒ: "äººå®…ç»“åˆ"AIåˆ†æ (æŠ¥å‘Šçµé­‚)

```typescript
// ğŸ“ src/lib/qiflow/ai/synthesis-prompt.ts

export const SYNTHESIS_PROMPT = `
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å‘½ç†é£æ°´å¤§å¸ˆ,æ“…é•¿å°†ä¸ªäººå‘½ç†ä¸ä½å®…é£æ°´è¿›è¡Œæ™ºèƒ½ç»¼åˆåˆ†æã€‚

ã€æ ¸å¿ƒä»»åŠ¡ã€‘
åŸºäºç”¨æˆ·çš„å…«å­—æ•°æ®å’Œä½å®…é£æ°´æ•°æ®,è¿›è¡Œ"äººå®…ç»“åˆ"çš„æ·±åº¦åˆ†æã€‚

ã€ç®—æ³•æ•°æ®ã€‘
å…«å­—ä¿¡æ¯:
- æ—¥ä¸»: {{dayMaster}}
- ç”¨ç¥: {{favorableGod}}
- å–œç¥: {{joyGod}}
- å¿Œç¥: {{avoidGod}}
- äº”è¡Œå¼ºå¼±: {{fiveElements}}

é£æ°´ä¿¡æ¯:
- æˆ¿å±‹åå‘: å{{mountain}}æœ{{facing}}
- ä¹å®«é£æ˜Ÿ: {{nineStars}}
- å½“å‰è¿åŠ¿: {{currentPeriod}}è¿

ã€åˆ†æè¦æ±‚ã€‘
1. æ‰¾å‡º"è¶…çº§å‰ä½": ç”¨æˆ·å–œç”¨ç¥æ–¹ä½ + æˆ¿å±‹é£æ˜Ÿå‰ä½çš„äº¤é›†
2. è¯†åˆ«"é£é™©åŒºåŸŸ": å¿Œç¥æ–¹ä½ + é£æ˜Ÿå‡¶ä½çš„å åŠ 
3. æä¾›3æ¡å¯ç«‹å³æ‰§è¡Œçš„å¸ƒå±€å»ºè®®
4. è¯­è¨€ç§¯æå»ºè®¾æ€§,é¿å…æå“æ€§è¯æ±‡

ã€è¾“å‡ºæ ¼å¼ã€‘
âœ… è¶…çº§å‰ä½å‘ç°:
[æè¿°äº¤é›†ä½ç½®åŠåŸå› ]

âš ï¸ é£é™©åŒºåŸŸè­¦æŠ¥:
[æè¿°å†²çªä½ç½®åŠåŸå› ]

ğŸ’¡ ç«‹å³è¡ŒåŠ¨å»ºè®®:
1. [å…·ä½“å»ºè®®1]
2. [å…·ä½“å»ºè®®2]
3. [å…·ä½“å»ºè®®3]

ã€åˆè§„çº¦æŸã€‘
- ç¦ç”¨è¯æ±‡: "å¿…å®š"ã€"ä¸€å®š"ã€"æ³¨å®š"ã€"ç¾éš¾"ã€"å‡¶äº‹"
- æ›¿æ¢ä¸º: "å¯èƒ½"ã€"å»ºè®®"ã€"å‚è€ƒ"ã€"æŒ‘æˆ˜"
- æ¯æ®µç»“å°¾æ ‡æ³¨"ä»¥ä¸Šåˆ†æä»…ä¾›å‚è€ƒ"
`;

async function generateSynthesisSection(baziData, fengshuiData): Promise<string> {
  const prompt = SYNTHESIS_PROMPT
    .replace('{{dayMaster}}', baziData.dayMaster)
    .replace('{{favorableGod}}', baziData.favorableGod || 'æœªè®¡ç®—')
    .replace('{{joyGod}}', baziData.joyGod || 'æœªè®¡ç®—')
    // ... å…¶ä»–å ä½ç¬¦æ›¿æ¢
  
  // ä½¿ç”¨deepseek (æ€§ä»·æ¯”é«˜)
  const result = await generateText({
    model: openai('deepseek-chat'),
    prompt: prompt,
    temperature: 0.7,
  });
  
  return result.text;
}
```

#### AIè´¨é‡å®¡æ ¸æœºåˆ¶ (åˆ›æ–°ç‚¹!)

```typescript
// ğŸ“ src/lib/qiflow/ai/quality-audit.ts

export async function aiQualityAudit(contents: string[]): Promise<AuditResult> {
  const fullText = contents.join('\n\n');
  
  const auditPrompt = `
ä½ æ˜¯ä¸€ä½ä¸¥è°¨çš„å†…å®¹å®¡æ ¸ä¸“å®¶ã€‚è¯·å®¡æ ¸ä»¥ä¸‹å‘½ç†æŠ¥å‘Šå†…å®¹ã€‚

ã€å®¡æ ¸ç»´åº¦ã€‘
1. é€»è¾‘ä¸€è‡´æ€§: æ˜¯å¦å­˜åœ¨è‡ªç›¸çŸ›ç›¾çš„è®ºæ–­
2. è¯­è¨€åˆè§„æ€§: æ˜¯å¦å«æœ‰å®¿å‘½è®ºã€æå“æ€§è¯æ±‡
3. ç§¯ææ€§: æ˜¯å¦ç»™ç”¨æˆ·å¸¦æ¥æ­£å‘å¿ƒç†æš—ç¤º
4. å¯æ“ä½œæ€§: å»ºè®®æ˜¯å¦å…·ä½“å¯æ‰§è¡Œ

ã€è¾“å‡ºæ ¼å¼ (JSON)ã€‘
{
  "riskScore": 0.0-1.0,  // 0=å®Œç¾, 1=ä¸¥é‡é—®é¢˜
  "issues": [
    { "type": "logic", "severity": "high", "description": "ç¬¬2ç« ä¸ç¬¬4ç« è®ºæ–­çŸ›ç›¾" },
    { "type": "compliance", "severity": "critical", "description": "å‡ºç°ç¦ç”¨è¯'å¿…å®š'" }
  ],
  "suggestions": [
    "å°†ç¬¬2ç« 'å¿…å®šå‘è´¢'æ”¹ä¸º'å¯èƒ½æœ‰è´¢è¿æœºä¼š'",
    "ç¬¬4ç« å¢åŠ æ›´å…·ä½“çš„æ‘†æ”¾å»ºè®®"
  ]
}
`;
  
  const result = await generateText({
    model: openai('gpt-3.5-turbo'),  // å®¡æ ¸ç”¨ä¾¿å®œæ¨¡å‹å³å¯
    prompt: auditPrompt + '\n\nã€å¾…å®¡æ ¸å†…å®¹ã€‘\n' + fullText,
    temperature: 0.3,  // é™ä½éšæœºæ€§
  });
  
  return JSON.parse(result.text);
}
```

### å®šä»·å»ºè®® (åŸºäºä»·å€¼é”šå®š)

```typescript
// åŸºå‡†: 100ç§¯åˆ† â‰ˆ $9.90 (ä»website.tsçš„ç§¯åˆ†åŒ…å®šä»·æ¨ç®—)
// å³ 1ç§¯åˆ† â‰ˆ $0.10

ç²¾åæŠ¥å‘Šå®šä»·å»ºè®®:
- ç§¯åˆ†è´­ä¹°: 99ç§¯åˆ† (æ¥è¿‘100,å¿ƒç†é—¨æ§›ä½)
- USDè´­ä¹°: $9.90 (ç»å…¸çš„"å·®ä¸€åˆ†"å®šä»·)
- ä»·å€¼å¯¹æ ‡: 
  * MyFengShui $7 (çº¯æ•°æ®æ— AI) < ä½ çš„$9.90 < Joey Yap $298 (äººå·¥å’¨è¯¢)
  * å¡«è¡¥å¸‚åœºç©ºç™½!

æ——èˆ°æŠ¥å‘Šå®šä»·å»ºè®®:
- ç§¯åˆ†è´­ä¹°: 299ç§¯åˆ†
- USDè´­ä¹°: $29.90
- ä»·å€¼å¯¹æ ‡: Sean Chan $488äººå·¥ç»¼åˆåˆ†æçš„è‡ªåŠ¨åŒ–æ›¿ä»£å“
```

### âš ï¸ å…³é”®å†³ç­–: ç§¯åˆ† OR USD?

**å»ºè®®**: æ”¯æŒ**åŒè½¨åˆ¶**,ä½†å¼•å¯¼ç”¨æˆ·ç”¨USDè´­ä¹°æŠ¥å‘Šã€‚

**ç†ç”±**:
1. **å¿ƒç†è´¦æˆ·**: ç”¨æˆ·æ›´æ„¿æ„ç”¨"è™šæ‹Ÿè´§å¸"(ç§¯åˆ†)å°è¯•åŠŸèƒ½,ä½†å¯¹"æ­£å¼äº§å“"(æŠ¥å‘Š)æ›´æ¥å—USDæ”¯ä»˜
2. **æ”¶å…¥ç¡®å®šæ€§**: USDæ”¯ä»˜ç›´æ¥å…¥è´¦,ç§¯åˆ†å¯èƒ½æ˜¯ä¹‹å‰å…è´¹è·å¾—çš„
3. **å®šä»·çµæ´»æ€§**: USDå¯ä»¥åšä¿ƒé”€($9.90 â†’ $6.90),ç§¯åˆ†éš¾ä»¥æ‰“æŠ˜

**å®æ–½**:
```typescript
// æŠ¥å‘Šè´­ä¹°é¡µæä¾›ä¸¤ä¸ªé€‰é¡¹
Option 1: ğŸ’³ USDæ”¯ä»˜ $9.90 (æ¨è) - "ç›´æ¥è´­ä¹°,ç«‹å³ç”Ÿæˆ"
Option 2: ğŸ’ ç§¯åˆ†æ”¯ä»˜ 99ç§¯åˆ† - "ä½¿ç”¨ç°æœ‰ç§¯åˆ†"

// é€šè¿‡UIè®¾è®¡å¼•å¯¼ç”¨æˆ·é€‰USD (æ›´å¤§çš„æŒ‰é’®,æ ‡æ³¨"æ¨è")
```

---

## ğŸ’¬ AI Chatä¼˜åŒ–ä¸RAGé›†æˆ (å»ºè®®4 & 8)

### ç°çŠ¶åˆ†æ

âœ… **å·²æœ‰åŸºç¡€** (ä»£ç å®¡è®¡å‘ç°):
- APIè·¯å¾„: `src/app/api/qiflow/chat/route.ts` (1400+è¡Œ,éå¸¸å®Œå–„!)
- ç®—æ³•ä¼˜å…ˆæ¶æ„: å·²å®ç°"è¯†åˆ«æ„å›¾â†’æ£€æŸ¥æ•°æ®â†’ç®—æ³•è®¡ç®—â†’AIç»„ç»‡è¯­è¨€"
- å¤šæ¨¡å‹é™çº§: DeepSeek â†’ OpenAI â†’ Google Gemini
- ä¸Šä¸‹æ–‡ç®¡ç†: å·²æ”¯æŒ`context.birthInfo` / `context.calculatedBazi`
- ç³»ç»ŸPromptä¼˜åŒ–: `src/lib/qiflow/ai/system-prompt.ts` (å·²æœ‰åˆè§„å‰ç¼€)

âœ… **AIå¢å¼ºåŠŸèƒ½å·²å­˜åœ¨**:
- ä¸ªæ€§åŒ–å»ºè®®ç”Ÿæˆ: `generatePersonalizedRecommendations(baziData, guidance)`
- ç»“åˆå…«å­—å’Œé£æ°´çš„ç»¼åˆåˆ†æ: `generateCombinedFengshuiResponse()`

âŒ **éœ€è¦ä¼˜åŒ–çš„ç‚¹**:
1. **5ç§¯åˆ†/æ¬¡çš„å¿ƒç†éšœç¢**: ç”¨æˆ·å®³æ€•æé—®,äº’åŠ¨é¢‘ç‡ä½
2. **ç¼ºå°‘RAGçŸ¥è¯†åº“**: AIåªèƒ½åŸºäºç®—æ³•æ•°æ®å›ç­”,æ— æ³•å¼•ç»æ®å…¸
3. **æ— ä¼šè¯è®°å¿†**: æ¯æ¬¡å¯¹è¯éƒ½æ˜¯ç‹¬ç«‹çš„,æ— æ³•å»ºç«‹æ·±åº¦äº’åŠ¨

### ä¼˜åŒ–æ–¹æ¡ˆ1: ä¼šè¯åˆ¶Chat (è§£å†³å»ºè®®4, MVPæ”¶æ•›ç‰ˆ)

```typescript
// ğŸ“ æ–°å¢: qiflow-pricing.ts

export const QIFLOW_PRICING = {
  // ç°æœ‰
  aiChat: 5,  // å•æ¬¡å¯¹è¯ (ä¿ç•™,ç”¨äºå¿«é€Ÿæé—®)
  
  // ğŸ†• æ–°å¢: ä¼šè¯æ¨¡å¼ (MVPä»…ä¸€æ¡£,é™ä½å¤æ‚åº¦)
  chatSession15Min: 10,   // 15åˆ†é’Ÿä¼šè¯,æœŸé—´æ— é™å¯¹è¯
  // chatSession30Min: 15,   // â³ äºŒæœŸå†åŠ 
  // chatSessionDaily: 30,   // â³ äºŒæœŸå†åŠ 
} as const;
```

**âš ï¸ ä¸ºä»€ä¹ˆMVPåªåš15åˆ†é’Ÿæ¡£?**
- é™ä½å‰ç«¯UIä¸åç«¯é€»è¾‘å¤æ‚åº¦(æ— éœ€é€‰æ‹©å™¨/å¤šæ¡£ä½å¤„ç†)
- 15åˆ†é’Ÿå·²è¶³å¤Ÿæ·±åº¦å¯¹è¯(5-10è½®)
- ç”¨æ•°æ®éªŒè¯"ä¼šè¯åˆ¶"æœ‰æ•ˆå,å†æ‰©å±•30åˆ†é’Ÿ/å…¨å¤©æ¡£

**ç”¨æˆ·å¿ƒç†è½¬å˜**:
```
æ—§æ¨¡å¼: "æ¯é—®ä¸€æ¬¡èŠ±5ç§¯åˆ†,æˆ‘è¦æƒ³å¥½å†é—®" â†’ æé—®è°¨æ…,äº’åŠ¨å°‘

æ–°æ¨¡å¼: "èŠ±10ç§¯åˆ†å¼€å¯15åˆ†é’Ÿä¼šè¯,å¿…é¡»é—®ä¸ªå¤Ÿæœ¬!" â†’ ç§¯ææé—®,æ·±åº¦äº’åŠ¨
```

**å®æ–½**:
```typescript
// ğŸ“ æ–°å»º: src/app/api/qiflow/chat/session/route.ts

export async function POST(request: Request) {
  const { sessionType } = await request.json();  // '15min' | '30min' | 'daily'
  const session = await getSession();
  
  // æ‰£é™¤ç§¯åˆ†
  const cost = QIFLOW_PRICING[`chatSession${sessionType}`];
  const result = await creditsManager.executeWithCredits(
    session.user.id,
    `chatSession${sessionType}`,
    async () => {
      // åˆ›å»ºä¼šè¯è®°å½•
      const chatSession = await db.chatSession.create({
        data: {
          userId: session.user.id,
          type: sessionType,
          startedAt: new Date(),
          expiresAt: calculateExpiry(sessionType),  // 15min/30min/24hå
          messageCount: 0,
        },
      });
      
      return { sessionId: chatSession.id };
    }
  );
  
  return NextResponse.json(result);
}
```

**å‰ç«¯ä½“éªŒ** (MVPç®€åŒ–ç‰ˆ):
```typescript
// ç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢ - å•æ¡£ä½,é™ä½å†³ç­–è´Ÿæ‹…

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ AIå¤§å¸ˆæ·±åº¦å¯¹è¯                      â”‚
â”‚                                         â”‚
â”‚  ç°åœ¨: 5ç§¯åˆ†/æ¬¡ â†’ æé—®è°¨æ…,æµ…å°è¾„æ­¢   â”‚
â”‚  å‡çº§: 10ç§¯åˆ†å¼€å¯15åˆ†é’Ÿæ·±åº¦ä¼šè¯        â”‚
â”‚                                         â”‚
â”‚  âœ… 15åˆ†é’Ÿå†…æ— é™æé—®                    â”‚
â”‚  âœ… æ·±å…¥æ¢è®¨å‘½ç†ç–‘æƒ‘                    â”‚
â”‚  âœ… AIç»“åˆæ‚¨çš„å…«å­—æ·±åº¦åˆ†æ              â”‚
â”‚                                         â”‚
â”‚  [ğŸš€ å¼€å¯15åˆ†é’Ÿä¼šè¯ - ä»…éœ€10ç§¯åˆ†]      â”‚
â”‚                                         â”‚
â”‚  ğŸ’¡ æç¤º: ä¼šè¯æœŸé—´å¯æ5-10ä¸ªé—®é¢˜,      â”‚
â”‚     æ¯”å•æ¬¡ä»˜è´¹åˆ’ç®—50%!                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// å¼€å¯åæ˜¾ç¤ºå€’è®¡æ—¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â° ä¼šè¯å‰©ä½™æ—¶é—´: 12:34                 â”‚
â”‚  ğŸ’¬ å·²å¯¹è¯: 3è½® | ç»§ç»­æé—®å§!          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ é£é™©æ§åˆ¶**:
```typescript
// ğŸ“ ä¼šè¯å®ˆå«é€»è¾‘

async function validateChatSession(userId: string): Promise<SessionStatus> {
  const session = await db.chatSession.findFirst({
    where: {
      userId,
      expiresAt: { gt: new Date() },  // æœªè¿‡æœŸ
    },
  });
  
  if (!session) {
    return { valid: false, needPurchase: true };
  }
  
  // é˜²æ»¥ç”¨: å•ä¼šè¯æœ€å¤š50æ¡æ¶ˆæ¯(å¼‚å¸¸æ£€æµ‹)
  if (session.messageCount >= 50) {
    return { valid: false, reason: 'ä¼šè¯å·²è¾¾ä¸Šé™' };
  }
  
  return { valid: true, session };
}
```

### ä¼˜åŒ–æ–¹æ¡ˆ2: RAGçŸ¥è¯†åº“é›†æˆ (è§£å†³å»ºè®®8)

#### æŠ€æœ¯é€‰å‹: `LlamaIndex.TS` + `pgvector`

**ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªç»„åˆ?**
1. **pgvector**: æ‚¨å·²ä½¿ç”¨PostgreSQL,ç›´æ¥åœ¨ç°æœ‰æ•°æ®åº“å¼€å¯å‘é‡æœç´¢,æ— éœ€é¢å¤–æœåŠ¡
2. **LlamaIndex.TS**: ä¸“ä¸ºTypeScript/Next.jsè®¾è®¡çš„RAGæ¡†æ¶,ä¸æ‚¨çš„æŠ€æœ¯æ ˆå®Œç¾å¥‘åˆ
3. **æˆæœ¬æ•ˆç›Š**: æ¯”Pineconeç­‰å¤–éƒ¨æœåŠ¡æ›´ç»æµ,é€‚åˆå¯åŠ¨é˜¶æ®µ

#### å®æ–½æ­¥éª¤

**Step 1: æ•°æ®å‡†å¤‡**
```typescript
// ğŸ“ æ–°å»º: scripts/ingest-knowledge-base.ts

/**
 * çŸ¥è¯†åº“æ¥æº:
 * 1. æ‚¨æä¾›çš„æ–‡æ¡£: D:\Desktop\mksaas_qiflowaiç»ˆä¼˜\*.md
 * 2. ç»å…¸å…¸ç±: ã€Šæ»´å¤©é«“ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ã€Šç´«å¾®æ–—æ•°å…¨ä¹¦ã€‹(å…¬å¼€æ–‡æœ¬)
 * 3. ç°ä»£æ¡ˆä¾‹: Joey Yapã€Sean Chanç­‰å…¬å¼€æ¡ˆä¾‹
 */

import { VectorStoreIndex, Document } from 'llamaindex';
import { OpenAIEmbedding } from 'llamaindex/embeddings/OpenAIEmbedding';
import { PGVectorStore } from 'llamaindex/vector_stores/PGVectorStore';
import fs from 'fs';
import path from 'path';

async function ingestKnowledgeBase() {
  // 1. è¯»å–æ‰€æœ‰æºæ–‡æ¡£
  const sourceDir = 'D:\\Desktop\\mksaas_qiflowaiç»ˆä¼˜';
  const files = fs.readdirSync(sourceDir).filter(f => f.endsWith('.md'));
  
  const documents = files.map(file => {
    const content = fs.readFileSync(path.join(sourceDir, file), 'utf-8');
    return new Document({ text: content, id_: file });
  });
  
  // 2. åˆ›å»ºEmbedding (ä½¿ç”¨OpenAI text-embedding-3-small,æ€§ä»·æ¯”é«˜)
  const embedModel = new OpenAIEmbedding({
    model: 'text-embedding-3-small',
    dimensions: 1536,
  });
  
  // 3. å­˜å‚¨åˆ°pgvector
  const vectorStore = new PGVectorStore({
    connectionString: process.env.DATABASE_URL,
    tableName: 'qiflow_knowledge_embeddings',
    embedDimensions: 1536,
  });
  
  // 4. æ„å»ºç´¢å¼•
  const index = await VectorStoreIndex.fromDocuments(documents, {
    embedModel,
    vectorStore,
  });
  
  console.log(`âœ… æˆåŠŸç´¢å¼• ${documents.length} ä»½æ–‡æ¡£`);
}
```

**Step 2: æ•°æ®åº“Schema**
```sql
-- ğŸ“ æ‰§è¡Œ: npx prisma migrate dev

CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE qiflow_knowledge_embeddings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  content TEXT NOT NULL,
  embedding vector(1536) NOT NULL,
  metadata JSONB,
  source VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX ON qiflow_knowledge_embeddings USING ivfflat (embedding vector_cosine_ops);
```

**Step 3: æŸ¥è¯¢é›†æˆ (RAGå·¥ä½œæµ)**
```typescript
// ğŸ“ ä¿®æ”¹: src/app/api/qiflow/chat/route.ts

import { VectorStoreIndex } from 'llamaindex';
import { PGVectorStore } from 'llamaindex/vector_stores/PGVectorStore';

async function answerWithRAG(question: string, context: any): Promise<string> {
  // 1. ä»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸å…³çŸ¥è¯†
  const vectorStore = new PGVectorStore({
    connectionString: process.env.DATABASE_URL,
    tableName: 'qiflow_knowledge_embeddings',
  });
  
  const index = await VectorStoreIndex.fromVectorStore(vectorStore);
  const retriever = index.asRetriever({ similarityTopK: 3 });  // æ£€ç´¢æœ€ç›¸å…³çš„3æ®µ
  
  const relevantDocs = await retriever.retrieve(question);
  
  // 2. æ„é€ å¢å¼ºPrompt
  const knowledgeContext = relevantDocs
    .map((doc, i) => `ã€å‚è€ƒèµ„æ–™${i+1}ã€‘\n${doc.text}`)
    .join('\n\n');
  
  const enhancedPrompt = `
ã€ç”¨æˆ·é—®é¢˜ã€‘
${question}

ã€èƒŒæ™¯çŸ¥è¯†ã€‘
${knowledgeContext}

ã€ç”¨æˆ·å‘½ç†æ•°æ®ã€‘
${JSON.stringify(context.calculatedBazi, null, 2)}

ã€å›ç­”è¦æ±‚ã€‘
1. ä¼˜å…ˆåŸºäºç®—æ³•è®¡ç®—ç»“æœ
2. å¼•ç”¨èƒŒæ™¯çŸ¥è¯†æ—¶æ³¨æ˜å‡ºå¤„ (å¦‚"æ ¹æ®ã€Šæ»´å¤©é«“ã€‹è®°è½½...")
3. è¯­è¨€é€šä¿—æ˜“æ‡‚,é¿å…è¿‡åº¦å¼•ç»æ®å…¸
4. ç»“è®ºæ˜ç¡®å¯æ“ä½œ
`;
  
  // 3. è°ƒç”¨AIç”Ÿæˆå›ç­”
  const result = await generateText({
    model: openai('deepseek-chat'),
    system: getSystemPrompt('bazi') + '\n\nä½ å¯ä»¥å¼•ç”¨ç»å…¸å‘½ç†å…¸ç±,ä½†éœ€æ³¨æ˜å‡ºå¤„ã€‚',
    prompt: enhancedPrompt,
    temperature: 0.7,
  });
  
  return result.text;
}
```

#### æ•ˆæœå¯¹æ¯”

**æ— RAG (å½“å‰):**
```
ç”¨æˆ·: "ç”²æœ¨æ—¥ä¸»çš„äººé€‚åˆåšä»€ä¹ˆå·¥ä½œ?"
AI: "ç”²æœ¨æ—¥ä¸»çš„äººæ€§æ ¼ç‰¹ç‚¹æ˜¯XXX,å»ºè®®ä»äº‹XXXè¡Œä¸šã€‚"
        â†‘ åªèƒ½åŸºäºç®—æ³•æ•°æ®æ³›æ³›è€Œè°ˆ
```

**æœ‰RAG (ä¼˜åŒ–å):**
```
ç”¨æˆ·: "ç”²æœ¨æ—¥ä¸»çš„äººé€‚åˆåšä»€ä¹ˆå·¥ä½œ?"
AI: "ç”²æœ¨æ—¥ä¸»çš„äºº,æ ¹æ®ã€Šæ»´å¤©é«“ã€‹è®°è½½:'ç”²æœ¨å‚å¤©,è„±èƒè¦ç«',è¡¨ç¤ºæ‚¨å¤©æ€§å‘ä¸Šã€æœ‰å¼€æ‹“ç²¾ç¥ã€‚
     ç»“åˆæ‚¨çš„å…«å­—åˆ†æ,æ—¥ä¸»ç”²æœ¨èº«å¼º,å»ºè®®ä»äº‹:
     1. æ•™è‚²åŸ¹è®­è¡Œä¸š(æœ¨ä¸»æ–‡æ•™,å‘æŒ¥å¼•å¯¼æ‰èƒ½)
     2. ç»¿è‰²ç¯ä¿äº§ä¸š(ä¸æœ¨å±æ€§ç›¸åˆ)
     3. åˆ›ä¸šæˆ–ç®¡ç†å²—ä½(ç”²æœ¨ä¸»åŠ¨,ä¸å®œè¢«åŠ¨)
     
     å‚è€ƒèµ„æ–™æ¥æº: ã€Šæ»´å¤©é«“Â·è®ºç”²æœ¨ã€‹"
        â†‘ å¼•ç»æ®å…¸,æƒå¨æ€§å¤§å¹…æå‡!
```

### æˆæœ¬ä¼°ç®—

**Embeddingæˆæœ¬** (ä¸€æ¬¡æ€§):
- å‡è®¾çŸ¥è¯†åº“æ€»è®¡500é¡µæ–‡æ¡£ â‰ˆ 300,000 tokens
- OpenAI text-embedding-3-small: $0.02 / 1M tokens
- æ€»æˆæœ¬: 300,000 / 1,000,000 * $0.02 = **$0.006** (å‡ ä¹å…è´¹)

**æŸ¥è¯¢æˆæœ¬** (æŒç»­):
- æ¯æ¬¡æŸ¥è¯¢æ£€ç´¢3æ®µç›¸å…³å†…å®¹ â‰ˆ å¢åŠ 1000 tokensä¸Šä¸‹æ–‡
- è¾¹é™…æˆæœ¬æå‡: çº¦20%
- ä½†ç”¨æˆ·ä½“éªŒå’Œæƒå¨æ€§çš„æå‡è¿œè¶…æˆæœ¬å¢åŠ 

**ç»“è®º**: RAGçš„ROIæé«˜,å¼ºçƒˆå»ºè®®ç«‹å³å®æ–½!

---

## ğŸ”„ è®¢é˜…ç•™å­˜ç­–ç•¥ (å»ºè®®5)

### å½“å‰é—®é¢˜

æ‚¨çš„Proè®¢é˜…($9.90/æœˆ,300ç§¯åˆ†/æœˆ)å’Œç»ˆèº«ç‰ˆ($199,500ç§¯åˆ†/æœˆ)å·²ç»å®ç°,ä½†å­˜åœ¨**ç•™å­˜æ¼æ´**:

âŒ **æ²¡æœ‰æŒç»­ä»·å€¼äº¤ä»˜**: ç”¨æˆ·è®¢é˜…å,æ¯æœˆåªæ˜¯è·å¾—300ç§¯åˆ†,ä½†ç§¯åˆ†ç”¨é€”ä¸å…è´¹ç”¨æˆ·å®Œå…¨ç›¸åŒ,æ— å·®å¼‚åŒ–ä»·å€¼ã€‚
âŒ **æ— åŠ¨æ€å†…å®¹**: è®¢é˜…åå¦‚æœç”¨æˆ·ä¸ä¸»åŠ¨ä½¿ç”¨,å°±æ²¡æœ‰ä»»ä½•è§¦ç‚¹,æµå¤±ç‡é«˜ã€‚

### ä¼˜åŒ–æ–¹æ¡ˆ: åŠ¨æ€"äººå®…åˆä¸€"è¿åŠ¿ä»ªè¡¨ç›˜

è¿™æ˜¯Proä¼šå‘˜çš„**æ ¸å¿ƒç‹¬äº«åŠŸèƒ½**,ä¹Ÿæ˜¯è®¢é˜…ç•™å­˜çš„å…³é”®ã€‚

#### äº§å“æ¦‚å¿µ

```
åç§°: "QiFlow åŠ¨æ€è¿åŠ¿ä»ªè¡¨ç›˜"
å®šä½: ä»"ä¸€æ¬¡æ€§ç®—å‘½"åˆ°"æŒç»­ç”Ÿæ´»æŒ‡å—"çš„é©å‘½æ€§è½¬å˜
æ ¸å¿ƒä»·å€¼: æ¯æ—¥æ›´æ–°çš„ä¸ªæ€§åŒ–äººå®…åˆä¸€å»ºè®®
```

#### åŠŸèƒ½è®¾è®¡

```typescript
// ğŸ“ æ–°å»º: src/app/(dashboard)/pro/dashboard/page.tsx

export default function ProDashboardPage() {
  return (
    <div className="space-y-6">
      {/* 1. ä»Šæ—¥è¿åŠ¿å¡ç‰‡ (æ¯æ—¥æ›´æ–°) */}
      <TodayFortuneCard />
      
      {/* 2. æœ¬æœˆäººå®…åˆä¸€é‡ç‚¹ (æ¯æœˆæ›´æ–°) */}
      <MonthlyFocusCard />
      
      {/* 3. åŠ¨æ€é£æ˜Ÿå›¾ (å®æ—¶è®¡ç®—) */}
      <DynamicFlyingStarChart />
      
      {/* 4. è¡ŒåŠ¨å»ºè®®æ¸…å• (AIç”Ÿæˆ) */}
      <ActionItemsList />
      
      {/* 5. å†å²è¶‹åŠ¿ (æ•°æ®å¯è§†åŒ–) */}
      <FortuneTrendChart />
    </div>
  );
}
```

#### æ ¸å¿ƒç»„ä»¶1: ä»Šæ—¥è¿åŠ¿å¡ç‰‡

```typescript
// ğŸ“ src/components/pro/TodayFortuneCard.tsx

export function TodayFortuneCard() {
  const today = new Date();
  const { baziData, fengshuiData } = useUserData();
  
  // ğŸ”¥ å…³é”®: å åŠ æµæ—¥çš„å½±å“
  const todayInfluence = calculateDailyInfluence(baziData, today);
  
  return (
    <Card className="bg-gradient-to-br from-indigo-500 to-purple-600 text-white">
      <CardHeader>
        <h2 className="text-2xl font-bold">
          â­ ä»Šæ—¥è¿åŠ¿ ({formatDate(today)})
        </h2>
        <p className="text-white/80">
          æµæ—¥: {todayInfluence.heavenlyStem}{todayInfluence.earthlyBranch}
        </p>
      </CardHeader>
      
      <CardContent className="space-y-4">
        {/* ç»¼åˆè¯„åˆ† */}
        <div className="flex items-center justify-between">
          <span>ç»¼åˆè¿åŠ¿</span>
          <div className="flex items-center gap-2">
            <Progress value={todayInfluence.overallScore * 100} className="w-32" />
            <span className="font-bold">{Math.round(todayInfluence.overallScore * 100)}åˆ†</span>
          </div>
        </div>
        
        {/* AIç”Ÿæˆçš„ä»Šæ—¥å»ºè®® */}
        <div className="bg-white/10 rounded-lg p-4">
          <h3 className="font-semibold mb-2">ğŸ’¡ ä»Šæ—¥é‡ç‚¹</h3>
          {todayInfluence.highlights.map((highlight, i) => (
            <p key={i} className="text-sm">â€¢ {highlight}</p>
          ))}
        </div>
        
        {/* ä»Šæ—¥å‰å‡¶æ–¹ä½ (äººå®…ç»“åˆ) */}
        <div>
          <h3 className="font-semibold mb-2">ğŸ§­ ä»Šæ—¥æ–¹ä½</h3>
          <div className="grid grid-cols-2 gap-2">
            <div className="bg-green-500/20 rounded p-2">
              <div className="text-xs text-green-200">å‰ä½</div>
              <div className="font-bold">{todayInfluence.favorableDirection}</div>
              <div className="text-xs">é€‚åˆ: å·¥ä½œã€æ´½è°ˆã€å†³ç­–</div>
            </div>
            <div className="bg-red-500/20 rounded p-2">
              <div className="text-xs text-red-200">å‡¶ä½</div>
              <div className="font-bold">{todayInfluence.unfavorableDirection}</div>
              <div className="text-xs">é¿å…: ä¹…åã€ä¼‘æ¯</div>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

#### æ ¸å¿ƒç»„ä»¶2: æœ¬æœˆäººå®…åˆä¸€é‡ç‚¹

```typescript
// ğŸ“ src/components/pro/MonthlyFocusCard.tsx

/**
 * è¿™æ˜¯ç•™å­˜çš„å…³é”®!
 * æ¯æœˆåˆ,ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆæœ¬æœˆçš„"äººå®…åˆä¸€"æ·±åº¦åˆ†æ
 * ç”¨æˆ·ä¼šåœ¨æ¯æœˆ1å·æ”¶åˆ°æ¨é€: "æ‚¨çš„1æœˆä¸“å±è¿åŠ¿æŒ‡å—å·²æ›´æ–°!"
 */

export function MonthlyFocusCard() {
  const currentMonth = new Date().getMonth() + 1;
  const { monthlyAnalysis } = useMonthlyFortune();  // ä»åç«¯è·å–
  
  return (
    <Card>
      <CardHeader>
        <h2 className="text-xl font-bold">
          ğŸ“… {currentMonth}æœˆäººå®…åˆä¸€é‡ç‚¹
        </h2>
        <p className="text-muted-foreground">
          åŸºäºæµæœˆé£æ˜Ÿä¸æ‚¨çš„å‘½ç†ç»¼åˆåˆ†æ
        </p>
      </CardHeader>
      
      <CardContent className="space-y-4">
        {/* âš ï¸ æœ¬æœˆè­¦æŠ¥ (å¦‚æœæœ‰) */}
        {monthlyAnalysis.alerts.length > 0 && (
          <Alert variant="destructive">
            <AlertTriangle className="h-4 w-4" />
            <AlertTitle>âš ï¸ æœ¬æœˆéœ€æ³¨æ„</AlertTitle>
            <AlertDescription>
              {monthlyAnalysis.alerts.map((alert, i) => (
                <div key={i} className="mt-2">
                  <strong>{alert.title}</strong>
                  <p className="text-sm">{alert.description}</p>
                  <p className="text-sm text-green-600">âœ… åŒ–è§£: {alert.solution}</p>
                </div>
              ))}
            </AlertDescription>
          </Alert>
        )}
        
        {/* æœ¬æœˆæœºé‡ */}
        <div className="bg-green-50 rounded-lg p-4">
          <h3 className="font-semibold text-green-900 mb-2">ğŸŒŸ æœ¬æœˆæœºé‡</h3>
          <ul className="space-y-2">
            {monthlyAnalysis.opportunities.map((opp, i) => (
              <li key={i} className="text-sm text-green-800">
                <strong>{opp.area}</strong>: {opp.description}
                <div className="text-xs text-green-600 mt-1">
                  æœ€ä½³æ—¶æœº: {opp.bestTiming}
                </div>
              </li>
            ))}
          </ul>
        </div>
        
        {/* æœ¬æœˆå¸ƒå±€è°ƒæ•´å»ºè®® */}
        <div>
          <h3 className="font-semibold mb-2">ğŸ  æœ¬æœˆå¸ƒå±€è°ƒæ•´</h3>
          <ol className="list-decimal list-inside space-y-1 text-sm">
            {monthlyAnalysis.layoutAdjustments.map((adj, i) => (
              <li key={i}>{adj}</li>
            ))}
          </ol>
        </div>
      </CardContent>
    </Card>
  );
}
```

#### åç«¯æ•°æ®ç”Ÿæˆ

```typescript
// ğŸ“ æ–°å»º: src/lib/qiflow/fortune/monthly-analysis.ts

export async function generateMonthlyAnalysis(
  userId: string,
  year: number,
  month: number
): Promise<MonthlyAnalysis> {
  // 1. è·å–ç”¨æˆ·åŸºç¡€æ•°æ®
  const user = await getUserData(userId);
  const { baziData, fengshuiData } = user;
  
  // 2. è®¡ç®—æµæœˆå½±å“
  const monthlyInfluence = calculateMonthlyInfluence(baziData, year, month);
  const monthlyFlyingStars = calculateMonthlyFlyingStars(fengshuiData, year, month);
  
  // 3. AIç»¼åˆåˆ†æ (äººå®…ç»“åˆ)
  const synthesisPrompt = `
ã€ä»»åŠ¡ã€‘ç”Ÿæˆç”¨æˆ·${year}å¹´${month}æœˆçš„"äººå®…åˆä¸€"è¿åŠ¿åˆ†æ

ã€ç”¨æˆ·å…«å­—ã€‘
æ—¥ä¸»: ${baziData.dayMaster}
ç”¨ç¥: ${baziData.favorableGod}
å–œå¿Œ: å–œ${baziData.joyGod}, å¿Œ${baziData.avoidGod}

ã€æµæœˆä¿¡æ¯ã€‘
æµæœˆå¹²æ”¯: ${monthlyInfluence.stem}${monthlyInfluence.branch}
ä¸æ—¥ä¸»å…³ç³»: ${monthlyInfluence.relationToDay Master}

ã€æˆ¿å±‹é£æ°´ã€‘
åå‘: å${fengshuiData.mountain}æœ${fengshuiData.facing}
${month}æœˆé£æ˜Ÿ: ${JSON.stringify(monthlyFlyingStars)}

ã€åˆ†æè¦æ±‚ã€‘
1. è¯†åˆ«æœ¬æœˆçš„é£é™©ç‚¹ (æµæœˆå†²å…‹ + é£æ˜Ÿå‡¶ä½)
2. è¯†åˆ«æœ¬æœˆçš„æœºé‡ç‚¹ (æµæœˆç”Ÿæ‰¶ + é£æ˜Ÿå‰ä½)
3. æä¾›3-5æ¡å¯æ‰§è¡Œçš„å¸ƒå±€è°ƒæ•´å»ºè®®
4. é¢„æµ‹æœ¬æœˆæœ€ä½³è¡ŒåŠ¨æ—¶æœº

ã€è¾“å‡ºJSONæ ¼å¼ã€‘
{
  "alerts": [
    {
      "title": "å¥åº·è­¦æŠ¥",
      "description": "æµæœˆäºŒé»‘é£ä¸´å¨æˆ¿,ä¸æ‚¨å…«å­—å¿Œç¥'åœŸ'å…±æŒ¯",
      "solution": "åœ¨å¨æˆ¿é—¨å£æ”¾ç½®é“œè‘«èŠ¦,æˆ–æœ¬æœˆå‡å°‘åœ¨å¨æˆ¿åœç•™æ—¶é—´"
    }
  ],
  "opportunities": [
    {
      "area": "äº‹ä¸š",
      "description": "æµæœˆå…«ç™½è´¢æ˜Ÿé£ä¸´ä¹¦æˆ¿,ä¸æ‚¨ç”¨ç¥'æœ¨'ç›¸ç”Ÿ",
      "bestTiming": "æœ¬æœˆ15-20æ—¥(ç”²æœ¨æ—¥)"
    }
  ],
  "layoutAdjustments": [
    "å°†åŠå…¬æ¡Œç§»è‡³ä¹¦æˆ¿ä¸œå—è§’(æµæœˆè´¢ä½)",
    "åœ¨å®¢å…æ­£å—æ‘†æ”¾çº¢è‰²æŠ±æ•(å¢å¼ºç”¨ç¥èƒ½é‡)"
  ]
}
`;
  
  const result = await generateText({
    model: openai('deepseek-chat'),
    prompt: synthesisPrompt,
    temperature: 0.7,
  });
  
  return JSON.parse(result.text);
}
```

#### è‡ªåŠ¨åŒ–ä»»åŠ¡ (Cron Job)

```typescript
// ğŸ“ æ–°å»º: src/app/api/cron/generate-monthly-fortunes/route.ts

/**
 * Vercel Cron: æ¯æœˆ1å·å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ‰§è¡Œ
 * ä¸ºæ‰€æœ‰Proè®¢é˜…ç”¨æˆ·ç”Ÿæˆæœ¬æœˆè¿åŠ¿
 */

export async function GET(request: Request) {
  // éªŒè¯Cronå¯†é’¥
  if (request.headers.get('Authorization') !== `Bearer ${process.env.CRON_SECRET}`) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth() + 1;
  
  // è·å–æ‰€æœ‰Pro/Lifetimeç”¨æˆ·
  const proUsers = await db.user.findMany({
    where: {
      OR: [
        { subscriptionPlan: 'pro' },
        { subscriptionPlan: 'lifetime' },
      ],
    },
  });
  
  console.log(`å¼€å§‹ä¸º ${proUsers.length} ä½è®¢é˜…ç”¨æˆ·ç”Ÿæˆ${month}æœˆè¿åŠ¿...`);
  
  for (const user of proUsers) {
    try {
      // ç”Ÿæˆæœˆåº¦åˆ†æ
      const analysis = await generateMonthlyAnalysis(user.id, year, month);
      
      // å­˜å‚¨åˆ°æ•°æ®åº“
      await db.monthlyFortune.create({
        data: {
          userId: user.id,
          year,
          month,
          analysisData: analysis,
        },
      });
      
      // å‘é€é€šçŸ¥ (å¯é€‰)
      await sendNotification(user.id, {
        title: `ğŸŒŸ æ‚¨çš„${month}æœˆä¸“å±è¿åŠ¿å·²æ›´æ–°!`,
        body: 'æŸ¥çœ‹æœ¬æœˆçš„äººå®…åˆä¸€é‡ç‚¹,æŠŠæ¡æœ€ä½³æ—¶æœº',
        link: '/pro/dashboard',
      });
      
    } catch (error) {
      console.error(`ç”¨æˆ·${user.id}ç”Ÿæˆå¤±è´¥:`, error);
    }
  }
  
  return NextResponse.json({ success: true, processed: proUsers.length });
}
```

```json
// vercel.json é…ç½®Cron
{
  "crons": [
    {
      "path": "/api/cron/generate-monthly-fortunes",
      "schedule": "0 2 1 * *"
    }
  ]
}
```

### ç•™å­˜æ•ˆæœé¢„æµ‹

**æ— åŠ¨æ€ä»ªè¡¨ç›˜ (å½“å‰)**:
- ç”¨æˆ·è®¢é˜…å,å¦‚æœä¸ä¸»åŠ¨ä½¿ç”¨,å°±æ²¡æœ‰ä»»ä½•ä»·å€¼æ„ŸçŸ¥
- é¢„è®¡30æ—¥ç•™å­˜ç‡: <50%
- é¢„è®¡90æ—¥ç»­è®¢ç‡: <30%

**æœ‰åŠ¨æ€ä»ªè¡¨ç›˜ (ä¼˜åŒ–å)**:
- æ¯å¤©æ‰“å¼€Appçœ‹"ä»Šæ—¥è¿åŠ¿",å½¢æˆä¹ æƒ¯
- æ¯æœˆ1å·æ”¶åˆ°"æœ¬æœˆè¿åŠ¿æ›´æ–°"æ¨é€,å¢å¼ºç²˜æ€§
- é¢„è®¡30æ—¥ç•™å­˜ç‡: >75%
- é¢„è®¡90æ—¥ç»­è®¢ç‡: >60%

**ç»“è®º**: åŠ¨æ€ä»ªè¡¨ç›˜æ˜¯è®¢é˜…ç•™å­˜çš„"æ ¸æ­¦å™¨"!

---

## ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­ç‰ˆè®¢é˜…è®¾è®¡ (å»ºè®®6)

### å¸‚åœºæœºé‡

**ç—›ç‚¹**: ä¸€ä¸ªå®¶åº­ä¸­,ä¸åŒæˆå‘˜çš„å…«å­—å–œå¿Œå¯èƒ½å†²çª,è€Œä»–ä»¬å…±ç”¨ä¸€ä¸ªä½å®…ã€‚ä¾‹å¦‚:
- çˆ¶äº²å–œç«,éœ€è¦å—æ–¹(ç«ä½)ä½œä¸ºåŠå…¬å®¤
- å„¿å­å¿Œç«,ä½†åˆéœ€è¦åœ¨å®¶å­¦ä¹ 
- å¦‚ä½•å¸ƒå±€æ‰èƒ½è®©å…¨å®¶äººçš„è¿åŠ¿éƒ½æœ€ä¼˜?

**å¸‚åœºç©ºç™½**: è¿™æ˜¯è¿äººç±»å¤§å¸ˆéƒ½å¤´ç–¼çš„å¤šç›®æ ‡ä¼˜åŒ–é—®é¢˜,ä½†æ°æ°æ˜¯AIæœ€æ“…é•¿çš„!

### äº§å“è®¾è®¡

#### å®šä»·

```typescript
// ğŸ“ website.ts æ–°å¢

plans: {
  // ç°æœ‰plans...
  
  family: {
    id: 'family',
    prices: [
      {
        type: 'subscription',
        priceId: process.env.NEXT_PUBLIC_STRIPE_PRICE_FAMILY_MONTHLY!,
        amount: 2990,  // $29.90/æœˆ
        currency: 'USD',
        interval: 'month',
      },
      {
        type: 'subscription',
        priceId: process.env.NEXT_PUBLIC_STRIPE_PRICE_FAMILY_YEARLY!,
        amount: 29900,  // $299/å¹´ (ç›¸å½“äº10ä¸ªæœˆä»·æ ¼)
        currency: 'USD',
        interval: 'year',
      },
    ],
    isFree: false,
    isLifetime: false,
    popular: false,
    maxMembers: 5,  // ğŸ†• å®¶åº­ç‰ˆç‰¹æœ‰
    credits: {
      enable: true,
      amount: 800,  // æ¯”Proçš„300å¤šå¾ˆå¤š,å› ä¸ºæ”¯æŒ5äºº
      expireDays: 0,
    },
  },
}
```

#### æ ¸å¿ƒåŠŸèƒ½: AIå®¶åº­å’Œè°åè°ƒå®˜

```typescript
// ğŸ“ æ–°å»º: src/lib/qiflow/family/harmony-optimizer.ts

interface FamilyMember {
  id: string;
  name: string;
  relationship: 'father' | 'mother' | 'son' | 'daughter' | 'other';
  baziData: ComputedBaziResult;
}

interface HouseInfo {
  facing: string;
  degree: number;
  rooms: {
    name: string;  // 'ä¸»å§'ã€'æ¬¡å§'ã€'ä¹¦æˆ¿'ã€'å®¢å…'
    position: string;  // 'ä¸œå—'ã€'è¥¿åŒ—'
  }[];
}

export async function optimizeFamilyHarmony(
  members: FamilyMember[],
  house: HouseInfo
): Promise<FamilyHarmonyPlan> {
  
  // Step 1: åˆ†ææ¯ä¸ªæˆå‘˜çš„å–œå¿Œ
  const memberPreferences = members.map(member => ({
    id: member.id,
    name: member.name,
    favorableDirections: extractFavorableDirections(member.baziData),
    unfavorableDirections: extractUnfavorableDirections(member.baziData),
    favorableElements: member.baziData.favorableGod,
    unfavorableElements: member.baziData.avoidGod,
  }));
  
  // Step 2: è¯†åˆ«å†²çªç‚¹
  const conflicts = detectConflicts(memberPreferences, house);
  
  // Step 3: AIå¤šç›®æ ‡ä¼˜åŒ–
  const optimizationPrompt = `
ä½ æ˜¯ä¸€ä½å®¶åº­é£æ°´åè°ƒä¸“å®¶,éœ€è¦ä¸ºä¸€ä¸ª${members.length}äººå®¶åº­è®¾è®¡æœ€ä¼˜çš„ä½å®…å¸ƒå±€æ–¹æ¡ˆã€‚

ã€å®¶åº­æˆå‘˜ã€‘
${memberPreferences.map((m, i) => `
${i+1}. ${m.name} (${members[i].relationship})
   - å–œç”¨ç¥: ${m.favorableElements}
   - å–œæ–¹ä½: ${m.favorableDirections.join('ã€')}
   - å¿Œæ–¹ä½: ${m.unfavorableDirections.join('ã€')}
`).join('\n')}

ã€ä½å®…ä¿¡æ¯ã€‘
æœå‘: ${house.facing}åº¦
æˆ¿é—´: ${house.rooms.map(r => `${r.name}(${r.position})`).join('ã€')}

ã€è¯†åˆ«çš„å†²çªã€‘
${conflicts.map(c => `âš ï¸ ${c.description}`).join('\n')}

ã€ä¼˜åŒ–ç›®æ ‡ã€‘
æ‰¾åˆ°ä¸€ä¸ªè®©å…¨å®¶äºº"ç»¼åˆè¿åŠ¿æœ€å¤§åŒ–"çš„å¸•ç´¯æ‰˜æœ€ä¼˜è§£,è€Œéè®©æŸä¸ªäºº100%å®Œç¾ã€‚

ã€è¾“å‡ºè¦æ±‚ (JSONæ ¼å¼)ã€‘
{
  "roomAssignments": [
    {
      "room": "ä¸»å§",
      "assignedTo": "çˆ¶äº²",
      "reason": "ä¸»å§ä½äºè¥¿åŒ—,å±çˆ¶äº²ç”¨ç¥æ–¹ä½,æœ‰åˆ©äº‹ä¸šè¿"
    }
  ],
  "layoutAdjustments": [
    "åœ¨å®¢å…ä¸œåŒ—è§’(å±åœŸ)æ”¾ç½®é»„æ°´æ™¶çƒ,ä»¥åœŸæ³„ç«,å¹³è¡¡çˆ¶äº²ç«æ—ºå¯¹å„¿å­çš„å½±å“"
  ],
  "compromises": [
    {
      "member": "å„¿å­",
      "sacrifice": "ä¹¦æˆ¿ä½äºå—æ–¹,ç•¥æœ‰ä¸åˆ©",
      "compensation": "é€šè¿‡åœ¨ä¹¦æˆ¿åŒ—å¢™æŒ‚è“è‰²å±±æ°´ç”»(æ°´å…‹ç«)è¿›è¡ŒåŒ–è§£"
    }
  ],
  "overallHarmonyScore": 0.85  // 0-1,ç»¼åˆå’Œè°åº¦
}
`;
  
  const result = await generateText({
    model: openai('gpt-4'),  // å®¶åº­ç‰ˆç”¨æ›´å¼ºçš„æ¨¡å‹
    prompt: optimizationPrompt,
    temperature: 0.7,
  });
  
  return JSON.parse(result.text);
}
```

#### å‰ç«¯ä½“éªŒ: å®¶åº­ç®¡ç†é¡µé¢

```typescript
// ğŸ“ æ–°å»º: src/app/(dashboard)/family/page.tsx

export default function FamilyDashboardPage() {
  const { familyMembers, harmonyPlan } = useFamilyData();
  
  return (
    <div className="space-y-6">
      {/* å®¶åº­æˆå‘˜å¡ç‰‡ */}
      <div className="grid md:grid-cols-3 gap-4">
        {familyMembers.map(member => (
          <Card key={member.id}>
            <CardHeader>
              <h3 className="font-bold">{member.name}</h3>
              <p className="text-sm text-muted-foreground">{member.relationship}</p>
            </CardHeader>
            <CardContent>
              <div className="text-sm space-y-1">
                <div>æ—¥ä¸»: {member.baziData.dayMaster}</div>
                <div>ç”¨ç¥: {member.baziData.favorableGod}</div>
                <div className="text-green-600">å–œ: {member.favorableDirections.join('ã€')}</div>
                <div className="text-red-600">å¿Œ: {member.unfavorableDirections.join('ã€')}</div>
              </div>
            </CardContent>
          </Card>
        ))}
        
        {familyMembers.length < 5 && (
          <Card className="border-dashed">
            <CardContent className="flex items-center justify-center h-full">
              <Button variant="outline">
                <Plus className="mr-2" /> æ·»åŠ å®¶åº­æˆå‘˜
              </Button>
            </CardContent>
          </Card>
        )}
      </div>
      
      {/* AIå’Œè°æ–¹æ¡ˆ */}
      <Card>
        <CardHeader>
          <h2 className="text-xl font-bold">ğŸ  AIå®¶åº­å’Œè°æ–¹æ¡ˆ</h2>
          <p className="text-muted-foreground">
            ç»¼åˆå’Œè°åº¦: {Math.round(harmonyPlan.overallHarmonyScore * 100)}%
          </p>
        </CardHeader>
        
        <CardContent className="space-y-6">
          {/* æˆ¿é—´åˆ†é… */}
          <div>
            <h3 className="font-semibold mb-3">ğŸ“ æˆ¿é—´åˆ†é…å»ºè®®</h3>
            <div className="space-y-2">
              {harmonyPlan.roomAssignments.map((assignment, i) => (
                <div key={i} className="bg-blue-50 rounded p-3">
                  <div className="font-medium">{assignment.room} â†’ {assignment.assignedTo}</div>
                  <div className="text-sm text-muted-foreground">{assignment.reason}</div>
                </div>
              ))}
            </div>
          </div>
          
          {/* å¸ƒå±€è°ƒæ•´ */}
          <div>
            <h3 className="font-semibold mb-3">ğŸ”§ å¸ƒå±€ä¼˜åŒ–å»ºè®®</h3>
            <ol className="list-decimal list-inside space-y-2 text-sm">
              {harmonyPlan.layoutAdjustments.map((adj, i) => (
                <li key={i}>{adj}</li>
              ))}
            </ol>
          </div>
          
          {/* å¦¥åä¸è¡¥å¿ (é€æ˜åŒ–) */}
          {harmonyPlan.compromises.length > 0 && (
            <div>
              <h3 className="font-semibold mb-3">âš–ï¸ å¹³è¡¡ä¸åŒ–è§£</h3>
              <Alert>
                <AlertDescription>
                  <p className="mb-2">ä¸ºäº†å…¨å®¶æ•´ä½“å’Œè°,éƒ¨åˆ†æˆå‘˜éœ€è¦åšå‡ºå°çš„å¦¥å:</p>
                  {harmonyPlan.compromises.map((comp, i) => (
                    <div key={i} className="mt-2">
                      <strong>{comp.member}</strong>
                      <div className="text-sm">âŒ {comp.sacrifice}</div>
                      <div className="text-sm text-green-600">âœ… è¡¥å¿æ–¹æ¡ˆ: {comp.compensation}</div>
                    </div>
                  ))}
                </Alert>
              </AlertDescription>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
```

### å·®å¼‚åŒ–ä¼˜åŠ¿

è¿™ä¸ªåŠŸèƒ½è®©QiFlowAIåœ¨å¸‚åœºä¸Š**ç‹¬ä¸€æ— äºŒ**:
1. **Joey Yapã€Sean Chanç­‰å¤§å¸ˆ**: åªèƒ½æä¾›"å•äºº"åˆ†æ,æ— æ³•è§£å†³å®¶åº­å†²çª
2. **å…¶ä»–SaaSç«å“**: åŒæ ·åªæ”¯æŒå•äººæ¨¡å¼
3. **ä½ çš„AI**: å¯ä»¥åŒæ—¶å¤„ç†5äººçš„å¤šç›®æ ‡ä¼˜åŒ–,è¿™æ˜¯äººç±»å¤§å¸ˆåšä¸åˆ°çš„!

**å®šä»·$29.90/æœˆå®Œå…¨åˆç†**,å› ä¸ºè¿™ç›¸å½“äº5ä¸ªäººçš„ä¸ªäººç‰ˆ($9.90 * 5 = $49.50)çš„6æŠ˜ä¼˜æƒ ,è€Œä¸”æä¾›äº†ç‹¬å®¶çš„"å†²çªåè°ƒ"åŠŸèƒ½ã€‚

---

## ğŸ¤– é¢å‘æœªæ¥çš„æ¶æ„æ¼”è¿› (å»ºè®®7)

### é•¿æœŸæ„¿æ™¯: å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

è™½ç„¶æ‚¨æ˜ç¡®è¡¨ç¤º"å¤šæ™ºèƒ½ä½“ä»¥ååš",ä½†å½“å‰çš„æ¶æ„è®¾è®¡å¿…é¡»ä¸ºæœªæ¥ç•™å¥½"æ¥å£"ã€‚

### å½“å‰æ¶æ„ä¼˜åŠ¿ (å·²ç»å¾ˆå¥½!)

âœ… **ç®—æ³•æœåŠ¡åŒ–**: `computeBaziSmart`ã€`generateFlyingStar` å·²ç»æ˜¯çº¯å‡½æ•°,æ— çŠ¶æ€
âœ… **ç¼–æ’æ¨¡å¼**: `src/app/api/qiflow/chat/route.ts` å·²ç»å±•ç°äº†ç¼–æ’æ€ç»´ (è¯†åˆ«æ„å›¾â†’æ£€æŸ¥æ•°æ®â†’ç®—æ³•è®¡ç®—â†’AIç»„ç»‡)
âœ… **æ•°æ®ä¸é€»è¾‘åˆ†ç¦»**: é…ç½®åœ¨`website.ts`/`qiflow-pricing.ts`,ä¸šåŠ¡é€»è¾‘åœ¨`/actions`

### éœ€è¦ä¼˜åŒ–çš„ç‚¹

âŒ **APIè·¯ç”±è¿‡äºå•ä½“**: `chat/route.ts` 1400+è¡Œ,åŒ…å«äº†å¤ªå¤šèŒè´£
âŒ **ç¼ºå°‘æ˜ç¡®çš„æœåŠ¡è¾¹ç•Œ**: ç®—æ³•è°ƒç”¨ã€AIè°ƒç”¨ã€æ•°æ®åº“æ“ä½œæ··åœ¨ä¸€èµ·

### é‡æ„å»ºè®®: å¾®æœåŠ¡åŒ–æ€ç»´

```typescript
// ğŸ“ ç›®æ ‡æ¶æ„: æœåŠ¡åˆ†å±‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Layer (ç¼–æ’å±‚)                      â”‚
â”‚  /api/qiflow/chat/route.ts             â”‚
â”‚  èŒè´£: æ¥æ”¶è¯·æ±‚ã€ç¼–æ’æœåŠ¡ã€è¿”å›ç»“æœ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Algorithm     â”‚ â”‚ AI Service      â”‚
â”‚ Service       â”‚ â”‚ Layer           â”‚
â”‚               â”‚ â”‚                 â”‚
â”‚ - bazi       â”‚ â”‚ - generateText  â”‚
â”‚ - fengshui   â”‚ â”‚ - embedding     â”‚
â”‚ - xuankong   â”‚ â”‚ - RAG query     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  Data Layer               â”‚
â”‚  - User State             â”‚
â”‚  - Credits Manager        â”‚
â”‚  - Analysis History       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…·ä½“æ­¥éª¤**:

```typescript
// ğŸ“ Step 1: åˆ›å»º src/services/ ç›®å½•,æŠ½è±¡æœåŠ¡

// src/services/algorithm/index.ts
export class AlgorithmService {
  async computeBazi(input: BaziInput): Promise<BaziResult> {
    return computeBaziSmart(input);
  }
  
  async computeFengshui(input: FengshuiInput): Promise<FengshuiResult> {
    return generateFlyingStar(input);
  }
}

// src/services/ai/index.ts
export class AIService {
  async generateAnalysis(
    type: 'bazi' | 'fengshui' | 'synthesis',
    data: any
  ): Promise<string> {
    const systemPrompt = getSystemPrompt(type);
    // è°ƒç”¨AIæ¨¡å‹...
  }
  
  async queryKnowledge(question: string): Promise<string[]> {
    // RAGæŸ¥è¯¢...
  }
}

// src/services/orchestrator/index.ts (æœªæ¥çš„æ™ºèƒ½ä½“ç¼–æ’å™¨)
export class QiFlowOrchestrator {
  constructor(
    private algorithm: AlgorithmService,
    private ai: AIService,
    private data: DataService
  ) {}
  
  async handleChatMessage(message: string, context: any): Promise<ChatResponse> {
    // 1. æ„å›¾è¯†åˆ«
    const intent = await this.detectIntent(message);
    
    // 2. è°ƒç”¨ç›¸åº”æœåŠ¡
    if (intent === 'bazi') {
      const baziData = await this.algorithm.computeBazi(context.birthInfo);
      const analysis = await this.ai.generateAnalysis('bazi', baziData);
      return { response: analysis, creditsUsed: 5 };
    }
    // ...
  }
}
```

**ä¼˜åŠ¿**:
1. **æ˜“æµ‹è¯•**: æ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹æµ‹è¯•
2. **æ˜“æ‰©å±•**: æœªæ¥è¦åŠ "ç´«å¾®æ–—æ•°æœåŠ¡",åªéœ€åœ¨`AlgorithmService`å¢åŠ ä¸€ä¸ªæ–¹æ³•
3. **æ˜“æ™ºèƒ½ä½“åŒ–**: `QiFlowOrchestrator` å¤©ç„¶å°±æ˜¯ä¸€ä¸ªæ™ºèƒ½ä½“çš„é›å½¢

### æ•°æ®åº“Schemaä¸ºæœªæ¥å‡†å¤‡

```prisma
// ğŸ“ prisma/schema.prisma

// ğŸ†• ä¸ºæœªæ¥çš„å¤šæ™ºèƒ½ä½“å¯¹è¯å‡†å¤‡
model Conversation {
  id        String   @id @default(cuid())
  userId    String
  type      String   // 'single' | 'multi_agent'
  messages  Message[]
  metadata  Json?    // å­˜å‚¨å¯¹è¯ä¸Šä¸‹æ–‡
  createdAt DateTime @default(now())
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  role           String   // 'user' | 'assistant' | 'agent_bazi' | 'agent_fengshui'
  content        String   @db.Text
  agentId        String?  // æœªæ¥: æ ‡è¯†å“ªä¸ªæ™ºèƒ½ä½“ç”Ÿæˆçš„
  creditsUsed    Int      @default(0)
  createdAt      DateTime @default(now())
}
```

**æœªæ¥çš„å¤šæ™ºèƒ½ä½“å¯¹è¯æµç¨‹** (é¢„æ¼”):
```
ç”¨æˆ·: "æˆ‘æƒ³çŸ¥é“æ˜å¹´é€‚åˆè·³æ§½å—?è€Œä¸”æ–°åŠå…¬å®¤è¯¥é€‰å“ªä¸ªæ–¹ä½?"

Orchestrator: æ£€æµ‹åˆ°éœ€è¦2ä¸ªæ™ºèƒ½ä½“åä½œ
  â†“
Agent_Bazi: "æ ¹æ®æ‚¨çš„å…«å­—,æ˜å¹´èµ°'æ­£å®˜è¿',é€‚åˆèŒä¸šæ™‹å‡..."
  â†“
Agent_Fengshui: "æ‚¨çš„ç”¨ç¥ä¸ºç«,æ–°åŠå…¬å®¤å»ºè®®é€‰å—æ–¹æˆ–ä¸œæ–¹..."
  â†“
Agent_Synthesis: "ç»¼åˆä»¥ä¸Šåˆ†æ,æ˜å¹´Q2è·³æ§½æœ€ä½³,åŠå…¬å®¤ä¼˜é€‰å—æ–¹..."
```

---

---

## âš ï¸ é£é™©æ§åˆ¶æ¸…å•

### æˆæœ¬å¤±æ§é˜²æŠ¤

```typescript
// ğŸ“ æ–°å»º: src/lib/cost-guard.ts

// 1. æ¯æ—¥æˆæœ¬ç›‘æ§
export async function checkDailyCost() {
  const today = new Date().toISOString().split('T')[0];
  const cost = await calculateDailyCost(today);  // æŸ¥è¯¢AIè°ƒç”¨è®°å½•
  
  if (cost > 50) {
    await sendAlert('warning', `ä»Šæ—¥AIæˆæœ¬: $${cost}, å·²è¶…é˜ˆå€¼$50`);
  }
  
  if (cost >= 100) {
    await sendAlert('critical', `ä»Šæ—¥AIæˆæœ¬: $${cost}, å·²è¾¾$100é˜ˆå€¼`);
    await toggleFeatureFlag('allow_new_registrations', false);  // æš‚åœæ–°æ³¨å†Œ
  }
}

// 2. ç”¨æˆ·çº§æˆæœ¬è¿½è¸ª
export async function trackUserCost(userId: string, operation: string, tokens: number) {
  const cost = calculateCost(operation, tokens);
  
  await db.userCostLog.create({
    data: { userId, operation, tokens, cost, createdAt: new Date() },
  });
  
  // å¼‚å¸¸æ£€æµ‹: å•ç”¨æˆ·æ—¥æ¶ˆè€—>$5
  const dailyCost = await getUserDailyCost(userId);
  if (dailyCost > 5) {
    await flagUser(userId, 'high_cost_usage');
  }
}
```

### å¹‚ç­‰è®¾è®¡æ¨¡å¼

```typescript
// ğŸ“ Webhookå¹‚ç­‰
async function handleStripeWebhook(event: Stripe.Event) {
  // 1. æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
  const existing = await db.webhookEvent.findUnique({
    where: { eventId: event.id },
  });
  
  if (existing) {
    console.log(`[Webhook] Event ${event.id} already processed`);
    return { received: true, duplicate: true };
  }
  
  // 2. å¤„ç†ä¸šåŠ¡é€»è¾‘
  await processPayment(event.data.object);
  
  // 3. æ ‡è®°å·²å¤„ç†
  await db.webhookEvent.create({
    data: { eventId: event.id, type: event.type, processedAt: new Date() },
  });
}

// ğŸ“ ä»»åŠ¡é¢†å¥–å¹‚ç­‰
async function claimMissionReward(userId: string, missionId: string) {
  const mission = await db.userMission.findFirst({
    where: { userId, missionId },
  });
  
  // åŒé‡æ£€æŸ¥
  if (!mission?.completed || mission.rewardClaimed) {
    throw new Error('Mission not eligible for reward');
  }
  
  // ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§
  await db.$transaction(async (tx) => {
    // å‘æ”¾ç§¯åˆ†
    await tx.userCredits.create({
      data: { userId, amount: mission.reward, source: 'mission_reward' },
    });
    
    // æ ‡è®°å·²é¢†å–
    await tx.userMission.update({
      where: { id: mission.id },
      data: { rewardClaimed: true, claimedAt: new Date() },
    });
  });
}
```

### åä½œå¼Šæœºåˆ¶

```typescript
// ğŸ“ æ–°å»º: src/lib/anti-fraud.ts

// 1. æ³¨å†Œé¢‘ç‡é™åˆ¶
export async function checkSignupRate(ip: string): Promise<boolean> {
  const recent = await redis.get(`signup_rate:${ip}`);
  
  if (recent && parseInt(recent) >= 3) {
    return false;  // åŒä¸€IP 1å°æ—¶å†…åªèƒ½æ³¨å†Œ3æ¬¡
  }
  
  await redis.setex(`signup_rate:${ip}`, 3600, (parseInt(recent || '0') + 1).toString());
  return true;
}

// 2. ä»»åŠ¡å®Œæˆæ¨¡å¼æ£€æµ‹
export async function detectAbnormalBehavior(userId: string): Promise<void> {
  const missions = await db.userMission.findMany({
    where: { userId, completed: true },
    orderBy: { completedAt: 'asc' },
  });
  
  // å¼‚å¸¸æ¨¡å¼: 5ä¸ªä»»åŠ¡åœ¨5åˆ†é’Ÿå†…å…¨éƒ¨å®Œæˆ
  if (missions.length === 5) {
    const timespan = missions[4].completedAt.getTime() - missions[0].completedAt.getTime();
    if (timespan < 5 * 60 * 1000) {
      await flagUser(userId, 'suspicious_mission_completion');
    }
  }
}

// 3. ä¼šè¯æ»¥ç”¨æ£€æµ‹
export async function validateChatSession(sessionId: string): Promise<boolean> {
  const session = await db.chatSession.findUnique({ where: { id: sessionId } });
  
  if (!session || session.expiresAt < new Date()) {
    return false;
  }
  
  // é˜²åˆ·: å•ä¼šè¯æœ€å¤š50æ¡æ¶ˆæ¯
  if (session.messageCount >= 50) {
    await db.chatSession.update({
      where: { id: sessionId },
      data: { flagged: true, flagReason: 'excessive_messages' },
    });
    return false;
  }
  
  return true;
}
```

---

## ğŸ—ºï¸ å®æ–½è·¯çº¿å›¾ (MVPæ”¶æ•›ç‰ˆ)

### ğŸš€ P0ä¸Šçº¿åŒ… (Week 1, å¿…é¡»å®Œæˆ)

**ç›®æ ‡**: æœ€å°å¯ç”¨+å®‰å…¨åˆè§„,å…ˆéªŒè¯"æŠ¥å‘Šå˜ç°"æ ¸å¿ƒå‡è®¾

```yaml
Day 1-2: å®‰å…¨åˆè§„ä¸‰ä»¶å¥— (ä¸å¯å¦¥å)
  âœ… 1. TurnstileéªŒè¯ç 
    - ä¿®æ”¹: src/config/website.ts 
      features.enableTurnstileCaptcha: false â†’ true
    - ç¯å¢ƒå˜é‡: NEXT_PUBLIC_TURNSTILE_SITE_KEY
    - æµ‹è¯•: æ³¨å†Œé¡µèƒ½æ­£å¸¸æ˜¾ç¤ºä¸æ ¡éªŒ
  
  âœ… 2. Webhookå¹‚ç­‰è®¾è®¡
    - ä¿®æ”¹: src/app/api/webhooks/stripe/route.ts
    - å¢åŠ : event.idå»é‡è¡¨ stripe_webhook_events
    - é˜²æ­¢: é‡å¤æ‰£æ¬¾/é‡å¤å‘è´§
    ```typescript
    // å¹‚ç­‰æ£€æŸ¥
    const processed = await db.webhookEvent.findUnique({
      where: { eventId: event.id },
    });
    if (processed) {
      return NextResponse.json({ received: true });
    }
    ```
  
  âœ… 3. AIåˆè§„å‰ç¼€
    - ä¿®æ”¹: src/lib/qiflow/ai/system-prompt.ts
    - æ·»åŠ : COMPLIANCE_PREFIX = "æ‚¨æ­£åœ¨ä½¿ç”¨AIè¾…åŠ©åˆ†æå·¥å…·,ç»“æœä»…ä¾›å‚è€ƒ,ä¸æ„æˆä¸“ä¸šå»ºè®®..."
    - åº”ç”¨: æ‰€æœ‰AIç”Ÿæˆå†…å®¹ç»Ÿä¸€æ³¨å…¥

Day 3-5: æŠ¥å‘Šäº§å“MVP (å…è´¹+ç²¾åä¸¤æ¡£)
  âœ… 1. å®šä»·é…ç½®
    - ä¿®æ”¹: src/config/qiflow-pricing.ts
    - æ–°å¢: reportBasic: 0, reportEssential: 99
    - âŒ æš‚ä¸åŠ : reportPremium (äºŒæœŸ)
  
  âœ… 2. æŠ¥å‘Šç”Ÿæˆå¼•æ“
    - æ–°å»º: src/lib/qiflow/reports/essential-report.ts
    - æ ¸å¿ƒ: generateEssentialReport(baziData, fengshuiData)
    - åŒ…å«: 5å¤§ç« èŠ‚(å‘½ç†DNA/äº‹ä¸šè´¢è¿/ç©ºé—´èƒ½é‡/äººå®…ç»“åˆ/è¡ŒåŠ¨æ¸…å•)
    - è´¨é‡å®¡æ ¸: aiQualityAudit() æ£€æŸ¥åˆè§„æ€§
  
  âœ… 3. Stripeäº§å“è®¾ç½®
    - Stripe Dashboard:
      * äº§å“å: "QiFlowç²¾åæŠ¥å‘Š"
      * ä»·æ ¼: $9.90 one-time payment
      * Webhook URL: /api/webhooks/stripe
    - ç¯å¢ƒå˜é‡: STRIPE_PRICE_ESSENTIAL_REPORT

Day 6-7: è´­ä¹°æµç¨‹ä¸å¹‚ç­‰
  âœ… 1. è´­ä¹°é¡µ
    - æ–°å»º: src/app/(dashboard)/reports/essential/buy/page.tsx
    - å±•ç¤º: æŠ¥å‘Šæ ·ä¾‹(å…è´¹ç‰ˆ) + ç²¾åç‰ˆå¯¹æ¯” + è´­ä¹°æŒ‰é’®
  
  âœ… 2. Webhookè§¦å‘ç”Ÿæˆ
    - ä¿®æ”¹: src/app/api/webhooks/stripe/route.ts
    - äº‹ä»¶: checkout.session.completed
    - é€»è¾‘: 
      1. å¹‚ç­‰æ£€æŸ¥(event.id)
      2. ç”ŸæˆæŠ¥å‘Š â†’ å­˜å‚¨åˆ°ç”¨æˆ·è´¦æˆ·
      3. å‘é€é‚®ä»¶é€šçŸ¥(é™„ä¸‹è½½é“¾æ¥)
  
  âœ… 3. æˆæœ¬ç›‘æ§
    - æ–°å»º: scripts/monitor-ai-cost.ts
    - è¿½è¸ª: æ¯æ—¥AI tokenæ¶ˆè€— + è´¹ç”¨
    - å‘Šè­¦: >$50å‘é‚®ä»¶, â‰¥$100æš‚åœæ–°æ³¨å†Œ

âœ… æˆåŠŸæ ‡å‡†:
  - [ ] ç”¨æˆ·èƒ½æˆåŠŸæ”¯ä»˜$9.90å¹¶ä¸‹è½½æŠ¥å‘Š
  - [ ] æŠ¥å‘ŠåŒ…å«"äººå®…ç»“åˆ"ç« èŠ‚(AIç”Ÿæˆ)
  - [ ] Webhookå¹‚ç­‰,æ— é‡å¤æ‰£æ¬¾
  - [ ] æˆæœ¬ç›‘æ§å°±ä½,æœ‰å‘Šè­¦
  - [ ] æ”¯ä»˜æˆåŠŸç‡>95%
```

### ğŸ“Š P1å¢é•¿éªŒè¯ (Week 2-4, è½¬åŒ–ä¼˜åŒ–)

```yaml
Week 2: ä¸¤é˜¶æ®µA/Bæµ‹è¯• - é˜¶æ®µ1å¯åŠ¨
  Day 1-2: è½»é‡çº§åˆ†ç»„å®ç°
    - âŒ ä¸ç”¨GrowthBookç­‰ç¬¬ä¸‰æ–¹(å¢åŠ å¤æ‚åº¦)
    - ä¿®æ”¹: src/actions/signup.ts
    - é€»è¾‘: 
      ```typescript
      const abGroup = (hash(userId) % 2 === 0) ? 'A' : 'B';
      // A=70ç§¯åˆ†æ— ä»»åŠ¡, B=50ç§¯åˆ†+ä»»åŠ¡(æ€»250)
      ```
    - å­˜å‚¨: user.metadata = { abGroup, abPhase: 1 }
  
  Day 3-4: ä»»åŠ¡ç³»ç»Ÿå‰ç«¯
    - æ–°å»º: src/components/onboarding/OnboardingBanner.tsx
    - å±•ç¤º: å½“å‰ä»»åŠ¡è¿›åº¦ + å¥–åŠ±é¢„è§ˆ
    - æ¥å…¥: ç°æœ‰ /api/missions/newbie API
  
  Day 5-7: ä»»åŠ¡è‡ªåŠ¨å®Œæˆä¸é¢†å¥–
    - æ–°å»º: src/app/api/missions/claim/route.ts
    - é’©å­: å…«å­—/é£æ°´/Chatå®Œæˆåè‡ªåŠ¨è§¦å‘
    - å¹‚ç­‰: completed=true + rewardClaimed=trueåŒæ£€æŸ¥

Week 3-4: ç›‘æ§ä¸å†³ç­–
  Day 1-3: ç®€å•ç›‘æ§è„šæœ¬
    - æ–°å»º: scripts/ab-test-report.ts
    - æŸ¥è¯¢: æ³¨å†Œ/æ¿€æ´»/ä»˜è´¹/ç•™å­˜ æŒ‰A/Båˆ†ç»„
    - è¾“å‡º: CSVæŠ¥è¡¨ + å…³é”®æŒ‡æ ‡å¯¹æ¯”
  
  Day 4-7: æ•°æ®ç§¯ç´¯ä¸ä¸­æœŸè¯„ä¼°
    - ç›®æ ‡: è‡³å°‘300æ³¨å†Œ/ç»„
    - è¯„ä¼°: ç¬¬3å‘¨æœ«çœ‹åˆæ­¥è¶‹åŠ¿
    - å†³ç­–: æ˜¯å¦è¿›å…¥é˜¶æ®µ2æˆ–å›æ»š

âœ… æˆåŠŸæ ‡å‡†:
  - [ ] A/Båˆ†ç»„ç¨³å®š,æ— æŠ€æœ¯å¼‚å¸¸
  - [ ] Bç»„ä»»åŠ¡å®Œæˆç‡>60%
  - [ ] æ•°æ®å¯è¿½è¸ª(signupâ†’activationâ†’paid)
  - [ ] æˆæœ¬åœ¨é˜ˆå€¼å†…(<$50/å¤©)
```

### ğŸ¯ P1äº’åŠ¨å¢å¼º (Month 2, æå‡ç²˜æ€§ä¸æƒå¨æ„Ÿ)

```yaml
Week 5-6: ä¼šè¯åˆ¶Chat (ä¼˜å…ˆ,å½±å“äº’åŠ¨é¢‘æ¬¡)
  Day 1-2: æ•°æ®åº“Schema
    - æ–°å»ºè¡¨: chat_session
      * userId, startedAt, expiresAt
      * messageCount (é˜²æ»¥ç”¨)
      * type='15min' (MVPåªè¿™ä¸€æ¡£)
  
  Day 3-5: åç«¯é€»è¾‘
    - æ–°å»º: src/app/api/qiflow/chat/session/route.ts
    - è´­ä¹°: æ‰£10ç§¯åˆ† â†’ åˆ›å»º15åˆ†é’Ÿä¼šè¯
    - å®ˆå«: ä¼šè¯å†…å…æ‰£å•æ¡5ç§¯åˆ†
    - é˜²æ»¥ç”¨: messageCount>50å¼ºåˆ¶ç»“æŸ
  
  Day 6-7: å‰ç«¯UI(ç®€åŒ–ç‰ˆ)
    - å•ä¸€æŒ‰é’®: "å¼€å¯15åˆ†é’Ÿæ·±åº¦å¯¹è¯(10ç§¯åˆ†)"
    - å€’è®¡æ—¶: "å‰©ä½™12:34"
    - âŒ ä¸åš: å¤šæ¡£ä½é€‰æ‹©å™¨(é™ä½å¤æ‚åº¦)

Week 7-8: RAGçŸ¥è¯†åº“ (æå‡æƒå¨æ„Ÿ)
  Day 1-3: æœ€å°æ•°æ®é›†
    - ç´¢å¼•èŒƒå›´: 
      * ä½ çš„ä¼˜åŒ–æ–‡æ¡£(D:\Desktop\mksaas_qiflowaiç»ˆä¼˜\*.md)
      * 2-3éƒ¨å…¬å¼€å…¸ç±(ã€Šæ»´å¤©é«“ã€‹ã€Šå­å¹³çœŸè¯ ã€‹ç²¾é€‰ç« èŠ‚)
    - æ€»é‡æ§åˆ¶: â‰¤50ä¸‡tokens,Embeddingæˆæœ¬<$1
  
  Day 4-6: æ£€ç´¢é›†æˆ
    - ä¿®æ”¹: src/app/api/qiflow/chat/route.ts
    - å¢åŠ : answerWithRAG(question, baziData)
    - topK=3 (æ§åˆ¶ä¸Šä¸‹æ–‡æˆæœ¬)
    - æ ‡æ³¨å‡ºå¤„: "æ ¹æ®ã€Šæ»´å¤©é«“ã€‹..."
  
  Day 7-8: æˆæœ¬ä¸è´¨é‡éªŒè¯
    - ç›‘æ§: tokenæ¶ˆè€—å¢åŠ â‰¤20%
    - æµ‹è¯•: 10ä¸ªé«˜é¢‘é—®é¢˜çš„å¼•ç”¨å‡†ç¡®æ€§
    - è°ƒä¼˜: æ£€ç´¢é˜ˆå€¼/Promptæ¨¡æ¿

âœ… æˆåŠŸæ ‡å‡†:
  - [ ] ä¼šè¯åˆ¶ç”¨æˆ·å¯¹è¯è½®æ•° â‰¥ å•æ¬¡ç”¨æˆ·çš„3å€
  - [ ] RAGå¼•ç”¨ç‡>30%(æœ‰æ„ä¹‰çš„å¼•ç”¨)
  - [ ] æˆæœ¬å¢åŠ <20%, ä½†ç”¨æˆ·æ»¡æ„åº¦â†‘
  - [ ] Chatæ•´ä½“æ”¶å…¥æå‡>40%
```

### ğŸ”„ P2è®¢é˜…ç•™å­˜ (Month 3-4, Proä¼šå‘˜ä»·å€¼å¼ºåŒ–)

```yaml
Week 9-11: åŠ¨æ€è¿åŠ¿ä»ªè¡¨ç›˜ (æœˆåº¦ä¼˜å…ˆ,æ—¥åº¦äºŒæœŸ)
  Day 1-5: æœˆåº¦åˆ†æç”Ÿæˆå™¨
    - æ–°å»º: src/lib/qiflow/fortune/monthly-analysis.ts
    - è¾“å…¥: baziData + fengshuiData + year + month
    - è¾“å‡º: { alerts, opportunities, layoutAdjustments }
    - âŒ æš‚ä¸åš: æ—¥è¿å¡ç‰‡(é«˜é¢‘å¼€é”€å¤§)
  
  Day 6-10: å‰ç«¯ä»ªè¡¨ç›˜
    - æ–°å»º: src/app/(dashboard)/pro/dashboard/page.tsx
    - æ ¸å¿ƒå¡ç‰‡: MonthlyFocusCard (æœ¬æœˆäººå®…åˆä¸€é‡ç‚¹)
    - âŒ æš‚ä¸åš: TodayFortuneCard (äºŒæœŸ)
  
  Day 11-15: Cronè‡ªåŠ¨åŒ–
    - æ–°å»º: src/app/api/cron/generate-monthly-fortunes/route.ts
    - è§¦å‘: æ¯æœˆ1å·å‡Œæ™¨2ç‚¹
    - é€»è¾‘: 
      1. æŸ¥è¯¢æ‰€æœ‰Pro/Lifetimeç”¨æˆ·
      2. æ‰¹é‡ç”Ÿæˆæœˆåº¦åˆ†æ
      3. å‘é€ç«™å†…é€šçŸ¥
    - æˆæœ¬æ§åˆ¶: é¢„ä¼°Proç”¨æˆ·â‰¤100,æœˆæˆæœ¬<$20

Week 12-13: å®¶åº­ç‰ˆè®¢é˜… (å»¶ååˆ°Month 4)
  â³ æš‚ç¼“åŸå› :
    - éœ€å…ˆéªŒè¯Proç•™å­˜æ•ˆæœ
    - å¤æ‚åº¦é«˜(å¤šäººåè°ƒAI)
    - å¸‚åœºéœ€æ±‚å¾…éªŒè¯
  
  âœ… æ›¿ä»£æ–¹æ¡ˆ: Month 3èšç„¦Proç•™å­˜
    - ä¼˜åŒ–æœˆåº¦åˆ†æè´¨é‡
    - å¢åŠ Proä¸“å±åŠŸèƒ½(ä¼˜å…ˆæŠ¥å‘Šç”Ÿæˆé˜Ÿåˆ—)
    - ç›‘æµ‹ç•™å­˜æ•°æ®,ä¸ºFamilyç‰ˆåšå‡†å¤‡

âœ… æˆåŠŸæ ‡å‡†:
  - [ ] Proç”¨æˆ·æœˆæ´»ç‡>80% (æŸ¥çœ‹ä»ªè¡¨ç›˜)
  - [ ] 30æ—¥ç•™å­˜ç‡>65%
  - [ ] 90æ—¥ç»­è®¢ç‡>50%
  - [ ] æœˆåº¦åˆ†æç”ŸæˆæˆåŠŸç‡>98%
```

### ğŸ—ï¸ P3æ¶æ„ä¼˜åŒ– (Month 5-6, å¯é€‰,ä¸é˜»å¡å•†ä¸šéªŒè¯)

```yaml
â³ æš‚ç¼“åŸå› :
  - å½“å‰æ¶æ„è¶³å¤Ÿæ”¯æ’‘5000ç”¨æˆ·è§„æ¨¡
  - å•†ä¸šéªŒè¯ä¼˜å…ˆäºæŠ€æœ¯ä¼˜åŒ–
  - é¿å…"è¿‡æ—©ä¼˜åŒ–"

âœ… æ›¿ä»£æ–¹æ¡ˆ: æ¸è¿›å¼ä¼˜åŒ–
  Week 13-14: ä»£ç è´¨é‡æå‡
    - é‡æ„: chat/route.ts æ‹†åˆ†ä¸ºå­å‡½æ•°(ä¿æŒ1ä¸ªæ–‡ä»¶)
    - å¢åŠ : å…³é”®è·¯å¾„çš„å•å…ƒæµ‹è¯•
    - æ–‡æ¡£: æ ¸å¿ƒç®—æ³•ä¸AI Promptçš„æ³¨é‡Š
  
  Week 15-16: ç›‘æ§ä¸å‘Šè­¦å®Œå–„
    - éƒ¨ç½²: Sentryé”™è¯¯è¿½è¸ª
    - é…ç½®: æ…¢æŸ¥è¯¢æ—¥å¿—(>1s)
    - ä»ªè¡¨ç›˜: Vercel Analyticså…³é”®æŒ‡æ ‡
  
  Week 17-18: æ•°æ®åº“ä¼˜åŒ–(æŒ‰éœ€)
    - ç´¢å¼•: é«˜é¢‘æŸ¥è¯¢ä¼˜åŒ–
    - æ¸…ç†: å†å²æ•°æ®å½’æ¡£ç­–ç•¥
    - âŒ ä¸åš: å¤§è§„æ¨¡Schemaé‡æ„

â° ä½•æ—¶è€ƒè™‘æœåŠ¡åŒ–é‡æ„?
  è§¦å‘æ¡ä»¶(æ»¡è¶³ä»»ä¸€):
  - æ³¨å†Œç”¨æˆ·>10,000
  - API p95å»¶è¿Ÿ>2s
  - å›¢é˜Ÿæ‰©å±•åˆ°3+åç«¯å·¥ç¨‹å¸ˆ
  - éœ€è¦é›†æˆç´«å¾®æ–—æ•°ç­‰æ–°ç³»ç»Ÿ

âœ… å½“å‰é˜¶æ®µé‡ç‚¹:
  - [ ] ä¿æŒä»£ç å¯è¯»æ€§
  - [ ] å…³é”®è·¯å¾„æœ‰æµ‹è¯•è¦†ç›–
  - [ ] ç›‘æ§ä¸å‘Šè­¦å°±ä½
  - [ ] ä¸ºæœªæ¥é‡æ„é¢„ç•™æ¥å£(å¦‚ç®—æ³•å‡½æ•°æ— çŠ¶æ€)
```

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡ä¸å†³ç­–çŸ©é˜µ

### ç¬¬1ä¸ªæœˆ (MVPéªŒè¯)

```yaml
å…³é”®æŒ‡æ ‡:
  âœ… æ³¨å†Œç”¨æˆ·: 200+
  âœ… æ¿€æ´»ç”¨æˆ·(å®Œæˆ1æ¬¡åˆ†æ): 140+ (70%æ¿€æ´»ç‡)
  âœ… ç²¾åæŠ¥å‘Šè´­ä¹°: 15+ (7-10%è½¬åŒ–ç‡)
  âœ… MRR: $150+ (15ä»½æŠ¥å‘Š * $9.90)
  
äº§å“æŒ‡æ ‡:
  âœ… æŠ¥å‘Šç”ŸæˆæˆåŠŸç‡: >98%
  âœ… æŠ¥å‘Šæ»¡æ„åº¦: >4.0/5.0
  âœ… PDFä¸‹è½½æˆåŠŸç‡: >95%
  âœ… æ”¯ä»˜æˆåŠŸç‡: >95%
  
é£é™©æ§åˆ¶:
  âœ… AIæˆæœ¬/å¤©: <$50
  âœ… æ¶æ„æ³¨å†Œäº‹ä»¶: 0æ¬¡
  âœ… æ³•å¾‹æŠ•è¯‰: 0æ¬¡
  âœ… Turnstileæ‹¦æˆªç‡: 5-10% (æ­£å¸¸)
```

### ç¬¬3ä¸ªæœˆ (å¢é•¿éªŒè¯)

```yaml
å…³é”®æŒ‡æ ‡:
  âœ… æ³¨å†Œç”¨æˆ·: 1,000+
  âœ… ä»˜è´¹ç”¨æˆ·: 100+ (10%è½¬åŒ–ç‡)
  âœ… MRR: $1,500+ (80ä»½æŠ¥å‘Š + 50ä¸ªProè®¢é˜…)
  âœ… 7æ—¥ç•™å­˜ç‡: >40%
  âœ… 30æ—¥ç•™å­˜ç‡: >25%
  
äº§å“çº¿:
  âœ… ç²¾åæŠ¥å‘Š: 80ä»½ ($792)
  âœ… æ——èˆ°æŠ¥å‘Š: 10ä»½ ($299)
  âœ… Proè®¢é˜…: 50äºº ($495/æœˆ)
  âœ… Familyè®¢é˜…: 5å®¶ ($150/æœˆ)
  
ABæµ‹è¯•ç»“æœ:
  âœ… æœ€ä¼˜æ³¨å†Œç¤¼ç¡®å®š: [70/150/200]ä¸­è¡¨ç°æœ€ä½³çš„
  âœ… ä¼šè¯åˆ¶Chatå æ¯”: >40% (è¯´æ˜ç”¨æˆ·æ¥å—æ–°æ¨¡å¼)
  âœ… RAGçŸ¥è¯†åº“ä½¿ç”¨ç‡: >30%çš„å¯¹è¯å¼•ç”¨äº†çŸ¥è¯†åº“
```

### ç¬¬6ä¸ªæœˆ (è§„æ¨¡åŒ–)

```yaml
å…³é”®æŒ‡æ ‡:
  âœ… æ³¨å†Œç”¨æˆ·: 5,000+
  âœ… ä»˜è´¹ç”¨æˆ·: 500+
  âœ… MRR: $5,000+
  âœ… Proç”¨æˆ·30æ—¥ç•™å­˜: >70%
  âœ… LTV/CAC: >3 (å¥åº·æ¯”ä¾‹)
  
è®¢é˜…å æ¯”:
  âœ… Proè®¢é˜…: 200äºº ($1,980/æœˆ)
  âœ… Familyè®¢é˜…: 30å®¶ ($900/æœˆ)
  âœ… ä¸€æ¬¡æ€§æŠ¥å‘Š: 200ä»½/æœˆ ($2,000)
  âœ… ç§¯åˆ†åŒ…: $1,000/æœˆ
```

---

## ğŸ¯ å…³é”®å†³ç­–ç‚¹æŒ‡å¯¼

### å†³ç­–1: ä¸ºä»€ä¹ˆç®€åŒ–ä¸ºä¸¤é˜¶æ®µA/B?

**ç»“è®º: ä¸¤é˜¶æ®µA/Bæ˜¯æœ€ä¼˜é€‰æ‹©,å¹³è¡¡äº†æ¢ç´¢æ€§ä¸å¯æ§æ€§ã€‚**

**ç†ç”±**:
1. **é™ä½å®éªŒå¤æ‚åº¦**: A/B/Céœ€è¦ç»Ÿè®¡è®¾è®¡æ›´å¤æ‚,æ ·æœ¬é‡éœ€æ±‚æ›´å¤§(æ¯ç»„â‰¥500),å¼€å‘ä¸ç›‘æ§æˆæœ¬æ›´é«˜ã€‚
2. **èšç„¦æ ¸å¿ƒå‡è®¾**: å…ˆéªŒè¯"å‚ä¸æ¿€åŠ±æœºåˆ¶"(é˜¶æ®µ1),å†éªŒè¯"æ…·æ…¨ä¸Šé™"(é˜¶æ®µ2),é€»è¾‘æ¸…æ™°,é£é™©å¯æ§ã€‚
3. **æˆæœ¬å¯æ§**: é˜¶æ®µ1çš„Bç»„(æ€»250ç§¯åˆ†)æ¯”åŸCç»„(350)æ›´ä¿å®ˆ,å¤±è´¥æˆæœ¬æ›´ä½ã€‚
4. **å¿«é€Ÿè¿­ä»£**: å•æ¬¡A/Bä»…2-3å‘¨,ä¸¤é˜¶æ®µå…±4-6å‘¨,æ€»å‘¨æœŸåè€Œæ›´çŸ­(æ¯”A/B/Cä¸€æ¬¡æ€§4-6å‘¨+å†³ç­–ä¸æ˜ç¡®æ›´é«˜æ•ˆ)ã€‚

**æ•°æ®å¯¹æ¯”**:
| æ–¹æ¡ˆ | å®éªŒç»„æ•° | æœ€å°æ ·æœ¬ | å¼€å‘å¤æ‚åº¦ | å†³ç­–æ¸…æ™°åº¦ | æˆæœ¬é£é™© |
|------|----------|----------|------------|------------|----------|
| A/B/Cä¸€æ¬¡æ€§ | 3 | 500*3=1500 | é«˜ | ä¸­ | é«˜ |
| ä¸¤é˜¶æ®µA/B | 2*2=4 | 300*2*2=1200 | ä¸­ | é«˜ | ä½ |

**å®æ–½å»ºè®®**:
- âœ… å¯åŠ¨ä¸¤é˜¶æ®µA/B(Week 2å¼€å§‹)
- âš ï¸ å‰ç½®: Turnstile + æˆæœ¬ç›‘æ§ + å¹‚ç­‰è®¾è®¡
- ğŸ“Š é˜¶æ®µ1: 2-3å‘¨, é˜¶æ®µ2: 2-3å‘¨
- ğŸš¨ æ¯é˜¶æ®µä¸­æœŸè¯„ä¼°,å¼‚å¸¸ç«‹å³å›æ»š

### å†³ç­–2: RAGçŸ¥è¯†åº“ä¼˜å…ˆçº§?

**ç»“è®º: é«˜ä¼˜å…ˆçº§,å»ºè®®åœ¨Month 2ç«‹å³å®æ–½ã€‚**

**ç†ç”±**:
1. **ROIæé«˜**: ä¸€æ¬¡æ€§æˆæœ¬<$1,è¾¹é™…æˆæœ¬+20%,ä½†AIæƒå¨æ€§æå‡100%+
2. **æŠ€æœ¯æˆç†Ÿ**: pgvector + LlamaIndex.TSå·²ç»éå¸¸ç¨³å®š
3. **å·®å¼‚åŒ–æ˜æ˜¾**: èƒ½å¼•ç»æ®å…¸çš„AI vs åªèƒ½æ³›æ³›è€Œè°ˆçš„AI,ç”¨æˆ·æ„ŸçŸ¥å·®å¼‚å·¨å¤§

**å®æ–½å»ºè®®**:
- âœ… Week 4-5å®æ–½ (ä¸å½±å“MVPä¸Šçº¿)
- ğŸ“š çŸ¥è¯†åº“æ¥æº: æ‚¨çš„ä¼˜åŒ–æ–‡æ¡£ + å…¬å¼€å…¸ç±
- ğŸ¯ ç›®æ ‡: 30%çš„å¯¹è¯èƒ½å¼•ç”¨çŸ¥è¯†åº“

### å†³ç­–3: å®¶åº­ç‰ˆä½•æ—¶æ¨å‡º?

**ç»“è®º: Month 4-5,åœ¨Proç•™å­˜éªŒè¯åå†åšã€‚**

**ç†ç”±**:
1. **éœ€å…ˆéªŒè¯Proä»·å€¼**: å®¶åº­ç‰ˆæ˜¯Proçš„å‡çº§ç‰ˆ,éœ€å…ˆç¡®ä¿Proç•™å­˜ç‡è¾¾æ ‡(>60%)
2. **å¤æ‚åº¦é«˜**: å¤šäººåè°ƒAIéœ€è¦å¤§é‡æç¤ºè¯å·¥ç¨‹ä¸æµ‹è¯•
3. **å¸‚åœºéœ€æ±‚å¾…éªŒè¯**: å…ˆé€šè¿‡ç”¨æˆ·åé¦ˆç¡®è®¤"å®¶åº­å†²çª"æ˜¯çœŸå®ç—›ç‚¹
4. **å®šä»·æ•æ„Ÿ**: $29.90/æœˆçš„å®¶åº­ç‰ˆéœ€è¦æ•°æ®æ”¯æ’‘(Proç”¨æˆ·æ„¿ä»˜æ„æ„¿ã€å®¶åº­è§„æ¨¡åˆ†å¸ƒ)

**å®æ–½å»ºè®®**:
- â³ Month 3èšç„¦Proç•™å­˜
- ğŸ“Š æ”¶é›†ç”¨æˆ·åé¦ˆ: "æ˜¯å¦æœ‰å®¶äººä¹Ÿæƒ³ä½¿ç”¨?" "ä½å®…å¸ƒå±€å†²çªå—?"
- ğŸ¯ è§¦å‘æ¡ä»¶: Proç•™å­˜>60% + è‡³å°‘20ä¸ªç”¨æˆ·æå‡ºå®¶åº­éœ€æ±‚
- ğŸ—ï¸ å‡†å¤‡: ä¼˜åŒ–æœˆåº¦åˆ†æè´¨é‡,ä¸ºå®¶åº­ç‰ˆ"å¤šäººåè°ƒ"ç§¯ç´¯ç»éªŒ

### å†³ç­–4: ç´«å¾®æ–—æ•°ä½•æ—¶åŠ å…¥?

**ç»“è®º: Month 6-9,ç”šè‡³å»¶ååˆ°å¹´åº•ã€‚**

**ç†ç”±**:
1. **å½“å‰è¶³å¤Ÿ**: å…«å­—+é£æ°´+äººå®…ç»“åˆå·²æ˜¯ç‹¬ç‰¹ç»„åˆ
2. **ç®—æ³•ç¼ºå¤±**: ç´«å¾®æ–—æ•°ç®—æ³•å¤æ‚,éœ€ä¸“é—¨å¼€å‘æˆ–å¤–éƒ¨é›†æˆ
3. **ROIä¸æ˜**: ç´«å¾®ç”¨æˆ·ä¸å…«å­—ç”¨æˆ·é‡å åº¦æœªçŸ¥
4. **æ¶æ„æœªå°±ç»ª**: éœ€æœåŠ¡åŒ–é‡æ„åæ‰å¥½é›†æˆ

**å®æ–½å»ºè®®**:
- â³ é•¿æœŸè§‚æœ›
- ğŸ“Š é€šè¿‡é—®å·/åé¦ˆäº†è§£éœ€æ±‚å¼ºåº¦
- ğŸ—ï¸ ç¡®ä¿ç®—æ³•æœåŠ¡åŒ–ä¸ºæœªæ¥é›†æˆåšå‡†å¤‡

---

## ğŸ“ æœ€ç»ˆæ€»ç»“

### æ ¸å¿ƒæ‰§è¡ŒåŸåˆ™

1. **å®‰å…¨ç¬¬ä¸€**: Turnstile + åˆè§„ + æˆæœ¬ç›‘æ§ = ä¸å¯å¦¥åçš„P0çº§
2. **å°æ­¥å¿«è·‘**: Week 1 MVP â†’ Week 2 ABæµ‹è¯• â†’ Month 2 å¢é•¿éªŒè¯
3. **æ•°æ®é©±åŠ¨**: æ¯ä¸ªå‡è®¾éƒ½ç”¨ABæµ‹è¯•éªŒè¯,æ¯ä¸ªå†³ç­–éƒ½åŸºäºæ•°æ®
4. **ç”¨æˆ·ä¸ºæœ¬**: ä»"ç®—å‘½å·¥å…·"è½¬å‘"ç”Ÿæ´»å†³ç­–åŠ©æ‰‹"

### ä¸‰å¤§çªç ´ç‚¹

1. **æŠ¥å‘Šäº§å“**: å¡«è¡¥$10-$30å¸‚åœºç©ºç™½,è¿™æ˜¯æ‚¨çš„ç°é‡‘ç‰›
2. **åŠ¨æ€ä»ªè¡¨ç›˜**: ä»"ä¸€æ¬¡æ€§"åˆ°"æŒç»­è®¢é˜…",è¿™æ˜¯ç•™å­˜æ ¸æ­¦å™¨
3. **å®¶åº­ç‰ˆ**: å¤šç›®æ ‡ä¼˜åŒ–æ˜¯AIç‹¬æœ‰èƒ½åŠ›,è¿™æ˜¯å·®å¼‚åŒ–å£å’

### æœ€å¯èƒ½çš„æˆåŠŸè·¯å¾„

```
Week 1: MVPä¸Šçº¿ (ç²¾åæŠ¥å‘Š $9.90)
  â†“
Week 2-3: ABæµ‹è¯• + æ–°æ‰‹å¼•å¯¼ä¼˜åŒ–
  â†“
Month 2: RAGé›†æˆ + ä¼šè¯åˆ¶Chat
  â†“
Month 3-4: åŠ¨æ€ä»ªè¡¨ç›˜ + Familyè®¢é˜…
  â†“
Month 6: MRRè¾¾åˆ°$5,000+,è¿›å…¥å¯æŒç»­å¢é•¿é˜¶æ®µ
```

---

**è®©QiFlowAIä¸ä»…ä»…æ˜¯ä¸€ä¸ªè®¡ç®—å™¨,è€Œæ˜¯ç”¨æˆ·äººç”Ÿé‡å¤§å†³ç­–æ—¶ä¿¡èµ–çš„AIæ™ºå›Šå›¢!** ğŸš€

---

## ğŸ“ é™„å½•: å¿«é€Ÿå‚è€ƒ

### æ ¸å¿ƒé…ç½®æ–‡ä»¶ç´¢å¼•

```
src/config/
  â”œâ”€ website.ts              # å•†ä¸šæ¨¡å¼æ ¸å¿ƒé…ç½®
  â”‚   â”œâ”€ registerGiftCredits: 70 â†’ [70/150/200] ABæµ‹è¯•
  â”‚   â”œâ”€ dailySignin: 10-30 â†’ 30-50 (å¯é€‰ä¼˜åŒ–)
  â”‚   â”œâ”€ features.enableTurnstileCaptcha: false â†’ true (P0!)
  â”‚   â””â”€ plans.family (æ–°å¢Familyè®¢é˜…)
  â””â”€ qiflow-pricing.ts      # åŠŸèƒ½å®šä»·
      â”œâ”€ aiChat: 5
      â”œâ”€ chatSession15Min: 10 (æ–°å¢)
      â”œâ”€ reportEssential: 99 (æ–°å¢)
      â””â”€ reportPremium: 299 (æ–°å¢)

src/lib/qiflow/
  â”œâ”€ reports/
  â”‚   â””â”€ essential-report.ts (æ–°å¢: æŠ¥å‘Šç”Ÿæˆé€»è¾‘)
  â”œâ”€ ai/
  â”‚   â”œâ”€ quality-audit.ts (æ–°å¢: AIå®¡æ ¸)
  â”‚   â””â”€ synthesis-prompt.ts (ä¼˜åŒ–: äººå®…ç»“åˆPrompt)
  â”œâ”€ fortune/
  â”‚   â””â”€ monthly-analysis.ts (æ–°å¢: æœˆåº¦è¿åŠ¿)
  â””â”€ family/
      â””â”€ harmony-optimizer.ts (æ–°å¢: å®¶åº­å’Œè°ä¼˜åŒ–)

scripts/
  â”œâ”€ ingest-knowledge-base.ts (æ–°å¢: RAGæ•°æ®ç´¢å¼•)
  â”œâ”€ ab-test-monitor-v2.ts (æ–°å¢: ABæµ‹è¯•ç›‘æ§)
  â””â”€ export-sample-pdf.ts (é‡æ„: PDFç”Ÿæˆ)
```

### å…³é”®æŒ‡ä»¤é€ŸæŸ¥

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# æ•°æ®åº“è¿ç§» (æ–°è¡¨: chat_session, qiflow_knowledge_embeddings, monthly_fortune)
npx prisma migrate dev

# RAGçŸ¥è¯†åº“ç´¢å¼•
npx tsx scripts/ingest-knowledge-base.ts

# ABæµ‹è¯•ç›‘æ§ (Cron: æ¯6å°æ—¶)
npx tsx scripts/ab-test-monitor-v2.ts

# æœˆåº¦è¿åŠ¿ç”Ÿæˆ (Cron: æ¯æœˆ1å·)
curl -X GET https://qiflowai.com/api/cron/generate-monthly-fortunes \
  -H "Authorization: Bearer ${CRON_SECRET}"

# éƒ¨ç½²
vercel --prod
```

---

**æŠ¥å‘Šç»“æŸ** | ç”Ÿæˆæ—¥æœŸ: 2025-01-15 | ç‰ˆæœ¬: v3.0 (æœ€ç»ˆç‰ˆ) | åŸºäºå®Œæ•´ä»£ç å®¡è®¡ + 8ç‚¹æ ¸å¿ƒå»ºè®®
