name: å›½é™…åŒ–æ£€æŸ¥

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]

jobs:
  i18n-check:
    name: æ£€æŸ¥ç¡¬ç¼–ç ä¸­æ–‡
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkoutä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: è®¾ç½®Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: å®‰è£…ä¾èµ–
        run: npm ci
      
      - name: è¿è¡Œå›½é™…åŒ–æ£€æŸ¥
        run: node scripts/check-i18n.js --strict
        env:
          CI: true
      
      - name: ä¸Šä¼ æ£€æŸ¥æŠ¥å‘Š
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: i18n-check-report
          path: i18n-check-report.json
      
      - name: è¯„è®ºPRï¼ˆå¦‚æœå¤±è´¥ï¼‰
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = JSON.parse(fs.readFileSync('i18n-check-report.json', 'utf8'));
            
            const comment = `## âŒ å›½é™…åŒ–æ£€æŸ¥å¤±è´¥
            
            å‘ç° **${report.totalIssues}** å¤„ç¡¬ç¼–ç ä¸­æ–‡ï¼Œåˆ†å¸ƒåœ¨ **${report.filesChecked}** ä¸ªæ–‡ä»¶ä¸­ã€‚
            
            ### ğŸ“‹ ä¿®å¤å»ºè®®
            
            1. å°†ç¡¬ç¼–ç ä¸­æ–‡ç§»åŠ¨åˆ°ç¿»è¯‘æ–‡ä»¶ \`src/locales/[lang]/common.json\`
            2. ä½¿ç”¨ \`useTranslations()\` é’©å­æ›¿æ¢ç¡¬ç¼–ç æ–‡æœ¬
            3. å¯¹äºå¿…é¡»ä¿ç•™çš„ä¸­æ–‡ï¼Œæ·»åŠ  \`// i18n-ignore\` æ³¨é‡Š
            4. å‚è€ƒ [å›½é™…åŒ–è§„èŒƒæ–‡æ¡£](../blob/main/docs/i18n-guide.md)
            
            ### ğŸ“ ç¤ºä¾‹
            
            \`\`\`typescript
            // âŒ é”™è¯¯
            const title = "æ¬¢è¿ä½¿ç”¨";
            
            // âœ… æ­£ç¡®
            const t = useTranslations("Common");
            const title = t("welcome");
            \`\`\`
            
            è¯¦ç»†æŠ¥å‘Šè¯·æŸ¥çœ‹ Actions å·¥ä»¶ã€‚
            `;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.name,
              body: comment
            });
