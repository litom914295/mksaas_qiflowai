# Pull Request

## 📝 变更描述

<!-- 请简要描述此 PR 的变更内容 -->

## 🎯 变更类型

请勾选适用的类型：

- [ ] 🐛 Bug 修复
- [ ] ✨ 新功能
- [ ] 🔒 安全修复
- [ ] ♻️ 代码重构
- [ ] 📝 文档更新
- [ ] 🎨 UI/样式更新
- [ ] ⚡️ 性能优化
- [ ] ✅ 测试相关
- [ ] 🔧 配置/构建相关

## 🔗 相关 Issue

<!-- 关联的 Issue 编号，如：Fixes #123, Closes #456 -->

## ✅ 审查清单

### 代码质量

- [ ] 代码遵循项目编码规范
- [ ] 已运行 `npm run lint` 并通过检查
- [ ] 已运行 `npm run type-check` 并通过检查
- [ ] 代码没有重复（DRY 原则）
- [ ] 函数和组件职责单一
- [ ] 变量和函数命名清晰有意义

### 类型安全

- [ ] 所有 TypeScript 类型正确定义
- [ ] 没有使用 `any` 类型（除非确实必要）
- [ ] Props 和返回值都有明确类型
- [ ] 正确处理 null/undefined 情况

### 安全性

- [ ] 没有硬编码的密钥或敏感信息
- [ ] 用户输入经过验证（使用 Zod schema）
- [ ] Actions 使用正确的认证客户端
  - `userActionClient` - 需要认证的操作
  - `strictRateLimitedActionClient` - 高风险操作（支付、积分）
  - `rateLimitedActionClient` - AI 相关操作
  - `actionClient` - 仅公开操作
- [ ] API 路由正确实现认证检查
- [ ] 没有使用 `dangerouslySetInnerHTML`（或已正确清理）
- [ ] 敏感操作记录审计日志

### 错误处理

- [ ] 所有异步操作有 try-catch
- [ ] 错误消息对用户友好
- [ ] 错误响应不泄露敏感信息
- [ ] 数据库操作使用事务（必要时）

### 测试

- [ ] 新功能有对应的单元测试
- [ ] Bug 修复有回归测试
- [ ] 已运行 `npm run test` 并通过
- [ ] 测试覆盖关键路径
- [ ] 测试用例有意义的描述

### 性能

- [ ] 没有不必要的重新渲染
- [ ] 大型列表使用虚拟化/分页
- [ ] 图片使用 `next/image` 组件
- [ ] 正确使用 React Server Components
- [ ] 避免在循环中进行数据库查询

### 数据库

- [ ] 使用事务保证数据一致性（涉及多表操作）
- [ ] 并发操作使用悲观锁（`FOR UPDATE`）
- [ ] Credits 操作使用 `consumeCredits`/`refundCredits`
- [ ] 支付操作正确记录审计日志

### 文档

- [ ] 复杂逻辑有注释说明
- [ ] 公共 API 有 JSDoc 文档
- [ ] README 已更新（如需要）
- [ ] 环境变量已文档化（如新增）

### 代码审查（Reviewer 检查）

- [ ] 代码逻辑正确
- [ ] 没有明显的性能问题
- [ ] 符合项目架构设计
- [ ] 变更范围合理（不过大）
- [ ] 没有引入新的技术债务

## 📸 截图（UI 变更时提供）

<!-- 如有 UI 变更，请提供截图或 GIF -->

## 🧪 测试步骤

<!-- 如何测试此变更？ -->

1. 
2. 
3. 

## 📋 部署注意事项

<!-- 是否需要特殊的部署步骤？环境变量？数据库迁移？ -->

- [ ] 需要数据库迁移
- [ ] 需要新增环境变量
- [ ] 需要清理缓存
- [ ] 需要重启服务
- [ ] 无特殊要求

## 🔍 自我审查

在提交此 PR 前，我已：

- [ ] 本地测试所有变更
- [ ] 审查自己的代码（diff）
- [ ] 完成上述所有检查项
- [ ] 更新相关文档
- [ ] 添加必要的测试

## 📝 补充说明

<!-- 其他需要说明的内容 -->

---

## ⚡️ 快速检查命令

```bash
# 类型检查
npm run type-check

# 代码规范
npm run lint

# 运行测试
npm run test

# 构建检查
npm run build
```

## 🔗 相关文档

- [编码规范](../docs/CODING_STANDARDS.md)
- [安全指南](../docs/SECURITY.md)
- [测试指南](../docs/TESTING.md)
