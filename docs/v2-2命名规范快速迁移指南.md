# v2-2 命名规范快速迁移指南

## 🎯 迁移概述

为了统一代码风格和提高可维护性，我们正在将 `v2.2` 和 `v2_2` 的命名统一为 `v2-2` 格式。

**好消息**：所有旧代码仍然可以正常工作！我们采用渐进式迁移策略。

---

## 📦 命名对照表

### 目录和文件路径

| 旧命名 | 新命名 | 状态 |
|-------|-------|------|
| `src/types/report-v2.2.ts` | `src/types/report-v2-2.ts` | ✅ 新文件已创建 |
| `src/lib/report/v2_2/` | `src/lib/report/v2-2/` | ✅ 新目录已创建 |
| `/api/reports/v2.2/` | `/api/reports/v2-2/` | ⏳ 计划中 |

### 类型名称

| 旧命名 | 新命名 | 说明 |
|-------|-------|------|
| `ReportOutput_v2_2` | `ReportOutputV22` | 去掉下划线，使用V22后缀 |
| `BaziToStrategyMapper` | `BaziToStrategyMapper` | 无版本后缀的类型保持不变 |

### 函数名称

| 旧命名 | 新命名 | 说明 |
|-------|-------|------|
| `renderReportHTML_v2_2` | `renderReportHtmlV22` | 小驼峰命名，V22后缀 |
| `generateFullReport_v2_2` | `generateFullReportV22` | 小驼峰命名，V22后缀 |

---

## 🚀 快速迁移步骤

### 1. 更新类型导入

**旧写法**：
```typescript
import type { ReportOutput_v2_2 } from '@/types/report-v2.2';
```

**新写法**：
```typescript
import type { ReportOutputV22 } from '@/types/report-v2-2';
```

### 2. 更新函数导入

**旧写法**：
```typescript
import { renderReportHTML_v2_2 } from '@/lib/report/v2_2/html';
```

**新写法**：
```typescript
import { renderReportHtmlV22 } from '@/lib/report/v2-2';
// 或者
import { renderReportHtmlV22 } from '@/lib/report/v2-2/html';
```

### 3. 更新 API 端点调用

**旧写法**：
```typescript
fetch('/api/reports/v2.2/generate', {
  method: 'POST',
  // ...
});
```

**新写法**：
```typescript
fetch('/api/reports/v2-2/generate', {
  method: 'POST',
  // ...
});
```

### 4. 更新变量和函数名称

**旧写法**：
```typescript
const report_v2_2: ReportOutput_v2_2 = generateFullReport_v2_2(data);
const html = renderReportHTML_v2_2(report_v2_2);
```

**新写法**：
```typescript
const reportV22: ReportOutputV22 = generateFullReportV22(data);
const html = renderReportHtmlV22(reportV22);
```

---

## ⚠️ 兼容性说明

### 旧代码仍然可用

所有旧的导入路径和函数名称都会继续工作，但会显示 TypeScript 废弃警告：

```typescript
// 这段代码仍然可以运行
import type { ReportOutput_v2_2 } from '@/types/report-v2.2';
// ⚠️ 但 IDE 会显示: @deprecated 请使用 ReportOutputV22
```

### 向后兼容期

- **当前阶段**：新旧代码共存
- **废弃警告期**：至少保留 3-6 个月
- **移除计划**：所有引用更新后再考虑移除旧文件

---

## 🔍 自动检测需要迁移的代码

### 使用 IDE 搜索

1. **搜索旧导入路径**：
   - 在项目中搜索：`@/types/report-v2.2`
   - 在项目中搜索：`@/lib/report/v2_2`
   - 在项目中搜索：`/api/reports/v2.2`

2. **搜索旧类型名称**：
   - 在项目中搜索：`ReportOutput_v2_2`
   - 在项目中搜索：`_v2_2` （查找所有使用旧后缀的标识符）

3. **搜索旧函数名称**：
   - 在项目中搜索：`renderReportHTML_v2_2`
   - 在项目中搜索：`_v2_2(` （查找所有使用旧后缀的函数调用）

### 使用命令行工具

```bash
# 在项目根目录运行

# 搜索所有包含 v2.2 的 TypeScript 文件
grep -r "v2\.2" --include="*.ts" --include="*.tsx" src/

# 搜索所有包含 v2_2 的 TypeScript 文件
grep -r "v2_2" --include="*.ts" --include="*.tsx" src/

# 使用 ripgrep（更快）
rg "v2\.2" --type ts --type tsx
rg "v2_2" --type ts --type tsx
```

---

## 📝 迁移检查清单

将以下清单复制到你的任务列表：

```markdown
### 迁移单个文件的步骤

- [ ] 备份原文件（可选，Git 已有版本控制）
- [ ] 更新所有类型导入路径
- [ ] 更新所有函数导入路径
- [ ] 更新所有类型名称（去掉下划线）
- [ ] 更新所有函数名称（使用小驼峰）
- [ ] 更新所有 API 端点 URL
- [ ] 保存并检查 TypeScript 错误
- [ ] 运行相关测试
- [ ] 提交代码
```

---

## 💡 最佳实践

### 1. 小步迁移
- 一次迁移一个文件或模块
- 每次迁移后立即测试
- 避免大规模批量修改

### 2. 优先级排序
按以下顺序迁移：
1. **高优先级**：核心库文件（types, generators）
2. **中优先级**：API 路由和主要组件
3. **低优先级**：测试文件和工具函数

### 3. 保持测试覆盖
- 迁移前确保有测试覆盖
- 迁移后运行完整测试套件
- 如果没有测试，先写测试再迁移

### 4. 团队协作
- 通知团队成员命名规范变更
- 在 PR 中说明迁移范围
- 代码审查时检查命名一致性

---

## 🐛 常见问题

### Q: 旧代码什么时候会停止工作？
A: 短期内不会。我们会保留至少 3-6 个月的兼容期，确保所有引用都已更新后才考虑移除。

### Q: 我正在开发新功能，应该用新命名还是旧命名？
A: **必须使用新命名**。所有新代码都应该遵循新的命名规范。

### Q: 我可以混用新旧命名吗？
A: 技术上可以，但**不推荐**。同一个文件中应该保持一致性，建议全部使用新命名。

### Q: 迁移会影响生产环境吗？
A: 不会。新旧代码在功能上完全等价，只是命名不同。

### Q: 如果我不确定某个改动是否正确怎么办？
A: 
1. 先在本地测试
2. 查看 TypeScript 类型提示
3. 参考 `docs/重构进度-v2-2命名规范.md`
4. 询问团队成员或查看已迁移的示例代码

---

## 📚 相关文档

- [重构进度跟踪](./重构进度-v2-2命名规范.md) - 查看当前进度和待办事项
- [完整命名规范指南](./付费逻辑和命名规范建议.md) - 详细的命名规范说明

---

## 🎉 迁移完成后

迁移完成后，你的代码将：
- ✅ 更加规范和统一
- ✅ 更易于维护和理解
- ✅ 符合 JavaScript/TypeScript 最佳实践
- ✅ 避免文件系统兼容性问题

---

**需要帮助？** 查看 [重构进度文档](./重构进度-v2-2命名规范.md) 或联系团队成员。
