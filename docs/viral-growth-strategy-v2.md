# æ°”æµAI ç—…æ¯’å¢é•¿ç­–ç•¥2.0
## åŸºäºç°æœ‰ç§¯åˆ†ç³»ç»Ÿçš„ç”Ÿæ´»åŠ©æ‰‹å®šä½å¢é•¿æ–¹æ¡ˆ

---

## ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 ç°æœ‰ç§¯åˆ†ç³»ç»Ÿæ¶æ„
```
âœ… å·²å®ç°åŠŸèƒ½ï¼š
- ç§¯åˆ†ç±»å‹ï¼šæ³¨å†Œèµ é€(50ç§¯åˆ†)ã€æœˆåº¦åˆ·æ–°ã€è´­ä¹°å……å€¼ã€è®¢é˜…ç»­è´¹
- ç§¯åˆ†ç®¡ç†ï¼šFIFOæ¶ˆè€—ã€è¿‡æœŸæœºåˆ¶(30å¤©)ã€ä½™é¢è¿½è¸ª
- ç§¯åˆ†åŒ…ï¼š4ä¸ªçº§åˆ«(100/200/500/1000ç§¯åˆ†)
- ç”¨æˆ·ä½“ç³»ï¼šè´¦å·ç³»ç»Ÿã€ç§¯åˆ†ä½™é¢ã€äº¤æ˜“è®°å½•

âŒ ç¼ºå¤±åŠŸèƒ½ï¼š
- é‚€è¯·æ¨èç³»ç»Ÿ
- ç¤¾äº¤åˆ†äº«å¥–åŠ±
- ä»»åŠ¡æˆå°±ä½“ç³»
- ç§¯åˆ†æ’è¡Œæ¦œ
- å›¢é˜Ÿ/ç¤¾ç¾¤æœºåˆ¶
```

### 1.2 äº§å“å®šä½é‡æ–°ç†è§£
**"AIç”Ÿæ´»åŠ©æ‰‹"** = å…«å­—é£æ°´ + æ—¥å¸¸æŒ‡å¯¼ + æƒ…æ„Ÿé™ªä¼´

ç”¨æˆ·æ ¸å¿ƒéœ€æ±‚ï¼š
1. **æ—¥å¸¸å†³ç­–**ï¼šä»Šæ—¥è¿åŠ¿ã€å‰æ—¶é€‰æ‹©ã€æ–¹ä½æŒ‡å¯¼
2. **äººç”Ÿè§„åˆ’**ï¼šèŒä¸šå»ºè®®ã€æ„Ÿæƒ…æŒ‡å—ã€è´¢è¿åˆ†æ  
3. **ç¯å¢ƒä¼˜åŒ–**ï¼šå®¶å±…é£æ°´ã€åŠå…¬å¸ƒå±€ã€åŒ–ç…å»ºè®®
4. **å¿ƒç†æ”¯æŒ**ï¼šæƒ…ç»ªç–å¯¼ã€å‹åŠ›ç¼“è§£ã€ä¿¡å¿ƒå»ºç«‹

---

## äºŒã€ç—…æ¯’å¢é•¿æ ¸å¿ƒç­–ç•¥

### 2.1 å¢é•¿å…¬å¼å‡çº§
```
ç—…æ¯’ç³»æ•° K = (é‚€è¯·ç‡ Ã— è½¬åŒ–ç‡ Ã— å¹³å‡é‚€è¯·æ•°) Ã— ç¤¾äº¤æ”¾å¤§å™¨

ç›®æ ‡ï¼šK > 1.5 (å½¢æˆè‡ªå¢é•¿)
ç°çŠ¶ï¼šK = 0 (æ— é‚€è¯·ç³»ç»Ÿ)
```

### 2.2 ä¸‰å±‚é£è½®æ¨¡å‹

#### ç¬¬ä¸€å±‚ï¼šä¸ªäººä»·å€¼é£è½®
```
å…è´¹ä½“éªŒ(50ç§¯åˆ†) â†’ è·å¾—å‡†ç¡®åˆ†æ â†’ äº§ç”Ÿä¿¡ä»» â†’ åˆ†äº«æ„æ„¿
```

#### ç¬¬äºŒå±‚ï¼šç¤¾äº¤ä¼ æ’­é£è½®  
```
åˆ†äº«å†…å®¹ â†’ æœ‹å‹æ³¨å†Œ â†’ åŒæ–¹è·ç›Š â†’ æ›´å¤šåˆ†äº«
```

#### ç¬¬ä¸‰å±‚ï¼šç¤¾ç¾¤å¢é•¿é£è½®
```
ç»„å»ºå›¢é˜Ÿ â†’ é›†ä½“æ”¶ç›Š â†’ ç«äº‰æ’å â†’ æ‰©å¤§å›¢é˜Ÿ
```

---

## ä¸‰ã€å…·ä½“å®æ–½æ–¹æ¡ˆ

### 3.1 é‚€è¯·å¥–åŠ±ç³»ç»Ÿï¼ˆç¬¬1é˜¶æ®µï¼šç¬¬1-2å‘¨ï¼‰

#### 3.1.1 åŒå‘å¥–åŠ±æœºåˆ¶
```typescript
// æ–°å¢ç§¯åˆ†ç±»å‹
export enum CREDIT_TRANSACTION_TYPE {
  // ... ç°æœ‰ç±»å‹
  REFERRAL_REWARD = 'REFERRAL_REWARD',        // æ¨èäººå¥–åŠ±
  REFEREE_BONUS = 'REFEREE_BONUS',            // è¢«æ¨èäººå¥–åŠ±  
  SHARE_REWARD = 'SHARE_REWARD',              // åˆ†äº«å¥–åŠ±
  TASK_COMPLETE = 'TASK_COMPLETE',            // ä»»åŠ¡å®Œæˆ
  ACHIEVEMENT_UNLOCK = 'ACHIEVEMENT_UNLOCK',   // æˆå°±è§£é”
}

// å¥–åŠ±é…ç½®
const referralRewards = {
  // ç›´æ¥æ¨èå¥–åŠ±
  directReferral: {
    referrer: 30,      // æ¨èäººè·å¾—30ç§¯åˆ†
    referee: 20,       // æ–°ç”¨æˆ·é¢å¤–è·å¾—20ç§¯åˆ†(æ€»è®¡70)
    maxDaily: 5,       // æ¯æ—¥æœ€å¤š5ä¸ªæœ‰æ•ˆæ¨è
  },
  // é—´æ¥æ¨èå¥–åŠ±(äºŒçº§)
  indirectReferral: {
    referrer: 10,      // é—´æ¥æ¨èäººè·å¾—10ç§¯åˆ†
    enabled: true,     // å¼€å¯äºŒçº§å¥–åŠ±
  },
  // é‡Œç¨‹ç¢‘å¥–åŠ±
  milestones: [
    { count: 3, reward: 50, name: "åˆçº§æ¨å¹¿å¤§ä½¿" },
    { count: 10, reward: 200, name: "ä¸­çº§æ¨å¹¿å¤§ä½¿" },
    { count: 30, reward: 500, name: "é«˜çº§æ¨å¹¿å¤§ä½¿" },
    { count: 100, reward: 2000, name: "è¶…çº§æ¨å¹¿å¤§ä½¿" },
  ]
}
```

#### 3.1.2 æ¨èç ç³»ç»Ÿ
```typescript
interface ReferralCode {
  code: string;           // 6ä½å”¯ä¸€ç : "QF8888"
  userId: string;         // æ‰€å±ç”¨æˆ·
  customCode?: string;    // VIPè‡ªå®šä¹‰ç 
  usageCount: number;     // ä½¿ç”¨æ¬¡æ•°
  totalRewards: number;   // ç´¯è®¡å¥–åŠ±
  expireAt?: Date;        // è¿‡æœŸæ—¶é—´(å¯é€‰)
}
```

### 3.2 ç¤¾äº¤åˆ†äº«æ¿€åŠ±ï¼ˆç¬¬1é˜¶æ®µï¼šåŒæ­¥å®æ–½ï¼‰

#### 3.2.1 åˆ†äº«å†…å®¹æ¨¡æ¿
```typescript
const shareTemplates = {
  // è¿åŠ¿åˆ†äº«
  dailyFortune: {
    title: "æˆ‘çš„ä»Šæ—¥è¿åŠ¿ï¼šè´¢è¿äº¨é€šâ­â­â­â­â­",
    content: "æ°”æµAIä¸ºæˆ‘ç²¾å‡†åˆ†æäº†ä»Šæ—¥è¿åŠ¿ï¼Œå¤ªå‡†äº†ï¼",
    image: "dynamic_fortune_card.png",
    reward: 5,  // åˆ†äº«è·å¾—5ç§¯åˆ†
  },
  // å…«å­—åˆ†æåˆ†äº«
  baziAnalysis: {
    title: "åŸæ¥æˆ‘æ˜¯${element}å‘½äººï¼Œæ€§æ ¼è§£æå¤ªå‡†äº†ï¼",
    content: "åˆšç”¨æ°”æµAIæµ‹äº†å…«å­—ï¼Œå‡†ç¡®åº¦è®©æˆ‘éœ‡æƒŠ...",
    image: "bazi_result_card.png", 
    reward: 10,
  },
  // é£æ°´å»ºè®®åˆ†äº«
  fengshuiTips: {
    title: "2025å¹´è´¢ä½åœ¨${direction}ï¼Œä½ å®¶çš„è´¢ä½æ‰¾å¯¹äº†å—ï¼Ÿ",
    content: "æ°”æµAIå¸®æˆ‘æ‰¾åˆ°äº†å®¶é‡Œçš„è´¢ä½å’Œæ–‡æ˜Œä½...",
    image: "fengshui_layout.png",
    reward: 10,
  },
  // æˆå°±åˆ†äº«
  achievement: {
    title: "æˆ‘åœ¨æ°”æµAIè·å¾—äº†ã€Œ${achievementName}ã€æˆå°±ï¼",
    content: "è¿ç»­ä½¿ç”¨${days}å¤©ï¼Œè§£é”äº†ç‰¹æ®Šç§°å·...",
    image: "achievement_badge.png",
    reward: 15,
  }
}
```

#### 3.2.2 åˆ†äº«è¿½è¸ªä¸é˜²åˆ·
```typescript
interface ShareTracking {
  userId: string;
  shareType: string;
  platform: 'wechat' | 'weibo' | 'douyin' | 'xiaohongshu';
  shareTime: Date;
  clickCount: number;      // ç‚¹å‡»æ¬¡æ•°
  conversionCount: number; // è½¬åŒ–æ¬¡æ•°
  rewardGranted: boolean;  // æ˜¯å¦å·²å‘æ”¾å¥–åŠ±
}

// é˜²åˆ·è§„åˆ™
const antiCheatRules = {
  minViewTime: 10,        // æœ€å°‘åœç•™10ç§’
  maxDailyShares: 3,      // æ¯æ—¥æœ€å¤šå¥–åŠ±3æ¬¡åˆ†äº«
  uniqueIPRequired: true, // éœ€è¦ä¸åŒIPç‚¹å‡»
  cooldownMinutes: 60,    // åˆ†äº«é—´éš”1å°æ—¶
}
```

### 3.3 æ¯æ—¥ä»»åŠ¡ç³»ç»Ÿï¼ˆç¬¬2é˜¶æ®µï¼šç¬¬3-4å‘¨ï¼‰

#### 3.3.1 ä»»åŠ¡ç±»å‹è®¾è®¡
```typescript
const dailyTasks = {
  // åŸºç¡€ä»»åŠ¡
  basic: [
    { id: 'daily_login', name: 'æ¯æ—¥ç™»å½•', reward: 5, icon: 'ğŸ“…' },
    { id: 'daily_fortune', name: 'æŸ¥çœ‹ä»Šæ—¥è¿åŠ¿', reward: 10, icon: 'ğŸ”®' },
    { id: 'ai_chat', name: 'AIå¯¹è¯3è½®', reward: 15, icon: 'ğŸ’¬' },
  ],
  // ç¤¾äº¤ä»»åŠ¡
  social: [
    { id: 'share_result', name: 'åˆ†äº«åˆ†æç»“æœ', reward: 20, icon: 'ğŸ“¤' },
    { id: 'invite_friend', name: 'é‚€è¯·1ä½å¥½å‹', reward: 30, icon: 'ğŸ‘¥' },
    { id: 'help_friend', name: 'å¸®åŠ©å¥½å‹è§£ç­”', reward: 15, icon: 'ğŸ¤' },
  ],
  // æ·±åº¦ä»»åŠ¡
  advanced: [
    { id: 'complete_profile', name: 'å®Œå–„ä¸ªäººèµ„æ–™', reward: 25, icon: 'ğŸ‘¤' },
    { id: 'fengshui_analysis', name: 'å®Œæˆé£æ°´åˆ†æ', reward: 30, icon: 'ğŸ ' },
    { id: 'weekly_report', name: 'ç”Ÿæˆå‘¨è¿æŠ¥å‘Š', reward: 40, icon: 'ğŸ“Š' },
  ]
}

// è¿ç»­å®Œæˆå¥–åŠ±
const streakBonus = {
  3: 30,   // è¿ç»­3å¤©
  7: 100,  // è¿ç»­7å¤©
  30: 500, // è¿ç»­30å¤©
}
```

#### 3.3.2 æˆå°±ç³»ç»Ÿ
```typescript
const achievements = {
  // ä½¿ç”¨æˆå°±
  usage: [
    { id: 'first_analysis', name: 'åˆæ¬¡ä½“éªŒ', condition: 'complete_first_bazi', reward: 20 },
    { id: 'fortune_teller', name: 'å‘½ç†è¾¾äºº', condition: 'analyses_count >= 10', reward: 100 },
    { id: 'fengshui_master', name: 'é£æ°´å¤§å¸ˆ', condition: 'fengshui_count >= 5', reward: 150 },
  ],
  // ç¤¾äº¤æˆå°±
  social: [
    { id: 'influencer_1', name: 'äººæ°”æ–°æ˜Ÿ', condition: 'referrals >= 5', reward: 100 },
    { id: 'influencer_2', name: 'ç¤¾äº¤è¾¾äºº', condition: 'referrals >= 20', reward: 500 },
    { id: 'influencer_3', name: 'æ¨å¹¿å¤§ä½¿', condition: 'referrals >= 50', reward: 1500 },
  ],
  // æ´»è·ƒæˆå°±
  activity: [
    { id: 'week_active', name: 'å‘¨æ´»è·ƒç”¨æˆ·', condition: 'login_days >= 7', reward: 50 },
    { id: 'month_active', name: 'æœˆåº¦ä¹‹æ˜Ÿ', condition: 'login_days >= 30', reward: 200 },
    { id: 'year_active', name: 'å¹´åº¦ç”¨æˆ·', condition: 'login_days >= 365', reward: 2000 },
  ]
}
```

### 3.4 å›¢é˜Ÿ/å®¶åº­ç³»ç»Ÿï¼ˆç¬¬3é˜¶æ®µï¼šç¬¬5-6å‘¨ï¼‰

#### 3.4.1 å®¶åº­ç»„åŠŸèƒ½
```typescript
interface FamilyGroup {
  id: string;
  name: string;             // "å¼ å®¶é£æ°´å›¢"
  creatorId: string;
  members: FamilyMember[];
  sharedCredits: number;    // å…±äº«ç§¯åˆ†æ± 
  level: number;             // å®¶æ—ç­‰çº§
  benefits: string[];        // å®¶æ—ç‰¹æƒ
}

interface FamilyMember {
  userId: string;
  role: 'creator' | 'admin' | 'member';
  contribution: number;      // è´¡çŒ®ç§¯åˆ†æ•°
  joinedAt: Date;
}

// å®¶æ—ç‰¹æƒ
const familyBenefits = {
  level1: ['ç§¯åˆ†å…±äº«', 'å®¶æ—é£æ°´æŠ¥å‘Š'],
  level2: ['é¢å¤–10%ç§¯åˆ†åŠ æˆ', 'ä¸“å±å®¢æœ'],
  level3: ['æ¯æœˆ200å…è´¹ç§¯åˆ†', 'VIPåŠŸèƒ½è§£é”'],
}
```

#### 3.4.2 æ’è¡Œæ¦œç³»ç»Ÿ
```typescript
const leaderboards = {
  // ä¸ªäººæ’è¡Œ
  personal: {
    daily: { reset: '00:00', reward: [50, 30, 20] },
    weekly: { reset: 'Monday', reward: [200, 100, 50] },
    monthly: { reset: '1st', reward: [1000, 500, 300] },
  },
  // å›¢é˜Ÿæ’è¡Œ
  team: {
    weekly: { reset: 'Monday', reward: [500, 300, 200] },
    monthly: { reset: '1st', reward: [2000, 1000, 500] },
  }
}
```

### 3.5 è£‚å˜æ´»åŠ¨æ¨¡æ¿ï¼ˆæŒç»­è¿è¥ï¼‰

#### 3.5.1 é™æ—¶æ´»åŠ¨
```typescript
const viralCampaigns = {
  // æ–°å¹´æ´»åŠ¨
  newYear: {
    name: "2025æ–°å¹´è¿åŠ¿å¤§è½¬ç›˜",
    duration: "2025-01-20 to 2025-02-10",
    mechanics: "é‚€è¯·å¥½å‹åŠ©åŠ›ï¼Œè§£é”è½¬ç›˜æ¬¡æ•°",
    rewards: [
      { probability: 0.4, reward: "10ç§¯åˆ†" },
      { probability: 0.3, reward: "30ç§¯åˆ†" },
      { probability: 0.2, reward: "50ç§¯åˆ†" },
      { probability: 0.08, reward: "100ç§¯åˆ†" },
      { probability: 0.02, reward: "1000ç§¯åˆ†" },
    ]
  },
  // æ‹¼å›¢æ´»åŠ¨
  groupBuy: {
    name: "ç§¯åˆ†æ‹¼å›¢",
    mechanics: "3äººæ‹¼å›¢ï¼Œæ¯äººè·å¾—150ç§¯åˆ†(åŸä»·100ç§¯åˆ†/äºº)",
    discount: "50%",
    minMembers: 3,
  },
  // åŠ©åŠ›æ´»åŠ¨
  boost: {
    name: "å¥½å‹åŠ©åŠ›å¾—ç§¯åˆ†",
    mechanics: "é‚€è¯·5ä½å¥½å‹åŠ©åŠ›ï¼Œè·å¾—100ç§¯åˆ†",
    stages: [
      { helpers: 1, reward: 10 },
      { helpers: 3, reward: 30 },
      { helpers: 5, reward: 100 },
    ]
  }
}
```

---

## å››ã€æ•°æ®åº“è®¾è®¡

### 4.1 æ–°å¢æ•°æ®è¡¨

```sql
-- æ¨èå…³ç³»è¡¨
CREATE TABLE referral_relationships (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  referrer_id VARCHAR(255) NOT NULL,      -- æ¨èäºº
  referee_id VARCHAR(255) NOT NULL,       -- è¢«æ¨èäºº
  referral_code VARCHAR(20),              -- ä½¿ç”¨çš„æ¨èç 
  level INTEGER DEFAULT 1,                -- æ¨èå±‚çº§(1=ç›´æ¥,2=é—´æ¥)
  status VARCHAR(20) DEFAULT 'pending',   -- pending/active/expired
  reward_granted BOOLEAN DEFAULT false,   -- æ˜¯å¦å·²å‘æ”¾å¥–åŠ±
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  activated_at TIMESTAMP,                 -- æ¿€æ´»æ—¶é—´
  FOREIGN KEY (referrer_id) REFERENCES "user"(id),
  FOREIGN KEY (referee_id) REFERENCES "user"(id)
);

-- æ¨èç è¡¨
CREATE TABLE referral_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(20) UNIQUE NOT NULL,       -- æ¨èç 
  user_id VARCHAR(255) NOT NULL,          -- æ‰€å±ç”¨æˆ·
  custom_code VARCHAR(20),                -- VIPè‡ªå®šä¹‰ç 
  usage_count INTEGER DEFAULT 0,          -- ä½¿ç”¨æ¬¡æ•°
  max_usage INTEGER,                      -- æœ€å¤§ä½¿ç”¨æ¬¡æ•°
  total_rewards INTEGER DEFAULT 0,        -- ç´¯è®¡å¥–åŠ±ç§¯åˆ†
  expire_at TIMESTAMP,                    -- è¿‡æœŸæ—¶é—´
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES "user"(id)
);

-- åˆ†äº«è®°å½•è¡¨
CREATE TABLE share_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR(255) NOT NULL,
  share_type VARCHAR(50) NOT NULL,        -- dailyFortune/baziAnalysisç­‰
  platform VARCHAR(20),                   -- wechat/weibo/douyinç­‰
  share_url TEXT,                         -- åˆ†äº«é“¾æ¥
  click_count INTEGER DEFAULT 0,          -- ç‚¹å‡»æ¬¡æ•°
  conversion_count INTEGER DEFAULT 0,     -- è½¬åŒ–æ¬¡æ•°
  reward_granted BOOLEAN DEFAULT false,   -- æ˜¯å¦å·²å‘æ”¾å¥–åŠ±
  reward_amount INTEGER DEFAULT 0,        -- å¥–åŠ±ç§¯åˆ†æ•°
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES "user"(id)
);

-- ä»»åŠ¡è¿›åº¦è¡¨
CREATE TABLE task_progress (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR(255) NOT NULL,
  task_id VARCHAR(50) NOT NULL,           -- ä»»åŠ¡ID
  task_type VARCHAR(20),                  -- daily/weekly/achievement
  progress INTEGER DEFAULT 0,             -- å½“å‰è¿›åº¦
  target INTEGER NOT NULL,                -- ç›®æ ‡å€¼
  completed BOOLEAN DEFAULT false,        -- æ˜¯å¦å®Œæˆ
  reward_claimed BOOLEAN DEFAULT false,   -- æ˜¯å¦å·²é¢†å–å¥–åŠ±
  completed_at TIMESTAMP,                 -- å®Œæˆæ—¶é—´
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES "user"(id)
);

-- æˆå°±è®°å½•è¡¨
CREATE TABLE achievements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id VARCHAR(255) NOT NULL,
  achievement_id VARCHAR(50) NOT NULL,    -- æˆå°±ID
  achievement_name VARCHAR(100),          -- æˆå°±åç§°
  achievement_level INTEGER DEFAULT 1,    -- æˆå°±ç­‰çº§
  unlocked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  reward_amount INTEGER,                  -- å¥–åŠ±ç§¯åˆ†
  FOREIGN KEY (user_id) REFERENCES "user"(id),
  UNIQUE(user_id, achievement_id)
);

-- å®¶æ—/å›¢é˜Ÿè¡¨
CREATE TABLE family_groups (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,             -- å®¶æ—åç§°
  creator_id VARCHAR(255) NOT NULL,       -- åˆ›å»ºè€…
  shared_credits INTEGER DEFAULT 0,       -- å…±äº«ç§¯åˆ†æ± 
  level INTEGER DEFAULT 1,                -- å®¶æ—ç­‰çº§
  member_count INTEGER DEFAULT 1,         -- æˆå‘˜æ•°é‡
  total_contribution INTEGER DEFAULT 0,   -- æ€»è´¡çŒ®å€¼
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (creator_id) REFERENCES "user"(id)
);

-- å®¶æ—æˆå‘˜è¡¨
CREATE TABLE family_members (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  family_id UUID NOT NULL,
  user_id VARCHAR(255) NOT NULL,
  role VARCHAR(20) DEFAULT 'member',      -- creator/admin/member
  contribution INTEGER DEFAULT 0,         -- è´¡çŒ®ç§¯åˆ†
  joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (family_id) REFERENCES family_groups(id),
  FOREIGN KEY (user_id) REFERENCES "user"(id),
  UNIQUE(family_id, user_id)
);

-- åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_referral_referrer ON referral_relationships(referrer_id);
CREATE INDEX idx_referral_referee ON referral_relationships(referee_id);
CREATE INDEX idx_referral_code ON referral_codes(code);
CREATE INDEX idx_share_user_type ON share_records(user_id, share_type);
CREATE INDEX idx_task_user_type ON task_progress(user_id, task_type);
CREATE INDEX idx_achievement_user ON achievements(user_id);
CREATE INDEX idx_family_members_user ON family_members(user_id);
```

---

## äº”ã€å®æ–½è·¯çº¿å›¾

### ç¬¬1é˜¶æ®µï¼ˆç¬¬1-2å‘¨ï¼‰ï¼šåŸºç¡€ç—…æ¯’æœºåˆ¶
- [ ] å®ç°æ¨èç ç”Ÿæˆå’ŒéªŒè¯
- [ ] åŒå‘å¥–åŠ±ç§¯åˆ†å‘æ”¾
- [ ] åˆ†äº«å¡ç‰‡ç”Ÿæˆå™¨
- [ ] åŸºç¡€é˜²ä½œå¼Šæœºåˆ¶

### ç¬¬2é˜¶æ®µï¼ˆç¬¬3-4å‘¨ï¼‰ï¼šæ¿€åŠ±æ·±åŒ–
- [ ] æ¯æ—¥ä»»åŠ¡ç³»ç»Ÿ
- [ ] æˆå°±ç³»ç»Ÿæ¡†æ¶
- [ ] è¿ç»­ç­¾åˆ°å¥–åŠ±
- [ ] æ’è¡Œæ¦œå±•ç¤º

### ç¬¬3é˜¶æ®µï¼ˆç¬¬5-6å‘¨ï¼‰ï¼šç¤¾ç¾¤åŒ–
- [ ] å®¶æ—ç³»ç»Ÿ
- [ ] å›¢é˜Ÿç§¯åˆ†æ± 
- [ ] ç¾¤ä½“æ´»åŠ¨åŠŸèƒ½
- [ ] ç¤¾äº¤äº’åŠ¨åŠŸèƒ½

### ç¬¬4é˜¶æ®µï¼ˆç¬¬7-8å‘¨ï¼‰ï¼šä¼˜åŒ–è¿­ä»£
- [ ] æ•°æ®åˆ†æä»ªè¡¨æ¿
- [ ] A/Bæµ‹è¯•æ¡†æ¶
- [ ] ä¸ªæ€§åŒ–æ¨è
- [ ] é«˜çº§é˜²ä½œå¼Š

---

## å…­ã€é¢„æœŸæ•ˆæœ

### 6.1 å¢é•¿é¢„æµ‹
```
ç¬¬1æœˆï¼šK=0.8ï¼Œç”¨æˆ·5,000
ç¬¬2æœˆï¼šK=1.2ï¼Œç”¨æˆ·20,000
ç¬¬3æœˆï¼šK=1.5ï¼Œç”¨æˆ·80,000
ç¬¬6æœˆï¼šK=1.8ï¼Œç”¨æˆ·500,000+
```

### 6.2 å…³é”®æŒ‡æ ‡
- **æ¨èç‡**ï¼š30%ç”¨æˆ·ä¼šé‚€è¯·æœ‹å‹
- **è½¬åŒ–ç‡**ï¼šè¢«é‚€è¯·ç”¨æˆ·50%ä¼šæ³¨å†Œ
- **å¹³å‡é‚€è¯·æ•°**ï¼šæ¯ç”¨æˆ·é‚€è¯·3-5äºº
- **ç•™å­˜ç‡**ï¼š7æ—¥ç•™å­˜50%ï¼Œ30æ—¥ç•™å­˜30%

### 6.3 æ”¶å…¥æ¨¡å‹
```
ç”¨æˆ·è·å–æˆæœ¬(CAC)ï¼š0å…ƒ(çº¯ç—…æ¯’å¢é•¿)
ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼(LTV)ï¼š
- å…è´¹ç”¨æˆ·ï¼šè´¡çŒ®å†…å®¹å’Œä¼ æ’­ä»·å€¼
- ä»˜è´¹è½¬åŒ–ï¼š5%ç”¨æˆ·è´­ä¹°ç§¯åˆ†åŒ…
- å¹³å‡å®¢å•ä»·ï¼š30å…ƒ
- LTV/CAC = âˆ (æé«˜æŠ•èµ„å›æŠ¥)
```

---

## ä¸ƒã€é£é™©æ§åˆ¶

### 7.1 é˜²ä½œå¼Šæªæ–½
- IPåœ°å€éªŒè¯
- è®¾å¤‡æŒ‡çº¹è¯†åˆ«
- è¡Œä¸ºæ¨¡å¼åˆ†æ
- äººæœºéªŒè¯(å¿…è¦æ—¶)

### 7.2 ç§¯åˆ†é€šèƒ€æ§åˆ¶
- åŠ¨æ€è°ƒæ•´å¥–åŠ±æ•°å€¼
- è®¾ç½®æ¯æ—¥ä¸Šé™
- ç§¯åˆ†è¿‡æœŸæœºåˆ¶
- æ¶ˆè´¹åœºæ™¯æ‰©å±•

### 7.3 ç”¨æˆ·ä½“éªŒä¿æŠ¤
- é¿å…è¿‡åº¦è¥é”€
- ä¿æŠ¤ç”¨æˆ·éšç§
- ç»´æŒå†…å®¹è´¨é‡
- å¿«é€Ÿå®¢æœå“åº”

---

## å…«ã€è½åœ°æ‰§è¡Œchecklist

### ç«‹å³å¯åš(Day 1-3)
- [x] åœ¨website.tsxå¢åŠ æ¨èå¥–åŠ±é…ç½®
- [x] åˆ›å»ºæ¨èç ç”ŸæˆAPI
- [x] æ³¨å†Œé¡µé¢å¢åŠ æ¨èç è¾“å…¥
- [x] å®ç°åŸºç¡€åŒå‘å¥–åŠ±

### æœ¬å‘¨å®Œæˆ(Day 4-7)
- [ ] åˆ†äº«å¡ç‰‡è®¾è®¡å’Œç”Ÿæˆ
- [ ] å¾®ä¿¡åˆ†äº«SDKé›†æˆ
- [ ] æ¨èæ•°æ®ç»Ÿè®¡é¡µé¢
- [ ] é˜²åˆ·æœºåˆ¶ç¬¬ä¸€ç‰ˆ

### ä¸‹å‘¨ç›®æ ‡(Week 2)
- [ ] æ¯æ—¥ä»»åŠ¡ç³»ç»Ÿä¸Šçº¿
- [ ] æˆå°±ç³»ç»Ÿæ¡†æ¶
- [ ] æ¨é€é€šçŸ¥é›†æˆ
- [ ] æ•°æ®çœ‹æ¿æ­å»º

---

*ç­–ç•¥ç‰ˆæœ¬ï¼š2.0*
*æ›´æ–°æ—¥æœŸï¼š2025-01-11*
*ä¼˜åŒ–åŸºç¡€ï¼šç°æœ‰ç§¯åˆ†ç³»ç»Ÿ+ç”Ÿæ´»åŠ©æ‰‹å®šä½*