# 清理后测试检查清单

**清理执行时间:** 2025-11-05 12:01:49  
**清理统计:** 移动 374 个文件，删除 4 个文件，创建 133 个目录

---

## ✅ 已完成的基础测试

- [x] **开发服务器启动** - `npm run dev` 正常运行
- [x] **TypeScript 类型检查** - `npm run type-check` 运行正常（43个错误为清理前已存在）
- [x] **测试框架** - Vitest 正常工作，Jest 配置已成功移除
- [x] **脚本引用检查** - package.json 中所有引用的脚本文件都存在
- [x] **Git 状态** - 所有变更已记录
- [x] **清理报告** - 已生成 `.archived/CLEANUP_REPORT.md`

---

## 📋 建议进行的功能测试

### 1. 核心功能测试

建议手动测试以下核心功能是否正常：

#### 🔐 认证功能
```bash
# 在浏览器中测试
- [ ] 访问 http://localhost:3000
- [ ] 用户登录
- [ ] 用户注册
- [ ] 退出登录
```

#### 🔮 八字分析
```bash
- [ ] 访问八字分析页面
- [ ] 输入生辰信息
- [ ] 查看分析结果
- [ ] 保存历史记录
```

#### 🏠 玄空风水
```bash
- [ ] 访问风水分析页面
- [ ] 输入房屋信息
- [ ] 查看风水布局
- [ ] 导出报告
```

#### 🧭 智能罗盘
```bash
- [ ] 访问罗盘页面
- [ ] 测试罗盘功能
- [ ] 方位检测
```

#### 💬 AI 对话
```bash
- [ ] 访问 AI 聊天页面
- [ ] 发送消息测试
- [ ] 查看历史对话
```

#### 💰 积分系统
```bash
- [ ] 查看积分余额
- [ ] 测试积分消费
- [ ] 积分充值（如有测试环境）
```

### 2. 国际化测试

```bash
- [ ] 切换语言到中文
- [ ] 切换语言到英文
- [ ] 切换语言到马来语
- [ ] 检查页面文字是否正确显示
```

### 3. 响应式设计测试

```bash
- [ ] 桌面端显示
- [ ] 平板显示（调整浏览器窗口）
- [ ] 移动端显示
- [ ] 横竖屏切换
```

### 4. 数据库操作测试

```bash
# 运行数据库相关脚本测试
npm run list-users        # 列出用户
npm run list-contacts     # 列出联系人
npm run verify:credits    # 验证积分一致性
```

### 5. 构建测试

```bash
# 测试生产构建
npm run build

# 检查构建输出
- [ ] 构建成功完成
- [ ] 没有严重错误
- [ ] 文件大小合理
```

### 6. Lint 和格式化

```bash
# 代码质量检查
npm run lint              # Biome 检查
npm run format            # 格式化代码
```

---

## 🔍 清理相关的特定检查

### 检查移除的脚本是否有影响

检查以下被移动的脚本是否在其他地方被引用：

```bash
# 搜索项目中是否有对已移动脚本的硬编码引用
# 以下脚本已移动到 .archived/temp-scripts/
- [ ] test-bazi.js
- [ ] test-credits-fix.js
- [ ] check_test_users.js
- [ ] add-*-translations.js
- [ ] update-*-i18n.js
- [ ] verify-*-i18n.js

# 以下脚本已移动到 scripts/testing/
- [ ] 检查 scripts/testing/ 下的脚本是否需要在 CI/CD 中使用

# 以下脚本已移动到 scripts/diagnostics/
- [ ] 检查 scripts/diagnostics/ 下的脚本是否需要在运维中使用
```

### 检查文档链接

```bash
# 检查 README.md 等文档中的链接
- [ ] README.md 中的文档链接
- [ ] 贡献指南中的脚本引用
- [ ] 开发文档中的路径引用
```

### 验证 .gitignore 配置

```bash
git status

# 确认以下内容
- [ ] .archived/ 目录除 CLEANUP_REPORT.md 外不会被提交
- [ ] 没有意外忽略重要文件
- [ ] node_modules 仍被正确忽略
```

---

## 🚀 准备提交到 GitHub

### 提交前最后检查

```bash
# 1. 查看所有变更
git status

# 2. 查看删除的文件
git ls-files --deleted

# 3. 查看新增的文件
git ls-files --others --exclude-standard

# 4. 确认变更合理
- [ ] 旧的备份目录已删除
- [ ] Jest 配置文件已删除
- [ ] 新的目录结构已创建
- [ ] docs/archive/ 已包含归档文档
- [ ] scripts/ 目录已重组
```

### 提交变更

```bash
# 添加所有变更
git add -A

# 提交（使用准备好的提交信息）
git commit -m "chore: 清理和重组项目文件结构

执行项目清理，移除过期文件，重组目录结构

详细信息见 .archived/CLEANUP_REPORT.md"

# 推送到 GitHub
git push origin main
```

### 提交后验证

```bash
# 1. 在 GitHub 上检查
- [ ] 访问 GitHub 仓库
- [ ] 确认文件结构正确
- [ ] 确认旧文件已删除
- [ ] 确认 .archived/CLEANUP_REPORT.md 可见
- [ ] 确认其他归档内容不可见（被 gitignore）

# 2. 在另一台电脑测试克隆（可选）
cd /path/to/test
git clone <your-repo-url> test_clone
cd test_clone
npm install
npm run dev
```

---

## ⚠️ 注意事项

1. **TypeScript 错误**
   - 清理前有 43 个类型错误
   - 这些错误不是清理导致的
   - 建议后续专门处理这些类型问题

2. **测试失败**
   - 96 个测试套件失败
   - 这是项目原有问题，不是清理导致的
   - 建议后续逐步修复测试

3. **归档内容**
   - `.archived/` 目录只在本地
   - GitHub 上只会看到 `CLEANUP_REPORT.md`
   - 其他归档内容不会被同步

4. **环境配置**
   - 所有 `.env.*` 文件未被修改
   - 需要后续单独审查和清理

---

## 📝 后续改进建议

### 短期（1-2 周内）

1. **修复类型错误**
   - 逐步处理 43 个 TypeScript 错误
   - 优先处理影响开发的错误

2. **修复测试**
   - 分批修复失败的测试
   - 确保关键功能有测试覆盖

3. **清理环境配置**
   - 审查 12 个 `.env.*` 文件
   - 删除不再使用的配置（如 `.env.broken`）

### 中期（1 个月内）

1. **审查归档内容**
   - 检查 `.archived/temp-scripts/` 中的脚本
   - 确认功能已集成后删除

2. **更新文档**
   - 更新 README.md 说明新结构
   - 更新开发文档中的脚本路径

3. **代码质量提升**
   - 运行完整的 lint 检查
   - 修复代码质量问题

### 长期（3-6 个月）

1. **定期清理**
   - 每 3-6 个月审查归档内容
   - 删除超过 6 个月的编译日志

2. **持续改进**
   - 建立定期清理机制
   - 保持项目结构整洁

---

## ✅ 完成标志

当以下所有项都完成时，可以认为清理工作圆满完成：

- [ ] 所有核心功能测试通过
- [ ] 变更已成功提交到 GitHub
- [ ] 团队成员（如有）已被通知
- [ ] 另一台电脑能成功克隆和运行
- [ ] 文档已更新
- [ ] 旧的归档内容已审查

---

*检查清单生成时间: 2025-11-05*
*对应清理报告: .archived/CLEANUP_REPORT.md*
