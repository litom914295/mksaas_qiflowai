# 实施路线图 v2.2

> 专业报告系统从 v1.0 → v2.2 的迭代计划（技术 + 业务）

---

## 总览

### 目标
- **用户价值**：从"看得懂"提升到"愿意付费"（ARPU ↑ 40%）
- **业务指标**：转化率 8% → 12%，满意度 85% → 92%，退款率 5% → 3%
- **技术债务**：统一数据格式，解耦AI生成逻辑，支持模块化扩展

### 分阶段策略
| 阶段 | 目标 | 时间 | 优先级模块 |
|-----|------|------|-----------|
| **v1.0 MVP** | 基础报告上线 | 已完成 | 格局分析、飞星分析、基础建议 |
| **v2.0 增强** | 增加心理价值感知 | 2周 | 人生主题、归因分解、希望之光 |
| **v2.1 优化** | 提升可执行性 | 2周 | 行动清单、时间窗口、Checklist |
| **v2.2 完整** | 高端报告体验 | 3周 | 决策对比、零正审计、图表可视化 |

---

## 阶段一：v2.0 增强（优先级P0，2周）

### 核心价值：心理价值感知提升

#### 1. 人生主题故事（Life Theme）

**功能点**
- [ ] 根据格局/用神/大运生成统一叙事标题（如"先蓄力、后爆发"）
- [ ] 分阶段叙事（3-5个人生阶段）
- [ ] 每阶段包含：年龄范围、可能事件、命理意义、课题、习得能力、佐证

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `generateLifeTheme()`
- [ ] 输入：`PatternAnalysis` + `LuckPillars` + `currentAge`
- [ ] 输出：`StrategyMapping.lifeTheme`
- [ ] 规则库：创建 `src/lib/bazi/story-templates.ts`（格局→主题映射表）

**Prompt 修改**
- [ ] 在 `prompts/system/bazi_explainer.md` 增加"人生主题故事"模块
- [ ] 添加4种主题模板（顺势而为/先蓄力后爆发/逆袭/专精）
- [ ] 要求输出JSON格式（含 `title` + `summary` + `stages[]`）

**验收标准**
- [ ] 用5个真实案例测试（不同格局类型）
- [ ] 主题标题符合格局特征
- [ ] 阶段划分合理（对应大运）
- [ ] 用户反馈："感觉说中了我的经历"

**时间估算**：3天

---

#### 2. 归因分解（Attribution Breakdown）

**功能点**
- [ ] 将当前困境/成就分解为4因素：时间（30-50%）+ 禀赋（10-30%）+ 环境（20-30%）+ 策略（20-30%）
- [ ] 标注每个因素的"可控性"
- [ ] 关键话术："这不是你不行，而是时机不利（40%）"

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `calculateAttribution()`
- [ ] 输入：`PatternAnalysis` + `LuckPillars` + `currentAge`
- [ ] 输出：`StrategyMapping.attribution`（4个百分比 + notes）
- [ ] 算法逻辑：
  ```typescript
  // 示例规则
  if (当前大运为忌神) {
    timeFactor += 20; // 时间因素增加
  }
  if (格局破损严重) {
    endowmentFactor += 15; // 禀赋因素增加
  }
  // 剩余分配给环境和策略
  ```

**Prompt 修改**
- [ ] 在 `prompts/system/bazi_explainer.md` 增加"归因分解"模块
- [ ] 添加禁忌语言检查（避免"你能力不足"）
- [ ] 要求输出JSON格式（4个因素 + notes）

**验收标准**
- [ ] 用5个真实案例测试（不同困境类型）
- [ ] 4因素百分比合理（总和=100%）
- [ ] 用户反馈："感觉被理解了，不再自责"

**时间估算**：2天

---

#### 3. 希望之光（Hope Timeline）

**功能点**
- [ ] 短期改善（6-12个月）：小变化 + 关键事件时间
- [ ] 中期转折（1-3年）：关键转折点 + 量化改善 + 距离现在的时间
- [ ] 长期愿景（3-10年）：事业高峰期 + 财富积累预期
- [ ] 3个"为什么会好"的理由

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `generateHopeTimeline()`
- [ ] 输入：`LuckPillars` + `currentAge` + `PatternAnalysis`
- [ ] 输出：`HopeTimeline`（shortTerm + midTerm + longTerm + whyYouWillImprove）
- [ ] 算法逻辑：
  - 找下一个用神得力的大运/流年
  - 计算距离现在的时间
  - 根据格局强度量化改善幅度

**Prompt 修改**
- [ ] 在 `prompts/system/bazi_explainer.md` 增加"希望之光"模块
- [ ] 要求明确转折点时间（如"2027年2月"）
- [ ] 要求量化改善（如"收入提升30-50%"）
- [ ] 要求输出JSON格式

**验收标准**
- [ ] 用5个真实案例测试（不同年龄段）
- [ ] 转折点时间准确（对应大运切换）
- [ ] 改善幅度合理（不夸张）
- [ ] 用户反馈："有盼头了"

**时间估算**：3天

---

### 本阶段总时间：8天（含测试）

---

## 阶段二：v2.1 优化（优先级P0，2周）

### 核心价值：可执行性提升

#### 4. 分级行动清单（Action Plan）

**功能点**
- [ ] 必做项（1-2周见效）：1-3项
- [ ] 推荐项（1-2月见效）：3-5项
- [ ] 加分项（3-6月见效）：5-10项
- [ ] 每项包含：标题、命理依据、预期影响、预期时效、子步骤

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `generateActionPlan()`
- [ ] 输入：`UsefulGod` + `SeasonalAdjustment` + `PatternStrength`
- [ ] 输出：`StrategyMapping.actions`（essential + recommended + optional）
- [ ] 规则库：创建 `src/lib/bazi/action-templates.ts`（用神→行动映射表）

**Prompt 修改**
- [ ] 在 `prompts/system/bazi_explainer.md` 增加"行动清单"输出要求
- [ ] 要求三级分类 + 预期时效
- [ ] 要求输出JSON格式

**验收标准**
- [ ] 用5个真实案例测试（不同用神）
- [ ] 行动项具体可执行（非抽象建议）
- [ ] 预期时效合理
- [ ] 用户反馈："知道明天该干啥了"

**时间估算**：3天

---

#### 5. 决策时间窗口（Decision Windows）

**功能点**
- [ ] 根据大运/流年计算创业/跳槽/结婚/置业等决策的最佳时机
- [ ] 精确到日期（ISO格式）
- [ ] 包含置信度（0-100）
- [ ] 包含命理依据

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `generateDecisionWindows()`
- [ ] 输入：`LuckPillars` + `currentAge` + `UsefulGod`
- [ ] 输出：`StrategyMapping.decisionWindows`
- [ ] 算法逻辑：找用神得力 + 五行相合的时间段

**Prompt 修改**
- [ ] 在 `prompts/system/bazi_explainer.md` 增加"决策时间窗口"模块
- [ ] 要求精确日期（solar calendar）
- [ ] 要求输出JSON格式

**验收标准**
- [ ] 用5个真实案例测试（不同决策主题）
- [ ] 时间窗口准确（对应用神得力）
- [ ] 置信度合理

**时间估算**：3天

---

#### 6. 风水可执行Checklist

**功能点**
- [ ] 将"东南宜水"转化为"在客厅东南角摆放鱼缸"
- [ ] 每个任务包含：宫位、八卦、动作、物品、命理依据、优先级、预期影响、截止时间、周期
- [ ] 区分水位任务、山位任务、飞星任务

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `generateWaterActions()` + `generateMountainActions()`
- [ ] 输入：`LingzhengAnalysis` + `Recommendations`
- [ ] 输出：`FengshuiChecklist.environmentChecklist`

**Prompt 修改**
- [ ] 在 `prompts/system/fengshui_consult.md` 增加"可执行Checklist"模块
- [ ] 要求具体物品 + 具体位置
- [ ] 要求预期影响量化（如"提升财运10-15%"）
- [ ] 要求输出JSON格式

**验收标准**
- [ ] 用5个真实案例测试（不同户型）
- [ ] 任务具体可执行（非抽象建议）
- [ ] 用户反馈："照着做就行了"

**时间估算**：4天

---

### 本阶段总时间：10天（含测试）

---

## 阶段三：v2.2 完整（优先级P1，3周）

### 核心价值：高端报告体验

#### 7. 决策对比（Decision Comparison）

**功能点**
- [ ] A/B/C方案对比（匹配度 + 短期风险 + 长期收益 + 最佳时机）
- [ ] 推荐倾向性（如"A ≈ C > B"）
- [ ] 非最优方案的补救措施

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 实现 `generateDecisionComparison()`
- [ ] 输入：`DecisionOptions[]` + `PatternAnalysis` + `LuckPillars`
- [ ] 输出：`DecisionComparison`

**Prompt 修改**
- [ ] 在 `prompts/system/bazi_explainer.md` 增加"决策对比"模块
- [ ] 要求输出JSON格式

**验收标准**
- [ ] 用5个真实案例测试（不同决策场景）
- [ ] 对比合理（非简单评分）
- [ ] 补救措施可执行

**时间估算**：5天

---

#### 8. 零正审计（Zero-Positive Audit）

**功能点**
- [ ] 检查当前布局是否"零正颠倒"
- [ ] 量化风险等级（critical/major/minor/none）
- [ ] 提供具体整改建议

**技术实现**
- [ ] 在 `report-generator-v2.2.ts` 集成 `checkZeroPositiveReversed()`
- [ ] 输出：`FengshuiChecklist.zeroPositiveAudit`

**Prompt 修改**
- [ ] 在 `prompts/system/fengshui_consult.md` 增加"零正审计"模块
- [ ] 要求输出JSON格式

**验收标准**
- [ ] 用5个真实案例测试（不同布局）
- [ ] 审计准确（对比现有函数）
- [ ] 风险等级合理

**时间估算**：3天

---

#### 9. 可视化图表

**功能点**
- [ ] 人生时间轴图（Timeline）：展示大运/流年变化
- [ ] 能力雷达图（Radar）：五行平衡/十神强度
- [ ] 风水热力图（Heatmap）：九宫飞星分布
- [ ] 运势波动图（Wave）：流年起伏
- [ ] 行动甘特图（Gantt）：行动清单时间线

**技术实现**
- [ ] 创建 `src/components/report/charts/` 目录
- [ ] 使用 Recharts / Chart.js / D3.js
- [ ] 输入：`ReportOutput_v2_2`
- [ ] 输出：5张图表组件 + 导出PNG功能

**验收标准**
- [ ] 5张图表可正常渲染
- [ ] 数据准确（对比原始分析）
- [ ] 美观（符合高端报告审美）

**时间估算**：7天

---

#### 10. VIP元素包装

**功能点**
- [ ] 封面设计（含用户姓名、报告日期、分析耗时）
- [ ] VIP标记（如"专属分析48小时"、"含12张图表"、"180天跟踪"）
- [ ] 稀缺性提示（如"您的格局仅占人群15%"）
- [ ] 附录（术语表、FAQ、客服联系方式）

**技术实现**
- [ ] 创建 `src/components/report/cover.tsx`
- [ ] 创建 `src/components/report/vip-badge.tsx`
- [ ] 在 `ReportOutput_v2_2` 中填充 `meta` 和 `appendix` 字段

**验收标准**
- [ ] 封面美观（参考高端咨询报告）
- [ ] VIP元素醒目（但不俗气）
- [ ] 用户反馈："感觉物有所值"

**时间估算**：5天

---

### 本阶段总时间：20天（含测试）

---

## 技术债务处理（并行进行）

### 1. 类型定义统一
- [ ] 确保 `report-v2.2.ts` 中的类型与现有 `pattern-analysis.ts` 和 `lingzheng.ts` 对齐
- [ ] 添加严格的 TypeScript 类型检查

### 2. 测试覆盖
- [ ] 单元测试：每个 Mapper 函数（80%覆盖率）
- [ ] 集成测试：完整报告生成流程（5个真实案例）
- [ ] E2E测试：前端展示 + 后端生成 + 用户交互

### 3. 性能优化
- [ ] 报告生成时间 < 5秒（含AI调用）
- [ ] 大文件优化（如PDF生成）
- [ ] 缓存策略（相同八字/风水不重复计算）

### 4. 文档完善
- [ ] API文档（所有公开函数）
- [ ] 开发者指南（如何添加新模块）
- [ ] 用户手册（如何解读报告）

---

## 业务指标监控

### 关键指标（KPI）

| 指标 | 现状 | v2.0目标 | v2.1目标 | v2.2目标 |
|-----|------|---------|---------|---------|
| **转化率** | 8% | 9% | 10% | 12% |
| **ARPU** | ¥120 | ¥135 | ¥150 | ¥168 |
| **满意度** | 85% | 88% | 90% | 92% |
| **退款率** | 5% | 4.5% | 4% | 3% |
| **续费率** | 30% | 35% | 40% | 50% |
| **NPS** | 60 | 65 | 68 | 70+ |

### 监控方式
- [ ] 埋点：报告生成次数、阅读时长、章节停留时间
- [ ] 问卷：购买后满意度调查（5星评分 + 开放反馈）
- [ ] A/B测试：v2.0 vs v1.0 对比（转化率、退款率）

---

## 风险与缓解

### 风险1：AI输出格式不稳定
- **影响**：JSON解析失败，报告生成中断
- **缓解**：
  - 在 Prompt 中强制要求JSON格式 + Schema验证
  - 添加容错机制（如Fallback到默认值）
  - 使用结构化输出模式（如OpenAI的 `response_format: json_object`）

### 风险2：用户期望过高
- **影响**：报告质量达不到用户预期，退款率上升
- **缓解**：
  - 在销售页面明确说明报告内容（避免过度承诺）
  - 提供"样例报告"预览
  - 第一次购买提供"7天无理由退款"

### 风险3：时间延误
- **影响**：功能上线延迟，影响业务增长
- **缓解**：
  - 分阶段交付（P0功能优先）
  - 每周进度回顾 + 风险评估
  - 预留20%缓冲时间

---

## 下一步行动

### 本周（Week 1）
- [ ] **Monday**：确认本路线图 + 排定优先级
- [ ] **Tuesday-Thursday**：实现"人生主题故事"模块（P0）
- [ ] **Friday**：测试 + 用户反馈收集

### 下周（Week 2）
- [ ] **Monday-Wednesday**：实现"归因分解"模块（P0）
- [ ] **Thursday-Friday**：实现"希望之光"模块（P0）

### Week 3-4
- [ ] 实现"分级行动清单"、"决策时间窗口"、"风水Checklist"（P0）
- [ ] v2.1 Beta测试 + 用户反馈

### Week 5-7
- [ ] 实现"决策对比"、"零正审计"、"可视化图表"、"VIP包装"（P1）
- [ ] v2.2 正式上线

---

## 成功标准

### 用户维度
- [ ] "这份报告值这个价"（92%同意）
- [ ] "我知道接下来该干什么"（90%同意）
- [ ] "我感觉被理解了"（88%同意）
- [ ] "我对未来有信心"（85%同意）

### 业务维度
- [ ] 转化率提升至12%（+50%）
- [ ] ARPU提升至¥168（+40%）
- [ ] 退款率降至3%（-40%）
- [ ] NPS达到70+（优秀水平）

### 技术维度
- [ ] 报告生成时间 < 5秒
- [ ] JSON解析成功率 > 99%
- [ ] 测试覆盖率 > 80%
- [ ] 代码可维护性评分 > 85（SonarQube）

---

## 总结

**总投入时间**：约7-8周（38天开发 + 测试缓冲）

**资源需求**：
- 1名全栈开发（TypeScript + React + Next.js）
- 1名UI设计师（图表 + VIP包装）
- 1名测试工程师（集成测试 + E2E测试）
- 1名产品经理（用户反馈 + 业务指标监控）

**预期ROI**：
- 投入成本：约¥50,000（人力 + 服务器）
- 预期增收：ARPU ↑ ¥48/人 × 预计1000人 = ¥48,000/月
- 回本周期：约1-2个月
- 年化ROI：约600%

**关键成功因素**：
1. **用户洞察准确**（8大心理需求是否真实）
2. **AI输出稳定**（JSON格式 + 质量）
3. **执行速度**（分阶段交付，快速迭代）
4. **业务指标跟踪**（数据驱动决策）
