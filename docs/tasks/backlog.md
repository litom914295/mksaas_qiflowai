# 任务分解与执行计划 (WBS)

## 执行优先级说明
- **P0**: 核心功能，必须完成
- **P1**: 重要功能，应该完成  
- **P2**: 增强功能，可选完成

## 任务清单

### Phase 1: 基础建设 (当前阶段)

#### ✅ T1.1: 项目体检 [完成]
- **优先级**: P0
- **估时**: 1h
- **依赖**: 无
- **交付物**: 
  - docs/scan/summary.md
  - 工作分支创建

#### ✅ T1.2: PRD与技术方案 [完成]
- **优先级**: P0
- **估时**: 2h
- **依赖**: T1.1
- **交付物**:
  - docs/prd/ai-bazi-website-prd.md
  - docs/plan/solution-arch.md
  - docs/tasks/backlog.md

#### ⏳ T1.3: 数据契约实现
- **优先级**: P0
- **估时**: 3h
- **依赖**: T1.2
- **子任务**:
  - [ ] 创建 app/api/bazi/schema.ts
  - [ ] 创建 app/api/fengshui/schema.ts
  - [ ] 实现Zod验证逻辑
  - [ ] 添加版本和hash生成

### Phase 2: 算法优先护栏

#### T2.1: AI系统提示词
- **优先级**: P0
- **估时**: 2h
- **依赖**: T1.3
- **子任务**:
  - [ ] 创建 prompts/system/bazi_explainer.md
  - [ ] 创建 prompts/system/fengshui_consult.md
  - [ ] 创建 prompts/system/guardrails.md

#### T2.2: 数据检测中间件
- **优先级**: P0
- **估时**: 3h
- **依赖**: T2.1
- **子任务**:
  - [ ] 实现 AlgorithmFirstGuard类
  - [ ] 集成到AI聊天路由
  - [ ] 添加数据缺失引导逻辑

#### T2.3: 缓存层实现
- **优先级**: P1
- **估时**: 2h
- **依赖**: T1.3
- **子任务**:
  - [ ] 实现计算结果缓存
  - [ ] 配置Next.js unstable_cache
  - [ ] 添加缓存键生成逻辑

### Phase 3: 用户旅程优化

#### T3.1: 首页重构
- **优先级**: P0
- **估时**: 4h
- **依赖**: T2.1
- **子任务**:
  - [ ] Hero区域设计实现
  - [ ] 信任元素添加
  - [ ] CTA按钮优化
  - [ ] 功能卡片展示

#### T3.2: 渐进式表单
- **优先级**: P0
- **估时**: 4h
- **依赖**: T1.3
- **子任务**:
  - [ ] 八字信息收集向导
  - [ ] 风水信息收集向导
  - [ ] 表单验证与错误处理
  - [ ] 步骤进度指示器

#### T3.3: 结果页面增强
- **优先级**: P0
- **估时**: 3h
- **依赖**: T3.2
- **子任务**:
  - [ ] 五行雷达图组件
  - [ ] 飞星九宫格组件
  - [ ] 交互式展开/折叠
  - [ ] AI问答入口整合

#### T3.4: 响应式适配
- **优先级**: P0
- **估时**: 2h
- **依赖**: T3.1, T3.2, T3.3
- **子任务**:
  - [ ] 移动端布局优化
  - [ ] 触摸手势支持
  - [ ] 断点样式调整

### Phase 4: 性能与监控

#### T4.1: 性能优化
- **优先级**: P1
- **估时**: 3h
- **依赖**: T3.1, T3.2, T3.3
- **子任务**:
  - [ ] 代码分割配置
  - [ ] 图片懒加载
  - [ ] 动态导入重组件
  - [ ] Suspense边界添加

#### T4.2: SEO优化
- **优先级**: P1
- **估时**: 2h
- **依赖**: T3.1
- **子任务**:
  - [ ] Metadata配置
  - [ ] OG图片生成API
  - [ ] Sitemap生成
  - [ ] JSON-LD结构数据

#### T4.3: 指标收集
- **优先级**: P1
- **估时**: 2h
- **依赖**: T3.1, T3.2
- **子任务**:
  - [ ] 转化漏斗事件埋点
  - [ ] 性能指标收集
  - [ ] 错误边界添加
  - [ ] 结构化日志配置

### Phase 5: 测试与部署

#### T5.1: E2E测试
- **优先级**: P0
- **估时**: 3h
- **依赖**: T3.1, T3.2, T3.3
- **子任务**:
  - [ ] Playwright配置
  - [ ] 核心流程测试用例
  - [ ] 表单提交测试
  - [ ] AI问答测试

#### T5.2: 性能测试
- **优先级**: P1
- **估时**: 2h
- **依赖**: T4.1
- **子任务**:
  - [ ] Lighthouse CI配置
  - [ ] 压力测试脚本
  - [ ] 性能基线建立
  - [ ] 前后对比报告

#### T5.3: 预览部署
- **优先级**: P0
- **估时**: 1h
- **依赖**: T5.1
- **子任务**:
  - [ ] Vercel配置
  - [ ] 环境变量设置
  - [ ] 预览链接生成
  - [ ] Smoke测试

#### T5.4: 文档完善
- **优先级**: P1
- **估时**: 2h
- **依赖**: T5.3
- **子任务**:
  - [ ] Warp Notebook生成
  - [ ] Workflows配置
  - [ ] 回滚手册
  - [ ] 运维指南

## 里程碑计划

### Milestone 1: 算法基础 (Day 1-2)
- ✅ 项目扫描与规划
- ⏳ 数据契约定义
- ⏳ 算法优先护栏

### Milestone 2: 用户体验 (Day 3-4)
- [ ] 首页转化优化
- [ ] 渐进式表单
- [ ] 结果展示增强

### Milestone 3: 质量保证 (Day 5-6)  
- [ ] 性能优化
- [ ] E2E测试
- [ ] 预览部署

## 风险管理

### 已识别风险
1. **AI模型响应不稳定**
   - 缓解: 多模型备选，降级策略
   
2. **算法准确性争议**
   - 缓解: 引用权威资料，提供算法选择

3. **性能不达标**
   - 缓解: 渐进增强，核心功能优先

## 验收标准

### 功能验收
- [ ] 八字计算准确性 >= 99%
- [ ] AI必须基于计算数据回答
- [ ] 移动端完美适配

### 性能验收
- [ ] LCP < 2.5s
- [ ] FID < 100ms
- [ ] CLS < 0.1
- [ ] Lighthouse >= 90

### 用户验收
- [ ] 转化率 >= 30%
- [ ] 错误率 < 0.1%
- [ ] 满意度 >= 4/5

## 资源需求

### 技术资源
- Next.js 15.5.2环境
- PostgreSQL数据库
- AI API密钥(OpenAI/Claude)
- Vercel账号

### 时间估算
- 总工时: ~40小时
- 日历时间: 5-6天
- 缓冲时间: 20%

---
*更新时间: 2025-01-05*
*版本: 1.0.0*
*负责人: AI全栈交付代理*