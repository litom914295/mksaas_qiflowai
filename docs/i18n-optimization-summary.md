# i18n 优化总结报告

**日期**: 2025-10-05  
**状态**: ✅ 基本完成，部分清理待进行

## 📋 问题总结

项目的 i18n 配置存在以下混乱：

1. **重复的语言文件**:
   - 英文: `en.json`, `en-qiflow.json`
   - 简体中文: `zh.json`, `zh-CN.json`, `qiflow-zh.json`

2. **键结构不一致**:
   - 大小写混用 (`Metadata` vs `metadata`)
   - 数组结构不统一 (`keywords.0`, `keywords.1` vs `keywords`)
   - 缺失的翻译键（800+ 个）

3. **翻译完整性问题**:
   - 其他语言文件缺少英文基准文件中的很多键

## ✅ 已完成的优化

### 1. 合并重复文件

#### 英文翻译
- ✅ 合并 `en.json` 和 `en-qiflow.json`
- ✅ 删除冗余文件 `en-qiflow.json`
- ✅ 最终键数: **2413 个**

#### 简体中文翻译
- ✅ 合并 `zh.json`, `zh-CN.json`, `qiflow-zh.json`
- ✅ 删除冗余文件 `zh.json`, `qiflow-zh.json`
- ✅ 最终键数: **2413 个**（已补齐）

### 2. 修复键结构问题

#### 大小写统一
修复了以下重复键（保留小写版本）:
- `Metadata` → `metadata`
- `Common` → `common`
- `Home` → `home`
- `Navigation` → `navigation`
- `Auth` → `auth`
- ... 等 25+ 个重复键

#### 数组结构标准化
- ✅ 将对象形式的数组（`keywords.0`, `keywords.1`）转换为真正的 JSON 数组
- ✅ 统一了 `hints`, `keywords`, `points` 等数组字段

### 3. 补齐缺失的翻译键

自动为所有语言文件补齐缺失的键：

| 语言 | 补齐前 | 补齐后 | 新增键数 |
|------|--------|--------|----------|
| en | 2405 | 2413 | 8 |
| zh-CN | 1704 | 2413 | 709 |
| zh-TW | 1622 | 2413 | 791 |
| ja | 1632 | 2413 | 781 |
| ko | 1644 | 2413 | 769 |
| ms-MY | 1603 | 2413 | 810 |

### 4. 创建的工具脚本

#### `scripts/merge-i18n.ts`
- 深度合并多个翻译文件
- 删除冗余文件
- 统计键数量

#### `scripts/fill-i18n-keys.ts`
- 自动补齐缺失的翻译键
- 使用英文作为占位符
- 删除多余的键

#### `scripts/fix-i18n-issues.ts`
- 修复大小写冲突的重复键
- 标准化数组结构
- 确保所有语言文件结构一致

## 📊 最终语言文件列表

```
messages/
├── en.json      (2413 个键) ✅ 基准语言
├── zh-CN.json   (2413 个键) ✅ 简体中文
├── zh-TW.json   (2413 个键) ✅ 繁体中文
├── ja.json      (2413 个键) ✅ 日语
├── ko.json      (2413 个键) ✅ 韩语
└── ms-MY.json   (2413 个键) ✅ 马来语
```

## 🚀 如何使用

### 验证翻译完整性
```bash
npm run validate:i18n
```

### 重新运行优化（如果需要）
```bash
# 1. 合并重复文件
npx tsx scripts/merge-i18n.ts

# 2. 补齐缺失的键
npx tsx scripts/fill-i18n-keys.ts

# 3. 修复键结构问题
npx tsx scripts/fix-i18n-keys.ts

# 4. 验证结果
npm run validate:i18n
```

## 📝 后续建议

### 短期任务 (本周)
1. ⚠️ **翻译英文占位符**
   - 新增的 ~800 个键目前使用英文占位符
   - 需要人工或 AI 翻译为对应语言
   - 优先级: 简体中文 > 其他语言

2. ⚠️ **测试语言切换**
   - 在浏览器中测试所有 6 种语言
   - 确保没有显示错误或布局问题
   - 检查关键页面: 首页、八字分析、支付页面

3. ✅ **更新使用文档**
   - 已更新 `docs/i18n-guide.md`
   - 需要团队成员熟悉新的文件结构

### 中期任务 (本月)
1. **建立翻译流程**
   - 新功能开发时同步更新 6 种语言
   - 添加 CI/CD 检查确保翻译完整性

2. **质量审查**
   - 请母语者审查各语言翻译质量
   - 修正不准确或不自然的翻译

3. **性能优化**
   - 监控翻译资源加载性能
   - 考虑按需加载大型翻译模块

## ⚠️ 已知问题

### 文件锁定问题
在运行修复脚本时，某些文件（zh-CN.json, zh-TW.json, ja.json 等）偶尔会被锁定无法写入。

**解决方法**:
1. 关闭所有编辑器和文件浏览器
2. 等待几秒后重新运行脚本
3. 或手动重启电脑后再运行

### 数组 vs 对象
某些翻译值在基准语言（英文）中可能定义为数组，但在其他语言中可能是对象或字符串。

**解决方法**:
- 手动检查 `validate:i18n` 报告中的 "Missing" 和 "Extra" 键
- 统一数据结构，确保类型匹配

## 🔧 维护建议

### 添加新翻译键
1. 在 `messages/en.json` 中添加新键
2. 运行 `npx tsx scripts/fill-i18n-keys.ts` 自动补齐其他语言
3. 翻译占位符内容
4. 运行 `npm run validate:i18n` 验证

### 修改现有翻译
1. 直接编辑对应语言文件
2. 运行 `npm run validate:i18n` 确保没有破坏结构

### 定期检查
```bash
# 每周运行一次，确保翻译完整性
npm run validate:i18n
```

## 📞 联系与支持

如有任何问题或需要帮助：
- 查看 `docs/i18n-guide.md` 使用指南
- 查看 `docs/i18n-migration-report.md` 详细迁移报告

---

**报告生成时间**: 2025-10-05  
**优化版本**: v1.0.1  
**状态**: ✅ 基本完成，等待翻译补充
