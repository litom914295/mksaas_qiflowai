# QiFlowAI 监控系统 - 管理员用户手册

## 📖 目录

1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [监控功能](#监控功能)
4. [配置管理](#配置管理)
5. [告警系统](#告警系统)
6. [备份恢复](#备份恢复)
7. [故障排查](#故障排查)
8. [最佳实践](#最佳实践)

## 系统概述

QiFlowAI 监控系统是一个全面的应用监控和运维平台，提供以下核心功能：

- 📊 **实时监控** - 系统性能、API响应时间、资源使用率
- 🐛 **错误追踪** - 自动收集和分析应用错误
- 📝 **日志管理** - 集中式日志查看和搜索
- 🔔 **告警通知** - 灵活的告警规则和多渠道通知
- 💾 **备份管理** - 自动化数据备份和恢复
- 🚀 **部署管理** - 部署历史和环境配置

## 快速开始

### 登录系统

1. 访问管理后台地址：`https://yourdomain.com/admin`
2. 使用管理员账号登录
3. 首次登录建议修改密码

### 主要导航

```
管理后台
├── 监控中心
│   ├── 错误监控
│   ├── 日志查看
│   ├── 性能监控
│   ├── 备份管理
│   ├── 系统健康
│   └── 告警配置
└── 系统配置
    ├── Sentry 配置
    ├── 云存储配置
    ├── 定时任务
    └── 部署管理
```

## 监控功能

### 错误监控

#### 查看错误列表

1. 进入 **监控中心 > 错误监控**
2. 默认显示未解决的错误
3. 使用筛选器过滤：
   - **级别**: error, warning, critical
   - **状态**: 未解决、已解决、已忽略
   - **时间范围**: 自定义日期范围

#### 处理错误

1. 点击错误查看详情
2. 查看错误堆栈和上下文信息
3. 处理选项：
   - **标记为已解决** - 错误已修复
   - **忽略** - 暂时忽略该错误
   - **分配** - 分配给团队成员

#### 错误统计

错误监控页面显示：
- **今日错误数** - 当天新增错误
- **未解决错误** - 待处理错误总数
- **错误趋势** - 过去7天错误趋势图
- **热点错误** - 出现次数最多的错误

### 日志查看

#### 实时日志流

1. 进入 **监控中心 > 日志查看**
2. 点击"自动刷新"启用实时更新
3. 日志按时间倒序显示

#### 日志搜索

搜索功能支持：
- **关键词搜索** - 搜索日志内容
- **级别筛选** - INFO, WARN, ERROR, DEBUG
- **来源筛选** - 按模块或服务筛选
- **时间范围** - 自定义时间段

#### 日志导出

1. 设置搜索条件
2. 点击"导出日志"
3. 选择导出格式（CSV/JSON）
4. 下载到本地

### 性能监控

#### 系统资源

实时监控：
- **CPU 使用率** - 当前 CPU 占用百分比
- **内存使用** - 内存占用情况
- **响应时间** - API 平均响应时间
- **数据库连接** - 活跃连接数

#### API 性能

查看 API 端点性能指标：
- **平均响应时间** - 端点平均耗时
- **P95/P99 延迟** - 95% 和 99% 百分位数
- **调用次数** - 总请求数
- **错误率** - 失败请求百分比

#### 性能趋势图表

- **折线图** - 显示性能随时间变化
- **柱状图** - 对比不同端点性能
- **面积图** - 资源使用趋势

### 系统健康

#### 服务状态

监控所有关键服务：
- ✅ **正常** - 服务运行良好
- ⚠️ **降级** - 性能下降但可用
- ❌ **故障** - 服务不可用

#### 健康检查配置

配置健康检查参数：
- **检查间隔** - 默认 60 秒
- **超时时间** - 默认 10 秒
- **失败重试** - 默认 3 次
- **告警阈值** - 连续失败次数

## 配置管理

### Sentry 配置

#### 基础配置

1. 进入 **系统配置 > Sentry 配置**
2. 填写配置信息：
   ```
   - DSN: Sentry 项目 DSN
   - 环境: development/staging/production
   - 采样率: 0.1 (10%)
   ```
3. 点击"测试连接"验证配置
4. 保存配置

#### 过滤规则

配置忽略的错误：
1. 点击"添加过滤规则"
2. 输入错误特征或正则表达式
3. 常见过滤规则：
   ```
   - ResizeObserver loop limit exceeded
   - ChunkLoadError
   - /health
   - /metrics
   ```

### 云存储配置

#### 配置 AWS S3

1. 进入 **系统配置 > 云存储配置**
2. 选择"Amazon S3"
3. 填写凭证信息：
   ```
   - Access Key ID
   - Secret Access Key
   - Region: 如 us-east-1
   - Bucket Name
   ```
4. 测试连接并保存

#### 配置阿里云 OSS

1. 选择"阿里云 OSS"
2. 填写配置：
   ```
   - Access Key ID
   - Access Key Secret
   - Endpoint: 如 oss-cn-hangzhou.aliyuncs.com
   - Bucket Name
   ```

#### 备份策略

配置自动备份：
- **备份频率**: 每天/每周/每月
- **保留时间**: 7天/30天/90天
- **备份内容**: 数据库/文件/日志

### 定时任务

#### 管理任务

1. 进入 **系统配置 > 定时任务**
2. 查看任务列表，包含：
   - 任务名称和描述
   - 执行计划 (Cron 表达式)
   - 上次/下次执行时间
   - 任务状态

#### 创建新任务

1. 点击"新建任务"
2. 填写任务信息：
   ```
   - 名称: 数据库全量备份
   - 描述: 每天凌晨2点执行
   - Cron: 0 2 * * *
   - 脚本路径: /scripts/backup.sh
   ```
3. 保存并启用任务

#### Cron 表达式说明

```
* * * * *
│ │ │ │ │
│ │ │ │ └─ 星期几 (0-7, 0和7都代表周日)
│ │ │ └─── 月份 (1-12)
│ │ └───── 日期 (1-31)
│ └─────── 小时 (0-23)
└───────── 分钟 (0-59)
```

常用示例：
- `0 2 * * *` - 每天凌晨2点
- `0 */6 * * *` - 每6小时
- `0 2 * * 0` - 每周日凌晨2点
- `0 0 1 * *` - 每月1号凌晨

### 部署管理

#### 查看部署历史

1. 进入 **系统配置 > 部署管理**
2. 查看部署记录：
   - 版本号和 Git 提交
   - 部署时间和部署者
   - 部署状态和耗时

#### 环境变量管理

1. 切换到"环境变量"标签
2. 查看和编辑环境变量
3. **注意**: 敏感信息自动加密显示
4. 修改后需要重新部署生效

#### 健康检查

测试各端点健康状态：
- `/api/health` - 应用健康
- `/api/health/db` - 数据库连接
- `/api/health/redis` - Redis 连接
- `/api/health/ai` - AI 服务状态

## 告警系统

### 告警规则

#### 创建告警规则

1. 进入 **监控中心 > 告警配置**
2. 点击"新建告警规则"
3. 配置规则：
   ```
   名称: CPU 使用率过高
   条件: cpu > 80%
   持续时间: 5分钟
   严重程度: warning
   通知渠道: email, slack
   ```

#### 告警条件

支持的指标：
- `cpu` - CPU 使用率百分比
- `memory` - 内存使用率百分比
- `error_rate` - 错误率百分比
- `response_time` - 响应时间毫秒
- `p95_response_time` - P95 响应时间

条件表达式示例：
- `cpu > 80`
- `memory > 90`
- `error_rate > 5`
- `p95_response_time > 2000`

### 通知渠道

#### 配置邮件通知

1. 点击"添加通知渠道"
2. 选择"邮件通知"
3. 填写接收邮箱
4. 测试并保存

#### 配置 Slack 通知

1. 选择"Slack"
2. 输入 Webhook URL
3. 指定频道 (如 #monitoring)
4. 测试发送

#### 通知模板

告警通知包含：
- 告警标题和描述
- 触发条件和当前值
- 触发时间
- 快速操作链接

## 备份恢复

### 自动备份

#### 配置自动备份

1. 进入 **监控中心 > 备份管理**
2. 确保云存储已配置
3. 设置备份计划：
   - 频率: 每天
   - 时间: 凌晨 2:00
   - 保留: 30天

#### 查看备份历史

备份列表显示：
- 备份时间
- 备份大小
- 备份状态
- 备份位置

### 手动备份

#### 立即备份

1. 点击"立即备份"
2. 选择备份类型：
   - **完整备份** - 备份所有数据
   - **增量备份** - 只备份变更部分
3. 等待备份完成

### 数据恢复

#### 从备份恢复

⚠️ **重要**: 恢复操作会覆盖当前数据，请谨慎操作！

1. 选择要恢复的备份
2. 点击"恢复"
3. 输入 `RESTORE` 确认
4. 等待恢复完成
5. 验证数据完整性

## 故障排查

### 常见问题

#### 1. 监控数据不更新

**症状**: 监控页面数据停止更新

**排查步骤**:
1. 检查实时数据流连接状态
2. 查看浏览器控制台错误
3. 验证 API 是否正常响应
4. 检查服务器日志

**解决方案**:
- 刷新页面重新连接
- 检查网络连接
- 重启监控服务

#### 2. 告警未触发

**症状**: 满足条件但未收到告警

**排查步骤**:
1. 检查告警规则是否启用
2. 验证告警条件配置
3. 查看通知渠道是否正确配置
4. 检查告警历史记录

**解决方案**:
- 重新保存告警规则
- 测试通知渠道
- 查看系统日志中的告警日志

#### 3. 备份失败

**症状**: 备份任务执行失败

**排查步骤**:
1. 查看备份错误信息
2. 验证云存储凭证
3. 检查网络连接
4. 确认存储空间充足

**解决方案**:
- 更新云存储凭证
- 检查防火墙规则
- 清理旧备份释放空间

### 紧急处理

#### 系统过载

1. 查看性能监控确认问题
2. 检查 CPU/内存使用率
3. 识别高负载端点
4. 临时措施：
   - 增加服务器资源
   - 启用限流
   - 关闭非关键功能

#### 数据丢失

1. 立即停止相关操作
2. 查看最近的备份
3. 评估数据丢失范围
4. 执行数据恢复流程
5. 记录事件并分析原因

## 最佳实践

### 日常监控

**每日检查**:
- ✅ 查看错误监控，处理新错误
- ✅ 检查系统健康状态
- ✅ 查看告警历史
- ✅ 验证备份成功

**每周检查**:
- ✅ 审查性能趋势
- ✅ 清理已解决的错误
- ✅ 更新告警规则
- ✅ 测试备份恢复

**每月检查**:
- ✅ 性能优化分析
- ✅ 安全审计
- ✅ 容量规划
- ✅ 文档更新

### 安全建议

1. **定期更改密码**
   - 至少每3个月更换一次
   - 使用强密码策略

2. **审计日志审查**
   - 定期检查操作日志
   - 注意异常活动

3. **权限管理**
   - 遵循最小权限原则
   - 定期审查权限分配

4. **备份验证**
   - 定期测试备份恢复
   - 验证备份完整性

### 性能优化

1. **监控数据清理**
   - 定期清理旧日志（30天以上）
   - 归档历史性能数据

2. **查询优化**
   - 使用适当的时间范围
   - 避免过大的数据集查询

3. **告警优化**
   - 调整告警阈值避免误报
   - 合并相似告警

## 附录

### 快捷键

- `Ctrl + K` - 全局搜索
- `Ctrl + /` - 帮助文档
- `Ctrl + R` - 刷新数据

### 支持渠道

- **技术支持**: support@qiflowai.com
- **紧急热线**: +86-xxx-xxxx-xxxx
- **文档中心**: https://docs.qiflowai.com
- **社区论坛**: https://community.qiflowai.com

### 更新日志

查看最新功能和改进：
https://qiflowai.com/changelog

---

**文档版本**: v1.0  
**最后更新**: 2025-10-13  
**适用版本**: QiFlowAI v1.2.0+
