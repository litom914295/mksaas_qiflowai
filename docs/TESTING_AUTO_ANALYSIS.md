# 测试自动分析功能指南

## 📋 功能说明

现在，当用户在AI对话中输入生辰八字信息时，系统会**自动识别并触发八字分析**，无需跳转到分析页面。

## 🧪 测试步骤

### 1. 启动开发服务器

```bash
npm run dev
```

等待服务器启动完成（看到 "Ready in..." 消息）

### 2. 打开浏览器

访问：`http://localhost:3000/zh-CN/ai-chat`

### 3. 测试输入示例

#### 测试用例 1：完整信息
```
1973年1月7日2点30分男性，岳阳
```

**预期结果**：
- ✅ 自动识别生辰信息
- ✅ 自动计算八字
- ✅ 显示完整的四柱命盘
- ✅ 显示五行分布
- ✅ 提供后续引导

#### 测试用例 2：标准格式
```
我是1990年1月1日12点30分出生的男生，在北京
```

**预期结果**：
- ✅ 成功解析所有信息
- ✅ 自动完成分析

#### 测试用例 3：ISO格式
```
1985-03-15 08:00 女
```

**预期结果**：
- ✅ 识别ISO日期格式
- ✅ 自动分析

#### 测试用例 4：信息不全
```
1990年1月1日出生
```

**预期结果**：
- ✅ 识别部分信息
- ✅ 提示需要：性别、出生时间
- ❌ 不会扣除积分

#### 测试用例 5：口语化
```
出生于1992年5月20日晚上8点，女生
```

**预期结果**：
- ✅ 识别口语化表达
- ✅ 正确解析时间

## 📊 验证清单

### 前端验证
- [ ] 输入后立即显示"正在分析..."
- [ ] 2-3秒内返回结果
- [ ] 显示完整的八字信息
- [ ] 格式美观（使用表格、表情符号）
- [ ] 提供后续引导（询问什么）

### 后端验证
- [ ] 控制台无错误日志
- [ ] 正确调用 calculateBazi()
- [ ] 返回完整的 BaziAnalysisResult
- [ ] HTTP 200 响应

### 边界情况
- [ ] 空输入不会崩溃
- [ ] 无效日期有友好提示
- [ ] API失败有降级处理
- [ ] 超时有提示

## 🐛 常见问题排查

### 问题1：仍然返回"请先进行八字分析"

**原因**：代码更改未生效

**解决**：
1. 停止所有 node 进程
2. 删除 `.next` 缓存
3. 重新启动：`npm run dev`

```bash
# Windows PowerShell
Get-Process node | Stop-Process -Force
Remove-Item -Recurse -Force .next
npm run dev
```

### 问题2：解析失败

**检查**：
1. 打开浏览器控制台（F12）
2. 查看 Network 标签
3. 找到 `/api/ai/chat` 请求
4. 检查请求/响应内容

### 问题3：八字计算错误

**检查**：
- `calculateBazi` 函数是否正常工作
- 日期时间格式是否正确
- 性别参数是否传递

## 📝 测试记录模板

### 测试日期：____年__月__日

| 测试用例 | 输入 | 预期 | 实际 | 状态 |
|---------|------|------|------|------|
| 完整信息 | 1973年1月7日2点30分男性 | 自动分析 | _____ | ☐ |
| 标准格式 | 1990年1月1日12点30分男生 | 自动分析 | _____ | ☐ |
| ISO格式 | 1985-03-15 08:00 女 | 自动分析 | _____ | ☐ |
| 信息不全 | 1990年1月1日 | 提示补充 | _____ | ☐ |
| 口语化 | 1992年5月20日晚上8点女生 | 自动分析 | _____ | ☐ |

## 🔧 调试模式

### 启用详细日志

在 `src/app/api/ai/chat/route.ts` 中添加：

```typescript
console.log('📝 Parsed input:', parsed);
console.log('🎯 Confidence:', parsed.confidence);
console.log('📋 Missing fields:', parsed.missingFields);
```

### 查看请求详情

```typescript
console.log('📨 Request message:', message);
console.log('🔍 Bazi data:', autoGeneratedBaziData);
```

## ✅ 成功标准

测试通过条件：

1. ✅ 至少4/5测试用例成功
2. ✅ 无错误日志
3. ✅ 响应时间 < 5秒
4. ✅ UI展示美观
5. ✅ 用户体验流畅

## 📚 相关文档

- [输入解析器API](./INPUT_PARSER_API.md)
- [算法优先优化说明](./ALGORITHM_FIRST_OPTIMIZATION.md)
- [八字计算服务](./BAZI_CALCULATOR.md)

---

**测试环境**: 开发环境  
**Node版本**: v18+  
**浏览器**: Chrome/Edge（推荐）
