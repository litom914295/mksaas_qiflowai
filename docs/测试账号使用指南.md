# æµ‹è¯•è´¦å·ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åˆ›å»ºå’Œç®¡ç†æµ‹è¯•è´¦å·ï¼Œä»¥åŠå¦‚ä½•ä¸ºæµ‹è¯•è´¦å·æ·»åŠ ç§¯åˆ†è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ã€‚

---

## ğŸ¯ å…³äºç§¯åˆ†ç³»ç»Ÿ

### ç®¡ç†å‘˜è´¦å·æƒé™

**é‡è¦è¯´æ˜ï¼šç®¡ç†å‘˜è´¦å·ï¼ˆrole='admin'ï¼‰é»˜è®¤æ²¡æœ‰ç§¯åˆ†é™åˆ¶ï¼**

æ ¹æ®ä»£ç åˆ†æï¼š
- ç®¡ç†å‘˜è´¦å·çš„è§’è‰²å­—æ®µä¸º `role: 'admin'`ï¼ˆä½äº `user` è¡¨ï¼‰
- æ™®é€šç”¨æˆ·çš„è§’è‰²ä¸º `role: 'user'`
- ç§¯åˆ†ç³»ç»Ÿä¸»è¦é’ˆå¯¹æ™®é€šç”¨æˆ·è¿›è¡Œé™åˆ¶
- ç®¡ç†å‘˜è´¦å·å¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼Œä½†ä¸å—ç§¯åˆ†é™åˆ¶

### å½“å‰ç®¡ç†å‘˜è´¦å·

æ ¹æ® `.env.local` é…ç½®ï¼Œå½“å‰ç³»ç»Ÿå·²æœ‰ç®¡ç†å‘˜è´¦å·ï¼š

```
é‚®ç®±: 58462822@qq.com
å¯†ç : sd721204
è§’è‰²: admin
```

**å¦‚æœä½ ç”¨ç®¡ç†å‘˜è´¦å·æµ‹è¯•ç§¯åˆ†åŠŸèƒ½ï¼Œå¯èƒ½çœ‹ä¸åˆ°ç§¯åˆ†é™åˆ¶æ•ˆæœï¼**

---

## ğŸ§ª æµ‹è¯•è´¦å·åˆ›å»º

### æ–¹æ³• 1: ä½¿ç”¨ç°æœ‰è„šæœ¬åˆ›å»ºæµ‹è¯•ç”¨æˆ·

å·²æœ‰ `scripts/create-test-user.ts` è„šæœ¬å¯ä»¥åˆ›å»ºæµ‹è¯•è´¦å·ï¼š

```bash
# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
npm run script:create-test-user

# é»˜è®¤åˆ›å»ºçš„æµ‹è¯•è´¦å·ä¿¡æ¯ï¼š
# é‚®ç®±: test@example.com
# å¯†ç : test123456
# è§’è‰²: user
```

### æ–¹æ³• 2: é€šè¿‡å‰ç«¯æ³¨å†Œ

1. è®¿é—®æ³¨å†Œé¡µé¢
2. ä½¿ç”¨ä¸€ä¸ªæ–°çš„é‚®ç®±æ³¨å†Œï¼ˆå¦‚ `test2@example.com`ï¼‰
3. æ–°ç”¨æˆ·ä¼šè‡ªåŠ¨è·å¾—æ³¨å†Œèµ é€ç§¯åˆ†ï¼š**70 ç§¯åˆ†**

---

## ğŸ’° ç§¯åˆ†ç®¡ç†

### æŸ¥çœ‹ç”¨æˆ·ç§¯åˆ†

```bash
# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
npm run list-users

# éªŒè¯ç§¯åˆ†ä¸€è‡´æ€§
npm run verify:credits
```

### ç»™æµ‹è¯•è´¦å·æ·»åŠ ç§¯åˆ†

#### ä½¿ç”¨æ–°åˆ›å»ºçš„è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# ç»™é»˜è®¤æµ‹è¯•è´¦å·æ·»åŠ  1000 ç§¯åˆ†
npm run add-credits

# ç»™æŒ‡å®šé‚®ç®±æ·»åŠ ç§¯åˆ†ï¼ˆè‡ªå®šä¹‰æ•°é‡ï¼‰
npm run add-credits test@example.com 5000

# ç»™è‡ªå·±çš„æµ‹è¯•è´¦å·æ·»åŠ ç§¯åˆ†
npm run add-credits your-test@example.com 2000
```

è„šæœ¬åŠŸèƒ½ï¼š
- âœ… è‡ªåŠ¨æŸ¥æ‰¾æŒ‡å®šé‚®ç®±çš„ç”¨æˆ·
- âœ… æ˜¾ç¤ºå½“å‰ç§¯åˆ†ä½™é¢
- âœ… æ·»åŠ æŒ‡å®šæ•°é‡çš„æµ‹è¯•ç§¯åˆ†
- âœ… ç§¯åˆ†æœ‰æ•ˆæœŸä¸º 1 å¹´
- âœ… æ˜¾ç¤ºæ“ä½œå‰åçš„ç§¯åˆ†å¯¹æ¯”

#### æ‰‹åŠ¨é€šè¿‡æ•°æ®åº“æ·»åŠ 

å¦‚æœéœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ SQLï¼š

```sql
-- 1. æŸ¥æ‰¾ç”¨æˆ· ID
SELECT id, email, name FROM "user" WHERE email = 'test@example.com';

-- 2. æŸ¥çœ‹å½“å‰ç§¯åˆ†
SELECT * FROM user_credit WHERE user_id = '<user_id>';

-- 3. æ·»åŠ ç§¯åˆ†äº¤æ˜“è®°å½•
INSERT INTO credit_transaction (
  id, user_id, type, amount, remaining_amount, 
  description, expiration_date, created_at, updated_at
) VALUES (
  gen_random_uuid(),
  '<user_id>',
  'manual_adjustment',
  1000,
  1000,
  'æµ‹è¯•ç§¯åˆ†',
  NOW() + INTERVAL '1 year',
  NOW(),
  NOW()
);

-- 4. æ›´æ–°ç”¨æˆ·ç§¯åˆ†ä½™é¢
UPDATE user_credit 
SET current_credits = current_credits + 1000,
    updated_at = NOW()
WHERE user_id = '<user_id>';
```

---

## ğŸ® åŠŸèƒ½æµ‹è¯•

### ç§¯åˆ†æ¶ˆè€—è§„åˆ™

æ ¹æ® `.env.admin.example` é…ç½®ï¼š

| åŠŸèƒ½ | æ¶ˆè€—ç§¯åˆ† | è¯´æ˜ |
|------|---------|------|
| **AI èŠå¤©** | 5 | æ¯æ¬¡å¯¹è¯æ¶ˆè€— 5 ç§¯åˆ† |
| **æ·±åº¦è§£è¯»** | 30 | æ·±åº¦åˆ†ææ¶ˆè€— 30 ç§¯åˆ† |
| **å…«å­—æµ‹ç®—** | 10 | åŸºç¡€å…«å­—åˆ†æ |
| **ç„ç©ºé£æ°´** | 20 | é£æ°´åˆ†æåŠŸèƒ½ |
| **PDF å¯¼å‡º** | 5 | å¯¼å‡ºæŠ¥å‘Šä¸º PDF |

### ç§¯åˆ†è·å–è§„åˆ™

| æ–¹å¼ | è·å¾—ç§¯åˆ† | è¯´æ˜ |
|------|---------|------|
| **æ³¨å†Œèµ é€** | 70 | æ–°ç”¨æˆ·æ³¨å†Œä¸€æ¬¡æ€§èµ é€ |
| **æ¯æ—¥ç­¾åˆ°** | 5 | æ¯å¤©ç­¾åˆ°å¯è·å¾—ç§¯åˆ† |
| **é‚€è¯·å¥½å‹ï¼ˆé‚€è¯·äººï¼‰** | 15 | æˆåŠŸé‚€è¯·ä¸€ä¸ªæ–°ç”¨æˆ· |
| **é‚€è¯·å¥½å‹ï¼ˆè¢«é‚€è¯·äººï¼‰** | 20 | é€šè¿‡é‚€è¯·é“¾æ¥æ³¨å†Œ |
| **åˆ†äº«å¥–åŠ±** | 5 | åˆ†äº«å†…å®¹åˆ°ç¤¾äº¤å¹³å° |

### æµ‹è¯•åœºæ™¯

#### åœºæ™¯ 1: æµ‹è¯•ç§¯åˆ†ä¸è¶³æç¤º

1. åˆ›å»ºæµ‹è¯•è´¦å·
2. **ä¸è¦æ·»åŠ ç§¯åˆ†**ï¼ˆæˆ–æ·»åŠ å°‘é‡ç§¯åˆ†ï¼Œå¦‚ 5 ç§¯åˆ†ï¼‰
3. å°è¯•ä½¿ç”¨ã€Œæ·±åº¦è§£è¯»ã€åŠŸèƒ½ï¼ˆéœ€è¦ 30 ç§¯åˆ†ï¼‰
4. éªŒè¯æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºã€Œç§¯åˆ†ä¸è¶³ã€æç¤º

#### åœºæ™¯ 2: æµ‹è¯•ç§¯åˆ†æ‰£é™¤

1. åˆ›å»ºæµ‹è¯•è´¦å·å¹¶æ·»åŠ  100 ç§¯åˆ†
2. ä½¿ç”¨ã€ŒAI èŠå¤©ã€åŠŸèƒ½ï¼ˆæ¶ˆè€— 5 ç§¯åˆ†ï¼‰
3. æ£€æŸ¥ç§¯åˆ†ä½™é¢æ˜¯å¦æ­£ç¡®å‡å°‘åˆ° 95
4. æŸ¥çœ‹ç§¯åˆ†äº¤æ˜“è®°å½•

#### åœºæ™¯ 3: æµ‹è¯•ç§¯åˆ†è´­ä¹°æµç¨‹

1. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•
2. è¿›å…¥ã€Œç§¯åˆ†å……å€¼ã€é¡µé¢
3. é€‰æ‹©ç§¯åˆ†å¥—é¤
4. ä½¿ç”¨æµ‹è¯•æ”¯ä»˜ï¼ˆStripe æµ‹è¯•æ¨¡å¼ï¼‰
5. éªŒè¯ç§¯åˆ†åˆ°è´¦

#### åœºæ™¯ 4: æµ‹è¯•é‚€è¯·å¥–åŠ±

1. ç”Ÿæˆé‚€è¯·é“¾æ¥
2. ä½¿ç”¨å¦ä¸€ä¸ªé‚®ç®±é€šè¿‡é‚€è¯·é“¾æ¥æ³¨å†Œ
3. æ£€æŸ¥é‚€è¯·äººæ˜¯å¦è·å¾— 15 ç§¯åˆ†
4. æ£€æŸ¥è¢«é‚€è¯·äººæ˜¯å¦è·å¾— 20 ç§¯åˆ†

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ‰¾ä¸åˆ°æµ‹è¯•ç”¨æˆ·

```bash
# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·æŸ¥çœ‹
npm run list-users

# é‡æ–°åˆ›å»ºæµ‹è¯•ç”¨æˆ·
npm run script:create-test-user
```

### é—®é¢˜ 2: æ·»åŠ ç§¯åˆ†å¤±è´¥

æ£€æŸ¥é”™è¯¯ä¿¡æ¯ï¼š
- ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Ÿ
- æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Ÿ
- ç§¯åˆ†æ•°é‡æ˜¯å¦æœ‰æ•ˆï¼ˆå¿…é¡» > 0ï¼‰ï¼Ÿ

```bash
# éªŒè¯æ•°æ®åº“è¿æ¥
npm run db:studio

# æ£€æŸ¥ç§¯åˆ†ç³»ç»Ÿä¸€è‡´æ€§
npm run verify:credits
```

### é—®é¢˜ 3: ç®¡ç†å‘˜è´¦å·æµ‹è¯•ä¸åˆ°ç§¯åˆ†é™åˆ¶

**è¿™æ˜¯æ­£å¸¸çš„ï¼** ç®¡ç†å‘˜è´¦å·ä¸å—ç§¯åˆ†é™åˆ¶ã€‚

è§£å†³æ–¹æ¡ˆï¼š
1. åˆ›å»ºä¸€ä¸ªæ™®é€šæµ‹è¯•è´¦å·ï¼ˆrole='user'ï¼‰
2. ç»™æµ‹è¯•è´¦å·æ·»åŠ å°‘é‡ç§¯åˆ†
3. ä½¿ç”¨æµ‹è¯•è´¦å·è¿›è¡ŒåŠŸèƒ½æµ‹è¯•

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### ç”¨æˆ·è¡¨ (`user`)

```sql
- id: ç”¨æˆ· ID
- email: é‚®ç®±
- name: å§“å
- role: è§’è‰² ('user' | 'admin')
- customerId: Stripe å®¢æˆ· ID
- banned: æ˜¯å¦è¢«å°ç¦
```

### ç§¯åˆ†ä½™é¢è¡¨ (`user_credit`)

```sql
- id: è®°å½• ID
- user_id: ç”¨æˆ· ID
- current_credits: å½“å‰ç§¯åˆ†ä½™é¢
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

### ç§¯åˆ†äº¤æ˜“è¡¨ (`credit_transaction`)

```sql
- id: äº¤æ˜“ ID
- user_id: ç”¨æˆ· ID
- type: äº¤æ˜“ç±»å‹
- amount: ç§¯åˆ†æ•°é‡ï¼ˆæ­£æ•°ä¸ºå¢åŠ ï¼Œè´Ÿæ•°ä¸ºæ‰£é™¤ï¼‰
- remaining_amount: å‰©ä½™å¯ç”¨ç§¯åˆ†
- description: äº¤æ˜“æè¿°
- expiration_date: è¿‡æœŸæ—¶é—´
- created_at: åˆ›å»ºæ—¶é—´
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. å‡†å¤‡å¤šä¸ªæµ‹è¯•è´¦å·

å»ºè®®åˆ›å»ºä»¥ä¸‹å‡ ç±»æµ‹è¯•è´¦å·ï¼š

- **æ–°ç”¨æˆ·è´¦å·**ï¼šæµ‹è¯•æ³¨å†Œæµç¨‹å’Œæ–°æ‰‹å¼•å¯¼
- **æœ‰ç§¯åˆ†è´¦å·**ï¼šæµ‹è¯•æ­£å¸¸åŠŸèƒ½ä½¿ç”¨
- **ç§¯åˆ†ä¸è¶³è´¦å·**ï¼šæµ‹è¯•ç§¯åˆ†é™åˆ¶å’Œæç¤º
- **VIP è´¦å·**ï¼šæµ‹è¯•ä»˜è´¹åŠŸèƒ½

### 2. å®šæœŸæ¸…ç†æµ‹è¯•æ•°æ®

```bash
# å®šæœŸæ£€æŸ¥å’Œæ¸…ç†æµ‹è¯•ç”¨æˆ·
npm run list-users

# å¦‚æœéœ€è¦ï¼Œå¯ä»¥é€šè¿‡æ•°æ®åº“æ‰‹åŠ¨åˆ é™¤æµ‹è¯•ç”¨æˆ·
# DELETE FROM "user" WHERE email LIKE '%test%';
```

### 3. ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒ

- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨çœŸå®ç”¨æˆ·æ•°æ®
- å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨æµ‹è¯•è´¦å·
- æµ‹è¯•ç¯å¢ƒï¼šå¯ä»¥éšæ„åˆ›å»º/åˆ é™¤æ•°æ®

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ€å¿«çš„æµ‹è¯•æ–¹å¼ï¼š

```bash
# 1. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
npm run script:create-test-user

# 2. æ·»åŠ æµ‹è¯•ç§¯åˆ†
npm run add-credits test@example.com 1000

# 3. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•
# é‚®ç®±: test@example.com
# å¯†ç : test123456

# 4. å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½ï¼
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
3. è¿è¡Œ `npm run verify:credits` éªŒè¯æ•°æ®ä¸€è‡´æ€§
4. æŸ¥çœ‹ `src/credits/credits.ts` æºä»£ç 

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰
