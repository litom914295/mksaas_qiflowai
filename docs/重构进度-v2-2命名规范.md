# v2-2 å‘½åè§„èŒƒæ¸è¿›å¼é‡æ„è¿›åº¦

## ğŸ“‹ æ€»ä½“ç­–ç•¥

é‡‡ç”¨æ¸è¿›å¼é‡æ„ï¼Œä¿æŒå‘åå…¼å®¹ï¼Œé¿å…ç ´åç°æœ‰ä»£ç ï¼š
1. âœ… åˆ›å»ºæ–°çš„ v2-2 æ–‡ä»¶å’Œç›®å½•ç»“æ„
2. âœ… åœ¨æ—§æ–‡ä»¶ä¸­æ·»åŠ  @deprecated æ ‡è®°
3. âœ… åœ¨æ—§æ–‡ä»¶ä¸­é‡æ–°å¯¼å‡ºæ–°å®ç°
4. ğŸ”„ é€æ­¥æ›´æ–°å¼•ç”¨åˆ°æ–°è·¯å¾„ï¼ˆè¿›è¡Œä¸­ï¼‰
5. â³ æœ€ç»ˆç§»é™¤æ—§æ–‡ä»¶ï¼ˆå¾…æ‰€æœ‰å¼•ç”¨æ›´æ–°åï¼‰

---

## â˜‘ï¸ å·²å®Œæˆçš„å·¥ä½œ

### 0. æ ¸å¿ƒåº“æ–‡ä»¶æ›´æ–°ï¼ˆæ–°å¢ï¼‰

#### å·²æ›´æ–°çš„æ–‡ä»¶
- âœ… `src/lib/report/report-generator-v2.2.ts` - å·²æ›´æ–°ä½¿ç”¨æ–°ç±»å‹
  - å¯¼å…¥è·¯å¾„æ›´æ–°ï¼š`@/types/report-v2-2`
  - ç±»å‹åæ›´æ–°ï¼š`ReportOutputV22`
  - æ–°å¢ `generateFullReportV22` å‡½æ•°
  - æ—§å‡½æ•° `generateFullReport_v2_2` å·²æ ‡è®°åºŸå¼ƒå¹¶è°ƒç”¨æ–°å‡½æ•°

## â˜‘ï¸ å·²å®Œæˆçš„å·¥ä½œï¼ˆåŸæœ‰ï¼‰

### 1. ç±»å‹å®šä¹‰æ–‡ä»¶

#### æ–°æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰
- âœ… `src/types/report-v2-2.ts` - ä½¿ç”¨æ–°å‘½åè§„èŒƒçš„ç±»å‹å®šä¹‰
  - æ¥å£å‘½åï¼š`ReportOutputV22`ï¼ˆPascalCase + V22åç¼€ï¼‰
  - å…¶ä»–ç±»å‹ä¿æŒä¸€è‡´

#### æ—§æ–‡ä»¶ï¼ˆå·²æ ‡è®°åºŸå¼ƒï¼‰
- âœ… `src/types/report-v2.2.ts` - æ·»åŠ  @deprecated æ ‡è®°
  - åœ¨æ–‡ä»¶å¤´æ·»åŠ åºŸå¼ƒè­¦å‘Š
  - åœ¨ `ReportOutput_v2_2` æ¥å£æ·»åŠ åºŸå¼ƒæ ‡è®°
  - åœ¨æ–‡ä»¶æœ«å°¾é‡æ–°å¯¼å‡ºæ–°ç±»å‹ `ReportOutputV22`

### 2. HTML æ¸²æŸ“å™¨

#### æ–°æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰
- âœ… `src/lib/report/v2-2/html.ts` - æ–°å‘½åè§„èŒƒçš„HTMLæ¸²æŸ“å™¨
  - å‡½æ•°å‘½åï¼š`renderReportHtmlV22`ï¼ˆcamelCase + V22åç¼€ï¼‰
  - ä½¿ç”¨æ–°ç±»å‹ï¼š`ReportOutputV22`

#### æ–°ç›®å½•ç´¢å¼•æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰
- âœ… `src/lib/report/v2-2/index.ts` - ä¾¿äºç»Ÿä¸€å¯¼å…¥
  - å¯¼å‡º `renderReportHtmlV22`
  - é‡æ–°å¯¼å‡ºå¸¸ç”¨ç±»å‹

#### æ—§æ–‡ä»¶ï¼ˆå·²æ ‡è®°åºŸå¼ƒå¹¶é‡å®šå‘ï¼‰
- âœ… `src/lib/report/v2_2/html.ts` - ä¿ç•™å¹¶é‡å®šå‘åˆ°æ–°å®ç°
  - æ·»åŠ  @deprecated æ ‡è®°
  - `renderReportHTML_v2_2` å†…éƒ¨è°ƒç”¨ `renderReportHtmlV22`
  - é‡æ–°å¯¼å‡ºæ–°å‡½æ•°

---

## âœ… å·²å®Œæˆçš„å·¥ä½œï¼ˆPhase 2ï¼‰

### 3. API è·¯ç”±é‡æ„

#### æ–°æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰
- âœ… `src/app/api/reports/v2-2/generate/route.ts` - æ–°å‘½åçš„ç”ŸæˆAPI
  - ä½¿ç”¨ `generateFullReportV22` å’Œ `renderReportHtmlV22`
  - è¿”å› `/reports/{id}/v2-2` è·¯å¾„
- âœ… `src/app/api/reports/[reportId]/v2-2/route.ts` - æ–°å‘½åçš„æŠ¥å‘Šè¯¦æƒ…API
  - æ ¹æ® reportId è·å–å¹¶æ¸²æŸ“æŠ¥å‘Š
  - ä½¿ç”¨ `renderReportHtmlV22` è¿›è¡Œ HTML æ¸²æŸ“

#### æ—§æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
- âœ… `src/app/api/reports/v2.2/generate/route.ts` - å·²æ ‡è®°åºŸå¼ƒå¹¶ä½¿ç”¨æ–°å‡½æ•°
  - æ›´æ–°ä¸ºä½¿ç”¨ `generateFullReportV22` å’Œ `renderReportHtmlV22`
  - è¿”å› `/reports/{id}/v2-2` è·¯å¾„ï¼ˆå‘å‰å…¼å®¹ï¼‰
- âœ… `src/app/api/reports/[reportId]/v2.2/route.ts` - å·²æ ‡è®°åºŸå¼ƒå¹¶ä½¿ç”¨æ–°å‡½æ•°
  - ä½¿ç”¨ `renderReportHtmlV22` è¿›è¡Œæ¸²æŸ“
  - æ·»åŠ  `X-Deprecated` å“åº”å¤´
- âœ… `src/app/api/report/export/route.ts` - å·²æ›´æ–°ä½¿ç”¨æ–°å‘½åè§„èŒƒ
  - å¯¼å…¥è·¯å¾„æ›´æ–°ï¼š`from '@/lib/report/v2-2'`
  - å‡½æ•°è°ƒç”¨æ›´æ–°ï¼š`generateFullReportV22`, `renderReportHtmlV22`

### 4. å‰ç«¯ç»„ä»¶æ›´æ–°

#### å·²æ›´æ–°çš„æ–‡ä»¶
- âœ… `src/app/[locale]/(routes)/report/page.tsx` - å·²æ›´æ–°APIç«¯ç‚¹
  - APIè°ƒç”¨æ›´æ–°ä¸º `/api/reports/v2-2/generate`

#### æ–°æ–‡ä»¶ï¼ˆå·²åˆ›å»ºï¼‰
- âœ… `src/app/(dashboard)/reports/[reportId]/v2-2/page.tsx` - æ–°å‘½åçš„æŠ¥å‘Šè¯¦æƒ…é¡µé¢
  - ä½¿ç”¨æ–°çš„ API ç«¯ç‚¹ `/api/reports/[reportId]/v2-2`
  - iframe åµŒå…¥æŠ¥å‘Šé¢„è§ˆ

#### æ—§æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
- âœ… `src/app/(dashboard)/reports/[reportId]/v2_2/page.tsx` - å·²æ ‡è®°åºŸå¼ƒå¹¶é‡å®šå‘
  - è‡ªåŠ¨é‡å®šå‘åˆ° `/reports/[reportId]/v2-2`

---

## â³ å¾…å¤„ç†çš„æ–‡ä»¶

### éœ€è¦æ›´æ–°å¯¼å…¥è·¯å¾„çš„æ–‡ä»¶

æ ¹æ® grep æœç´¢ç»“æœï¼Œä»¥ä¸‹æ–‡ä»¶éœ€è¦æ›´æ–°å¯¼å…¥è·¯å¾„ï¼š

#### é«˜ä¼˜å…ˆçº§ï¼ˆç›´æ¥ä½¿ç”¨ v2.2 ç±»å‹æˆ–å‡½æ•°ï¼‰
1. âœ… `src/lib/report/report-generator-v2.2.ts`
   - âœ… ç±»å‹å¯¼å…¥å·²æ›´æ–°ï¼š`from '@/types/report-v2-2'`
   - âœ… ç±»å‹åç§°å·²æ›´æ–°ï¼š`ReportOutputV22`
   - âœ… æ–°å¢ `generateFullReportV22` å‡½æ•°

2. âœ… `src/app/api/report/export/route.ts`
   - âœ… å¯¼å…¥è·¯å¾„å·²æ›´æ–°ï¼š`from '@/lib/report/v2-2'`
   - âœ… å‡½æ•°è°ƒç”¨å·²æ›´æ–°ï¼š`generateFullReportV22`, `renderReportHtmlV22`

3. âœ… `src/app/[locale]/(routes)/report/page.tsx`
   - âœ… APIç«¯ç‚¹å·²æ›´æ–°ï¼š`/api/reports/v2-2/generate`

4. âœ… `src/components/home/HeroWithForm.tsx`
   - âœ… é¦–é¡µç”ŸæˆæŠ¥å‘ŠæŒ‰é’®å·²ä½¿ç”¨æ–°ç«¯ç‚¹ `/api/reports/v2-2/generate`

#### ä¸­ä¼˜å…ˆçº§ï¼ˆæµ‹è¯•æ–‡ä»¶ï¼‰
5. âœ… `src/lib/report/__tests__/report-v2.1-integration.test.ts`
   - âœ… å¯¼å…¥å·²æ›´æ–°ï¼š`generateFullReportV22`
   - âœ… æ‰€æœ‰æµ‹è¯•ä¸­çš„å‡½æ•°è°ƒç”¨å·²æ›´æ–°
6. âœ… `src/lib/report/__tests__/report-v2.2-final.test.ts`
   - âœ… æµ‹è¯•çš„å‡½æ•°ä¸éœ€æ›´æ–°ï¼ˆä½¿ç”¨è¾…åŠ©å‡½æ•°ï¼‰
7. âœ… `src/lib/report/__tests__/fengshui-checklist.test.ts`
   - âœ… æµ‹è¯•çš„å‡½æ•°ä¸éœ€æ›´æ–°ï¼ˆä½¿ç”¨è¾…åŠ©å‡½æ•°ï¼‰

#### ä½ä¼˜å…ˆçº§ï¼ˆå¼•ç”¨æˆ–æ³¨é‡Šï¼‰
8. âœ… `src/lib/bazi/action-templates.ts`
   - âœ… å¯¼å…¥è·¯å¾„å·²æ›´æ–°ï¼š`from '@/types/report-v2-2'`
9. âœ… `src/lib/bazi/story-templates.ts`
   - âœ… å¯¼å…¥è·¯å¾„å·²æ›´æ–°ï¼š`from '@/types/report-v2-2'`
10. âœ… `src/components/report/charts/index.ts`
   - âœ… æ³¨é‡Šå·²æ›´æ–°ï¼š`v2.2` â†’ `v2-2`
11. âœ… `src/components/report/index.ts`
   - âœ… æ³¨é‡Šå·²æ›´æ–°ï¼š`v2.2` â†’ `v2-2`

---

## ğŸ“ é‡æ„æ£€æŸ¥æ¸…å•

### æ¯ä¸ªæ–‡ä»¶æ›´æ–°æ—¶éœ€è¦æ£€æŸ¥ï¼š
- [ ] å¯¼å…¥è·¯å¾„æ›´æ–°ï¼š`v2.2` â†’ `v2-2`, `v2_2` â†’ `v2-2`
- [ ] ç±»å‹åç§°æ›´æ–°ï¼š`_v2_2` â†’ `V22`, `_v2.2` â†’ `V22`
- [ ] å‡½æ•°åç§°æ›´æ–°ï¼š`_v2_2` â†’ `V22`, `_v2.2` â†’ `V22`
- [ ] APIç«¯ç‚¹æ›´æ–°ï¼š`/v2.2/` â†’ `/v2-2/`
- [ ] ç¡®ä¿ä»£ç ä»ç„¶æ­£å¸¸è¿è¡Œ
- [ ] æ›´æ–°ç›¸å…³æµ‹è¯•

---

## ğŸ¯ æ¥ä¸‹æ¥çš„æ­¥éª¤ï¼ˆæ¨èé¡ºåºï¼‰

### é˜¶æ®µ 1: æ ¸å¿ƒåº“æ–‡ä»¶æ›´æ–°ï¼ˆå·²å®Œæˆï¼‰
1. âœ… æ›´æ–°ç±»å‹å®šä¹‰å’ŒHTMLæ¸²æŸ“å™¨
2. âœ… æ›´æ–° `report-generator-v2.2.ts` ä½¿ç”¨æ–°ç±»å‹
3. âœ… åˆ›å»ºæ–°çš„ API è·¯ç”± (`v2-2/generate`)
4. âœ… æ›´æ–°å‰ç«¯ç»„ä»¶ä½¿ç”¨æ–°çš„ API ç«¯ç‚¹ï¼ˆæŠ¥å‘Šé¡µé¢ï¼‰

### é˜¶æ®µ 2: é¡µé¢å’Œç»„ä»¶æ›´æ–°ï¼ˆâœ… å·²å®Œæˆï¼‰
1. âœ… åˆ›å»ºæ–°çš„æŠ¥å‘Šè¯¦æƒ…é¡µé¢ (`v2-2/page.tsx`)
2. âœ… æ›´æ–°æ‰€æœ‰ç»„ä»¶å¼•ç”¨
3. âœ… æ›´æ–°æµ‹è¯•æ–‡ä»¶

### é˜¶æ®µ 3: æ¸…ç†å·¥ä½œï¼ˆâœ… å·²å®Œæˆï¼‰
1. âœ… éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
2. âœ… ç¡®è®¤æ‰€æœ‰æ–‡ä»¶å·²æ›´æ–°ä¸ºæ–°å‘½åè§„èŒƒ
3. â³ å¯é€‰ï¼šç§»é™¤æ—§æ–‡ä»¶ï¼ˆå»ºè®®ä¿ç•™ 3-6 ä¸ªæœˆä½œä¸ºç¼“å†²æœŸï¼‰

---

## ğŸ”§ å®ç”¨å‘½ä»¤

### æœç´¢æ—§å‘½åå¼•ç”¨
```bash
# æœç´¢ v2.2 ç›®å½•å¼•ç”¨
rg "v2\.2" --type ts --type tsx

# æœç´¢ v2_2 ç›®å½•å¼•ç”¨
rg "v2_2" --type ts --type tsx

# æœç´¢ V2.2 å¼•ç”¨
rg "V2\.2" --type ts --type tsx

# æœç´¢æ—§ç±»å‹åç§°
rg "ReportOutput_v2_2" --type ts --type tsx

# æœç´¢æ—§å‡½æ•°åç§°
rg "renderReportHTML_v2_2" --type ts --type tsx
```

### æ‰¹é‡æ›¿æ¢ç¤ºä¾‹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
```bash
# ä¸è¦ç›´æ¥è¿è¡Œï¼ä»…ä¾›å‚è€ƒ
# å…ˆå¤‡ä»½ä»£ç ï¼Œç„¶ååœ¨å°èŒƒå›´æµ‹è¯•

# ç¤ºä¾‹ï¼šæ›¿æ¢å¯¼å…¥è·¯å¾„
find src -name "*.ts" -o -name "*.tsx" | xargs sed -i "s/@\/types\/report-v2\.2/@\/types\/report-v2-2/g"
```

---

## ğŸ“Š å½“å‰è¿›åº¦ç»Ÿè®¡

- âœ… å·²å®Œæˆï¼šæ‰€æœ‰æ¨¡å—ï¼ˆç±»å‹ã€HTMLã€ç”Ÿæˆå™¨ã€APIã€é¡µé¢ã€ç»„ä»¶ã€æµ‹è¯•ã€æ¨¡æ¿ï¼‰
- ğŸ”„ è¿›è¡Œä¸­ï¼š0 ä¸ªæ¨¡å—
- â³ å¾…å¤„ç†ï¼š0 ä¸ªæ–‡ä»¶
- ğŸ“ˆ æ€»ä½“è¿›åº¦ï¼š**100% âœ…**

---

## ğŸ’¡ æ³¨æ„äº‹é¡¹

1. **ä¿æŒå‘åå…¼å®¹**ï¼šæ‰€æœ‰æ—§ä»£ç åœ¨é‡æ„æœŸé—´ä»å¯æ­£å¸¸å·¥ä½œ
2. **æ¸è¿›å¼æ›´æ–°**ï¼šä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶ï¼Œé€æ­¥éªŒè¯
3. **æµ‹è¯•ä¼˜å…ˆ**ï¼šæ¯æ¬¡æ›´æ–°åè¿è¡Œç›¸å…³æµ‹è¯•
4. **æ–‡æ¡£åŒæ­¥**ï¼šæ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæ³¨é‡Š
5. **å›¢é˜Ÿæ²Ÿé€š**ï¼šå¦‚æœæ˜¯å›¢é˜Ÿé¡¹ç›®ï¼Œé€šçŸ¥å…¶ä»–æˆå‘˜å‘½åè§„èŒƒå˜æ›´

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [ä»˜è´¹é€»è¾‘å’Œå‘½åè§„èŒƒå»ºè®®.md](./ä»˜è´¹é€»è¾‘å’Œå‘½åè§„èŒƒå»ºè®®.md) - å®Œæ•´çš„å‘½åè§„èŒƒè¯´æ˜
- [é¡¹ç›®æ€»ç»“_v2.2å‡çº§.md](./æŠ¥å‘Šæ¨¡ç‰ˆ/ä¼˜åŒ–æ–¹æ¡ˆ/v2.2/é¡¹ç›®æ€»ç»“_v2.2å‡çº§.md) - v2.2 ç‰ˆæœ¬å˜æ›´è®°å½•

---

**æœ€åæ›´æ–°**: 2025-01-15  
**è´Ÿè´£äºº**: AI Agent  
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆï¼ˆæ€»ä½“è¿›åº¦ 100%ï¼‰
