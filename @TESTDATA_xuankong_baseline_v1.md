# 玄空飞星测试数据集基线说明 v1.0

**创建日期**: 2025-11-12  
**数据集位置**: `mksaas/datasets/xuankong_cases.json`  
**总用例数**: 25 个

---

## 一、数据集概览

### 1.1 用例分类统计

| 类别 | 数量 | 用途 |
|------|------|------|
| 三元九运边界 | 3 | 验证运数切换正确性 |
| 典型格局 | 4 | 验证格局判断准确性 |
| 兼向与替卦 | 5 | 验证兼向和替卦逻辑 |
| 二十四山边界 | 2 | 验证山向映射正确性 |
| 特殊时刻 | 2 | 验证时间处理特殊情况 |
| 基准盘例 | 2 | 提供标准对照盘 |
| 算法验证 | 3 | 验证核心算法性质 |
| 元龙测试 | 3 | 验证元龙属性判断 |
| 边界条件 | 2 | 验证极端输入处理 |

### 1.2 覆盖范围

#### ✅ 已覆盖场景
- **运数边界**: 八运/九运交接 (2023/2024)
- **典型格局**: 旺山旺水、上山下水、双星到向/坐
- **兼向判断**: 正向、兼向、空亡线
- **二十四山**: 天元龙、人元龙、地元龙
- **算法不变量**: 顺飞/逆飞循环性、互逆性
- **边界输入**: 极小角度、负角度

#### ⚠️ 待补充场景
- **替卦实现后**: 正替、旁替具体规则验证
- **高级格局**: 七星打劫、零正颠倒、城门诀
- **流年叠加**: 年月日时飞星叠加测试
- **个性化分析**: 结合用户八字的测试
- **性能压测**: 大批量并发计算

---

## 二、关键用例说明

### 2.1 基准盘例

#### benchmark_001: 标准九运盘（子山午向）
```json
{
  "period": 9,
  "tianpan": [1宫:5, 2宫:1, 3宫:3, 4宫:4, 5宫:9, 6宫:2, 7宫:7, 8宫:8, 9宫:6]
}
```
**洛书顺序**: 中(9) → 乾(2) → 兑(7) → 艮(8) → 离(6) → 坎(5) → 坤(1) → 震(3) → 巽(4)

**验证点**:
- 中宫入当运星 9
- 按洛书轨迹顺飞: 5,6,7,8,9,1,2,3,4,5

#### benchmark_002: 标准八运盘（子山午向）
```json
{
  "period": 8,
  "tianpan": [1宫:4, 2宫:9, 3宫:2, 4宫:3, 5宫:8, 6宫:1, 7宫:6, 8宫:7, 9宫:5]
}
```

### 2.2 格局判断用例

#### pattern_001: 旺山旺水（九运子山午向）
**判断逻辑**:
- 九运当令
- 子山 = 坎宫(1宫)，山星应为 9（当旺）
- 午向 = 离宫(9宫)，向星应为 9（当旺）
- 符合"山星向星皆得令"条件 → 旺山旺水 ✅

#### pattern_002: 上山下水（九运午山子向）
**判断逻辑**:
- 午山 = 离宫(9宫)，山星应在向位
- 子向 = 坎宫(1宫)，向星应在山位
- 符合"山星向星颠倒"条件 → 上山下水 ⚠️

### 2.3 兼向与替卦用例

#### jianxiang_002: 兼向判断
```
输入: 187度（正南偏东7度）
判断: 
  - 主山向: 子山午向 (180度)
  - 偏离: 7度
  - 兼向: 癸丁方向
  - isJian: true
```

**兼向规则**:
- 容差范围: ±0.5度 为正向
- 偏离 > 0.5度: 判定为兼向
- 需识别兼向方向（左兼/右兼）

#### jianxiang_003: 空亡线
```
输入: 22.5度
位置: 坎艮分界线（八卦卦气交接点）
状态: isOnBoundary=true, ambiguous=true
```

**空亡线特征**:
- 位于卦气分界 (每 45度)
- 需要专业风水师实地勘测
- 系统应标记为模糊状态

### 2.4 算法验证用例

#### algorithm_001: 顺飞循环性
```typescript
shunFei(1, 9) === 1  // 从1顺飞9步回到1
shunFei(5, 9) === 5  // 从5顺飞9步回到5
```

**数学性质**: 
```
shunFei(x, 9) ≡ x  (对所有 x ∈ [1,9])
```

#### algorithm_003: 顺逆互逆性
```typescript
niFei(shunFei(x, n), n) === x  // 对所有x,n
```

**数学性质**:
```
顺飞 ∘ 逆飞 = 恒等映射
```

---

## 三、测试基线使用指南

### 3.1 单元测试集成

```typescript
// 示例：基于数据集的参数化测试
import testCases from '@/mksaas/datasets/xuankong_cases.json';

describe('玄空飞星基线测试', () => {
  testCases.testCases
    .filter(tc => tc.category === '基准盘例')
    .forEach(testCase => {
      test(testCase.name, () => {
        const result = generateFlyingStar(testCase.input);
        expect(result.period).toBe(testCase.expected.period);
        expect(result.plates.period).toEqual(testCase.expected.plates.period);
      });
    });
});
```

### 3.2 回归测试流程

1. **每次算法修改后**:
   - 运行全部 25 个基线用例
   - 对比结果与 expected 字段
   - 记录差异并分析

2. **添加新用例时**:
   - 更新 `xuankong_cases.json`
   - 更新 `metadata.total_cases`
   - 记录到 CHANGELOG

3. **基线更新**:
   - 算法修正后需更新 expected 值
   - 需通过 code review
   - 记录修改理由

### 3.3 性能基线

**目标**:
```
单个飞星计算: < 10ms
25个用例批量: < 100ms
```

**测试命令**:
```bash
npm run test:xuankong:perf
```

---

## 四、数据集维护规范

### 4.1 添加新用例

**模板**:
```json
{
  "id": "category_XXX",
  "category": "类别名称",
  "name": "简短描述",
  "input": { /* 输入参数 */ },
  "expected": { /* 期望结果 */ },
  "notes": "详细说明"
}
```

**命名规则**:
- id: `{category}_{序号}`
- name: 中文描述，明确测试目的
- notes: 说明测试意图和验证点

### 4.2 期望值验证

**验证方式**:
1. 手工计算（基准盘）
2. 权威软件对比
3. 专家审阅
4. 现有测试通过

**标记可信度**:
```json
{
  "expected": { ... },
  "confidence": "high|medium|low",
  "verifiedBy": "manual|authoritative|expert"
}
```

### 4.3 版本控制

- 数据集变更需记录到 CHANGELOG
- 重大修改需更新版本号
- 保留历史版本用于回溯

---

## 五、已知限制与待办

### 5.1 当前限制

1. **替卦用例不完整**: tigua_001 仅占位，待替卦实现后补充
2. **高级格局缺失**: 七星打劫等高级格局无测试用例
3. **性能用例缺失**: 无大规模并发测试数据

### 5.2 待补充优先级

**P0 (立即)**:
- [ ] 补充完整替卦规则验证用例
- [ ] 添加兼向权重计算用例

**P1 (两周内)**:
- [ ] 添加七星打劫、零正颠倒、城门诀用例
- [ ] 添加流年叠加测试用例
- [ ] 添加错误输入测试用例

**P2 (一个月内)**:
- [ ] 添加性能压测数据集
- [ ] 添加个性化分析用例
- [ ] 添加诊断预警用例

---

## 六、附录

### 6.1 参考资料

- 《玄空风水学》传统理论
- 现有测试文件：`__tests__/luoshu-algorithm-validation.test.ts`
- 审计报告：`@XUANKONG_AUDIT_REPORT_v1.md`

### 6.2 联系方式

- 数据集维护者: 开发团队
- 专家顾问: 待指定
- 问题反馈: 项目 Issue Tracker

---

**文档版本**: v1.0  
**最后更新**: 2025-11-12  
**下次审阅**: 完成第二周任务后
