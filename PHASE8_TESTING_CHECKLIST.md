# Phase 8: 功能测试清单

**测试环境**: http://localhost:3000  
**测试时间**: 2025-01-24  
**服务器状态**: ✅ 运行中

---

## 🎯 测试目标

验证 Pro 月度运势功能的 5 个核心场景：

1. ✅ **页面加载** - 路由正常，UI 渲染正确
2. ✅ **权限控制** - Pro 会员门禁生效
3. ✅ **运势生成** - 算法+AI 完整流程
4. ✅ **详情展示** - 飞星九宫+运势预测
5. ✅ **历史记录** - 列表展示+时间排序

---

## 📋 详细测试步骤

### 测试 1: 页面访问 ⏱️ 30秒

**URL**: `http://localhost:3000/qiflow/monthly-fortune`

#### 预期结果 ✅
- [ ] 页面正常加载（无 404/500 错误）
- [ ] 显示页面标题："Pro 月度运势"
- [ ] 显示 Pro 会员提示或运势卡片
- [ ] 无控制台错误

#### 测试命令
```bash
# 方法 1: 浏览器访问
打开浏览器 → http://localhost:3000/qiflow/monthly-fortune

# 方法 2: 自动化测试（使用 MCP 浏览器工具）
```

---

### 测试 2: 权限控制 ⏱️ 1分钟

**场景 A: 未登录用户**

#### 预期结果 ✅
- [ ] 重定向到登录页 `/auth/login`
- [ ] 或显示 Pro 会员升级提示
- [ ] 无法看到"生成运势"按钮

**场景 B: 普通用户（非 Pro）**

#### 预期结果 ✅
- [ ] 显示 Pro 升级提示卡片
- [ ] 包含"升级到 Pro"按钮
- [ ] 说明 Pro 会员权益
- [ ] 无法生成运势

**场景 C: Pro 会员用户**

#### 预期结果 ✅
- [ ] 显示运势卡片（或空状态）
- [ ] 显示"生成本月运势"按钮
- [ ] 可以点击生成

---

### 测试 3: 运势生成 ⏱️ 2分钟

**前置条件**: 
1. 已登录 Pro 会员账号
2. 该账号已有八字数据（通过 `/qiflow/bazi` 生成）

#### 步骤
1. 点击"生成本月运势"按钮
2. 等待生成过程（预计 2-5 秒）

#### 预期结果 ✅
- [ ] 显示加载状态（Loading UI）
- [ ] 生成成功后显示运势卡片
- [ ] 卡片包含：
  - [ ] 综合评分（0-100）
  - [ ] 吉利方位（3个）
  - [ ] 幸运颜色（3个）
  - [ ] 幸运数字（若干）
  - [ ] 飞星九宫格（9个宫位）
- [ ] 积分扣除 30 点
- [ ] 数据库中新增一条记录

#### 错误处理 ✅
- [ ] 如果积分不足：显示"积分不足"提示
- [ ] 如果本月已生成：显示"本月已生成"提示
- [ ] 如果无八字数据：显示"请先生成八字"提示
- [ ] 如果 AI 失败：显示错误信息，积分回退

---

### 测试 4: 详情展示 ⏱️ 2分钟

**前置条件**: 已生成本月运势

#### 步骤
1. 点击运势卡片
2. 进入详情页 `/qiflow/monthly-fortune/[id]`

#### 预期结果 ✅

**页面布局**
- [ ] 面包屑导航正确
- [ ] 返回按钮可用

**内容模块** (7个模块)
- [ ] **1. 综合评分** - 大号数字显示（0-100）
- [ ] **2. 吉祥元素** - 方位/颜色/数字卡片
- [ ] **3. 飞星九宫** - 九宫格布局，每宫显示：
  - [ ] 飞星数字（山星/向星/运星）
  - [ ] 吉凶标识（吉星绿色，凶星红色）
  - [ ] 宫位名称（正北/东北/正东等）
- [ ] **4. 关键警示** - 列出凶煞方位（五黄/二黑/病符等）
- [ ] **5. 运势预测** - 4 个维度（Tab 切换）：
  - [ ] 事业运
  - [ ] 财运
  - [ ] 感情运
  - [ ] 健康运
- [ ] **6. 化解建议** - 针对凶煞方位的化解方法
- [ ] **7. 时令分析** - 八字流年流月分析

**交互功能**
- [ ] Tab 切换正常
- [ ] 卡片悬停效果
- [ ] 响应式布局（移动端适配）

---

### 测试 5: 历史记录 ⏱️ 1分钟

**URL**: `http://localhost:3000/qiflow/monthly-fortune` (主页)

#### 预期结果 ✅

**空状态**（无历史记录）
- [ ] 显示空状态插图
- [ ] 提示"生成首份运势"
- [ ] 显示"生成运势"按钮

**有历史记录**
- [ ] 显示运势卡片列表
- [ ] 按时间倒序排列（最新在前）
- [ ] 每个卡片显示：
  - [ ] 年月标识（如"2025年1月"）
  - [ ] 综合评分
  - [ ] 生成时间
  - [ ] 查看详情按钮
- [ ] 点击卡片可跳转详情页

---

## 🔍 数据验证

### 数据库检查 ✅

#### 查询生成记录
```sql
SELECT 
  id, 
  user_id, 
  year, 
  month, 
  status,
  credits_used,
  created_at,
  (fortune_data->>'overallScore') as score
FROM monthly_fortunes
ORDER BY created_at DESC
LIMIT 5;
```

#### 预期结果
- [ ] 存在对应记录
- [ ] status = 'completed'
- [ ] credits_used = 30
- [ ] fortune_data JSON 完整
- [ ] flying_star_analysis JSON 完整
- [ ] bazi_timeliness JSON 完整

---

## 🧪 边界测试

### 测试 6: 重复生成 ⏱️ 30秒

#### 步骤
1. 已生成本月运势
2. 再次点击"生成运势"按钮

#### 预期结果 ✅
- [ ] 显示提示："本月运势已存在"
- [ ] 不扣除积分
- [ ] 数据库无新记录
- [ ] 提供"查看本月运势"按钮

---

### 测试 7: 无八字数据 ⏱️ 30秒

#### 步骤
1. 使用新注册的 Pro 账号
2. 未生成八字
3. 尝试生成月度运势

#### 预期结果 ✅
- [ ] 显示错误提示："请先生成八字"
- [ ] 提供跳转按钮 → `/qiflow/bazi`
- [ ] 不扣除积分

---

### 测试 8: 积分不足 ⏱️ 30秒

#### 步骤
1. Pro 账号积分 < 30
2. 尝试生成运势

#### 预期结果 ✅
- [ ] 显示错误提示："积分不足"
- [ ] 提供充值按钮 → `/pricing`
- [ ] 不生成运势

---

## 🚀 性能测试

### 测试 9: 生成速度 ⏱️ 1分钟

#### 测量指标
- [ ] 算法生成时间 < 500ms
- [ ] AI 生成时间 < 5s
- [ ] 总响应时间 < 6s
- [ ] 页面无卡顿

#### 实际测量
```
算法生成: _____ ms
AI 生成: _____ ms
总时间: _____ ms
```

---

## 📱 UI/UX 测试

### 测试 10: 响应式设计 ⏱️ 2分钟

#### 测试设备尺寸
- [ ] **桌面** (1920x1080) - 正常显示
- [ ] **平板** (768x1024) - 布局适配
- [ ] **手机** (375x667) - 单列布局

#### 检查项
- [ ] 九宫格自适应缩放
- [ ] 卡片堆叠正确
- [ ] 按钮大小适中
- [ ] 文字可读性良好

---

## ✅ 测试总结

### 核心功能 (必须通过)
- [ ] 测试 1: 页面访问
- [ ] 测试 2: 权限控制
- [ ] 测试 3: 运势生成
- [ ] 测试 4: 详情展示
- [ ] 测试 5: 历史记录

### 边界场景 (建议通过)
- [ ] 测试 6: 重复生成
- [ ] 测试 7: 无八字数据
- [ ] 测试 8: 积分不足

### 性能/UI (可选)
- [ ] 测试 9: 生成速度
- [ ] 测试 10: 响应式设计

---

## 🎯 验收标准

### 通过条件 ✅
- **核心功能**: 5/5 通过
- **边界场景**: 至少 2/3 通过
- **无严重 Bug**: 无阻塞性错误

### 失败条件 ❌
- 核心功能任意项失败
- 存在数据安全问题
- 性能低于预期 50% 以上

---

## 📝 测试记录

| 测试项 | 状态 | 备注 | 测试人 | 时间 |
|-------|------|------|--------|------|
| 测试 1 | ⏳ | | | |
| 测试 2 | ⏳ | | | |
| 测试 3 | ⏳ | | | |
| 测试 4 | ⏳ | | | |
| 测试 5 | ⏳ | | | |
| 测试 6 | ⏳ | | | |
| 测试 7 | ⏳ | | | |
| 测试 8 | ⏳ | | | |
| 测试 9 | ⏳ | | | |
| 测试 10 | ⏳ | | | |

---

## 🔧 快速测试命令

### 手动测试（推荐）
```bash
# 1. 确保服务器运行中
npm run dev

# 2. 打开浏览器
http://localhost:3000/qiflow/monthly-fortune

# 3. 登录 Pro 账号（或创建测试账号）

# 4. 依次测试上述场景
```

### 数据库查询（辅助验证）
```bash
# 连接数据库
npx tsx scripts/check-monthly-fortunes.ts

# 或使用 Supabase Dashboard
# https://supabase.com/dashboard → SQL Editor
```

---

**测试负责人**: _________  
**测试日期**: 2025-01-24  
**版本**: Phase 8 v1.0  
**状态**: ⏳ **待测试**
