# QiFlow æ”¹é€ å¿«é€Ÿå‚è€ƒæŒ‡å—

> å¿«é€ŸæŸ¥æ‰¾å¸¸ç”¨ä»£ç å’Œå‘½ä»¤

## ğŸ“¦ æ–°å¢ç»„ä»¶ä½¿ç”¨

### 1. é”™è¯¯è¾¹ç•Œ

```typescript
// å¯¼å…¥
import { ErrorBoundary } from '@/components/qiflow/error-boundary';

// ä½¿ç”¨
<ErrorBoundary>
  <YourComponent />
</ErrorBoundary>
```

### 2. éª¨æ¶å±

```typescript
// å¯¼å…¥
import { 
  BaziSkeleton, 
  XuankongSkeleton,
  FormSkeleton,
  CardListSkeleton 
} from '@/components/qiflow/skeletons';

// ä½¿ç”¨
<Suspense fallback={<BaziSkeleton />}>
  <BaziAnalysis />
</Suspense>
```

### 3. ç§¯åˆ†ç®¡ç†

```typescript
// å¯¼å…¥
import { creditsManager } from '@/lib/credits/manager';

// æ£€æŸ¥ä½™é¢
const balance = await creditsManager.getBalance(userId);

// æ‰§è¡Œå¸¦ç§¯åˆ†çš„åŠŸèƒ½
const result = await creditsManager.executeWithCredits(
  userId,
  'bazi',
  async () => fullAnalysis(),
  async () => limitedAnalysis()
);
```

### 4. AIå¯¹è¯

```typescript
// POSTè¯·æ±‚åˆ°
fetch('/api/qiflow/chat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    message: 'åˆ†ææˆ‘çš„å…«å­—',
    context: {
      type: 'bazi',
      data: { ... }
    }
  })
});
```

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘
npm run dev

# æ„å»º
npm run build

# Lintä¿®å¤
npm run lint:fix

# æ•°æ®åº“
npm run db:push
npm run db:studio

# æµ‹è¯•
npm run test:unit
npm run test:e2e
```

## ğŸ“ å…³é”®æ–‡ä»¶ä½ç½®

```
/src/lib/credits/manager.ts          # ç§¯åˆ†ç³»ç»Ÿ
/src/app/api/qiflow/chat/route.ts    # AIå¯¹è¯API
/src/components/qiflow/
  â”œâ”€â”€ error-boundary.tsx              # é”™è¯¯è¾¹ç•Œ
  â”œâ”€â”€ skeletons.tsx                   # éª¨æ¶å±
  â””â”€â”€ credits-price.tsx               # ç§¯åˆ†æ˜¾ç¤º

/messages/qiflow-zh.json              # ç¿»è¯‘æ–‡ä»¶

/@é¡¹ç›®æ”¹é€ æ–¹æ¡ˆ_2025.md                # è¯¦ç»†æ–¹æ¡ˆ
/@æ”¹é€ å®ŒæˆæŠ¥å‘Š_ç¬¬äºŒè½®.md              # æœ€æ–°æŠ¥å‘Š
```

## ğŸ¯ ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### æ€§èƒ½ä¼˜åŒ–
- [ ] ä½¿ç”¨åŠ¨æ€å¯¼å…¥ `dynamic()`
- [ ] æ·»åŠ éª¨æ¶å±
- [ ] ä¼˜åŒ–å›¾ç‰‡ `next/image`
- [ ] å®æ–½RSCä¼˜åŒ–

### é”™è¯¯å¤„ç†
- [ ] æ·»åŠ é”™è¯¯è¾¹ç•Œ
- [ ] æä¾›å‹å¥½é”™è¯¯æç¤º
- [ ] é›†æˆé”™è¯¯ç›‘æ§

### ç”¨æˆ·ä½“éªŒ
- [ ] åŠ è½½çŠ¶æ€åé¦ˆ
- [ ] è¡¨å•éªŒè¯
- [ ] ç§»åŠ¨ç«¯é€‚é…

## ğŸ› å¸¸è§é—®é¢˜

### æ„å»ºé”™è¯¯
```bash
# æ¸…ç†ç¼“å­˜
rm -rf .next
npm run build
```

### ç±»å‹é”™è¯¯
```typescript
// ä¸´æ—¶è·³è¿‡
// @ts-ignore

// æˆ–æ·»åŠ ç±»å‹
const t = useTranslations() as any;
```

### æ•°æ®åº“è¿æ¥
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env | grep DATABASE_URL

# æ¨é€schema
npm run db:push
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

```typescript
// ä½¿ç”¨Next.jså†…ç½®
import { Analytics } from '@vercel/analytics/react';

// æˆ–è‡ªå®šä¹‰
console.time('operation');
// ... code
console.timeEnd('operation');
```

## ğŸ”— æœ‰ç”¨é“¾æ¥

- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [Shadcn UI](https://ui.shadcn.com)
- [Drizzle ORM](https://orm.drizzle.team)
- [æ”¹é€ æ–¹æ¡ˆè¯¦æƒ…](./@é¡¹ç›®æ”¹é€ æ–¹æ¡ˆ_2025.md)

---
*æ›´æ–°æ—¶é—´: 2025-01-05*