# ä»ªè¡¨ç›˜å’Œç§¯åˆ†ç³»ç»Ÿä¼˜åŒ–æ€»ç»“

åŸºäº `mksaas_template` æ¨¡æ¿ï¼Œå¯¹æ°”æµAIçš„ä»ªè¡¨ç›˜å’Œç§¯åˆ†ç³»ç»Ÿè¿›è¡Œå…¨é¢ä¼˜åŒ–ã€‚

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. æ ¸å¿ƒæ•°æ®å¡ç‰‡ç»„ä»¶ (`qiflow-stats-cards.tsx`)

**å‚è€ƒ**: `mksaas_template/src/components/dashboard/section-cards.tsx`

**æ–°åŠŸèƒ½**:
- âœ… å…«å­—åˆ†ææ¬¡æ•°å¡ç‰‡ï¼ˆç´«è‰²å›¾æ ‡ï¼Œæœˆåº¦è¶‹åŠ¿ï¼‰
- âœ… é£æ°´åˆ†ææ¬¡æ•°å¡ç‰‡ï¼ˆç¥ç€è‰²å›¾æ ‡ï¼Œæœˆåº¦è¶‹åŠ¿ï¼‰  
- âœ… AIå¯¹è¯è½®æ•°å¡ç‰‡ï¼ˆè“è‰²å›¾æ ‡ï¼Œæœˆåº¦è¶‹åŠ¿ï¼‰
- âœ… è¿ç»­ç­¾åˆ°å¤©æ•°å¡ç‰‡ï¼ˆæ©™è‰²ç«ç„°å›¾æ ‡ï¼Œé‡Œç¨‹ç¢‘æç¤ºï¼‰

**ç‰¹ç‚¹**:
- å“åº”å¼ç½‘æ ¼å¸ƒå±€ï¼ˆ1/2/4åˆ—ï¼‰
- æ¸å˜èƒŒæ™¯ (ä» primary/5 åˆ° card)
- è¶‹åŠ¿å¾½ç« æ˜¾ç¤ºï¼ˆâ†‘ å¢é•¿ / â†“ ä¸‹é™ï¼‰
- åŠ è½½éª¨æ¶å±
- æ™ºèƒ½æ–‡æ¡ˆï¼ˆ"ç¨³æ­¥å¢é•¿"ã€"éœ€è¦æå‡"ç­‰ï¼‰

### 2. ç»Ÿè®¡æ•°æ®API (`/api/dashboard/stats`)

**æ–°å»ºæ–‡ä»¶**: `src/app/api/dashboard/stats/route.ts`

**åŠŸèƒ½**:
- è®¡ç®—æœ¬æœˆå’Œä¸Šæœˆå„é¡¹æ•°æ®å¯¹æ¯”
- è¿ç»­ç­¾åˆ°å¤©æ•°ç®—æ³•ä¼˜åŒ–ï¼ˆå‘å‰å›æº¯120å¤©ï¼‰
- è¶‹åŠ¿ç™¾åˆ†æ¯”è®¡ç®—
- æ•°æ®æ¥æºï¼š
  - `analysisResults` è¡¨ï¼ˆå…«å­—ã€é£æ°´åˆ†æï¼‰
  - `creditTransaction` è¡¨ï¼ˆAIå¯¹è¯ã€ç­¾åˆ°è®°å½•ï¼‰

**è¿”å›æ•°æ®ç»“æ„**:
```typescript
{
  baziAnalysisCount: number,
  baziAnalysisTrend: number,       // ç™¾åˆ†æ¯”
  fengshuiAnalysisCount: number,
  fengshuiAnalysisTrend: number,
  aiChatRounds: number,
  aiChatTrend: number,
  consecutiveSignIns: number,
  signInTrend: number
}
```

## ğŸ“‹ å¾…ä¼˜åŒ–é¡¹ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

### ä¼˜å…ˆçº§ 1: æ ¸å¿ƒåŠŸèƒ½å®Œå–„

#### 2.1 ä¼˜åŒ–ç§¯åˆ†ä½™é¢å¡ç‰‡
**å‚è€ƒ**: `mksaas_template/src/components/settings/credits/credits-card.tsx`

**ç›®æ ‡**: å¢å¼º `src/components/settings/credits/credits-balance-card.tsx`

**æ–°å¢åŠŸèƒ½**:
- [ ] ç§¯åˆ†è·å–è¶‹åŠ¿è¿·ä½ å›¾è¡¨ï¼ˆæœ€è¿‘7å¤©ï¼‰
- [ ] å¿«é€Ÿå……å€¼å…¥å£ï¼ˆå¿«æ·é‡‘é¢æŒ‰é’®ï¼‰
- [ ] ç§¯åˆ†ä½¿ç”¨å»ºè®®ï¼ˆåŸºäºä½™é¢æ™ºèƒ½æ¨èï¼‰
- [ ] å³å°†è¿‡æœŸçš„ç§¯åˆ†æé†’
- [ ] æœ¬æœˆç§¯åˆ†æ”¶æ”¯ç»Ÿè®¡

#### 2.2 ç§¯åˆ†äº¤æ˜“å†å²è¡¨æ ¼ä¼˜åŒ–
**å‚è€ƒ**: `mksaas_template/src/components/settings/credits/credit-transactions.tsx`

**ç›®æ ‡**: é‡æ„ `src/components/points/transaction-history.tsx`

**æ–°å¢åŠŸèƒ½**:
- [ ] æœåŠ¡ç«¯åˆ†é¡µï¼ˆæ›¿æ¢å®¢æˆ·ç«¯åˆ†é¡µï¼‰
- [ ] æœç´¢åŠŸèƒ½ï¼ˆæè¿°ã€äº¤æ˜“IDï¼‰
- [ ] å¤šåˆ—æ’åºï¼ˆæ—¶é—´ã€é‡‘é¢ã€ç±»å‹ï¼‰
- [ ] ç±»å‹ç­›é€‰å™¨ï¼ˆæ”¶å…¥/æ”¯å‡ºã€å…·ä½“ç±»å‹ï¼‰
- [ ] æ—¶é—´èŒƒå›´ç­›é€‰ï¼ˆæœ¬æœˆã€æœ¬å‘¨ã€è‡ªå®šä¹‰ï¼‰
- [ ] URLçŠ¶æ€åŒæ­¥ï¼ˆä½¿ç”¨ nuqsï¼‰
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰

#### 2.3 ç§¯åˆ†è·å–æŒ‡å—ä¼˜åŒ–
**ç›®æ ‡**: å¢å¼º `src/components/dashboard/credits/credits-earning-guide.tsx`

**æ–°å¢åŠŸèƒ½**:
- [ ] æ¯æ—¥ä»»åŠ¡è¿›åº¦æ¡ï¼ˆç­¾åˆ°ã€åˆ†æã€å¯¹è¯ï¼‰
- [ ] é‡Œç¨‹ç¢‘å¥–åŠ±æ—¶é—´è½´
- [ ] æ¨èä»»åŠ¡çªå‡ºæ˜¾ç¤ºï¼ˆé«˜äº®+å€’è®¡æ—¶ï¼‰
- [ ] å®Œæˆåº¦å¾½ç« ç³»ç»Ÿ
- [ ] ä»»åŠ¡ç‚¹å‡»å¿«é€Ÿè·³è½¬

### ä¼˜å…ˆçº§ 2: æ•°æ®å¯è§†åŒ–

#### 2.4 ç”¨æˆ·æ´»åŠ¨æ—¶é—´çº¿å›¾è¡¨
**å‚è€ƒ**: `mksaas_template/src/components/dashboard/chart-area-interactive.tsx`

**æ–°å»º**: `src/components/dashboard/activity-chart.tsx`

**åŠŸèƒ½**:
- [ ] æ˜¾ç¤ºæœ€è¿‘30å¤©æ´»åŠ¨è¶‹åŠ¿
- [ ] åŒçº¿å›¾è¡¨ï¼ˆåˆ†ææ¬¡æ•° vs AIå¯¹è¯æ¬¡æ•°ï¼‰
- [ ] æ—¶é—´èŒƒå›´åˆ‡æ¢ï¼ˆ7å¤©/30å¤©/90å¤©ï¼‰
- [ ] ç§»åŠ¨ç«¯ä¼˜åŒ–
- [ ] äº¤äº’å¼Tooltip
- [ ] é¢ç§¯æ¸å˜å¡«å……

#### 2.5 ç­¾åˆ°æ—¥å†å¢å¼º
**ç›®æ ‡**: ä¼˜åŒ– `src/components/daily-signin/signin-calendar.tsx`

**æ–°å¢åŠŸèƒ½**:
- [ ] æœˆåº¦ç­¾åˆ°çƒ­åŠ›å›¾ï¼ˆæ—¥å†è§†å›¾ï¼‰
- [ ] è¿ç»­ç­¾åˆ°é‡Œç¨‹ç¢‘è¿›åº¦æ¡ï¼ˆ7/15/30/60/90å¤©ï¼‰
- [ ] ä¸‹ä¸€ä¸ªå¥–åŠ±é¢„è§ˆå¡ç‰‡
- [ ] å†å²ç­¾åˆ°è®°å½•æŸ¥çœ‹
- [ ] ç­¾åˆ°æé†’è®¾ç½®

### ä¼˜å…ˆçº§ 3: ç”¨æˆ·ä½“éªŒæå‡

#### 2.6 ä»ªè¡¨ç›˜é¡µé¢æ•´åˆ
**æ–°å»º**: `src/app/[locale]/(protected)/dashboard/page.tsx`

**å¸ƒå±€ç»“æ„**:
```
- QiFlowStatsCardsï¼ˆæ ¸å¿ƒæ•°æ®å¡ç‰‡ï¼‰4x1
- ActivityChartï¼ˆæ´»åŠ¨è¶‹åŠ¿å›¾è¡¨ï¼‰full-width
- ä¸¤åˆ—å¸ƒå±€ï¼š
  - å·¦ä¾§ï¼šSignInCalendarï¼ˆç­¾åˆ°æ—¥å†ï¼‰
  - å³ä¾§ï¼šCreditsEarningGuideï¼ˆç§¯åˆ†æŒ‡å—ï¼‰
- TransactionHistoryï¼ˆè¿‘æœŸäº¤æ˜“ï¼‰full-width
```

#### 2.7 ä»ªè¡¨ç›˜Skeletonä¼˜åŒ–
**å‚è€ƒ**: `mksaas_template/src/components/dashboard/*-skeleton.tsx`

**ç›®æ ‡**: åˆ›å»ºä¸“ç”¨çš„loadingçŠ¶æ€ç»„ä»¶

#### 2.8 ç§¯åˆ†é¡µé¢Tabä¼˜åŒ–
**å‚è€ƒ**: `mksaas_template/src/components/settings/credits/credits-page-client.tsx`

**æ”¹è¿›**:
- [ ] TabçŠ¶æ€æŒä¹…åŒ–ï¼ˆURLåŒæ­¥ï¼‰
- [ ] å¹³æ»‘åˆ‡æ¢åŠ¨ç”»
- [ ] ç‹¬ç«‹çš„ç­›é€‰å™¨çŠ¶æ€ç®¡ç†

## ğŸ”§ æŠ€æœ¯æ ˆå¯¹é½

### å·²ä½¿ç”¨ï¼ˆä¸æ¨¡æ¿ä¸€è‡´ï¼‰
- âœ… TanStack Query (React Query)
- âœ… nuqs (URLçŠ¶æ€ç®¡ç†)
- âœ… Shadcn UIç»„ä»¶åº“
- âœ… Rechartså›¾è¡¨åº“
- âœ… @tabler/icons-react

### éœ€è¦å®‰è£…
```bash
# å¦‚æœç¼ºå°‘ä»¥ä¸‹ä¾èµ–
pnpm install date-fns recharts
```

## ğŸ“Š æ•°æ®åº“Schemaå»ºè®®

### ä¼˜åŒ–å»ºè®®
1. `creditTransaction` è¡¨æ·»åŠ ç´¢å¼•ï¼š
   ```sql
   CREATE INDEX idx_credit_transaction_user_type_date 
   ON credit_transaction(user_id, type, created_at DESC);
   ```

2. `analysisResults` è¡¨æ·»åŠ ç´¢å¼•ï¼š
   ```sql
   CREATE INDEX idx_analysis_results_user_type_date 
   ON analysis_results(user_id, analysis_type, created_at DESC);
   ```

## ğŸ¨ UI/UXè®¾è®¡è§„èŒƒ

### é¢œè‰²ç³»ç»Ÿï¼ˆä¸æ¨¡æ¿å¯¹é½ï¼‰
- å…«å­—åˆ†æï¼š`purple-500` ç´«è‰²
- é£æ°´åˆ†æï¼š`amber-500` ç¥ç€è‰²
- AIå¯¹è¯ï¼š`blue-500` è“è‰²
- ç­¾åˆ°ï¼š`orange-500` æ©™è‰²

### é—´è·è§„èŒƒ
- å¡ç‰‡é—´è·ï¼š`gap-4` (1rem)
- å†…è¾¹è·ï¼š`px-4 lg:px-6`
- å“åº”å¼æ–­ç‚¹ï¼š`@xl/main` (container query)

## ğŸš€ å®æ–½æ­¥éª¤

1. âœ… **ç¬¬ä¸€é˜¶æ®µ**ï¼ˆå·²å®Œæˆï¼‰ï¼šæ ¸å¿ƒæ•°æ®å¡ç‰‡ + ç»Ÿè®¡API
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šç§¯åˆ†ç³»ç»Ÿä¼˜åŒ–ï¼ˆä½™é¢å¡ç‰‡ã€äº¤æ˜“è¡¨æ ¼ã€è·å–æŒ‡å—ï¼‰
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæ•°æ®å¯è§†åŒ–ï¼ˆæ´»åŠ¨å›¾è¡¨ã€ç­¾åˆ°æ—¥å†ï¼‰
4. **ç¬¬å››é˜¶æ®µ**ï¼šé¡µé¢æ•´åˆä¸ä½“éªŒä¼˜åŒ–

## ğŸ“ ä½¿ç”¨æ–¹å¼

### åœ¨ä»ªè¡¨ç›˜é¡µé¢ä½¿ç”¨æ–°ç»„ä»¶

```tsx
import { QiFlowStatsCards } from '@/components/dashboard/qiflow-stats-cards';

export default function DashboardPage() {
  return (
    <div className="@container/main">
      <QiFlowStatsCards />
      {/* å…¶ä»–ç»„ä»¶... */}
    </div>
  );
}
```

### APIè°ƒç”¨ç¤ºä¾‹

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
const { data } = useQuery({
  queryKey: ['qiflow-dashboard-stats'],
  queryFn: async () => {
    const res = await fetch('/api/dashboard/stats');
    return res.json();
  },
});
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç­¾åˆ°é€»è¾‘ä¿®å¤**ï¼šç¡®ä¿ `/api/credits/daily-signin` å’ŒçŠ¶æ€æ£€æŸ¥APIæ­£å¸¸å·¥ä½œ
2. **æƒé™æ§åˆ¶**ï¼šæ‰€æœ‰APIéœ€éªŒè¯ç”¨æˆ·èº«ä»½
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨React Queryç¼“å­˜å‡å°‘APIè°ƒç”¨
4. **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…é™çº§ï¼Œæ˜¾ç¤ºéª¨æ¶å±æˆ–é»˜è®¤æ•°æ®

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

- **ç”¨æˆ·ç•™å­˜æå‡**ï¼šæ¸…æ™°çš„æ•°æ®å±•ç¤ºæ¿€åŠ±ç”¨æˆ·æŒç»­ä½¿ç”¨
- **ç§¯åˆ†è½¬åŒ–æå‡**ï¼šç›´è§‚çš„è¶‹åŠ¿å’Œå»ºè®®ä¿ƒè¿›ç§¯åˆ†è´­ä¹°
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šæµç•…çš„äº¤äº’å’Œä¸“ä¸šçš„æ•°æ®å¯è§†åŒ–
- **ç³»ç»Ÿå¯ç»´æŠ¤æ€§**ï¼šç»„ä»¶åŒ–ã€æ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ‰©å±•

---

**åˆ›å»ºæ—¶é—´**: 2025-01-05  
**ç»´æŠ¤è€…**: AI Agent  
**å‚è€ƒæ¨¡æ¿**: mksaas_template v3.0+
