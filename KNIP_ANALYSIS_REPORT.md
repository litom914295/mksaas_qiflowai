# Knip åˆ†ææŠ¥å‘Š - æœªä½¿ç”¨çš„ä¾èµ–åŒ…å’Œä»£ç 

**æ—¥æœŸ**: 2025-01-24  
**é¡¹ç›®**: QiFlow AI  
**å·¥å…·**: Knip v5.x

---

## ğŸ“Š æ€»ä½“æ¦‚è§ˆ

| ç±»åˆ« | æ•°é‡ | çŠ¶æ€ |
|------|------|------|
| **æœªä½¿ç”¨æ–‡ä»¶** | 706 | âš ï¸ éœ€å®¡æŸ¥ |
| **æœªä½¿ç”¨ä¾èµ–åŒ…** | 50 | âš ï¸ å¯æ¸…ç† |
| **æœªä½¿ç”¨å¼€å‘ä¾èµ–** | 7 | âš ï¸ å¯æ¸…ç† |
| **ç¼ºå¤±ä¾èµ–** | 5 | ğŸ”´ éœ€æ·»åŠ  |
| **æœªä½¿ç”¨å¯¼å‡º** | 667 | âš ï¸ éœ€å®¡æŸ¥ |
| **é‡å¤å¯¼å‡º** | 16 | âš ï¸ éœ€ä¿®å¤ |

---

## ğŸ“¦ æœªä½¿ç”¨çš„ç”Ÿäº§ä¾èµ–åŒ… (50ä¸ª)

### ğŸ”´ é«˜ä¼˜å…ˆçº§ - å¯ç«‹å³åˆ é™¤ (ä½“ç§¯è¾ƒå¤§æˆ–æ˜ç¡®æœªä½¿ç”¨)

```json
{
  "@base-ui-components/react": "package.json:99:6",
  "@dnd-kit/modifiers": "package.json:102:6",
  "@mdx-js/react": "package.json:107:6",
  "@next/swc-win32-x64-msvc": "package.json:110:6",
  "@openpanel/nextjs": "package.json:112:6",
  "@orama/orama": "package.json:114:6",
  "@orama/tokenizers": "package.json:115:6",
  "@stripe/stripe-js": "package.json:149:6",
  "@types/three": "package.json:161:6",
  "@uiw/react-md-editor": "package.json:162:6",
  "@vercel/speed-insights": "package.json:165:6",
  "cmdk": "package.json:173:6",
  "critters": "package.json:176:6",
  "dotted-map": "package.json:181:6",
  "fabric": "package.json:184:6",
  "gray-matter": "package.json:189:6",
  "input-otp": "package.json:190:6",
  "ioredis": "package.json:191:6",
  "jsonwebtoken": "package.json:192:6",
  "radix-ui": "package.json:205:6",
  "react-konva": "package.json:211:6",
  "react-resizable-panels": "package.json:213:6",
  "react-syntax-highlighter": "package.json:214:6",
  "react-use-measure": "package.json:216:6",
  "react-virtualized-auto-sizer": "package.json:217:6",
  "react-window": "package.json:218:6",
  "react-window-infinite-loader": "package.json:219:6",
  "rehype-sanitize": "package.json:221:6",
  "remark": "package.json:222:6",
  "remark-html": "package.json:223:6",
  "sharp": "package.json:226:6",
  "shiki": "package.json:227:6",
  "slugify": "package.json:228:6",
  "speakeasy": "package.json:230:6",
  "styled-jsx": "package.json:233:6",
  "swiper": "package.json:234:6",
  "tailwindcss-animate": "package.json:236:6",
  "three": "package.json:237:6",
  "use-media": "package.json:240:6"
}
```

### ğŸŸ¡ ä¸­ç­‰ä¼˜å…ˆçº§ - éœ€ç¡®è®¤ (å¯èƒ½åœ¨é…ç½®æˆ–ç‰¹æ®Šåœºæ™¯ä¸­ä½¿ç”¨)

```json
{
  "@better-fetch/fetch": "package.json:100:6",
  "@next/third-parties": "package.json:111:6",
  "@radix-ui/react-aspect-ratio": "package.json:118:6",
  "@radix-ui/react-checkbox": "package.json:120:6",
  "@radix-ui/react-context-menu": "package.json:122:6",
  "@radix-ui/react-menubar": "package.json:128:6",
  "@types/bcryptjs": "package.json:156:6",
  "@types/jsonwebtoken": "package.json:158:6",
  "@types/qrcode": "package.json:159:6",
  "@types/speakeasy": "package.json:160:6",
  "qrcode": "package.json:204:6"
}
```

**é¢„è®¡å¯é‡Šæ”¾ç©ºé—´**: ~150-200 MB

---

## ğŸ› ï¸ æœªä½¿ç”¨çš„å¼€å‘ä¾èµ– (7ä¸ª)

```json
{
  "@next/bundle-analyzer": "package.json:250:6",
  "@tanstack/eslint-plugin-query": "package.json:253:6",
  "@types/react-syntax-highlighter": "package.json:264:6",
  "jspdf": "package.json:269:6",
  "node-fetch": "package.json:271:6",
  "prettier": "package.json:273:6",
  "puppeteer": "package.json:274:6"
}
```

**æ³¨æ„**: 
- `prettier` æ ‡è®°ä¸ºæœªä½¿ç”¨ä½†å¯èƒ½åœ¨ç¼–è¾‘å™¨ä¸­ä½¿ç”¨
- `@next/bundle-analyzer` å¯èƒ½ç”¨äºç‰¹å®šåˆ†æåœºæ™¯
- å»ºè®®ä¿ç•™ `prettier`ï¼Œå…¶ä»–å¯åˆ é™¤

---

## ğŸ”´ ç¼ºå¤±çš„ä¾èµ–åŒ… (5ä¸ª) - éœ€è¦æ·»åŠ 

```bash
npm install --save-dev jsdom @vitest/coverage-v8 postcss-load-config node-mocks-http
npm install server-only
```

**è¯¦ç»†è¯´æ˜**:

| åŒ…å | ä½¿ç”¨ä½ç½® | ç±»å‹ | ä¼˜å…ˆçº§ |
|------|----------|------|--------|
| `jsdom` | `vitest.config.ts` | devDependencies | ğŸ”´ é«˜ |
| `@vitest/coverage-v8` | `vitest.config.ts` | devDependencies | ğŸ”´ é«˜ |
| `postcss-load-config` | `postcss.config.mjs:1:2` | devDependencies | ğŸ”´ é«˜ |
| `node-mocks-http` | `__tests__/api/users.test.ts:2:29` | devDependencies | ğŸŸ¡ ä¸­ |
| `server-only` | `src/lib/server.ts:1:8` | dependencies | ğŸ”´ é«˜ |

---

## ğŸ“‚ æœªä½¿ç”¨çš„æ–‡ä»¶ (706ä¸ª)

### ç±»åˆ«åˆ†å¸ƒ

#### 1. è„šæœ¬æ–‡ä»¶ (çº¦ 65ä¸ª)
**ä½ç½®**: `scripts/`

å¤§éƒ¨åˆ†æ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„è¿ç§»ã€è¯Šæ–­å’Œä¿®å¤è„šæœ¬ï¼Œå¯ä»¥è€ƒè™‘ï¼š
- ç§»åˆ° `.archived/scripts/`
- æˆ–ä¿ç•™åœ¨ `scripts/archived/`

**ç¤ºä¾‹**:
```
scripts/add-all-form-translations.js
scripts/fix-admin-password.ts
scripts/create-admin-complete.ts
scripts/comprehensive-system-test.ts
scripts/diagnose-database.ts
... (æ›´å¤š)
```

#### 2. å†…å®¹æ–‡ä»¶ (çº¦ 60ä¸ª)
**ä½ç½®**: `content/`

MDX æ–‡æ¡£å’Œåšå®¢æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯ï¼š
- ç¤ºä¾‹å†…å®¹
- æ—§çš„æ–‡æ¡£ç‰ˆæœ¬
- æœªä½¿ç”¨çš„åšå®¢æ–‡ç« 

**ç¤ºä¾‹**:
```
content/blog/fumadocs.mdx
content/blog/fumadocs.zh.mdx
content/docs/comparisons.mdx
content/author/fox.mdx
... (æ›´å¤š)
```

#### 3. QiFlow åˆ†æç»„ä»¶ (çº¦ 500ä¸ª)
**ä½ç½®**: `src/components/qiflow/`, `src/lib/qiflow/`, `src/lib/bazi-pro/`

å¤§é‡æœªä½¿ç”¨çš„ QiFlow AI åŠŸèƒ½ç»„ä»¶å’Œåº“ï¼š
- Baziï¼ˆå…«å­—ï¼‰åˆ†æ
- Fengshuiï¼ˆé£æ°´ï¼‰åˆ†æ
- Xuankongï¼ˆç„ç©ºï¼‰åˆ†æ

**å…³é”®é—®é¢˜**: è¿™äº›å¯èƒ½æ˜¯:
1. æœªæ¥åŠŸèƒ½çš„å‡†å¤‡ä»£ç 
2. å·²å¼ƒç”¨ä½†æœªæ¸…ç†çš„ä»£ç 
3. å¤‡ç”¨å®ç°

#### 4. ä¸­é—´ä»¶å’Œé…ç½®æ–‡ä»¶ (çº¦ 10ä¸ª)
```
src/middleware-supabase.ts
src/_middleware.off.ts
src/__middleware_disabled.original.ts
next.config.compiled.js
source.config.ts
test-db.mjs
```

#### 5. å…¶ä»–æœåŠ¡å’Œå·¥å…· (çº¦ 71ä¸ª)
```
services/bazi-analysis.service.ts
public/debug-login.js
public/sw.js (Service Worker)
src/analytics/* (å¤šä¸ªåˆ†ææä¾›å•†)
```

---

## ğŸ”„ é‡å¤å¯¼å‡º (16ä¸ª)

éœ€è¦ç»Ÿä¸€å¯¼å‡ºæ–¹å¼çš„æ¨¡å—ï¼š

```typescript
// ç¤ºä¾‹
WuxingStrengthAnalyzer | WuxingStrengthCalculator  // src/lib/bazi-pro/core/analyzer/wuxing-strength.ts
comprehensiveAnalysis | runComprehensiveAnalysis   // src/lib/qiflow/xuankong/comprehensive-engine.ts
performanceMonitor | default                       // src/lib/qiflow/xuankong/performance-monitor.ts
BasicAnalysisView | default                        // src/components/qiflow/xuankong/basic-analysis-view.tsx
KnowledgePanel | default                           // src/components/xuankong/knowledge-panel.tsx
retry | withRetry                                  // src/lib/utils/retry-utils.ts
// ... æ›´å¤š
```

**å»ºè®®**: é€‰æ‹©ä¸€ç§å¯¼å‡ºæ–¹å¼å¹¶ç»Ÿä¸€ä½¿ç”¨

---

## ğŸ” æœªè§£æçš„å¯¼å…¥ (7ä¸ª)

éœ€è¦ä¿®å¤çš„å¯¼å…¥è·¯å¾„ï¼š

```typescript
'../src/db/schema/auth'                 // scripts/seed-admin.ts:40:27
'@/lib/database'                        // __tests__/api/users.test.ts:30:18
'../permissions'                        // lib/auth/__tests__/permissions.test.ts:7:8
'@/components/qiflow/bazi/NaYinList'    // src/components/qiflow/__tests__/ui-boundaries.test.tsx:5:32
'@/components/qiflow/bazi/TenGodsList'  // src/components/qiflow/__tests__/ui-boundaries.test.tsx:6:34
'../feng-shui-compass'                  // src/components/qiflow/compass/__tests__/feng-shui-compass.test.tsx:7:29
'../../fengshui/mountain'               // src/lib/qiflow/xuankong/__tests__/flying-star.test.ts:3:33
```

---

## ğŸ“‹ æ¨èè¡ŒåŠ¨è®¡åˆ’

### é˜¶æ®µ 1: ç«‹å³æ‰§è¡Œï¼ˆå®‰å…¨ä¸”é«˜ä»·å€¼ï¼‰

1. **æ·»åŠ ç¼ºå¤±ä¾èµ–** (5åˆ†é’Ÿ)
   ```bash
   npm install --save-dev jsdom @vitest/coverage-v8 postcss-load-config node-mocks-http
   npm install server-only
   ```

2. **åˆ é™¤æ˜ç¡®æœªä½¿ç”¨çš„ç”Ÿäº§ä¾èµ–** (10åˆ†é’Ÿ)
   ```bash
   npm uninstall fabric three swiper react-konva @types/three dotted-map
   npm uninstall critters gray-matter input-otp ioredis styled-jsx use-media
   npm uninstall react-window react-window-infinite-loader react-virtualized-auto-sizer
   npm uninstall rehype-sanitize remark remark-html shiki slugify
   ```
   **é¢„è®¡é‡Šæ”¾**: ~100 MB

3. **åˆ é™¤æœªä½¿ç”¨çš„å¼€å‘ä¾èµ–** (5åˆ†é’Ÿ)
   ```bash
   npm uninstall --save-dev jspdf node-fetch puppeteer @types/react-syntax-highlighter
   npm uninstall --save-dev @tanstack/eslint-plugin-query @next/bundle-analyzer
   ```
   **ä¿ç•™**: `prettier` (ç¼–è¾‘å™¨éœ€è¦)

### é˜¶æ®µ 2: éœ€è¦å®¡æŸ¥ï¼ˆä¸­ç­‰é£é™©ï¼‰

4. **å®¡æŸ¥ Radix UI ç»„ä»¶**
   - æ£€æŸ¥æ˜¯å¦çœŸçš„æœªä½¿ç”¨ï¼š`@radix-ui/react-checkbox`, `@radix-ui/react-menubar`, `@radix-ui/react-context-menu`
   - å¦‚æœç¡®è®¤æœªä½¿ç”¨ï¼Œå¯ä»¥åˆ é™¤

5. **å®¡æŸ¥ç±»å‹å®šä¹‰åŒ…**
   - `@types/bcryptjs`, `@types/jsonwebtoken`, `@types/qrcode`, `@types/speakeasy`
   - å¦‚æœå¯¹åº”çš„è¿è¡Œæ—¶åŒ…ä¹Ÿæœªä½¿ç”¨ï¼Œä¸€å¹¶åˆ é™¤

6. **æ¸…ç†è„šæœ¬ç›®å½•**
   ```bash
   mkdir -p .archived/scripts
   mv scripts/fix-* .archived/scripts/
   mv scripts/diagnose-* .archived/scripts/
   mv scripts/create-admin-* .archived/scripts/
   ```

### é˜¶æ®µ 3: æ·±åº¦æ¸…ç†ï¼ˆéœ€è¦ä»”ç»†è¯„ä¼°ï¼‰

7. **è¯„ä¼° QiFlow ç»„ä»¶**
   - ç¡®è®¤ `src/components/qiflow/` å’Œ `src/lib/qiflow/` ä¸­ 500+ æ–‡ä»¶çš„ç”¨é€”
   - å¦‚æœæ˜¯æœªæ¥åŠŸèƒ½ï¼Œä¿ç•™
   - å¦‚æœæ˜¯åºŸå¼ƒä»£ç ï¼Œç§»åˆ° `.archived/`

8. **æ¸…ç†å†…å®¹æ–‡ä»¶**
   - ç¡®è®¤ `content/` ç›®å½•ä¸­çš„ MDX æ–‡ä»¶ç”¨é€”
   - åˆ é™¤æˆ–å½’æ¡£ç¤ºä¾‹å†…å®¹

9. **ä¼˜åŒ–å¯¼å‡º**
   - ç»Ÿä¸€ 16 ä¸ªé‡å¤å¯¼å‡ºçš„æ¨¡å—
   - ä¿®å¤ 7 ä¸ªæœªè§£æçš„å¯¼å…¥

### é˜¶æ®µ 4: é…ç½®ä¼˜åŒ–

10. **åˆ›å»º knip.json é…ç½®**
    ```json
    {
      "entry": [
        "src/app/**/*.{ts,tsx}",
        "src/components/**/*.{ts,tsx}",
        "src/lib/**/*.ts"
      ],
      "project": [
        "src/**/*.{ts,tsx}",
        "!src/**/*.test.{ts,tsx}",
        "!src/**/__tests__/**"
      ],
      "ignore": [
        "scripts/archived/**",
        ".archived/**",
        "content/blog/**"
      ]
    }
    ```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸è¦åˆ é™¤çš„åŒ…

1. **Next.js ç›¸å…³**
   - æ‰€æœ‰ `@next/*` åŒ…ï¼ˆå¯èƒ½åœ¨æ„å»ºæ—¶ä½¿ç”¨ï¼‰
   - ç¡®è®¤åå†åˆ é™¤

2. **Radix UI**
   - æŸäº›ç»„ä»¶å¯èƒ½é€šè¿‡ Shadcn UI é—´æ¥ä½¿ç”¨
   - éœ€è¦ä»”ç»†æ£€æŸ¥

3. **åˆ†æå·¥å…·**
   - `@vercel/analytics`, `@openpanel/nextjs` å¯èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒæ¿€æ´»
   - æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

4. **ç±»å‹å®šä¹‰**
   - å³ä½¿è¿è¡Œæ—¶åŒ…æœªä½¿ç”¨ï¼Œç±»å‹å®šä¹‰å¯èƒ½ç”¨äºç±»å‹æ£€æŸ¥

### éªŒè¯æ­¥éª¤

æ¯ä¸ªé˜¶æ®µæ‰§è¡Œåè¿è¡Œï¼š
```bash
npm run type-check
npm run lint
npm run build
npm run test
```

---

## ğŸ“Š é¢„æœŸæ”¶ç›Š

| æŒ‡æ ‡ | é¢„æœŸæ”¹å–„ |
|------|----------|
| **node_modules å¤§å°** | -150 MB åˆ° -200 MB |
| **å®‰è£…æ—¶é—´** | -30% |
| **æ„å»ºæ—¶é—´** | -10% |
| **ä»£ç åº“æ¸…æ™°åº¦** | æ˜¾è‘—æå‡ |

---

## ğŸ¯ æ€»ç»“

**ç«‹å³è¡ŒåŠ¨ï¼ˆé˜¶æ®µ1ï¼‰**:
- âœ… æ·»åŠ  5 ä¸ªç¼ºå¤±ä¾èµ–
- âœ… åˆ é™¤ ~15 ä¸ªæ˜ç¡®æœªä½¿ç”¨çš„ä¾èµ–
- â±ï¸ é¢„è®¡è€—æ—¶: 20 åˆ†é’Ÿ
- ğŸ’° é¢„è®¡æ”¶ç›Š: ~100 MB ç©ºé—´

**å¯é€‰è¡ŒåŠ¨ï¼ˆé˜¶æ®µ2-4ï¼‰**:
- âš ï¸ éœ€è¦æ›´å¤šå®¡æŸ¥å’Œæµ‹è¯•
- â±ï¸ é¢„è®¡è€—æ—¶: 2-4 å°æ—¶
- ğŸ’° é¢å¤–æ”¶ç›Š: ~50-100 MB ç©ºé—´ + ä»£ç æ¸…æ™°åº¦

---

**ç”Ÿæˆæ—¶é—´**: 2025-01-24  
**å·¥å…·**: Knip v5.x  
**çŠ¶æ€**: â³ å¾…æ‰§è¡Œ
