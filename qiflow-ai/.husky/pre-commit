#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run ESLint on staged files only
echo "ğŸ“‹ Running lint checks on staged files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)

if [ -n "$STAGED_FILES" ]; then
  npx eslint $STAGED_FILES
  if [ $? -ne 0 ]; then
    echo "âŒ Lint checks failed. Please fix the issues before committing."
    echo "ğŸ’¡ Run 'npm run lint:fix' to auto-fix some issues."
    exit 1
  fi

  # Run Prettier format check on staged files
  echo "ğŸ¨ Running format checks on staged files..."
  npx prettier --check $STAGED_FILES
  if [ $? -ne 0 ]; then
    echo "âŒ Format checks failed. Please run 'npm run format' to fix formatting issues."
    echo "ğŸ’¡ Run 'npx prettier --write $STAGED_FILES' to fix these files."
    exit 1
  fi
else
  echo "â„¹ï¸  No TypeScript/JavaScript files to check."
fi

# Only run type check if there are relevant staged files
if [ -n "$STAGED_FILES" ]; then
  echo "ğŸ”· Running type checks..."
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ Type checks failed. Please fix TypeScript errors before committing."
    echo "ğŸ’¡ Check the output above for specific errors."
    exit 1
  fi
fi

echo "âœ… All pre-commit checks passed!"