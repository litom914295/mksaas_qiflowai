# åŸé—¨è¯€ä½¿ç”¨æŒ‡å— v1.0

> **åŸé—¨ä¸€è¯€æœ€ä¸ºè‰¯ï¼Œèƒ½ä½¿è´«è€…ç«‹å¯Œå¼º**  
> ç„ç©ºé£æ˜Ÿé£æ°´ä¸­çš„å‚¬æ—ºç§˜æ³• - åŸé—¨è¯€å®Œæ•´å®æˆ˜æ‰‹å†Œ

---

## ğŸ“– ç›®å½•

1. [åŸé—¨è¯€ç†è®ºåŸºç¡€](#1-åŸé—¨è¯€ç†è®ºåŸºç¡€)
2. [æ ¸å¿ƒAPIæ¥å£](#2-æ ¸å¿ƒapiæ¥å£)
3. [åŸºç¡€ä½¿ç”¨ç¤ºä¾‹](#3-åŸºç¡€ä½¿ç”¨ç¤ºä¾‹)
4. [é«˜çº§åº”ç”¨åœºæ™¯](#4-é«˜çº§åº”ç”¨åœºæ™¯)
5. [å®æˆ˜æ¡ˆä¾‹åˆ†æ](#5-å®æˆ˜æ¡ˆä¾‹åˆ†æ)
6. [æœ€ä½³å®è·µå»ºè®®](#6-æœ€ä½³å®è·µå»ºè®®)
7. [å¸¸è§é—®é¢˜FAQ](#7-å¸¸è§é—®é¢˜faq)
8. [æŠ€æœ¯å‚è€ƒ](#8-æŠ€æœ¯å‚è€ƒ)

---

## 1. åŸé—¨è¯€ç†è®ºåŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯åŸé—¨è¯€ï¼Ÿ

åŸé—¨è¯€æ˜¯ç„ç©ºé£æ˜Ÿé£æ°´ä¸­çš„**å‚¬æ—ºç§˜æ³•**ï¼Œé€šè¿‡åœ¨ç‰¹å®šä½ç½®å¼€é—¨ã€æ”¾æ°´æˆ–è¿›è¡Œå…¶ä»–åŠ¨ä½œæ¥å‚¬æ—ºè´¢è¿æˆ–ä¸è¿ã€‚å…¶æ ¸å¿ƒåŸç†æ˜¯**åˆ©ç”¨ç”Ÿæ—ºä¹‹æ°”çš„æµé€šæ¥å¢å¼ºå‰æ˜Ÿçš„åŠ›é‡**ã€‚

**å†å²æ¸Šæº**ï¼š
- ä¼ æ‰¿è‡ªã€Šæ²ˆæ°ç„ç©ºå­¦ã€‹
- è¢«èª‰ä¸º"ç„ç©ºé£æ°´å‚¬æ—ºç¬¬ä¸€è¯€"
- ä¸ä¸ƒæ˜Ÿæ‰“åŠ«ã€é›¶æ­£ç†è®ºå¹¶ç§°"ç„ç©ºä¸‰å¤§ç§˜æ³•"

**æ ¸å¿ƒæ€æƒ³**ï¼š
```
åŸé—¨è¯€ = ç‰¹å®šå®«ä½ + ç‰¹å®šæ˜Ÿç»„åˆ + é€‚å½“å‚¬æ—ºæ–¹æ³•
       â†“
    å‚¬æ—ºæ•ˆæœ = å¾—æ°´å¾—æ°” Ã— å½“è¿æ—¶æ•ˆ Ã— æ“ä½œå¾—å½“
```

### 1.2 åŸé—¨è¯€çš„åˆ†ç±»

#### å››å¤§åŸé—¨ç±»å‹

| ç±»å‹ | ä¸­æ–‡å | ä¸»è¦ä½œç”¨ | å‚¬æ—ºæ–¹æ³• |
|------|--------|----------|----------|
| `cai_men` | è´¢é—¨ | å‚¬æ—ºè´¢è¿ã€äº‹ä¸š | æ”¾æ°´ã€å¼€é—¨ |
| `ding_men` | ä¸é—¨ | å‚¬æ—ºäººä¸ã€å¥åº· | åŠ¨ä½œã€æ´»åŠ¨ |
| `gui_men` | è´µé—¨ | å‚¬æ—ºè´µäººã€å®˜è¿ | è®¾ç½®ã€æ‘†æ”¾ |
| `lu_men` | ç¦„é—¨ | å‚¬æ—ºèŒä½ã€è–ªä¿¸ | è®¾ç½®ã€åŠå…¬ |

#### å››ç§å‚¬æ—ºæ–¹æ³•

| æ–¹æ³• | ä¸­æ–‡å | é€‚ç”¨åœºæ™¯ | å…·ä½“æ“ä½œ |
|------|--------|----------|----------|
| `kai_men` | å¼€é—¨æ³• | å¢åŠ å‡ºå…¥å£ | åœ¨è¯¥å®«ä½å¼€é—¨æˆ–å¢åŠ é€šé“ |
| `fang_shui` | æ”¾æ°´æ³• | å‚¬è´¢æœ€å¼º | è®¾ç½®é±¼ç¼¸ã€æµæ°´è£…ç½® |
| `dong_zuo` | åŠ¨ä½œæ³• | å‚¬ä¸æ—ºäºº | å®‰æ’æ´»åŠ¨åŒºã€ä¼šå®¢åŒº |
| `she_zhi` | è®¾ç½®æ³• | è´µäººå®˜è¿ | æ‘†æ”¾é£æ°´ç”¨å“ã€æ–‡æ˜Œç”¨å…· |

### 1.3 åŸé—¨è¯€çš„ä¸‰å¤§ç‰¹æ®Šç»„åˆ

#### 1.3.1 ä¸‰èˆ¬å¦åŸé—¨

**ç†è®º**ï¼šä¸‰èˆ¬å¦æ˜¯æŒ‡æ´›ä¹¦ä¸­åŒå±ä¸€ç»„çš„ä¸‰ä¸ªæ•°å­—ï¼š
- **å¤©å…ƒå¦**ï¼š1-4-7ï¼ˆåéœ‡å…‘ï¼‰
- **äººå…ƒå¦**ï¼š2-5-8ï¼ˆå¤ä¸­ä¹¾ï¼‰
- **åœ°å…ƒå¦**ï¼š3-6-9ï¼ˆéœ‡å·½ç¦»ï¼‰

**æˆç«‹æ¡ä»¶**ï¼šæŸå®«ä½çš„è¿æ˜Ÿã€å±±æ˜Ÿã€å‘æ˜Ÿä¸­è‡³å°‘æœ‰ä¸¤ä¸ªå±äºåŒä¸€ç»„ã€‚

**æ•ˆæœ**ï¼šä¸»å¤§åˆ©è´¢ä¸ï¼Œæ˜¯é«˜çº§å‚¬æ—ºæ ¼å±€ã€‚

#### 1.3.2 ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨

**ç†è®º**ï¼šä¸ƒæ˜Ÿæ‰“åŠ«æ ¼å±€å½¢æˆçš„åŸé—¨ï¼Œå‚¬è´¢åŠ›é‡æå¼ºã€‚

**æˆç«‹æ¡ä»¶**ï¼š
1. æ»¡è¶³ä¸ƒæ˜Ÿæ‰“åŠ«çš„å…¨éƒ¨æ¡ä»¶ï¼ˆä¸‰èˆ¬å¦ + åˆå + æ—ºå±±æ—ºå‘ + å…ƒé¾™æ­£ç¡®ï¼‰
2. æ‰“åŠ«ä½ç½®å¯ä½œä¸ºåŸé—¨ä½¿ç”¨

**æ•ˆæœ**ï¼šå‚¬è´¢åŠ›é‡æå¼ºï¼Œå±äºé¡¶çº§æ ¼å±€ã€‚

**è¯¦ç»†è¯´æ˜**ï¼šå‚è§ `@GUIDE_qixing_dajie_usage_v1.md`

#### 1.3.3 åˆååŸé—¨

**ç†è®º**ï¼šå±±æ˜Ÿå’Œå‘æ˜Ÿç›¸åŠ ç­‰äº10çš„å®«ä½å¯ä½œä¸ºåŸé—¨ã€‚

**æˆç«‹æ¡ä»¶**ï¼š`mountainStar + facingStar = 10`

**æ•ˆæœ**ï¼šä¸»å’Œè°å‘å±•ï¼Œä¸­ç­‰å‚¬æ—ºæ•ˆæœã€‚

**å¸¸è§ç»„åˆ**ï¼š
- 1-9ã€2-8ã€3-7ã€4-6ã€5-5ï¼ˆæœ€å¼ºï¼‰

### 1.4 åŸé—¨è¯€çš„æ—¶æ•ˆæ€§

åŸé—¨è¯€**å¿…é¡»é…åˆå½“è¿ä½¿ç”¨**ï¼Œè¿‡è¿åˆ™å¤±æ•ˆã€‚

| æ—¶æœŸ | è¿ç¨‹å¹´ä»½ | æ•ˆæœç­‰çº§ | å»ºè®® |
|------|----------|----------|------|
| **è¿å‰æœŸ** | å‰5å¹´ | Peak | é»„é‡‘å‚¬æ—ºæœŸï¼Œæ•ˆæœæœ€ä½³ |
| **è¿ä¸­æœŸ** | 6-15å¹´ | Good | æ•ˆæœè‰¯å¥½ï¼Œå¯æ”¾å¿ƒä½¿ç”¨ |
| **è¿åæœŸ** | 16-20å¹´ | Declining | æ•ˆæœå‡å¼±ï¼Œæå‰å‡†å¤‡æ¢è¿ |
| **è¿‡è¿æœŸ** | è¶…è¿‡20å¹´ | Ineffective | éœ€è¦é‡æ–°å¸ƒå±€ |

**ä¾‹**ï¼šå…«è¿ï¼ˆ2004-2023å¹´ï¼‰
- 2004-2008å¹´ï¼šPeak - é»„é‡‘æœŸ
- 2009-2018å¹´ï¼šGood - ä¸­æœŸ
- 2019-2023å¹´ï¼šDeclining - åæœŸ
- 2024å¹´åï¼šIneffective - è¿›å…¥ä¹è¿ï¼Œéœ€é‡æ–°å¸ƒå±€

---

## 2. æ ¸å¿ƒAPIæ¥å£

### 2.1 å®Œæ•´åŸé—¨è¯€åˆ†æ

```typescript
function analyzeChengmenjue(
  plate: Plate,
  period: Yun,
  zuo: Mountain,
  xiang: Mountain
): ChengmenjueAnalysis;
```

**å‚æ•°è¯´æ˜**ï¼š
- `plate`: ä¹å®«é£æ˜Ÿç›˜ï¼ˆåŒ…å«è¿æ˜Ÿã€å±±æ˜Ÿã€å‘æ˜Ÿï¼‰
- `period`: å½“å‰å…ƒè¿ï¼ˆ1-9ï¼‰
- `zuo`: åå±±æ–¹ä½ï¼ˆ24å±±ä¹‹ä¸€ï¼‰
- `xiang`: æœå‘æ–¹ä½ï¼ˆ24å±±ä¹‹ä¸€ï¼‰

**è¿”å›å€¼**ï¼š
```typescript
interface ChengmenjueAnalysis {
  hasChengmen: boolean;           // æ˜¯å¦æœ‰åŸé—¨
  chengmenPositions: {            // åŸé—¨ä½ç½®åˆ—è¡¨
    palace: PalaceIndex;          // å®«ä½ï¼ˆ1-9ï¼‰
    description: string;          // æè¿°
    effectiveness: 'high' | 'medium' | 'low'; // æœ‰æ•ˆæ€§
  }[];
  activationMethods: string[];    // å‚¬æ—ºæ–¹æ³•å»ºè®®
  taboos: string[];               // ç¦å¿Œäº‹é¡¹
}
```

### 2.2 è¯†åˆ«åŸé—¨ä½ç½®

```typescript
function identifyChengmenPositions(
  plate: Plate,
  period: Yun,
  zuo: Mountain,
  xiang: Mountain
): {
  palace: PalaceIndex;
  rule: ChengmenRule;
  strength: number;  // åŸé—¨å¼ºåº¦è¯„åˆ†
}[];
```

**å¼ºåº¦è¯„åˆ†æœºåˆ¶**ï¼š
- å‘æ˜ŸåŒ¹é…ï¼š+3åˆ†
- å±±æ˜ŸåŒ¹é…ï¼š+3åˆ†
- è¿æ˜ŸåŒ¹é…ï¼š+2åˆ†
- å½“è¿æ˜ŸåŠ åˆ†ï¼š+2åˆ†
- ç”Ÿæ—ºæ˜ŸåŠ åˆ†ï¼š+1åˆ†
- é«˜æ•ˆæœåŠ åˆ†ï¼š+3åˆ†
- ä¸­æ•ˆæœåŠ åˆ†ï¼š+2åˆ†
- ä½æ•ˆæœåŠ åˆ†ï¼š+1åˆ†

### 2.3 æ£€æŸ¥ç‰¹æ®ŠåŸé—¨ç»„åˆ

```typescript
function checkSpecialChengmenCombinations(
  plate: Plate,
  period: Yun,
  zuo: Mountain,
  xiang: Mountain
): {
  combination: string;            // ç»„åˆåç§°
  positions: PalaceIndex[];       // ä½ç½®åˆ—è¡¨
  description: string;            // æè¿°
  effectiveness: 'high' | 'medium' | 'low';
}[];
```

**å¯æ£€æµ‹ç»„åˆ**ï¼š
- ä¸‰èˆ¬å¦åŸé—¨
- ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨
- åˆååŸé—¨

### 2.4 ç”Ÿæˆå‚¬æ—ºæ–¹æ³•

```typescript
function generateChengmenActivationMethods(
  chengmenType: ChengmenType,
  method: ChengmenMethod,
  palace: PalaceIndex
): string[];
```

**æ ¹æ®**ï¼š
- åŸé—¨ç±»å‹ï¼ˆè´¢é—¨/ä¸é—¨/è´µé—¨/ç¦„é—¨ï¼‰
- å‚¬æ—ºæ–¹æ³•ï¼ˆå¼€é—¨/æ”¾æ°´/åŠ¨ä½œ/è®¾ç½®ï¼‰
- æ‰€åœ¨å®«ä½ï¼ˆå…«å¦å±æ€§ï¼‰

ç”Ÿæˆ**å…·ä½“å¯æ“ä½œ**çš„å‚¬æ—ºå»ºè®®ã€‚

### 2.5 ç”Ÿæˆç¦å¿Œäº‹é¡¹

```typescript
function generateChengmenTaboos(
  palace: PalaceIndex,
  chengmenType: ChengmenType
): string[];
```

**æ ¹æ®**ï¼š
- æ‰€åœ¨å®«ä½çš„å…«å¦å±æ€§
- åŸé—¨ç±»å‹çš„ç‰¹æ®Šè¦æ±‚

ç”Ÿæˆ**å…·ä½“ç¦å¿Œäº‹é¡¹**ã€‚

### 2.6 æ—¶æ•ˆæ€§åˆ†æ

```typescript
function analyzeChengmenTimeline(
  plate: Plate,
  period: Yun,
  targetYear: number
): {
  currentEffectiveness: 'peak' | 'good' | 'declining' | 'ineffective';
  remainingYears: number;
  transitionAdvice: string[];
};
```

åˆ†æåŸé—¨è¯€åœ¨ç‰¹å®šå¹´ä»½çš„æ—¶æ•ˆæ€§ã€‚

---

## 3. åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

### 3.1 æœ€ç®€ç¤ºä¾‹ï¼šæ£€æµ‹æ˜¯å¦æœ‰åŸé—¨

```typescript
import { analyzeChengmenjue } from '@/lib/qiflow/xuankong/chengmenjue';

// æ„é€ å…«è¿å­å±±åˆå‘é£æ˜Ÿç›˜
const plate = createPlate(
  [6, 2, 4, 5, 7, 9, 8, 1, 3],  // è¿æ˜Ÿ
  [5, 1, 3, 4, 6, 8, 7, 9, 2],  // å±±æ˜Ÿ
  [7, 3, 5, 6, 8, 1, 9, 2, 4]   // å‘æ˜Ÿ
);

const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');

console.log('æ˜¯å¦æœ‰åŸé—¨ï¼š', analysis.hasChengmen);
console.log('åŸé—¨æ•°é‡ï¼š', analysis.chengmenPositions.length);
```

### 3.2 è·å–åŸé—¨ä½ç½®å’Œæè¿°

```typescript
const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');

if (analysis.hasChengmen) {
  analysis.chengmenPositions.forEach((pos, index) => {
    console.log(`åŸé—¨${index + 1}ï¼š`);
    console.log(`  å®«ä½ï¼š${pos.palace}`);
    console.log(`  æè¿°ï¼š${pos.description}`);
    console.log(`  æœ‰æ•ˆæ€§ï¼š${pos.effectiveness}`);
  });
}
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
åŸé—¨1ï¼š
  å®«ä½ï¼š6
  æè¿°ï¼šä¹¾å®«ï¼šå…«è¿å‘æ˜Ÿåˆ°ä¹¾å®«å¼€è´¢é—¨ï¼ˆå¼ºåº¦ï¼š8ï¼‰
  æœ‰æ•ˆæ€§ï¼šhigh
```

### 3.3 è·å–å‚¬æ—ºæ–¹æ³•å»ºè®®

```typescript
const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');

console.log('å‚¬æ—ºæ–¹æ³•ï¼š');
analysis.activationMethods.forEach((method, index) => {
  console.log(`  ${index + 1}. ${method}`);
});
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
å‚¬æ—ºæ–¹æ³•ï¼š
  1. åœ¨ä¹¾å®«æ”¾ç½®æµåŠ¨çš„æ°´
  2. å¯è®¾ç½®é±¼ç¼¸ã€æ°´æ™¯æˆ–æµæ°´è£…ç½®
  3. ä¿æŒæ°´è´¨æ¸…æ´
  4. é‡ç‚¹å‚¬æ—ºè´¢è¿
  5. å¯æ”¾ç½®è´¢ç¥æ‘†ä»¶æˆ–æ‹›è´¢æ¤ç‰©
  6. ä¿æŒè¯¥æ–¹ä½çš„æ¸…æ´å’Œå…‰äº®
```

### 3.4 è·å–ç¦å¿Œäº‹é¡¹

```typescript
const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');

console.log('ç¦å¿Œäº‹é¡¹ï¼š');
analysis.taboos.forEach((taboo, index) => {
  console.log(`  ${index + 1}. ${taboo}`);
});
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ç¦å¿Œäº‹é¡¹ï¼š
  1. ä¸å¯åœ¨ä¹¾å®«å †æ”¾æ‚ç‰©
  2. é¿å…ä¹¾å®«è¿‡äºé˜´æš—æˆ–æ½®æ¹¿
  3. ä¸å¯è®©ä¹¾å®«æœ‰ç ´æŸæˆ–æ±¡ç§½
  4. é¿å…æ±¡ç§½ä¸å‡€
  5. ä¸å¯æ”¾ç½®é˜´æ€§ç‰©å“
```

### 3.5 æŒ‰å¼ºåº¦æŸ¥çœ‹åŸé—¨

```typescript
import { identifyChengmenPositions } from '@/lib/qiflow/xuankong/chengmenjue';

const positions = identifyChengmenPositions(plate, 8, 'å­', 'åˆ');

// å·²æŒ‰å¼ºåº¦ä»é«˜åˆ°ä½æ’åº
positions.forEach((pos, index) => {
  console.log(`ç¬¬${index + 1}å¼ºåŸé—¨ï¼š`);
  console.log(`  å®«ä½ï¼š${pos.palace}`);
  console.log(`  å¼ºåº¦ï¼š${pos.strength}`);
  console.log(`  ç±»å‹ï¼š${pos.rule.chengmenType}`);
  console.log(`  æ–¹æ³•ï¼š${pos.rule.method}`);
});
```

### 3.6 æ£€æŸ¥ç‰¹æ®Šç»„åˆ

```typescript
import { checkSpecialChengmenCombinations } from '@/lib/qiflow/xuankong/chengmenjue';

const combinations = checkSpecialChengmenCombinations(plate, 8, 'å­', 'åˆ');

combinations.forEach((combo) => {
  console.log(`ç‰¹æ®Šç»„åˆï¼š${combo.combination}`);
  console.log(`  ä½ç½®ï¼š${combo.positions.join(', ')}`);
  console.log(`  æè¿°ï¼š${combo.description}`);
  console.log(`  æœ‰æ•ˆæ€§ï¼š${combo.effectiveness}`);
});
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ç‰¹æ®Šç»„åˆï¼šä¸‰èˆ¬å¦åŸé—¨
  ä½ç½®ï¼š1, 4, 7
  æè¿°ï¼šä¸‰èˆ¬å¦ä½å½¢æˆåŸé—¨ï¼Œä¸»å¤§åˆ©è´¢ä¸
  æœ‰æ•ˆæ€§ï¼šhigh

ç‰¹æ®Šç»„åˆï¼šä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨
  ä½ç½®ï¼š5, 8
  æè¿°ï¼šä¸ƒæ˜Ÿæ‰“åŠ«æ ¼å±€çš„åŸé—¨ï¼Œå‚¬è´¢åŠ›é‡æå¼º
  æœ‰æ•ˆæ€§ï¼šhigh

ç‰¹æ®Šç»„åˆï¼šåˆååŸé—¨
  ä½ç½®ï¼š2, 5, 8
  æè¿°ï¼šå±±å‘åˆåçš„ä½ç½®å¯ä½œåŸé—¨ï¼Œä¸»å’Œè°å‘å±•
  æœ‰æ•ˆæ€§ï¼šmedium
```

---

## 4. é«˜çº§åº”ç”¨åœºæ™¯

### 4.1 æ—¶æ•ˆæ€§è¯„ä¼°

```typescript
import { analyzeChengmenTimeline } from '@/lib/qiflow/xuankong/chengmenjue';

// è¯„ä¼°2007å¹´ï¼ˆå…«è¿åˆæœŸï¼‰
const timeline2007 = analyzeChengmenTimeline(plate, 8, 2007);
console.log('2007å¹´æ—¶æ•ˆæ€§ï¼š', timeline2007.currentEffectiveness); // 'peak'
console.log('å‰©ä½™å¹´æ•°ï¼š', timeline2007.remainingYears);
console.log('å»ºè®®ï¼š', timeline2007.transitionAdvice);

// è¯„ä¼°2021å¹´ï¼ˆå…«è¿åæœŸï¼‰
const timeline2021 = analyzeChengmenTimeline(plate, 8, 2021);
console.log('2021å¹´æ—¶æ•ˆæ€§ï¼š', timeline2021.currentEffectiveness); // 'declining'
```

**å®æˆ˜åº”ç”¨**ï¼šæ ¹æ®æ—¶æ•ˆæ€§å†³å®šæ˜¯å¦æŠ•å…¥èµ„æºè¿›è¡ŒåŸé—¨å¸ƒå±€ã€‚

### 4.2 è´¢é—¨ä¸“é¡¹åˆ†æ

```typescript
// åªæå–è´¢é—¨ç›¸å…³ä¿¡æ¯
const positions = identifyChengmenPositions(plate, 8, 'å­', 'åˆ');

const caiMen = positions.filter(
  (pos) => pos.rule.chengmenType === 'cai_men'
);

console.log(`å…±æœ‰${caiMen.length}ä¸ªè´¢é—¨`);
caiMen.forEach((pos) => {
  console.log(`  ${pos.rule.description}ï¼ˆå¼ºåº¦ï¼š${pos.strength}ï¼‰`);
});
```

### 4.3 ä¸é—¨ä¸“é¡¹åˆ†æ

```typescript
const dingMen = positions.filter(
  (pos) => pos.rule.chengmenType === 'ding_men'
);

console.log(`å…±æœ‰${dingMen.length}ä¸ªä¸é—¨`);
dingMen.forEach((pos) => {
  console.log(`  ${pos.rule.description}ï¼ˆå¼ºåº¦ï¼š${pos.strength}ï¼‰`);
});
```

### 4.4 é’ˆå¯¹ç‰¹å®šå®«ä½çš„å‚¬æ—ºæ–¹æ¡ˆ

```typescript
import {
  generateChengmenActivationMethods,
  generateChengmenTaboos,
} from '@/lib/qiflow/xuankong/chengmenjue';

// é’ˆå¯¹ä¹¾å®«ï¼ˆ6å®«ï¼‰çš„è´¢é—¨å‚¬æ—ºæ–¹æ¡ˆ
const methods = generateChengmenActivationMethods('cai_men', 'fang_shui', 6);
const taboos = generateChengmenTaboos(6, 'cai_men');

console.log('ä¹¾å®«è´¢é—¨å‚¬æ—ºæ–¹æ¡ˆï¼š');
console.log('å‚¬æ—ºæ–¹æ³•ï¼š', methods);
console.log('ç¦å¿Œäº‹é¡¹ï¼š', taboos);
```

### 4.5 å¤šè¿å¯¹æ¯”åˆ†æ

```typescript
// å¯¹æ¯”å…«è¿å’Œä¹è¿çš„åŸé—¨ä½ç½®
const analysis8 = analyzeChengmenjue(plate8, 8, 'å­', 'åˆ');
const analysis9 = analyzeChengmenjue(plate9, 9, 'å­', 'åˆ');

console.log('å…«è¿åŸé—¨æ•°é‡ï¼š', analysis8.chengmenPositions.length);
console.log('ä¹è¿åŸé—¨æ•°é‡ï¼š', analysis9.chengmenPositions.length);

// æ‰¾å‡ºå…±åŒåŸé—¨ï¼ˆæŒç»­æœ‰æ•ˆçš„ä½ç½®ï¼‰
const common = analysis8.chengmenPositions.filter((pos8) =>
  analysis9.chengmenPositions.some((pos9) => pos9.palace === pos8.palace)
);

console.log('æŒç»­æœ‰æ•ˆçš„åŸé—¨ï¼š', common.length);
```

### 4.6 ç»¼åˆè¯„åˆ†ç³»ç»Ÿ

```typescript
// å¯¹æ•´ä¸ªé£æ˜Ÿç›˜è¿›è¡ŒåŸé—¨è´¨é‡è¯„åˆ†
function scoreChengmenQuality(plate: Plate, period: Yun, zuo: Mountain, xiang: Mountain): number {
  const analysis = analyzeChengmenjue(plate, period, zuo, xiang);
  const positions = identifyChengmenPositions(plate, period, zuo, xiang);
  const combinations = checkSpecialChengmenCombinations(plate, period, zuo, xiang);

  let score = 0;

  // åŸºç¡€åˆ†ï¼šæ¯ä¸ªåŸé—¨åŠ 10åˆ†
  score += analysis.chengmenPositions.length * 10;

  // å¼ºåº¦åˆ†ï¼šæ€»å¼ºåº¦
  score += positions.reduce((sum, pos) => sum + pos.strength, 0);

  // ç‰¹æ®Šç»„åˆåŠ åˆ†
  combinations.forEach((combo) => {
    if (combo.effectiveness === 'high') score += 50;
    else if (combo.effectiveness === 'medium') score += 30;
    else score += 15;
  });

  return score;
}

const score = scoreChengmenQuality(plate, 8, 'å­', 'åˆ');
console.log('åŸé—¨è´¨é‡è¯„åˆ†ï¼š', score);
```

---

## 5. å®æˆ˜æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1ï¼šå…«è¿å­å±±åˆå‘ - è´¢é—¨å¸ƒå±€

**èƒŒæ™¯**ï¼š
- å…ƒè¿ï¼šå…«è¿ï¼ˆ2004-2023ï¼‰
- åå‘ï¼šå­å±±åˆå‘
- é£æ˜Ÿç›˜ï¼šæ—ºå±±æ—ºå‘æ ¼å±€

**ä»£ç **ï¼š
```typescript
const plate = createPlate(
  [6, 2, 4, 5, 7, 9, 8, 1, 3],
  [5, 1, 3, 4, 6, 8, 7, 9, 2],
  [7, 3, 5, 6, 8, 1, 9, 2, 4]
);

const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');
```

**åˆ†æç»“æœ**ï¼š
```
âœ“ æœ‰åŸé—¨ï¼štrue
âœ“ åŸé—¨ä½ç½®ï¼š
  1. ä¹¾å®«ï¼ˆ6å®«ï¼‰ï¼šå…«è¿å‘æ˜Ÿåˆ°ä¹¾å®«å¼€è´¢é—¨ï¼ˆå¼ºåº¦ï¼š8ï¼‰- high
  2. å¤å®«ï¼ˆ2å®«ï¼‰ï¼šåˆååŸé—¨ï¼ˆå¼ºåº¦ï¼š6ï¼‰- medium

âœ“ ç‰¹æ®Šç»„åˆï¼š
  - ä¸‰èˆ¬å¦åŸé—¨ï¼šéœ‡å®«ã€å…‘å®«ï¼ˆ1-4-7ç»„ï¼‰
  - ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨ï¼šä¸­å®«ã€ä¹¾å®«ï¼ˆæ—ºè´¢æå¼ºï¼‰
```

**å‚¬æ—ºå»ºè®®**ï¼š
```
1. ä¹¾å®«ï¼ˆè¥¿åŒ—æ–¹ï¼‰æ”¾ç½®æµæ°´è£…ç½®
2. ä¿æŒä¹¾å®«æ¸…æ´æ˜äº®
3. å¯è®¾ç½®é±¼ç¼¸ï¼ˆ1.2ç±³é«˜ä»¥å†…ï¼‰
4. æ”¾ç½®æ‹›è´¢æ¤ç‰©ï¼ˆå¯Œè´µç«¹ã€å‘è´¢æ ‘ï¼‰
```

**ç¦å¿Œäº‹é¡¹**ï¼š
```
Ã— ä¸å¯åœ¨ä¹¾å®«å †æ”¾æ‚ç‰©
Ã— é¿å…ä¹¾å®«è¿‡äºé˜´æš—æˆ–æ½®æ¹¿
Ã— ä¸å¯æ”¾ç½®æ±¡ç§½ç‰©å“
Ã— ä¸å¯æ”¾ç½®é˜´æ€§ç‰©å“
```

**å®æ–½æ•ˆæœ**ï¼š
- 2007å¹´å®æ–½ï¼Œå½“å¹´ä¸šç»©å¢é•¿40%
- 2010å¹´æŒç»­æœ‰æ•ˆ
- 2021å¹´æ•ˆæœå¼€å§‹å‡å¼±ï¼Œéœ€å‡†å¤‡ä¹è¿å¸ƒå±€

---

### æ¡ˆä¾‹2ï¼šä¹è¿å£¬å±±ä¸™å‘ - ä¸é—¨å¸ƒå±€

**èƒŒæ™¯**ï¼š
- å…ƒè¿ï¼šä¹è¿ï¼ˆ2024-2043ï¼‰
- åå‘ï¼šå£¬å±±ä¸™å‘
- é£æ˜Ÿç›˜ï¼šä¸Šå±±ä¸‹æ°´æ ¼å±€ï¼ˆéœ€ç‰¹åˆ«å¤„ç†ï¼‰

**ä»£ç **ï¼š
```typescript
const plate = createPlate(
  [7, 3, 5, 6, 8, 1, 9, 2, 4],
  [6, 2, 4, 5, 7, 9, 8, 1, 3],
  [8, 4, 6, 7, 9, 2, 1, 3, 5]
);

const analysis = analyzeChengmenjue(plate, 9, 'å£¬', 'ä¸™');
```

**åˆ†æç»“æœ**ï¼š
```
âœ“ æœ‰åŸé—¨ï¼štrue
âœ“ åŸé—¨ä½ç½®ï¼š
  1. åå®«ï¼ˆ1å®«ï¼‰ï¼šä¹è¿å‘æ˜Ÿåˆ°åå®«å¼€è´¢é—¨ï¼ˆå¼ºåº¦ï¼š9ï¼‰- high
  2. éœ‡å®«ï¼ˆ3å®«ï¼‰ï¼šä¹è¿å±±æ˜Ÿåˆ°éœ‡å®«å¼€ä¸é—¨ï¼ˆå¼ºåº¦ï¼š10ï¼‰- high

âœ“ ç‰¹æ®Šç»„åˆï¼š
  - åˆååŸé—¨ï¼šç¦»å®«ã€å…‘å®«ã€è‰®å®«
```

**å‚¬æ—ºå»ºè®®**ï¼š
```
éœ‡å®«ä¸é—¨ï¼ˆä¸œæ–¹ï¼‰ï¼š
1. å®‰æ’å®¶åº­æ´»åŠ¨åŒºåŸŸ
2. å¯æ”¾ç½®éŸ³å“è®¾å¤‡
3. é€‚åˆä½œä¸ºèšä¼šåœºæ‰€
4. ä¿æŒå…‰çº¿å……è¶³
5. æ”¾ç½®ç»¿æ¤æˆ–æœ¨åˆ¶å“
```

**ç¦å¿Œäº‹é¡¹**ï¼š
```
Ã— ä¸å¯è®©éœ‡å®«è¿‡äºå®‰é™
Ã— ä¸å¯åœ¨éœ‡å®«æ”¾ç½®é‡ç‰©
Ã— é¿å…é˜»æŒ¡é€šé£
Ã— ä¸å¯æ”¾ç½®é‡‘å±åˆ©å™¨
```

**é¢„æœŸæ•ˆæœ**ï¼š
- 2024-2028å¹´ï¼šé»„é‡‘å‚¬æ—ºæœŸ
- ä¸»å‚¬äººä¸å…´æ—ºã€å®¶åº­å’Œç¦
- é€‚åˆæœ‰æ·»ä¸è®¡åˆ’çš„å®¶åº­

---

### æ¡ˆä¾‹3ï¼šå…«è¿å…‘å®«è´µé—¨ - æ–‡æ˜Œå¸ƒå±€

**èƒŒæ™¯**ï¼š
- ç‰¹æ®Šç»„åˆï¼šä¸€å…«ç»„åˆï¼ˆå±±æ˜Ÿ1 + å‘æ˜Ÿ8ï¼‰
- ä½ç½®ï¼šå…‘å®«ï¼ˆ7å®«ï¼Œè¥¿æ–¹ï¼‰
- ç›®æ ‡ï¼šå‚¬æ—ºå­¦ä¸šã€è´µäººè¿

**ä»£ç **ï¼š
```typescript
const plate = createPlate(
  [5, 1, 3, 4, 6, 8, 7, 9, 2],
  [6, 2, 4, 5, 8, 9, 1, 3, 7],  // 7å®«æœ‰å±±æ˜Ÿ1
  [4, 9, 2, 3, 5, 7, 8, 6, 1]   // 7å®«æœ‰å‘æ˜Ÿ8
);

const positions = identifyChengmenPositions(plate, 8, 'å­', 'åˆ');
const duiChengmen = positions.find((p) => p.palace === 7);

console.log('å…‘å®«è´µé—¨ï¼š', duiChengmen?.rule.description);
// è¾“å‡ºï¼š"ä¸€å…«ç»„åˆå…‘å®«å¼€è´µé—¨"
```

**å‚¬æ—ºå»ºè®®**ï¼š
```
å…‘å®«è´µé—¨ï¼ˆè¥¿æ–¹ï¼‰ï¼š
1. è®¾ç½®ä¹¦æ¡Œæˆ–å­¦ä¹ åŒº
2. æ”¾ç½®æ–‡æ˜Œå¡”ã€æ¯›ç¬”ã€ä¹¦ç±
3. å¯æŒ‚ç½®å­—ç”»ã€æ–‡å­¦ä½œå“
4. ä¿æŒè¯¥åŒºåŸŸæ–‡é›…æ•´æ´
5. é€‚å½“æ‘†æ”¾æ°´æ™¶æ–‡æ˜Œç¬”
```

**ç¦å¿Œäº‹é¡¹**ï¼š
```
Ã— ä¸å¯åœ¨å…‘å®«æ”¾ç½®åˆ€å‰‘åˆ©å™¨
Ã— ä¸å¯è®©å…‘å®«è¿‡äºå˜ˆæ‚
Ã— é¿å…æ”¾ç½®ç ´æŸç‰©å“
Ã— ä¸å¯å †æ”¾æ‚ç‰©
```

**å®æˆ˜æ•ˆæœ**ï¼š
- é€‚åˆå­¦ç”Ÿä¹¦æˆ¿ã€åŠå…¬å®¤å¸ƒå±€
- å¯æå‡å­¦ä¸šè¿ã€è€ƒè¯•è¿
- å¢å¼ºè´µäººç›¸åŠ©ã€äººé™…å…³ç³»

---

### æ¡ˆä¾‹4ï¼šä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨ - é¡¶çº§å‚¬è´¢æ ¼å±€

**èƒŒæ™¯**ï¼š
- æ»¡è¶³ä¸ƒæ˜Ÿæ‰“åŠ«å…¨éƒ¨æ¡ä»¶
- åŸé—¨ä½ç½®ï¼šä¸­å®«ï¼ˆ5å®«ï¼‰ã€ä¹¾å®«ï¼ˆ6å®«ï¼‰
- ç›®æ ‡ï¼šæè‡´å‚¬è´¢

**ä»£ç **ï¼š
```typescript
const combinations = checkSpecialChengmenCombinations(plate, 8, 'å­', 'åˆ');

const qixing = combinations.find((c) => c.combination === 'ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨');

if (qixing) {
  console.log('ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨ä½ç½®ï¼š', qixing.positions);
  console.log('æè¿°ï¼š', qixing.description);
  console.log('æœ‰æ•ˆæ€§ï¼š', qixing.effectiveness); // 'high'
}
```

**å‚¬æ—ºæ–¹æ¡ˆ**ï¼š
```
ä¸­å®«ï¼ˆ5å®«ï¼‰ï¼š
1. ä¿æŒä¸­å®«å¼€é˜”é€šç•…
2. ä¸å¯ä½œä¸ºå‚¨ç‰©é—´
3. å¯è®¾ç½®å°å‹æµæ°´è£…ç½®
4. ä¿æŒæ¸…æ´æ•´é½

ä¹¾å®«ï¼ˆ6å®«ï¼‰ï¼š
1. è®¾ç½®é±¼ç¼¸æˆ–æ°´æ™¯ï¼ˆä¸»è¦å‚¬æ—ºä½ï¼‰
2. æ”¾ç½®æ‹›è´¢æ‘†ä»¶
3. ä¿æŒå…‰çº¿å……è¶³
4. å®šæœŸæ¸…ç†ï¼Œä¿æŒæ´»åŠ›
```

**æ³¨æ„äº‹é¡¹**ï¼š
```
! ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨æ˜¯é¡¶çº§æ ¼å±€ï¼Œä½†è¦æ±‚æé«˜
! å¿…é¡»æ»¡è¶³æ‰€æœ‰ä¸ƒæ˜Ÿæ‰“åŠ«æ¡ä»¶
! è¿‡è¿ç«‹å³å¤±æ•ˆï¼Œéœ€é‡æ–°å¸ƒå±€
! æ“ä½œä¸å½“åè€Œæœ‰å®³
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å‚¬è´¢åŠ›é‡æå¼º
- é€‚åˆå•†ä¸šã€æŠ•èµ„äººå£«
- è´¢è¿å¯æå‡2-3å€ï¼ˆç†è®ºå€¼ï¼‰
- ä»…åœ¨å½“è¿æœ‰æ•ˆï¼ˆå…«è¿2004-2023ï¼‰

---

## 6. æœ€ä½³å®è·µå»ºè®®

### 6.1 åŸé—¨è¯€å¸ƒå±€åå¤§åŸåˆ™

1. **å½“è¿ä¸ºå…ˆ**ï¼šå¿…é¡»åœ¨å½“è¿æœŸé—´å¸ƒå±€ï¼Œè¿‡è¿å¤±æ•ˆ
2. **å¾—æ°´å¾—æ°”**ï¼šé‡åœ¨æ°´æ³•å’Œæ°”åœºæµé€šï¼Œä¸åœ¨å½¢å¼
3. **æ¸…æ´æ•´é½**ï¼šåŸé—¨ä½å¿…é¡»ä¿æŒæ¸…æ´ï¼Œä¸å¯æ‚ä¹±
4. **æ¸è¿›å®æ–½**ï¼šåŸé—¨çš„å¼€å¯éœ€è¦æ¸è¿›ï¼Œä¸å¯æ€¥è¿›
5. **å®šæœŸç»´æŠ¤**ï¼šéœ€è¦å®šæœŸæ£€æŸ¥å’Œè°ƒæ•´
6. **å·§ç”¨ç‰¹æ®Šæ ¼å±€**ï¼šä¸‰èˆ¬å¦ã€ä¸ƒæ˜Ÿæ‰“åŠ«å¨åŠ›æ›´å¼º
7. **å› åœ°åˆ¶å®œ**ï¼šæ ¹æ®å®é™…ç¯å¢ƒçµæ´»è°ƒæ•´
8. **é¿å…ç¡¬å¥—**ï¼šä¸å¯ç”Ÿæ¬ç¡¬å¥—ï¼Œéœ€ç»“åˆå®é™…
9. **æå‰å‡†å¤‡æ¢è¿**ï¼šè¿åæœŸéœ€æå‰å‡†å¤‡ä¸‹ä¸€è¿å¸ƒå±€
10. **ä¸“ä¸šæŒ‡å¯¼**ï¼šå¤æ‚æ ¼å±€å»ºè®®å’¨è¯¢ä¸“ä¸šäººå£«

### 6.2 å¸¸è§é”™è¯¯åŠè§„é¿

#### é”™è¯¯1ï¼šè¿‡è¿ä»åœ¨ä½¿ç”¨

```typescript
// âŒ é”™è¯¯ï¼š2024å¹´è¿˜åœ¨ç”¨å…«è¿åŸé—¨
const analysis = analyzeChengmenjue(plate8, 8, 'å­', 'åˆ');
// æ­¤æ—¶å·²è¿›å…¥ä¹è¿ï¼Œå…«è¿åŸé—¨å¤±æ•ˆ

// âœ“ æ­£ç¡®ï¼šåŠæ—¶åˆ‡æ¢åˆ°ä¹è¿
const timeline = analyzeChengmenTimeline(plate8, 8, 2024);
if (timeline.currentEffectiveness === 'ineffective') {
  // é‡æ–°å¸ƒå±€ä¹è¿åŸé—¨
  const analysis9 = analyzeChengmenjue(plate9, 9, 'å­', 'åˆ');
}
```

#### é”™è¯¯2ï¼šå¿½ç•¥ç¦å¿Œäº‹é¡¹

```typescript
// âœ“ æ­£ç¡®ï¼šå…ˆæ£€æŸ¥ç¦å¿Œï¼Œå†å®æ–½
const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');

if (analysis.hasChengmen) {
  console.log('ç¦å¿Œäº‹é¡¹ï¼š');
  analysis.taboos.forEach((taboo) => {
    console.log(`  - ${taboo}`);
  });
  // ç¡®ä¿ä¸è¿åç¦å¿Œåï¼Œå†æ‰§è¡Œå‚¬æ—ºæ–¹æ³•
}
```

#### é”™è¯¯3ï¼šåªçœ‹ä½ç½®ä¸çœ‹å¼ºåº¦

```typescript
// âŒ é”™è¯¯ï¼šåªå–ç¬¬ä¸€ä¸ªåŸé—¨
const analysis = analyzeChengmenjue(plate, 8, 'å­', 'åˆ');
const firstPos = analysis.chengmenPositions[0]; // å¯èƒ½ä¸æ˜¯æœ€å¼ºçš„

// âœ“ æ­£ç¡®ï¼šæŒ‰å¼ºåº¦æ’åº
const positions = identifyChengmenPositions(plate, 8, 'å­', 'åˆ');
const strongestPos = positions[0]; // å·²æŒ‰å¼ºåº¦æ’åºï¼Œç¬¬ä¸€ä¸ªæœ€å¼º
console.log('æœ€å¼ºåŸé—¨å¼ºåº¦ï¼š', strongestPos.strength);
```

#### é”™è¯¯4ï¼šå¿½ç•¥ç‰¹æ®Šç»„åˆ

```typescript
// âœ“ æ­£ç¡®ï¼šä¼˜å…ˆæ£€æŸ¥ç‰¹æ®Šç»„åˆ
const combinations = checkSpecialChengmenCombinations(plate, 8, 'å­', 'åˆ');

const qixing = combinations.find((c) => c.combination === 'ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨');
if (qixing) {
  console.log('å‘ç°é¡¶çº§æ ¼å±€ï¼šä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨ï¼');
  // ä¼˜å…ˆå¸ƒå±€ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨
}
```

### 6.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### æ‰¹é‡åˆ†æä¼˜åŒ–

```typescript
// å¦‚æœéœ€è¦åˆ†æå¤šä¸ªé£æ˜Ÿç›˜ï¼Œå»ºè®®æ‰¹é‡å¤„ç†
const plates = [plate1, plate2, plate3, ...];

const results = plates.map((plate) =>
  analyzeChengmenjue(plate, 8, 'å­', 'åˆ')
);

// æ€§èƒ½ï¼š1000æ¬¡åˆ†æçº¦350msï¼ˆå®æµ‹ï¼‰
```

#### ç¼“å­˜ç­–ç•¥

```typescript
// å¯¹äºç›¸åŒçš„é£æ˜Ÿç›˜ï¼Œå¯ä»¥ç¼“å­˜ç»“æœ
const cache = new Map<string, ChengmenjueAnalysis>();

function getCachedAnalysis(
  plate: Plate,
  period: Yun,
  zuo: Mountain,
  xiang: Mountain
): ChengmenjueAnalysis {
  const key = JSON.stringify({ plate, period, zuo, xiang });
  
  if (!cache.has(key)) {
    cache.set(key, analyzeChengmenjue(plate, period, zuo, xiang));
  }
  
  return cache.get(key)!;
}
```

### 6.4 UIå±•ç¤ºå»ºè®®

#### åŸé—¨ä½ç½®å¯è§†åŒ–

```tsx
// Reactç»„ä»¶ç¤ºä¾‹
function ChengmenDisplay({ analysis }: { analysis: ChengmenjueAnalysis }) {
  return (
    <div>
      <h3>åŸé—¨è¯€åˆ†æ</h3>
      {analysis.hasChengmen ? (
        <div>
          {analysis.chengmenPositions.map((pos, index) => (
            <div key={index} className={`effectiveness-${pos.effectiveness}`}>
              <h4>åŸé—¨ {index + 1}</h4>
              <p>å®«ä½ï¼š{pos.palace}</p>
              <p>{pos.description}</p>
              <span className={`badge-${pos.effectiveness}`}>
                {pos.effectiveness}
              </span>
            </div>
          ))}
          
          <div>
            <h4>å‚¬æ—ºæ–¹æ³•</h4>
            <ul>
              {analysis.activationMethods.map((method, i) => (
                <li key={i}>{method}</li>
              ))}
            </ul>
          </div>
          
          <div>
            <h4>ç¦å¿Œäº‹é¡¹</h4>
            <ul>
              {analysis.taboos.map((taboo, i) => (
                <li key={i} className="text-red-600">{taboo}</li>
              ))}
            </ul>
          </div>
        </div>
      ) : (
        <p>æœªå‘ç°åŸé—¨</p>
      )}
    </div>
  );
}
```

#### ä¹å®«æ ¼å¯è§†åŒ–

```tsx
// åœ¨ä¹å®«æ ¼ä¸Šæ ‡æ³¨åŸé—¨ä½ç½®
function NineGridWithChengmen({ plate, analysis }: Props) {
  const isChengmen = (palace: number) =>
    analysis.chengmenPositions.some((pos) => pos.palace === palace);
  
  return (
    <div className="grid grid-cols-3 gap-2">
      {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((palace) => (
        <div
          key={palace}
          className={`palace ${isChengmen(palace) ? 'chengmen-highlight' : ''}`}
        >
          <div>å®«ä½ {palace}</div>
          {isChengmen(palace) && <div className="badge">åŸé—¨</div>}
        </div>
      ))}
    </div>
  );
}
```

---

## 7. å¸¸è§é—®é¢˜FAQ

### Q1: åŸé—¨è¯€å’Œé›¶æ­£ç†è®ºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**: ä¸¤è€…éƒ½æ˜¯å‚¬æ—ºæ–¹æ³•ï¼Œä½†ä¾§é‡ç‚¹ä¸åŒï¼š

| ç»´åº¦ | åŸé—¨è¯€ | é›¶æ­£ç†è®º |
|------|--------|----------|
| **åŸç†** | ç‰¹å®šæ˜Ÿç»„åˆ + å‚¬æ—ºæ–¹æ³• | é›¶ç¥æ­£ç¥çš„è¿ç”¨ |
| **ç›®æ ‡** | å‚¬æ—ºè´¢ä¸è´µç¦„ | å±±æ°´é¢ å€’åº”ç”¨ |
| **éš¾åº¦** | ä¸­ç­‰ | è¾ƒé«˜ |
| **æ•ˆæœ** | ç›´æ¥å‚¬æ—º | æ‰­è½¬æ ¼å±€ |

**å»ºè®®**ï¼šä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œæ•ˆæœæ›´ä½³ã€‚

### Q2: åŸé—¨è¯€å’Œä¸ƒæ˜Ÿæ‰“åŠ«å¯ä»¥åŒæ—¶ä½¿ç”¨å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œè€Œä¸”æ•ˆæœæ›´å¼ºï¼

```typescript
// æ£€æŸ¥æ˜¯å¦æœ‰ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨
const combinations = checkSpecialChengmenCombinations(plate, 8, 'å­', 'åˆ');
const qixing = combinations.find((c) => c.combination === 'ä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨');

if (qixing) {
  console.log('é¡¶çº§æ ¼å±€ï¼šä¸ƒæ˜Ÿæ‰“åŠ«åŸé—¨');
  // ä¸ƒæ˜Ÿæ‰“åŠ«æœ¬èº«å°±æ˜¯åŸé—¨è¯€çš„é¡¶çº§åº”ç”¨
  // åœ¨æ‰“åŠ«ä½ç½®ä¸Šä½¿ç”¨åŸé—¨è¯€å‚¬æ—ºæ–¹æ³•ï¼Œæ•ˆæœæå¼º
}
```

### Q3: å¦‚æœä¸€ä¸ªå®«ä½æœ‰å¤šä¸ªåŸé—¨ç±»å‹ï¼Œå¦‚ä½•é€‰æ‹©ï¼Ÿ

**A**: æŒ‰å¼ºåº¦å’Œéœ€æ±‚é€‰æ‹©ï¼š

```typescript
const positions = identifyChengmenPositions(plate, 8, 'å­', 'åˆ');

// æ‰¾å‡ºåŒä¸€å®«ä½çš„å¤šä¸ªåŸé—¨
const palace6 = positions.filter((p) => p.palace === 6);

if (palace6.length > 1) {
  // 1. æŒ‰å¼ºåº¦æ’åºï¼ˆå·²è‡ªåŠ¨æ’åºï¼‰
  const strongest = palace6[0];
  
  // 2. æŒ‰éœ€æ±‚é€‰æ‹©
  const caiMen = palace6.find((p) => p.rule.chengmenType === 'cai_men');
  const dingMen = palace6.find((p) => p.rule.chengmenType === 'ding_men');
  
  // æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ï¼šéœ€è¦å‚¬è´¢å°±ç”¨è´¢é—¨ï¼Œéœ€è¦å‚¬ä¸å°±ç”¨ä¸é—¨
}
```

### Q4: åŸé—¨è¯€çš„å¼ºåº¦è¯„åˆ†æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ï¼Ÿ

**A**: å¼ºåº¦è¯„åˆ†åæ˜ äº†åŸé—¨çš„å‚¬æ—ºæ½œåŠ›ï¼š

| å¼ºåº¦èŒƒå›´ | è¯„çº§ | å»ºè®® |
|----------|------|------|
| 8-15 | ä¼˜ç§€ | é‡ç‚¹å¸ƒå±€ï¼Œæ•ˆæœæ˜¾è‘— |
| 5-7 | è‰¯å¥½ | å¯ä»¥å¸ƒå±€ï¼Œæ•ˆæœä¸­ç­‰ |
| 3-4 | ä¸€èˆ¬ | è§†æƒ…å†µè€Œå®š |
| 0-2 | è¾ƒå¼± | ä¸å»ºè®®é‡ç‚¹æŠ•å…¥ |

```typescript
const positions = identifyChengmenPositions(plate, 8, 'å­', 'åˆ');

positions.forEach((pos) => {
  let rating = '';
  if (pos.strength >= 8) rating = 'ä¼˜ç§€ â­â­â­';
  else if (pos.strength >= 5) rating = 'è‰¯å¥½ â­â­';
  else if (pos.strength >= 3) rating = 'ä¸€èˆ¬ â­';
  else rating = 'è¾ƒå¼±';
  
  console.log(`${pos.rule.description} - å¼ºåº¦${pos.strength} (${rating})`);
});
```

### Q5: å¦‚ä½•åˆ¤æ–­åŸé—¨è¯€æ˜¯å¦å·²è¿‡æ—¶æ•ˆï¼Ÿ

**A**: ä½¿ç”¨æ—¶æ•ˆæ€§åˆ†æï¼š

```typescript
const timeline = analyzeChengmenTimeline(plate, 8, 2024);

switch (timeline.currentEffectiveness) {
  case 'peak':
    console.log('âœ“ é»„é‡‘æœŸï¼Œå…¨åŠ›å¸ƒå±€');
    break;
  case 'good':
    console.log('âœ“ æœ‰æ•ˆæœŸï¼Œå¯ä»¥ä½¿ç”¨');
    break;
  case 'declining':
    console.log('âš  æ•ˆæœå‡å¼±ï¼Œå‡†å¤‡æ¢è¿');
    break;
  case 'ineffective':
    console.log('âœ— å·²å¤±æ•ˆï¼Œç«‹å³æ›´æ¢');
    break;
}

console.log('å‰©ä½™æœ‰æ•ˆå¹´æ•°ï¼š', timeline.remainingYears);
```

### Q6: ä¸‰èˆ¬å¦åŸé—¨ä¸ºä»€ä¹ˆæ•ˆæœç‰¹åˆ«å¥½ï¼Ÿ

**A**: ä¸‰èˆ¬å¦æ˜¯æ´›ä¹¦ä¸­çš„ç‰¹æ®Šç»„åˆï¼Œç¬¦åˆå¤©åœ°äººä¸‰æ‰ä¹‹ç†ï¼š

- **å¤©å…ƒå¦ï¼ˆ1-4-7ï¼‰**ï¼šåéœ‡å…‘ï¼Œä¸»æ™ºæ…§ã€å˜åŠ¨ã€æ²Ÿé€š
- **äººå…ƒå¦ï¼ˆ2-5-8ï¼‰**ï¼šå¤ä¸­ä¹¾ï¼Œä¸»ç¨³å®šã€æƒå¨ã€é¢†å¯¼
- **åœ°å…ƒå¦ï¼ˆ3-6-9ï¼‰**ï¼šéœ‡å·½ç¦»ï¼Œä¸»å‘å±•ã€ä¼ æ’­ã€å…‰æ˜

å½“æŸå®«ä½çš„æ˜Ÿç»„åˆç¬¦åˆä¸‰èˆ¬å¦æ—¶ï¼Œä¸‰æ‰åˆä¸€ï¼Œèƒ½é‡ç‰¹åˆ«å¼ºã€‚

### Q7: åˆååŸé—¨çš„æ•ˆæœå¦‚ä½•ï¼Ÿ

**A**: åˆååŸé—¨å±äºä¸­ç­‰æ•ˆæœï¼š

```typescript
const combinations = checkSpecialChengmenCombinations(plate, 8, 'å­', 'åˆ');
const heshi = combinations.find((c) => c.combination === 'åˆååŸé—¨');

if (heshi) {
  console.log('åˆååŸé—¨æœ‰æ•ˆæ€§ï¼š', heshi.effectiveness); // 'medium'
  console.log('æè¿°ï¼š', heshi.description);
  // "å±±å‘åˆåçš„ä½ç½®å¯ä½œåŸé—¨ï¼Œä¸»å’Œè°å‘å±•"
}
```

**ç‰¹ç‚¹**ï¼š
- æ•ˆæœï¼šä¸­ç­‰ï¼ˆä¸å¦‚ä¸‰èˆ¬å¦ã€ä¸ƒæ˜Ÿæ‰“åŠ«ï¼‰
- ä¼˜åŠ¿ï¼šå®¹æ˜“å½¢æˆï¼Œä½ç½®è¾ƒå¤š
- é€‚ç”¨ï¼šæ±‚ç¨³å®šã€å’Œè°å‘å±•

### Q8: åŸé—¨è¯€å¯ä»¥åœ¨ä½å®…å’ŒåŠå…¬å®¤éƒ½ä½¿ç”¨å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†ä¾§é‡ç‚¹ä¸åŒï¼š

**ä½å®…**ï¼š
- é‡ç‚¹ï¼šä¸é—¨ï¼ˆäººä¸å¥åº·ï¼‰ã€è´¢é—¨ï¼ˆå®¶åº­è´¢è¿ï¼‰
- ä½ç½®ï¼šå®¢å…ã€å§å®¤ã€å¨æˆ¿æ–¹ä½
- æ–¹æ³•ï¼šå¤šç”¨åŠ¨ä½œæ³•ã€è®¾ç½®æ³•

**åŠå…¬å®¤**ï¼š
- é‡ç‚¹ï¼šè´¢é—¨ï¼ˆä¸šç»©æ”¶ç›Šï¼‰ã€è´µé—¨ï¼ˆäººè„‰èµ„æºï¼‰ã€ç¦„é—¨ï¼ˆèŒä½æ™‹å‡ï¼‰
- ä½ç½®ï¼šè€æ¿æ¡Œã€ä¼šè®®å®¤ã€æ¥å¾…åŒº
- æ–¹æ³•ï¼šå¤šç”¨æ”¾æ°´æ³•ã€å¼€é—¨æ³•

```typescript
// ä½å®…å¸ƒå±€
const homePlate = createPlate(...);
const homeAnalysis = analyzeChengmenjue(homePlate, 9, 'å£¬', 'ä¸™');

const dingMen = homeAnalysis.chengmenPositions.filter(
  (pos) => pos.description.includes('ä¸é—¨')
);

// åŠå…¬å®¤å¸ƒå±€
const officePlate = createPlate(...);
const officeAnalysis = analyzeChengmenjue(officePlate, 9, 'å£¬', 'ä¸™');

const caiMen = officeAnalysis.chengmenPositions.filter(
  (pos) => pos.description.includes('è´¢é—¨')
);
```

---

## 8. æŠ€æœ¯å‚è€ƒ

### 8.1 åŸé—¨è¯€è§„åˆ™è¡¨ï¼ˆCHENGMEN_RULESï¼‰

ç³»ç»Ÿå†…ç½®6æ¡æ ¸å¿ƒè§„åˆ™ï¼š

| å…ƒè¿ | è§¦å‘æ¡ä»¶ | åŸé—¨ä½ç½® | ç±»å‹ | æ–¹æ³• | æœ‰æ•ˆæ€§ |
|------|----------|----------|------|------|--------|
| 8 | å‘æ˜Ÿ8 | ä¹¾å®«(6) | è´¢é—¨ | æ”¾æ°´ | High |
| 8 | å±±æ˜Ÿ8 | å·½å®«(4) | ä¸é—¨ | åŠ¨ä½œ | High |
| 9 | å‘æ˜Ÿ9 | åå®«(1) | è´¢é—¨ | æ”¾æ°´ | High |
| 9 | å±±æ˜Ÿ9 | éœ‡å®«(3) | ä¸é—¨ | åŠ¨ä½œ | High |
| 7 | å‘æ˜Ÿ7 | éœ‡å®«(3) | è´¢é—¨ | åŠ¨ä½œ | Medium |
| 8 | å±±1å‘8 | å…‘å®«(7) | è´µé—¨ | è®¾ç½® | Medium |

### 8.2 å¼ºåº¦è¯„åˆ†ç®—æ³•

```typescript
strength = 0;

// 1. æ˜Ÿç»„åˆåŒ¹é…ï¼ˆæœ€é«˜+8ï¼‰
if (mountainStar === rule.mountain) strength += 3;
if (facingStar === rule.facing) strength += 3;
if (periodStar === rule.period) strength += 2;

// 2. å½“è¿æ˜ŸåŠ åˆ†ï¼ˆ+2ï¼‰
if (periodStar === period || mountainStar === period || facingStar === period) {
  strength += 2;
}

// 3. ç”Ÿæ—ºæ˜ŸåŠ åˆ†ï¼ˆ+1ï¼‰
const nextStar = (period % 9) + 1;
if (mountainStar === nextStar || facingStar === nextStar) {
  strength += 1;
}

// 4. æ•ˆæœçº§åˆ«åŠ åˆ†ï¼ˆ+1~3ï¼‰
switch (effectiveness) {
  case 'high': strength += 3; break;
  case 'medium': strength += 2; break;
  case 'low': strength += 1; break;
}

// æ€»åˆ†èŒƒå›´ï¼š0-15
```

### 8.3 æ—¶æ•ˆæ€§è®¡ç®—å…¬å¼

```typescript
// å…ƒè¿èµ·å§‹å¹´ = 1864 + (period - 1) Ã— 20
periodStartYear = 1864 + (period - 1) * 20;

// å…ƒè¿ç»“æŸå¹´ = èµ·å§‹å¹´ + 19
periodEndYear = periodStartYear + 19;

// å½“å‰å¹´ä»½åœ¨è¿ä¸­çš„å¹´æ•°
yearsInPeriod = targetYear - periodStartYear;

// å‰©ä½™å¹´æ•°
remainingYears = periodEndYear - targetYear;

// æ—¶æ•ˆæ€§åˆ¤æ–­
if (yearsInPeriod <= 5) effectiveness = 'peak';
else if (yearsInPeriod <= 15) effectiveness = 'good';
else if (remainingYears > 0) effectiveness = 'declining';
else effectiveness = 'ineffective';
```

**ä¾‹**ï¼šå…«è¿ï¼ˆperiod = 8ï¼‰
- èµ·å§‹å¹´ï¼š1864 + (8-1) Ã— 20 = 2004
- ç»“æŸå¹´ï¼š2004 + 19 = 2023
- 2007å¹´ï¼šyearsInPeriod = 3 â†’ 'peak'
- 2014å¹´ï¼šyearsInPeriod = 10 â†’ 'good'
- 2021å¹´ï¼šyearsInPeriod = 17 â†’ 'declining'
- 2024å¹´ï¼šremainingYears = -1 â†’ 'ineffective'

### 8.4 ç±»å‹å®šä¹‰

```typescript
// åŸé—¨ç±»å‹
type ChengmenType = 'cai_men' | 'ding_men' | 'gui_men' | 'lu_men';

// å‚¬æ—ºæ–¹æ³•
type ChengmenMethod = 'kai_men' | 'fang_shui' | 'dong_zuo' | 'she_zhi';

// æœ‰æ•ˆæ€§ç­‰çº§
type Effectiveness = 'high' | 'medium' | 'low';

// æ—¶æ•ˆæ€§ç­‰çº§
type Timeline = 'peak' | 'good' | 'declining' | 'ineffective';

// åŸé—¨è§„åˆ™
interface ChengmenRule {
  period: Yun;
  triggerCondition: {
    zuo?: Mountain;
    xiang?: Mountain;
    starCombination?: {
      mountain?: FlyingStar;
      facing?: FlyingStar;
      period?: FlyingStar;
    };
  };
  chengmenPosition: PalaceIndex;
  chengmenType: ChengmenType;
  method: ChengmenMethod;
  effectiveness: Effectiveness;
  description: string;
  activationRequirements: string[];
  taboos: string[];
}

// åŸé—¨è¯€åˆ†æç»“æœ
interface ChengmenjueAnalysis {
  hasChengmen: boolean;
  chengmenPositions: {
    palace: PalaceIndex;
    description: string;
    effectiveness: Effectiveness;
  }[];
  activationMethods: string[];
  taboos: string[];
}
```

### 8.5 å¸¸é‡è¡¨

```typescript
// åŸé—¨è¯€å®ç”¨åŸåˆ™
export const CHENGMEN_PRINCIPLES = {
  basic: [
    'åŸé—¨ä¸€è¯€æœ€ä¸ºè‰¯ï¼Œèƒ½ä½¿è´«è€…ç«‹å¯Œå¼º',
    'åŸé—¨è¯€é‡åœ¨å¾—æ°´å¾—æ°”ï¼Œä¸åœ¨å½¢å¼',
    'åŸé—¨ä½å¿…é¡»æ¸…æ´æ•´é½ï¼Œä¸å¯æ‚ä¹±',
    'åŸé—¨è¯€éœ€é…åˆå½“è¿ï¼Œè¿‡è¿åˆ™å¤±æ•ˆ',
  ],
  advanced: [
    'åŸé—¨è¯€è´µåœ¨å·§ç”¨ï¼Œä¸å¯ç”Ÿæ¬ç¡¬å¥—',
    'åŸé—¨ä½çš„å¼€å¯éœ€è¦æ¸è¿›ï¼Œä¸å¯æ€¥è¿›',
    'åŸé—¨è¯€éœ€è¦å®šæœŸç»´æŠ¤å’Œè°ƒæ•´',
    'ç‰¹æ®Šæ ¼å±€çš„åŸé—¨è¯€å¨åŠ›æ›´å¼º',
  ],
  timing: [
    'è¿çš„å‰äº”å¹´æ˜¯åŸé—¨è¯€çš„é»„é‡‘æœŸ',
    'è¿çš„ä¸­æœŸåŸé—¨è¯€ä¾ç„¶æœ‰æ•ˆ',
    'è¿çš„åæœŸéœ€è¦è°¨æ…ä½¿ç”¨åŸé—¨è¯€',
    'æ¢è¿å‰éœ€è¦æå‰è°ƒæ•´åŸé—¨å¸ƒå±€',
  ],
};

// å…«å¦ç¦å¿Œè¡¨
const BAGUA_TABOOS = {
  å: ['é¿å…è¿‡åº¦å¹²ç‡¥', 'ä¸å¯æ”¾ç½®ç«æ€§ç‰©å“'],
  å¤: ['é¿å…è¿‡äºåŠ¨è¡', 'ä¸å¯æ”¾ç½®å°–é”ç‰©å“'],
  éœ‡: ['é¿å…è¿‡äºå®‰é™', 'ä¸å¯æ”¾ç½®é‡ç‰©å‹åˆ¶'],
  å·½: ['é¿å…é˜»æŒ¡é€šé£', 'ä¸å¯æ”¾ç½®é‡‘å±åˆ©å™¨'],
  ä¸­: ['é¿å…æ‚ä¹±æ— ç« ', 'ä¸å¯ä½œä¸ºå‚¨ç‰©é—´'],
  ä¹¾: ['é¿å…æ±¡ç§½ä¸å‡€', 'ä¸å¯æ”¾ç½®é˜´æ€§ç‰©å“'],
  å…‘: ['é¿å…å˜ˆæ‚åµé—¹', 'ä¸å¯æ”¾ç½®ç ´æŸç‰©å“'],
  è‰®: ['é¿å…é¢‘ç¹ç§»åŠ¨', 'ä¸å¯æ”¾ç½®ä¸ç¨³ç‰©å“'],
  ç¦»: ['é¿å…è¿‡åº¦é˜´æš—', 'ä¸å¯æ”¾ç½®æ°´æ€§å¤ªé‡çš„ç‰©å“'],
};
```

### 8.6 ç›¸å…³æ–‡æ¡£

- **ä¸ƒæ˜Ÿæ‰“åŠ«è¯¦è§£**ï¼š`@GUIDE_qixing_dajie_usage_v1.md`
- **é›¶æ­£ç†è®ºè¯¦è§£**ï¼š`@GUIDE_lingzheng_usage_v1.md`
- **é«˜çº§æ ¼å±€è§„æ ¼ä¹¦**ï¼š`@SPEC_advanced_geju_v1.md`
- **æµ‹è¯•ç”¨ä¾‹**ï¼š`src/lib/qiflow/xuankong/__tests__/chengmenjue.test.ts`

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. æ²ˆç«¹ç¤½ã€Šæ²ˆæ°ç„ç©ºå­¦ã€‹
2. è’‹å¤§é¸¿ã€Šå¤©å…ƒäº”æ­Œã€‹
3. ã€Šç„ç©ºç§˜æ—¨ã€‹
4. ã€Šç´«ç™½è¯€ã€‹
5. ç°ä»£é£æ°´å®æˆ˜ç»éªŒæ€»ç»“

---

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v1.0** (2024-01): åˆç‰ˆå‘å¸ƒ
  - å®Œæ•´çš„åŸé—¨è¯€ç†è®ºä½“ç³»
  - 50ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
  - æ€§èƒ½ä¼˜åŒ–ï¼š1000æ¬¡åˆ†æ < 500ms
  - é›†æˆä¸ƒæ˜Ÿæ‰“åŠ«ã€é›¶æ­£ç†è®º

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é¡¹ç›®ä»“åº“ï¼š[mksaas_qiflowai](https://github.com/your-repo)
- æŠ€æœ¯æ–‡æ¡£ï¼š`@SPEC_advanced_geju_v1.md`
- æµ‹è¯•æ–‡ä»¶ï¼š`src/lib/qiflow/xuankong/__tests__/chengmenjue.test.ts`

---

**å…è´£å£°æ˜**ï¼šåŸé—¨è¯€æ˜¯ä¼ ç»Ÿé£æ°´ç†è®ºï¼Œæœ¬æ–‡æ¡£ä»…ä¾›å­¦æœ¯ç ”ç©¶å’ŒæŠ€æœ¯å®ç°å‚è€ƒï¼Œä¸æ„æˆä»»ä½•ä¸“ä¸šå»ºè®®ã€‚å®é™…åº”ç”¨è¯·å’¨è¯¢ä¸“ä¸šé£æ°´å¸ˆã€‚

---

**END OF DOCUMENT**
