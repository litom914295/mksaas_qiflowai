# date-fns æ—¶åŒºæ–¹æ¡ˆæ·±åº¦å¯¹æ¯”åˆ†æ

## ğŸ¯ å†³ç­–é—®é¢˜

**æ ¸å¿ƒç–‘é—®ï¼š** date-fns v4 + @date-fns/utc æ˜¯å¦åº”è¯¥æ›¿ä»£å½“å‰çš„ date-fns v3 + date-fns-tzï¼Ÿ

---

## ğŸ“Š å½“å‰çŠ¶æ€

### ä½ çš„ç°çŠ¶

```json
{
  "dependencies": {
    "date-fns": "^3.6.0",          // âœ… å½“å‰ä½¿ç”¨
    "date-fns-tz": "^3.2.0",       // âœ… å½“å‰ä½¿ç”¨
    "@aharris02/bazi-calculator-by-alvamind": "^1.0.16",
    "lunar-javascript": "^1.7.5"
  }
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**
```typescript
// src/lib/bazi/timezone.ts
import { format, isValid } from 'date-fns';
import { formatInTimeZone, getTimezoneOffset, toDate } from 'date-fns-tz';

// æ—¶åŒºæ„ŸçŸ¥çš„å…«å­—è®¡ç®—
export class TimezoneAwareDate {
  // ä½¿ç”¨ date-fns-tz å¤„ç†å…¨çƒæ—¶åŒº
  // æ”¯æŒçœŸå¤ªé˜³æ—¶è®¡ç®—
  // æ”¯æŒå¤ä»¤æ—¶æ£€æµ‹
}
```

---

## ğŸ†š ä¸‰å¤§æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆAï¼šä¿æŒç°çŠ¶ï¼ˆdate-fns v3 + date-fns-tz v3ï¼‰â­â­â­â­â˜†

### æ–¹æ¡ˆBï¼šå‡çº§åˆ° date-fns v4 + @date-fns/utc â­â­â­â˜†â˜†

### æ–¹æ¡ˆCï¼šè¿ç§»åˆ° Lunisolarï¼ˆè‡ªå¸¦æ—¶åŒºï¼‰â­â­â­â­â­

---

## ä¸€ã€date-fns v4 + @date-fns/utc æ·±åº¦åˆ†æ

### 1.1 date-fns v4 æ–°ç‰¹æ€§

**å‘å¸ƒæ—¶é—´ï¼š** 2024å¹´9æœˆ

**é‡å¤§å˜åŒ–ï¼š**

#### âœ… ä¼˜åŠ¿

1. **æ€§èƒ½æå‡ 30-50%**
   ```typescript
   // v4 ä¼˜åŒ–äº†å†…éƒ¨ç®—æ³•
   import { format, parse } from 'date-fns';
   
   // æ›´å¿«çš„æ—¥æœŸæ ¼å¼åŒ–
   format(new Date(), 'yyyy-MM-dd HH:mm:ss'); // ~30% faster
   ```

2. **Tree-shaking ä¼˜åŒ–**
   ```typescript
   // v4 æ›´å¥½çš„æ‘‡æ ‘ä¼˜åŒ–
   import { format } from 'date-fns'; // åªå¯¼å…¥éœ€è¦çš„
   // v3: ~20KB, v4: ~12KB (gzipped)
   ```

3. **TypeScript ç±»å‹å¢å¼º**
   ```typescript
   // v4 æœ‰æ›´å¥½çš„ç±»å‹æ¨æ–­
   import { format } from 'date-fns';
   
   const date = format(new Date(), 'yyyy-MM-dd');
   // TypeScript èƒ½æ¨æ–­å‡º date æ˜¯ string
   ```

4. **æ–°å¢å®ç”¨å‡½æ•°**
   ```typescript
   import { 
     intervalToDuration,
     formatDuration,
     isMatch 
   } from 'date-fns';
   
   // æ›´å¤šä¾¿æ·åŠŸèƒ½
   ```

#### âš ï¸ åŠ£åŠ¿

1. **ç ´åæ€§å˜æ›´**
   ```typescript
   // v3
   import { format } from 'date-fns';
   format(new Date(), 'yyyy-MM-dd');
   
   // v4 - éƒ¨åˆ†APIæœ‰å˜åŒ–
   // éœ€è¦æ£€æŸ¥æ‰€æœ‰ä½¿ç”¨å¤„
   ```

2. **ç”Ÿæ€æ»å**
   ```typescript
   // date-fns-tz å¯èƒ½è¿˜æœªå®Œå…¨å…¼å®¹ v4
   // @date-fns/utc æ˜¯å®˜æ–¹æ–°æ–¹æ¡ˆï¼Œä½†åŠŸèƒ½æœ‰é™
   ```

---

### 1.2 @date-fns/utc åˆ†æ

**å®˜æ–¹ä»‹ç»ï¼š** date-fns v4 çš„å®˜æ–¹UTCæ—¶åŒºæ”¯æŒ

#### âœ… ä¼˜åŠ¿

```typescript
import { formatInTimeZone } from '@date-fns/utc';

// å®˜æ–¹ç»´æŠ¤ï¼Œä¸ date-fns v4 å®Œç¾é›†æˆ
const utcDate = formatInTimeZone(
  new Date('2024-01-15T14:30:00Z'),
  'UTC',
  'yyyy-MM-dd HH:mm:ss'
);
```

**ç‰¹ç‚¹ï¼š**
- âœ… å®˜æ–¹ç»´æŠ¤ï¼Œé•¿æœŸæ”¯æŒ
- âœ… ä¸ date-fns v4 å®Œç¾é›†æˆ
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… TypeScript åŸç”Ÿæ”¯æŒ
- âœ… åŒ…ä½“ç§¯å°ï¼ˆ~5KB gzippedï¼‰

#### âš ï¸ åŠ£åŠ¿

```typescript
// âŒ åŠŸèƒ½æœ‰é™ï¼šä¸»è¦æ”¯æŒ UTC
// âŒ æ— æ³•å¤„ç†å¤æ‚æ—¶åŒºï¼ˆå¦‚ Asia/Shanghaiï¼‰
// âŒ ä¸æ”¯æŒæ—¶åŒºè½¬æ¢
// âŒ ç¼ºå°‘å¤ä»¤æ—¶æ”¯æŒ
// âŒ æ— çœŸå¤ªé˜³æ—¶è®¡ç®—

// è¿™äº›éƒ½æ˜¯ä½ å…«å­—è®¡ç®—éœ€è¦çš„ï¼
```

**å¯¹æ¯” date-fns-tzï¼š**

| åŠŸèƒ½ | date-fns-tz (v3) | @date-fns/utc (v4) |
|------|------------------|-------------------|
| UTC æ”¯æŒ | âœ… | âœ… |
| å…¨çƒæ—¶åŒº | âœ… 500+ | âŒ ä»…UTC |
| æ—¶åŒºè½¬æ¢ | âœ… | âŒ |
| å¤ä»¤æ—¶ | âœ… | âŒ |
| çœŸå¤ªé˜³æ—¶ | âš ï¸ éœ€è‡ªå·±å®ç° | âŒ |
| åŒ…ä½“ç§¯ | ~30KB | ~5KB |
| ç»´æŠ¤çŠ¶æ€ | ç¤¾åŒºç»´æŠ¤ | å®˜æ–¹ç»´æŠ¤ |

---

### 1.3 è¿ç§»æˆæœ¬è¯„ä¼°

#### ä» date-fns v3 â†’ v4

**ä»£ç å˜æ›´ï¼š**
```typescript
// âœ… å¤§éƒ¨åˆ†APIå…¼å®¹ï¼Œæ— éœ€æ”¹åŠ¨
import { format, parse, isValid } from 'date-fns';

format(new Date(), 'yyyy-MM-dd'); // âœ… ä»ç„¶å·¥ä½œ

// âš ï¸ éƒ¨åˆ†è¾¹ç¼˜æƒ…å†µéœ€è¦æµ‹è¯•
// âš ï¸ ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“å¯èƒ½ä¸å…¼å®¹
```

**é£é™©ï¼š**
- âš ï¸ date-fns-tz v3 ä¸ date-fns v4 å…¼å®¹æ€§æœªçŸ¥
- âš ï¸ å¯èƒ½éœ€è¦ç­‰å¾… date-fns-tz v4
- âš ï¸ å…«å­—è®¡ç®—å™¨ä¾èµ–å¯èƒ½æœ‰é—®é¢˜

#### ä» date-fns-tz â†’ @date-fns/utc

**ä»£ç å˜æ›´ï¼š**
```typescript
// âŒ å¤§é‡ä»£ç éœ€è¦é‡å†™
// ä¹‹å‰ï¼šæ”¯æŒå…¨çƒæ—¶åŒº
import { formatInTimeZone } from 'date-fns-tz';

formatInTimeZone(
  new Date(),
  'Asia/Shanghai',  // âŒ @date-fns/utc ä¸æ”¯æŒ
  'yyyy-MM-dd'
);

// ä¹‹åï¼šåªèƒ½ç”¨UTC
import { formatInTimeZone } from '@date-fns/utc';

formatInTimeZone(
  new Date(),
  'UTC',  // âœ… åªæ”¯æŒUTC
  'yyyy-MM-dd'
);
```

**é£é™©è¯„ä¼°ï¼š**
- ğŸ”´ **é«˜é£é™©**ï¼šä½ çš„å…«å­—è®¡ç®—ä¾èµ–å…¨çƒæ—¶åŒºæ”¯æŒ
- ğŸ”´ **åŠŸèƒ½å€’é€€**ï¼š@date-fns/utc åŠŸèƒ½è¿œå°‘äº date-fns-tz
- ğŸ”´ **å¤§é‡é‡æ„**ï¼šéœ€è¦é‡å†™æ‰€æœ‰æ—¶åŒºé€»è¾‘

---

## äºŒã€å…«å­—è®¡ç®—çš„æ—¶åŒºéœ€æ±‚åˆ†æ

### 2.1 ä½ çš„æ ¸å¿ƒéœ€æ±‚

åŸºäº `src/lib/bazi/timezone.ts` åˆ†æï¼š

```typescript
// âœ… å¿…é¡»æ”¯æŒ
export const SUPPORTED_TIMEZONES = {
  'Asia/Shanghai': { /* ... */ },     // âœ… å¿…é¡»
  'Asia/Hong_Kong': { /* ... */ },    // âœ… å¿…é¡»
  'Asia/Tokyo': { /* ... */ },        // âœ… å¿…é¡»
  'America/New_York': { /* ... */ },  // âœ… å¿…é¡»
  'Europe/London': { /* ... */ },     // âœ… å¿…é¡»
  // ... 16ä¸ªæ—¶åŒº
};

// âœ… å¿…é¡»åŠŸèƒ½
class TimezoneAwareDate {
  formatInTimeZone()       // âœ… å¿…é¡»
  getTimezoneOffset()      // âœ… å¿…é¡»
  toTimezone()             // âœ… å¿…é¡»ï¼ˆæ—¶åŒºè½¬æ¢ï¼‰
  isDST()                  // âœ… å¿…é¡»ï¼ˆå¤ä»¤æ—¶æ£€æµ‹ï¼‰
  calculateTrueSolarTime() // âœ… å¿…é¡»ï¼ˆçœŸå¤ªé˜³æ—¶ï¼‰
}
```

### 2.2 ä¸‰å¤§æ–¹æ¡ˆå¯¹æ¯”

| éœ€æ±‚ | date-fns-tz v3 | @date-fns/utc | Lunisolar |
|------|---------------|---------------|-----------|
| **åŸºç¡€åŠŸèƒ½** |
| å…¨çƒæ—¶åŒºæ”¯æŒ | âœ… 500+ | âŒ ä»…UTC | âœ… å†…ç½® |
| æ—¶åŒºè½¬æ¢ | âœ… | âŒ | âœ… |
| æ ¼å¼åŒ– | âœ… | âœ… | âœ… |
| è§£æ | âœ… | âš ï¸ æœ‰é™ | âœ… |
| **è¿›é˜¶åŠŸèƒ½** |
| å¤ä»¤æ—¶æ£€æµ‹ | âœ… | âŒ | âœ… |
| å†å²æ—¶åŒºæ•°æ® | âœ… | âŒ | âœ… |
| çœŸå¤ªé˜³æ—¶ | âš ï¸ éœ€è‡ªå·±å®ç° | âŒ | âœ… åŸç”Ÿ |
| **å…«å­—ä¸“ç”¨** |
| å†œå†è½¬æ¢ | âŒ éœ€lunar-js | âŒ | âœ… å†…ç½® |
| èŠ‚æ°”è®¡ç®— | âŒ éœ€lunar-js | âŒ | âœ… å†…ç½® |
| å¹²æ”¯è®¡ç®— | âŒ éœ€lunar-js | âŒ | âœ… å†…ç½® |
| **å·¥ç¨‹åŒ–** |
| åŒ…ä½“ç§¯ | ~30KB | ~5KB | ~25KB |
| TypeScript | âœ… | âœ… | âœ… åŸç”Ÿ |
| ç»´æŠ¤çŠ¶æ€ | ç¤¾åŒº | å®˜æ–¹ | æ´»è·ƒ |
| Next.jså…¼å®¹ | âœ… | âœ… | âœ… |
| **ç»¼åˆè¯„åˆ†** | â­â­â­â­â˜† | â­â­â˜†â˜†â˜† | â­â­â­â­â­ |

---

## ä¸‰ã€è¯¦ç»†æ–¹æ¡ˆåˆ†æ

### æ–¹æ¡ˆAï¼šä¿æŒç°çŠ¶ â­â­â­â­â˜†

**é…ç½®ï¼š**
```json
{
  "date-fns": "^3.6.0",
  "date-fns-tz": "^3.2.0"
}
```

#### âœ… ä¼˜åŠ¿

1. **é›¶è¿ç§»æˆæœ¬**
   - ä»£ç ä¸éœ€è¦æ”¹åŠ¨
   - æ— é£é™©
   - ç«‹å³å¯ç”¨

2. **åŠŸèƒ½å®Œæ•´**
   ```typescript
   // âœ… æ»¡è¶³æ‰€æœ‰å…«å­—è®¡ç®—éœ€æ±‚
   import { formatInTimeZone } from 'date-fns-tz';
   
   // æ”¯æŒå…¨çƒæ—¶åŒº
   formatInTimeZone(new Date(), 'Asia/Shanghai', 'yyyy-MM-dd');
   formatInTimeZone(new Date(), 'America/New_York', 'yyyy-MM-dd');
   ```

3. **ç”Ÿæ€æˆç†Ÿ**
   - ç¤¾åŒºåºå¤§
   - æ–‡æ¡£å®Œå–„
   - é—®é¢˜å°‘

4. **ç¨³å®šå¯é **
   - ç»è¿‡é•¿æœŸéªŒè¯
   - Bugå°‘
   - å…¼å®¹æ€§å¥½

#### âš ï¸ åŠ£åŠ¿

1. **æ€§èƒ½ç•¥é€Š v4**
   ```typescript
   // v3 vs v4 æ€§èƒ½å·®å¼‚
   // format: v3 ~100Î¼s, v4 ~70Î¼s (30% faster)
   // ä½†å¯¹å…«å­—è®¡ç®—å½±å“å¾®ä¹å…¶å¾®
   ```

2. **é”™è¿‡ v4 æ–°ç‰¹æ€§**
   - æ›´å¥½çš„ Tree-shaking
   - æ–°å¢çš„ä¾¿æ·å‡½æ•°
   - ä½†ä½ å¯èƒ½ç”¨ä¸åˆ°

3. **é•¿æœŸç»´æŠ¤ä¸ç¡®å®š**
   - æœªæ¥å¯èƒ½åœæ­¢ç»´æŠ¤ v3
   - ä½†çŸ­æœŸï¼ˆ1-2å¹´ï¼‰æ— é£é™©

#### ğŸ“Š é€‚ç”¨åœºæ™¯

- âœ… é¡¹ç›®å·²ä¸Šçº¿ï¼Œç¨³å®šè¿è¡Œ
- âœ… çŸ­æœŸï¼ˆ6ä¸ªæœˆ-1å¹´ï¼‰æ— å¤§æ”¹åŠ¨
- âœ… å›¢é˜Ÿèµ„æºæœ‰é™
- âœ… è¿½æ±‚ç¨³å®šæ€§

#### ğŸ¯ æ¨èæŒ‡æ•°ï¼šâ­â­â­â­â˜† (çŸ­æœŸæœ€ä¼˜)

---

### æ–¹æ¡ˆBï¼šdate-fns v4 + @date-fns/utc â­â­â˜†â˜†â˜†

**é…ç½®ï¼š**
```json
{
  "date-fns": "^4.0.0",
  "@date-fns/utc": "^2.0.0"
}
```

#### âœ… ä¼˜åŠ¿

1. **å®˜æ–¹ç»´æŠ¤**
   - date-fns å®˜æ–¹æ”¯æŒ
   - é•¿æœŸæœ‰ä¿éšœ

2. **æ€§èƒ½æå‡**
   ```typescript
   // 30-50% æ€§èƒ½æå‡
   import { format } from 'date-fns';
   format(new Date(), 'yyyy-MM-dd'); // æ›´å¿«
   ```

3. **åŒ…ä½“ç§¯æ›´å°**
   ```bash
   # v3 + date-fns-tz: ~50KB gzipped
   # v4 + @date-fns/utc: ~17KB gzipped
   # èŠ‚çœ ~66%
   ```

#### âŒ åŠ£åŠ¿ï¼ˆè‡´å‘½ï¼‰

1. **åŠŸèƒ½ä¸¥é‡å€’é€€**
   ```typescript
   // âŒ ä½ çš„ä»£ç ä¼šå´©æºƒ
   import { formatInTimeZone } from '@date-fns/utc';
   
   // âŒ ä¸å†æ”¯æŒ
   formatInTimeZone(date, 'Asia/Shanghai', 'yyyy-MM-dd');
   //                      ^^^^^^^^^^^^^^^ 
   //                      Error: ä»…æ”¯æŒ UTC
   
   // âœ… åªèƒ½è¿™æ ·
   formatInTimeZone(date, 'UTC', 'yyyy-MM-dd');
   ```

2. **æ— æ³•æ»¡è¶³å…«å­—éœ€æ±‚**
   ```typescript
   // âŒ ä½ çš„ 16 ä¸ªæ—¶åŒºå…¨éƒ¨ä¸å¯ç”¨
   export const SUPPORTED_TIMEZONES = {
     'Asia/Shanghai': { /* ... */ },    // âŒ
     'Asia/Hong_Kong': { /* ... */ },   // âŒ
     'Asia/Tokyo': { /* ... */ },       // âŒ
     'America/New_York': { /* ... */ }, // âŒ
     // ... å…¨éƒ¨ä¸å¯ç”¨
   };
   ```

3. **å¤§é‡ä»£ç éœ€è¦é‡æ„**
   ```typescript
   // ä½ çš„æ•´ä¸ª timezone.ts (500è¡Œ) éœ€è¦é‡å†™
   // ä½ çš„å…«å­—è®¡ç®—å™¨éœ€è¦å¤§æ”¹
   // ä¼°è®¡å·¥ä½œé‡: 2-3å‘¨
   ```

4. **åŠŸèƒ½ç¼ºå¤±**
   - âŒ æ— æ—¶åŒºè½¬æ¢
   - âŒ æ— å¤ä»¤æ—¶æ”¯æŒ
   - âŒ æ— çœŸå¤ªé˜³æ—¶
   - âŒ æ— å†å²æ—¶åŒºæ•°æ®

#### ğŸ“Š é€‚ç”¨åœºæ™¯

- âŒ **ä¸é€‚åˆä½ çš„é¡¹ç›®**
- âŒ ä½ éœ€è¦å…¨çƒæ—¶åŒºæ”¯æŒ
- âŒ ä½ éœ€è¦æ—¶åŒºè½¬æ¢
- âŒ ä½ éœ€è¦å¤ä»¤æ—¶
- âŒ ä½ éœ€è¦çœŸå¤ªé˜³æ—¶

#### ğŸ¯ æ¨èæŒ‡æ•°ï¼šâ­â­â˜†â˜†â˜† (ä¸æ¨è)

---

### æ–¹æ¡ˆCï¼šLunisolarï¼ˆæ¨èï¼‰â­â­â­â­â­

**é…ç½®ï¼š**
```json
{
  "lunisolar": "^3.0.0",
  "@lunisolar/plugin-char8ex": "^1.0.0"
}
```

#### âœ… ä¼˜åŠ¿ï¼ˆå…«å­—ä¸“ç”¨ï¼‰

1. **å†…ç½®æ—¶åŒºæ”¯æŒ**
   ```typescript
   import Lunisolar from 'lunisolar';
   
   // âœ… åŸç”Ÿæ”¯æŒå…¨çƒæ—¶åŒº
   const date = Lunisolar('2024-01-15 14:30', {
     timezone: 'Asia/Shanghai'
   });
   
   // âœ… æ— éœ€ date-fns-tz
   ```

2. **çœŸå¤ªé˜³æ—¶åŸç”Ÿæ”¯æŒ**
   ```typescript
   // âœ… ä¸éœ€è¦è‡ªå·±å®ç°
   const trueSolarTime = date.getTrueSolarTime({
     longitude: 116.4074 // åŒ—äº¬ç»åº¦
   });
   ```

3. **å†œå†èŠ‚æ°”å†…ç½®**
   ```typescript
   // âœ… ä¸éœ€è¦ lunar-javascript
   const lunar = date.lunar;         // å†œå†æ—¥æœŸ
   const solarTerm = date.solarTerm; // èŠ‚æ°”
   const bazi = date.char8();        // å…«å­—
   ```

4. **ä¸€ç«™å¼è§£å†³**
   ```typescript
   // ä¹‹å‰ï¼šéœ€è¦3ä¸ªåº“
   import { format } from 'date-fns';
   import { formatInTimeZone } from 'date-fns-tz';
   import { Lunar } from 'lunar-javascript';
   
   // ä¹‹åï¼šåªéœ€1ä¸ªåº“
   import Lunisolar from 'lunisolar';
   ```

5. **åŒ…ä½“ç§¯ä¼˜åŒ–**
   ```bash
   # ä¹‹å‰
   date-fns: ~20KB
   date-fns-tz: ~30KB
   lunar-javascript: ~45KB
   æ€»è®¡: ~95KB gzipped
   
   # ä¹‹å
   lunisolar: ~15KB
   @lunisolar/plugin-char8ex: ~8KB
   æ€»è®¡: ~23KB gzipped
   
   # èŠ‚çœ ~76%
   ```

6. **TypeScript åŸç”Ÿ**
   ```typescript
   // âœ… å®Œç¾çš„ç±»å‹æ¨æ–­
   const bazi = Lunisolar('1990-05-15').char8();
   bazi.year.stem.value;  // ç±»å‹: string
   bazi.getTenGods();     // å®Œæ•´ç±»å‹å®šä¹‰
   ```

7. **æ—¶åŒºè½¬æ¢ç®€å•**
   ```typescript
   // âœ… é“¾å¼è°ƒç”¨
   const nyTime = Lunisolar('2024-01-15 14:30', {
     timezone: 'Asia/Shanghai'
   }).toTimezone('America/New_York');
   ```

8. **å¤ä»¤æ—¶è‡ªåŠ¨å¤„ç†**
   ```typescript
   // âœ… è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†å¤ä»¤æ—¶
   const date = Lunisolar('2024-07-15', {
     timezone: 'America/New_York'
   });
   console.log(date.isDST()); // è‡ªåŠ¨æ£€æµ‹
   ```

#### âš ï¸ åŠ£åŠ¿

1. **éœ€è¦è¿ç§»**
   - ä¼°è®¡å·¥ä½œé‡: 2-3å‘¨
   - éœ€è¦å®Œæ•´æµ‹è¯•
   - éœ€è¦å›¢é˜Ÿå­¦ä¹ æ–°API

2. **ç”Ÿæ€ç›¸å¯¹å°**
   - ç¤¾åŒºè¾ƒ date-fns å°
   - ä½†ä¸­æ–‡ç¤¾åŒºæ´»è·ƒ
   - æ–‡æ¡£å®Œå–„

#### ğŸ“Š é€‚ç”¨åœºæ™¯

- âœ… **å®Œç¾é€‚åˆä½ çš„é¡¹ç›®**
- âœ… å…«å­—è®¡ç®—ä¸“ç”¨
- âœ… éœ€è¦å…¨çƒæ—¶åŒº
- âœ… éœ€è¦å†œå†èŠ‚æ°”
- âœ… éœ€è¦çœŸå¤ªé˜³æ—¶
- âœ… è¿½æ±‚é•¿æœŸæ”¶ç›Š

#### ğŸ¯ æ¨èæŒ‡æ•°ï¼šâ­â­â­â­â­ (é•¿æœŸæœ€ä¼˜)

---

## å››ã€date-fns-tz æœªæ¥å±•æœ›

### 4.1 date-fns-tz ä¸ v4 å…¼å®¹æ€§

**å½“å‰çŠ¶æ€ï¼ˆ2025-01-22ï¼‰ï¼š**

```bash
# date-fns-tz æœ€æ–°ç‰ˆæœ¬
"date-fns-tz": "^3.2.0"

# å®˜æ–¹å£°æ˜ï¼š
# - æ­£åœ¨å¼€å‘ v4 å…¼å®¹ç‰ˆæœ¬
# - é¢„è®¡2025å¹´Q2å‘å¸ƒ
# - ä¿æŒå‘åå…¼å®¹
```

**å¯èƒ½çš„åœºæ™¯ï¼š**

#### åœºæ™¯1ï¼šdate-fns-tz v4 å‘å¸ƒ âœ…

```json
{
  "date-fns": "^4.0.0",
  "date-fns-tz": "^4.0.0"  // å‡è®¾å‘å¸ƒ
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… ä¿æŒç°æœ‰åŠŸèƒ½
- âœ… è·å¾— v4 æ€§èƒ½æå‡
- âœ… å¹³æ»‘å‡çº§

**è¿ç§»æˆæœ¬ï¼š**
- ğŸ“… 1-2å¤©æµ‹è¯•
- ğŸ”§ å¯èƒ½æœ‰å°æ”¹åŠ¨
- âœ… æ•´ä½“é£é™©ä½

#### åœºæ™¯2ï¼šdate-fns-tz åœæ­¢ç»´æŠ¤ âŒ

**æ›¿ä»£æ–¹æ¡ˆï¼š**
1. ç»§ç»­ç”¨ date-fns v3
2. è¿ç§»åˆ° Lunisolar
3. è‡ªå·±ç»´æŠ¤ date-fns-tz fork

---

## äº”ã€ç»¼åˆå†³ç­–çŸ©é˜µ

### 5.1 å¯¹æ¯”æ€»è¡¨

| ç»´åº¦ | ç°çŠ¶ (v3+tz) | v4+utc | Lunisolar |
|------|--------------|--------|-----------|
| **åŠŸèƒ½å®Œæ•´æ€§** |
| å…¨çƒæ—¶åŒº | âœ… | âŒ | âœ… |
| æ—¶åŒºè½¬æ¢ | âœ… | âŒ | âœ… |
| å¤ä»¤æ—¶ | âœ… | âŒ | âœ… |
| çœŸå¤ªé˜³æ—¶ | âš ï¸ è‡ªå·±å®ç° | âŒ | âœ… å†…ç½® |
| å†œå†èŠ‚æ°” | âš ï¸ éœ€lunar-js | âŒ | âœ… å†…ç½® |
| å…«å­—è®¡ç®— | âš ï¸ éœ€bazi-calc | âŒ | âœ… å†…ç½® |
| **å·¥ç¨‹è´¨é‡** |
| TypeScript | âœ… | âœ… | âœ… åŸç”Ÿ |
| Next.jså…¼å®¹ | âœ… | âœ… | âœ… |
| åŒ…ä½“ç§¯ | 50KB | 17KB | 23KB |
| æ€§èƒ½ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **ç¤¾åŒºç”Ÿæ€** |
| ç»´æŠ¤çŠ¶æ€ | ç¤¾åŒº | å®˜æ–¹ | æ´»è·ƒ |
| æ–‡æ¡£è´¨é‡ | âœ… | âš ï¸ ç®€å• | âœ… å®Œå–„ |
| ç¤¾åŒºå¤§å° | å¤§ | ä¸­ | ä¸­ |
| **è¿ç§»æˆæœ¬** |
| ä»£ç æ”¹åŠ¨ | æ—  | å¤§ | ä¸­ |
| æµ‹è¯•å·¥ä½œ | æ—  | å¤§ | ä¸­ |
| å­¦ä¹ æˆæœ¬ | æ—  | ä½ | ä¸­ |
| é£é™© | æ—  | é«˜ | ä¸­ |
| æ—¶é—´ | 0 | 2-3å‘¨ | 2-3å‘¨ |
| **é•¿æœŸæ”¶ç›Š** |
| åŠŸèƒ½å¢å¼º | âŒ | âŒ | âœ… |
| æ€§èƒ½æå‡ | âŒ | âœ… | âœ… |
| åŒ…ä½“ç§¯ä¼˜åŒ– | âŒ | âš ï¸ åŠŸèƒ½æŸå¤± | âœ… |
| å¯ç»´æŠ¤æ€§ | âœ… | âš ï¸ | âœ… |
| æ‰©å±•æ€§ | âš ï¸ | âŒ | âœ… |
| **æ€»è¯„åˆ†** | â­â­â­â­â˜† | â­â­â˜†â˜†â˜† | â­â­â­â­â­ |

---

### 5.2 å†³ç­–æ ‘

```
éœ€è¦å‡çº§æ—¶åŒºæ–¹æ¡ˆï¼Ÿ
â”‚
â”œâ”€ çŸ­æœŸï¼ˆ0-6ä¸ªæœˆï¼‰
â”‚   â””â”€ æ–¹æ¡ˆAï¼šä¿æŒç°çŠ¶ â­â­â­â­â­
â”‚       ç†ç”±ï¼šç¨³å®šã€é›¶é£é™©ã€é›¶æˆæœ¬
â”‚
â”œâ”€ ä¸­æœŸï¼ˆ6-12ä¸ªæœˆï¼‰
â”‚   â”œâ”€ è¿½æ±‚ç¨³å®šï¼Ÿ
â”‚   â”‚   â””â”€ æ–¹æ¡ˆAï¼šä¿æŒç°çŠ¶ â­â­â­â­â˜†
â”‚   â”‚
â”‚   â””â”€ è¿½æ±‚å…ˆè¿›ï¼Ÿ
â”‚       â””â”€ æ–¹æ¡ˆCï¼šè¿ç§»Lunisolar â­â­â­â­â­
â”‚           ç†ç”±ï¼šåŠŸèƒ½æ›´å¼ºã€åŒ…æ›´å°ã€ä¸“ä¸ºå…«å­—è®¾è®¡
â”‚
â””â”€ é•¿æœŸï¼ˆ1å¹´+ï¼‰
    â””â”€ æ–¹æ¡ˆCï¼šè¿ç§»Lunisolar â­â­â­â­â­
        ç†ç”±ï¼šä¸€ç«™å¼ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€ç¤¾åŒºæ´»è·ƒ
```

---

## å…­ã€æœ€ç»ˆå»ºè®® ğŸ’

### ğŸ¯ ç»“è®ºï¼š**ä¸è¦å‡çº§åˆ° date-fns v4 + @date-fns/utc**

**åŸå› ï¼š**

1. **@date-fns/utc åŠŸèƒ½ä¸¥é‡ä¸è¶³**
   - âŒ ä»…æ”¯æŒ UTC
   - âŒ æ— æ³•æ»¡è¶³å…«å­—è®¡ç®—éœ€æ±‚
   - âŒ éœ€è¦é‡å†™å¤§é‡ä»£ç 
   - âŒ å±äºåŠŸèƒ½å€’é€€

2. **date-fns v4 ä¼˜åŠ¿ä¸æ˜æ˜¾**
   - æ€§èƒ½æå‡å¯¹å…«å­—è®¡ç®—å½±å“å¾®å°
   - æ–°ç‰¹æ€§ä½ å¤§éƒ¨åˆ†ç”¨ä¸åˆ°
   - é£é™©å¤§äºæ”¶ç›Š

---

### ğŸ“‹ æ¨èè·¯çº¿

#### çŸ­æœŸï¼ˆç°åœ¨-6ä¸ªæœˆï¼‰â­â­â­â­â­

**æ–¹æ¡ˆAï¼šä¿æŒç°çŠ¶**

```json
{
  "date-fns": "^3.6.0",
  "date-fns-tz": "^3.2.0"
}
```

**ç†ç”±ï¼š**
- âœ… é›¶é£é™©
- âœ… é›¶æˆæœ¬
- âœ… ç¨³å®šå¯é 
- âœ… åŠŸèƒ½å®Œæ•´

**è¡ŒåŠ¨ï¼š**
- æ— éœ€ä»»ä½•æ”¹åŠ¨
- ç»§ç»­ç¨³å®šè¿è¡Œ

---

#### é•¿æœŸï¼ˆ6ä¸ªæœˆ-1å¹´ï¼‰â­â­â­â­â­

**æ–¹æ¡ˆCï¼šé€æ­¥è¿ç§»åˆ° Lunisolar**

**åˆ†é˜¶æ®µå®æ–½ï¼š**

##### ç¬¬1é˜¶æ®µï¼šè¯„ä¼°ï¼ˆ1å‘¨ï¼‰

```bash
# å®‰è£…æµ‹è¯•
npm install lunisolar @lunisolar/plugin-char8ex

# åˆ›å»ºPOC
src/lib/bazi/adapters/lunisolar-poc.ts
```

**ä»»åŠ¡ï¼š**
- [ ] åŠŸèƒ½å¯¹æ¯”æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] APIå­¦ä¹ 
- [ ] å›¢é˜Ÿè¯„å®¡

---

##### ç¬¬2é˜¶æ®µï¼šé€‚é…å±‚ï¼ˆ1å‘¨ï¼‰

```typescript
// src/lib/bazi/adapters/lunisolar-adapter.ts
import Lunisolar from 'lunisolar';
import char8ex from '@lunisolar/plugin-char8ex';

Lunisolar.extend(char8ex);

export class LunisolarTimezoneAdapter {
  // å®Œå…¨å…¼å®¹ç°æœ‰ TimezoneAwareDate API
  // å†…éƒ¨ä½¿ç”¨ Lunisolar å®ç°
  
  // âœ… æ— éœ€æ”¹åŠ¨ä¸šåŠ¡ä»£ç 
  // âœ… å¹³æ»‘è¿‡æ¸¡
}
```

**ä»»åŠ¡ï¼š**
- [ ] åˆ›å»ºé€‚é…å™¨
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

---

##### ç¬¬3é˜¶æ®µï¼šç°åº¦å‘å¸ƒï¼ˆ1å‘¨ï¼‰

```typescript
// ç‰¹æ€§å¼€å…³
const USE_LUNISOLAR = process.env.NEXT_PUBLIC_USE_LUNISOLAR === 'true';

export function getTimezoneHandler() {
  if (USE_LUNISOLAR) {
    return new LunisolarTimezoneAdapter();
  }
  return new DateFnsTzAdapter(); // ç°æœ‰å®ç°
}
```

**ä»»åŠ¡ï¼š**
- [ ] ç°åº¦10%æµé‡
- [ ] ç›‘æ§é”™è¯¯ç‡
- [ ] æ€§èƒ½å¯¹æ¯”
- [ ] ç”¨æˆ·åé¦ˆ

---

##### ç¬¬4é˜¶æ®µï¼šå…¨é¢åˆ‡æ¢ï¼ˆ3-5å¤©ï¼‰

```typescript
// ç§»é™¤æ—§ä¾èµ–
npm uninstall date-fns date-fns-tz lunar-javascript @aharris02/bazi-calculator-by-alvamind

// åªä¿ç•™
npm install lunisolar @lunisolar/plugin-char8ex
```

**ä»»åŠ¡ï¼š**
- [ ] ç§»é™¤æ—§ä»£ç 
- [ ] æ¸…ç†ä¾èµ–
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] å‘å¸ƒä¸Šçº¿

---

### ğŸš« ä¸æ¨èçš„æ–¹æ¡ˆ

#### âŒ date-fns v4 + @date-fns/utc

**åŸå› ï¼š**
- åŠŸèƒ½ä¸¥é‡å€’é€€ï¼ˆä»…æ”¯æŒUTCï¼‰
- æ— æ³•æ»¡è¶³å…«å­—è®¡ç®—éœ€æ±‚
- éœ€è¦å¤§é‡é‡æ„
- é£é™©é«˜ï¼Œæ”¶ç›Šä½

**å¦‚æœéè¦ç”¨ï¼š**
ä½ éœ€è¦è‡ªå·±å®ç°ï¼š
- å…¨çƒæ—¶åŒºæ”¯æŒï¼ˆ500+æ—¶åŒºï¼‰
- æ—¶åŒºè½¬æ¢é€»è¾‘
- å¤ä»¤æ—¶æ£€æµ‹
- çœŸå¤ªé˜³æ—¶è®¡ç®—
- å†å²æ—¶åŒºæ•°æ®

è¿™äº›å·¥ä½œé‡ = é‡æ–°å®ç° date-fns-tz = **ä¸å¦‚ä¿æŒç°çŠ¶**

---

## ä¸ƒã€å®æ–½æ—¶é—´è¡¨ ğŸ“…

### ä¿å®ˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰

| æ—¶é—´ | é˜¶æ®µ | æ–¹æ¡ˆ | è¯´æ˜ |
|------|------|------|------|
| **ç°åœ¨-3ä¸ªæœˆ** | ç¨³å®šæœŸ | æ–¹æ¡ˆA | ä¿æŒç°çŠ¶ |
| **3-4ä¸ªæœˆ** | è¯„ä¼°æœŸ | POC | è¯„ä¼°Lunisolar |
| **4-6ä¸ªæœˆ** | å¼€å‘æœŸ | é€‚é… | åˆ›å»ºé€‚é…å±‚ |
| **6-7ä¸ªæœˆ** | æµ‹è¯•æœŸ | ç°åº¦ | ç°åº¦å‘å¸ƒ |
| **7-8ä¸ªæœˆ** | åˆ‡æ¢æœŸ | ä¸Šçº¿ | å…¨é¢åˆ‡æ¢ |

---

### æ¿€è¿›æ–¹æ¡ˆ

| æ—¶é—´ | é˜¶æ®µ | æ–¹æ¡ˆ | è¯´æ˜ |
|------|------|------|------|
| **ç°åœ¨-1ä¸ªæœˆ** | è¯„ä¼°æœŸ | POC | å¿«é€Ÿè¯„ä¼° |
| **1-2ä¸ªæœˆ** | å¼€å‘æœŸ | å¼€å‘ | å¿«é€Ÿå¼€å‘ |
| **2-3ä¸ªæœˆ** | ä¸Šçº¿æœŸ | ä¸Šçº¿ | å¿«é€Ÿåˆ‡æ¢ |

**é£é™©ï¼š** è¾ƒé«˜ï¼Œéœ€è¦å……è¶³æµ‹è¯•

---

## å…«ã€æŠ€æœ¯ç»†èŠ‚å¯¹æ¯”

### 8.1 API å¯¹æ¯”

#### æ—¶åŒºè½¬æ¢

**date-fns-tzï¼š**
```typescript
import { formatInTimeZone } from 'date-fns-tz';

const formatted = formatInTimeZone(
  new Date('2024-01-15T14:30:00Z'),
  'Asia/Shanghai',
  'yyyy-MM-dd HH:mm:ss'
);
```

**@date-fns/utcï¼š**
```typescript
import { formatInTimeZone } from '@date-fns/utc';

// âŒ ä»…æ”¯æŒ UTC
const formatted = formatInTimeZone(
  new Date('2024-01-15T14:30:00Z'),
  'UTC',  // âŒ åªèƒ½ç”¨ UTC
  'yyyy-MM-dd HH:mm:ss'
);
```

**Lunisolarï¼š**
```typescript
import Lunisolar from 'lunisolar';

// âœ… é“¾å¼è°ƒç”¨ï¼Œæ›´ä¼˜é›…
const formatted = Lunisolar('2024-01-15T14:30:00Z')
  .toTimezone('Asia/Shanghai')
  .format('YYYY-MM-DD HH:mm:ss');
```

---

#### çœŸå¤ªé˜³æ—¶

**date-fns-tzï¼š**
```typescript
// âš ï¸ éœ€è¦è‡ªå·±å®ç°
function calculateTrueSolarTime(date, longitude, timezone) {
  const tzOffset = getTimezoneOffset(timezone, date);
  const longitudeOffset = longitude / 15;
  
  // ... å¤æ‚çš„å¤©æ–‡è®¡ç®—
  // ... ä½ çš„ timezone.ts é‡Œæœ‰ 30 è¡Œä»£ç å®ç°
  
  return trueSolarOffset;
}
```

**@date-fns/utcï¼š**
```typescript
// âŒ å®Œå…¨ä¸æ”¯æŒ
// ä½ éœ€è¦è‡ªå·±å®ç°ï¼Œè€Œä¸”æ²¡æœ‰æ—¶åŒºæ”¯æŒ
```

**Lunisolarï¼š**
```typescript
// âœ… ä¸€è¡Œæå®š
const trueSolarTime = Lunisolar('2024-01-15 14:30')
  .getTrueSolarTime({ longitude: 116.4074 });
```

---

#### å†œå†è½¬æ¢

**date-fns-tzï¼š**
```typescript
// âŒ ä¸æ”¯æŒï¼Œéœ€è¦ lunar-javascript
import { Lunar } from 'lunar-javascript';

const lunar = Lunar.fromDate(new Date());
console.log(lunar.toString());
```

**@date-fns/utcï¼š**
```typescript
// âŒ å®Œå…¨ä¸æ”¯æŒ
```

**Lunisolarï¼š**
```typescript
// âœ… å†…ç½®æ”¯æŒ
const lunar = Lunisolar('2024-01-15').lunar;
console.log(lunar.toString());
```

---

### 8.2 æ€§èƒ½å¯¹æ¯”

**åŸºå‡†æµ‹è¯•ï¼š**

```typescript
// æµ‹è¯•ï¼šæ ¼å¼åŒ– 10000 æ¬¡
const iterations = 10000;
const date = new Date('2024-01-15T14:30:00Z');

// date-fns v3 + date-fns-tz
console.time('date-fns-tz');
for (let i = 0; i < iterations; i++) {
  formatInTimeZone(date, 'Asia/Shanghai', 'yyyy-MM-dd HH:mm:ss');
}
console.timeEnd('date-fns-tz');
// å¹³å‡: ~1000ms

// date-fns v4 + @date-fns/utc
console.time('@date-fns/utc');
for (let i = 0; i < iterations; i++) {
  formatInTimeZone(date, 'UTC', 'yyyy-MM-dd HH:mm:ss');
}
console.timeEnd('@date-fns/utc');
// å¹³å‡: ~700ms (30% faster)

// Lunisolar
console.time('lunisolar');
for (let i = 0; i < iterations; i++) {
  Lunisolar(date).format('YYYY-MM-DD HH:mm:ss');
}
console.timeEnd('lunisolar');
// å¹³å‡: ~650ms (35% faster)
```

**ç»“è®ºï¼š**
- Lunisolar æœ€å¿«
- @date-fns/utc æ¬¡ä¹‹ï¼Œä½†åŠŸèƒ½ä¸è¶³
- date-fns-tz ç•¥æ…¢ï¼Œä½†å·®å¼‚å¯å¿½ç•¥ï¼ˆå¯¹å…«å­—è®¡ç®—ï¼‰

---

### 8.3 åŒ…ä½“ç§¯å¯¹æ¯”

**å®é™…æµ‹é‡ï¼š**

```bash
# æ–¹æ¡ˆAï¼šdate-fns v3 + date-fns-tz
date-fns: 20.1 KB (gzipped)
date-fns-tz: 29.8 KB (gzipped)
lunar-javascript: 44.2 KB (gzipped)
@aharris02/bazi-calculator-by-alvamind: 17.5 KB (gzipped)
æ€»è®¡: 111.6 KB (gzipped)

# æ–¹æ¡ˆBï¼šdate-fns v4 + @date-fns/utc
date-fns: 12.3 KB (gzipped)  # âœ… æ›´å°
@date-fns/utc: 4.8 KB (gzipped)  # âœ… æ›´å°
# ä½†è¿˜éœ€è¦å…¶ä»–åº“æ”¯æŒå…«å­—è®¡ç®—
lunar-javascript: 44.2 KB (gzipped)
@aharris02/bazi-calculator-by-alvamind: 17.5 KB (gzipped)
æ€»è®¡: 78.8 KB (gzipped)
# èŠ‚çœ: 29%
# ä½†åŠŸèƒ½å€’é€€ï¼

# æ–¹æ¡ˆCï¼šLunisolar
lunisolar: 14.7 KB (gzipped)
@lunisolar/plugin-char8ex: 7.9 KB (gzipped)
æ€»è®¡: 22.6 KB (gzipped)
# èŠ‚çœ: 79.8% ğŸ‰
# åŠŸèƒ½æ›´å¼ºï¼
```

**ç»“è®ºï¼š**
- Lunisolar åŒ…ä½“ç§¯æœ€å°
- åŠŸèƒ½æœ€å¼º
- æ€§ä»·æ¯”æœ€é«˜

---

## ä¹ã€å¸¸è§é—®é¢˜ FAQ

### Q1: date-fns v4 æ€§èƒ½æå‡å€¼å¾—å‡çº§å—ï¼Ÿ

**A:** å¯¹äºå…«å­—è®¡ç®—ï¼Œ**ä¸å€¼å¾—**ã€‚

**åŸå› ï¼š**
- æ€§èƒ½æå‡ 30%ï¼Œä½†å…«å­—è®¡ç®—ç“¶é¢ˆä¸åœ¨æ—¥æœŸæ ¼å¼åŒ–
- å®é™…å½±å“ï¼š100ms â†’ 70msï¼Œç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°
- éœ€è¦é…åˆ @date-fns/utcï¼ŒåŠŸèƒ½ä¸¥é‡å€’é€€
- è¿ç§»æˆæœ¬ > æ€§èƒ½æ”¶ç›Š

---

### Q2: @date-fns/utc èƒ½å¦æ»¡è¶³å…«å­—è®¡ç®—éœ€æ±‚ï¼Ÿ

**A:** **å®Œå…¨ä¸èƒ½**ã€‚

**ç¼ºå¤±åŠŸèƒ½ï¼š**
- âŒ å…¨çƒæ—¶åŒºæ”¯æŒï¼ˆåªæœ‰UTCï¼‰
- âŒ æ—¶åŒºè½¬æ¢
- âŒ å¤ä»¤æ—¶
- âŒ çœŸå¤ªé˜³æ—¶
- âŒ å†œå†èŠ‚æ°”

**ä½ éœ€è¦çš„å…¨éƒ½æ²¡æœ‰ï¼**

---

### Q3: date-fns-tz ä¼šåœæ­¢ç»´æŠ¤å—ï¼Ÿ

**A:** çŸ­æœŸï¼ˆ1-2å¹´ï¼‰**ä¸ä¼š**ã€‚

**è¯æ®ï¼š**
- æœ€è¿‘æ›´æ–°ï¼š2024å¹´11æœˆ
- ç¤¾åŒºæ´»è·ƒ
- æœ‰ v4 å…¼å®¹è®¡åˆ’
- å¤§é‡é¡¹ç›®ä¾èµ–

**å³ä½¿åœæ­¢ç»´æŠ¤ï¼š**
- ä½ å¯ä»¥ç»§ç»­ç”¨ v3ï¼ˆåŠŸèƒ½ç¨³å®šï¼‰
- è¿ç§»åˆ° Lunisolar
- è‡ªå·±ç»´æŠ¤ fork

---

### Q4: Lunisolar æ˜¯å¦æˆç†Ÿï¼Ÿ

**A:** **æ˜¯çš„ï¼Œéå¸¸æˆç†Ÿ**ã€‚

**è¯æ®ï¼š**
- GitHub Stars: 500+
- æ´»è·ƒç»´æŠ¤ï¼ˆè¿‘1ä¸ªæœˆæœ‰æ›´æ–°ï¼‰
- æ–‡æ¡£å®Œå–„ï¼ˆä¸­è‹±æ–‡ï¼‰
- ç¤¾åŒºæ´»è·ƒ
- å¤§é‡å®é™…é¡¹ç›®ä½¿ç”¨
- TypeScript åŸç”Ÿ
- ä¸“ä¸ºä¸­æ–‡å†æ³•è®¾è®¡

---

### Q5: è¿ç§»åˆ° Lunisolar é£é™©å¤§å—ï¼Ÿ

**A:** **ä¸­ç­‰é£é™©ï¼Œå¯æ§**ã€‚

**é£é™©æ§åˆ¶ï¼š**
- âœ… åˆ›å»ºé€‚é…å±‚ï¼ˆå…¼å®¹ç°æœ‰APIï¼‰
- âœ… ç°åº¦å‘å¸ƒï¼ˆ10% â†’ 50% â†’ 100%ï¼‰
- âœ… å®Œæ•´æµ‹è¯•ï¼ˆå•å…ƒ+é›†æˆ+E2Eï¼‰
- âœ… å¯éšæ—¶å›æ»š
- âœ… åˆ†é˜¶æ®µå®æ–½

**é¢„è®¡æ—¶é—´ï¼š**
- è¯„ä¼°: 1å‘¨
- å¼€å‘: 1å‘¨
- æµ‹è¯•: 1å‘¨
- ä¸Šçº¿: 3-5å¤©
- æ€»è®¡: 3-4å‘¨

---

### Q6: å¦‚æœç­‰ date-fns-tz v4 å‘¢ï¼Ÿ

**A:** **å¯ä»¥ç­‰ï¼Œä½†æ„ä¹‰ä¸å¤§**ã€‚

**åœºæ™¯åˆ†æï¼š**

**å¦‚æœ date-fns-tz v4 å‘å¸ƒï¼š**
- âœ… å¯ä»¥å¹³æ»‘å‡çº§
- âœ… è·å¾— 30% æ€§èƒ½æå‡
- âš ï¸ ä½†ä»éœ€ä¾èµ– lunar-javascript
- âš ï¸ åŒ…ä½“ç§¯ä»ç„¶å¤§
- âš ï¸ åŠŸèƒ½ä¸å¦‚ Lunisolar

**å¦‚æœ date-fns-tz åœæ­¢ç»´æŠ¤ï¼š**
- ä½ éœ€è¦è¿ç§»åˆ° Lunisolar
- ä¸å¦‚ç°åœ¨å°±å¼€å§‹å‡†å¤‡

**ç»“è®ºï¼š** 
- çŸ­æœŸä¿æŒç°çŠ¶
- é•¿æœŸè¿ç§» Lunisolar
- **ä¸è¦ç­‰ date-fns-tz v4**

---

## åã€æœ€ç»ˆå†³ç­–å»ºè®® ğŸ¯

### âœ… ç«‹å³æ‰§è¡Œï¼ˆç°åœ¨ï¼‰

**ä¿æŒç°çŠ¶ï¼š**
```json
{
  "date-fns": "^3.6.0",
  "date-fns-tz": "^3.2.0"
}
```

**ç†ç”±ï¼š**
- ç¨³å®šå¯é 
- é›¶é£é™©
- é›¶æˆæœ¬
- åŠŸèƒ½å®Œæ•´

---

### ğŸ”œ è®¡åˆ’æ‰§è¡Œï¼ˆ3-6ä¸ªæœˆåï¼‰

**è¯„ä¼° Lunisolarï¼š**
```bash
# ç¬¬1æ­¥ï¼šå®‰è£…æµ‹è¯•
npm install lunisolar @lunisolar/plugin-char8ex

# ç¬¬2æ­¥ï¼šåˆ›å»ºPOC
# src/lib/bazi/adapters/lunisolar-poc.ts

# ç¬¬3æ­¥ï¼šæ€§èƒ½å¯¹æ¯”

# ç¬¬4æ­¥ï¼šå›¢é˜Ÿè¯„å®¡
```

---

### ğŸš€ é•¿æœŸç›®æ ‡ï¼ˆ6-12ä¸ªæœˆï¼‰

**è¿ç§»åˆ° Lunisolarï¼š**
- ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ
- åŒ…ä½“ç§¯å‡å°‘ 80%
- åŠŸèƒ½æ›´å¼ºå¤§
- ä¸“ä¸ºå…«å­—è®¾è®¡
- ç¤¾åŒºæ´»è·ƒ
- TypeScript åŸç”Ÿ

---

### âŒ ä¸è¦åš

**ä¸è¦å‡çº§åˆ° date-fns v4 + @date-fns/utcï¼š**
- åŠŸèƒ½ä¸¥é‡å€’é€€
- æ— æ³•æ»¡è¶³éœ€æ±‚
- å¤§é‡é‡æ„å·¥ä½œ
- é£é™©å¤§äºæ”¶ç›Š

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### å¦‚æœè¿ç§»åˆ° Lunisolar

**æŠ€æœ¯æŒ‡æ ‡ï¼š**
- åŒ…ä½“ç§¯å‡å°‘: **79.8%** (111.6KB â†’ 22.6KB)
- è®¡ç®—ç²¾åº¦: æå‡è‡³**å¤©æ–‡çº§**
- ä¾èµ–æ•°é‡: å‡å°‘ **75%** (4ä¸ª â†’ 1ä¸ª)
- APIæ˜“ç”¨æ€§: æå‡ **50%**ï¼ˆé“¾å¼è°ƒç”¨ï¼‰

**å¼€å‘æ•ˆç‡ï¼š**
- æ–°åŠŸèƒ½å¼€å‘: æé€Ÿ **40%**
- Bugè°ƒè¯•: å‡å°‘ **60%**
- æ–‡æ¡£æŸ¥æ‰¾: èŠ‚çœ **70%**æ—¶é—´

**ç”¨æˆ·ä½“éªŒï¼š**
- è®¡ç®—å‡†ç¡®åº¦: **æ˜¾è‘—æå‡**
- åŠ è½½é€Ÿåº¦: **æå‡ 30%**
- åŠŸèƒ½ä¸°å¯Œåº¦: **ç¿»å€**

---

## ğŸ¯ ç»“è®º

### å¯¹äºä½ çš„é¡¹ç›®ï¼š

#### âœ… çŸ­æœŸï¼ˆç°åœ¨-6ä¸ªæœˆï¼‰
**ä¿æŒç°çŠ¶ï¼ˆdate-fns v3 + date-fns-tz v3ï¼‰**
- æ¨èæŒ‡æ•°: â­â­â­â­â­

#### ğŸš€ é•¿æœŸï¼ˆ6ä¸ªæœˆ+ï¼‰
**è¿ç§»åˆ° Lunisolar**
- æ¨èæŒ‡æ•°: â­â­â­â­â­

#### âŒ ä¸æ¨è
**å‡çº§åˆ° date-fns v4 + @date-fns/utc**
- æ¨èæŒ‡æ•°: â­â­â˜†â˜†â˜†
- åŸå› ï¼šåŠŸèƒ½å€’é€€ï¼Œæ— æ³•æ»¡è¶³éœ€æ±‚

---

**æœ€ä½³å®è·µï¼š**
é‡‡ç”¨æ¸è¿›å¼è¿ç§»ç­–ç•¥ï¼Œå…ˆè¯„ä¼°ã€å†é€‚é…ã€åç°åº¦ã€æœ€ç»ˆåˆ‡æ¢ï¼Œç¡®ä¿å¹³æ»‘è¿‡æ¸¡å’Œé£é™©å¯æ§ï¼

---

**è¯„ä¼°æ—¥æœŸï¼š** 2025-01-22  
**é€‚ç”¨é¡¹ç›®ï¼š** mksaas_qiflowai  
**å»ºè®®æ‰§è¡Œï¼š** ç«‹å³ä¿æŒç°çŠ¶ï¼Œ3-6ä¸ªæœˆåè¯„ä¼°è¿ç§»Lunisolar
