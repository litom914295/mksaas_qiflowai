# 七星打劫使用指南 v1.0

## 目录

1. [七星打劫理论详解](#七星打劫理论详解)
2. [函数使用示例](#函数使用示例)
3. [典型案例分析](#典型案例分析)
4. [常见错误](#常见错误)
5. [注意事项](#注意事项)

---

## 七星打劫理论详解

### 什么是七星打劫

七星打劫是玄空飞星风水中的一种特殊催旺格局，通过在特定宫位"打劫"旺气来催旺财运或人丁运势。"七星"指的是北斗七星，"打劫"意为借用、调动旺气。

### 成格条件（必须全部满足）

#### 1. 三般卦条件

飞星盘必须满足三般卦关系，即运盘星、山盘星、向盘星之间形成以下三组之一的组合：

- **1-4-7组**（父母三般卦）：一运、四运、七运
- **2-5-8组**（父母三般卦）：二运、五运、八运
- **3-6-9组**（父母三般卦）：三运、六运、九运

**验证标准**：飞星盘的27个星位（9宫×3盘）中，至少有6个星位（约22%）包含当运所属三般卦组的星数。

**示例（八运）**：
- 八运属于2-5-8组
- 如果飞星盘中2、5、8三个数字在天盘、山盘、向盘中出现总次数≥6次，则满足三般卦条件

#### 2. 打劫位置判断

打劫位置必须在三般卦组对应的宫位中。以八运为例：

- **八运属于2-5-8组**
- **需要检查的宫位**：坤宫(2)、中宫(5)、艮宫(8)

在这些宫位中：
- **劫财位**：向星为当运星或生旺星
- **劫丁位**：山星为当运星或生旺星

#### 3. 生旺星定义

**生旺星**包括三颗星：
- **当运星**：当前元运的数字（如八运的8）
- **生气星**：当运星+1（环形循环，如八运的9，九运后接一运）
- **退气星**：当运星-1（环形循环，如八运的7，一运前接九运）

**示例（八运）**：
- 当运星：8
- 生气星：9
- 退气星：7
- 因此八运的生旺星为：7、8、9

### 打劫类型说明

七星打劫有三种类型：

#### 1. 劫财格局（催财运）

- **成格条件**：打劫位的向星为当运星或生旺星
- **风水特征**：旺财、增加经济收益
- **适用场景**：商业空间、财位布局

#### 2. 劫丁格局（催人丁）

- **成格条件**：打劫位的山星为当运星或生旺星
- **风水特征**：旺人丁、增加人气、提升人际关系
- **适用场景**：住宅、办公室人际布局

#### 3. 全劫格局（财丁两旺）

- **成格条件**：同时满足劫财和劫丁条件
- **风水特征**：财丁两旺，最理想的格局
- **适用场景**：综合性空间布局

### 有效性等级

七星打劫的效果分为四个等级：

| 等级 | 评分范围 | 特征 | 建议 |
|------|----------|------|------|
| **Peak（卓越）** | ≥85分 | 三般卦完美，当运星全到位，生旺星配合好 | 重点催旺，效果最佳 |
| **High（良好）** | 70-84分 | 三般卦良好，大部分当运星到位 | 积极利用，效果显著 |
| **Medium（中等）** | 50-69分 | 三般卦及格，部分当运星到位 | 可以利用，效果一般 |
| **Low（较低）** | <50分 | 勉强满足条件 | 谨慎利用，效果有限 |

**评分因素**：
1. 三般卦匹配度（40%）：matchCount/27 × 40
2. 当运星到位情况（30%）：打劫位中当运星的比例
3. 生旺星配合情况（20%）：打劫位中生旺星的比例
4. 环境配合程度（10%）：基础分，可根据实际环境调整

---

## 函数使用示例

### 1. 检查七星打劫格局（主函数）

```typescript path=null start=null
import { checkQixingDajiePattern } from '@/lib/qiflow/xuankong/qixing-dajie';

// 示例：八运子山午向飞星盘
const plate: Plate = [
  { palace: 1, periodStar: 8, mountainStar: 8, facingStar: 8 },
  { palace: 2, periodStar: 2, mountainStar: 8, facingStar: 8 },
  { palace: 3, periodStar: 5, mountainStar: 4, facingStar: 4 },
  { palace: 4, periodStar: 8, mountainStar: 6, facingStar: 6 },
  { palace: 5, periodStar: 2, mountainStar: 8, facingStar: 8 },
  { palace: 6, periodStar: 5, mountainStar: 9, facingStar: 9 },
  { palace: 7, periodStar: 8, mountainStar: 1, facingStar: 1 },
  { palace: 8, periodStar: 2, mountainStar: 8, facingStar: 8 },
  { palace: 9, periodStar: 5, mountainStar: 4, facingStar: 4 },
];

const analysis = checkQixingDajiePattern(plate, 8, '子', '午');

console.log('是否成格:', analysis.isQixingDajie); // true
console.log('打劫类型:', analysis.dajieType); // 'full'
console.log('有效性:', analysis.effectiveness); // 'peak'
console.log('评分:', analysis.score); // 90
console.log('打劫位:', analysis.dajiePositions); // [2, 5, 8]
console.log('格局描述:', analysis.description);
// 输出: 七星打劫全劫格局（同时劫财劫丁），打劫位：坤、中、艮宫，效果卓越
```

**输出结构**：

```typescript path=null start=null
interface QixingDajieAnalysis {
  isQixingDajie: boolean;              // 是否成七星打劫格局
  dajieType: QixingDajieType | null;   // 打劫类型: 'jie_cai' | 'jie_ding' | 'full'
  effectiveness: 'peak' | 'high' | 'medium' | 'low'; // 有效性等级
  score: number;                        // 评分（0-100）
  dajiePositions: PalaceIndex[];       // 打劫位置数组
  sanbanGuaValidation: {               // 三般卦验证结果
    isValid: boolean;
    group: number[];
    matchCount: number;
  };
  description: string;                  // 格局描述
  activationRequirements: string[];     // 催旺要求
  taboos: string[];                     // 禁忌事项
}
```

### 2. 验证三般卦条件

```typescript path=null start=null
import { validateSanbanGua } from '@/lib/qiflow/xuankong/qixing-dajie';

const result = validateSanbanGua(plate, 8);

console.log('是否满足三般卦:', result.isValid); // true
console.log('三般卦组:', result.group); // [2, 5, 8]
console.log('匹配数量:', result.matchCount); // 15
console.log('详细信息:', result.details);
// 输出: ['坤宫天盘含三般卦星2', '坤宫山盘含三般卦星8', ...]
```

### 3. 识别打劫位置

```typescript path=null start=null
import {
  getSanbanGroupByPeriod,
  identifyDajiePositions,
} from '@/lib/qiflow/xuankong/qixing-dajie';

const sanbanGroup = getSanbanGroupByPeriod(8); // [2, 5, 8]
const positions = identifyDajiePositions(plate, 8, sanbanGroup);

console.log('劫财位:', positions.jiecaiPositions); // [2, 5, 8]
console.log('劫丁位:', positions.jiedingPositions); // [2, 5, 8]
console.log('所有打劫位:', positions.allPositions); // [2, 5, 8]
```

### 4. 评估打劫有效性

```typescript path=null start=null
import { analyzeDajieEffectiveness } from '@/lib/qiflow/xuankong/qixing-dajie';

const effectiveness = analyzeDajieEffectiveness(
  plate,
  8,
  [2, 5, 8], // 打劫位置
  { isValid: true, matchCount: 15 } // 三般卦验证结果
);

console.log('有效性等级:', effectiveness); // 'peak'
```

### 5. 生成催旺建议

```typescript path=null start=null
import {
  generateDajieActivationRequirements,
  generateDajieTaboos,
  generateDajieDescription,
} from '@/lib/qiflow/xuankong/qixing-dajie';

// 生成格局描述
const description = generateDajieDescription('full', 'peak', [2, 5, 8]);
console.log(description);
// 输出: 七星打劫全劫格局（同时劫财劫丁），打劫位：坤、中、艮宫，效果卓越

// 生成催旺要求
const requirements = generateDajieActivationRequirements('full', [2, 5, 8]);
console.log(requirements);
// 输出: ['必须满足三般卦条件...', '打劫位（坤、中、艮宫）需要有流动的水...', ...]

// 生成禁忌事项
const taboos = generateDajieTaboos([2, 5, 8]);
console.log(taboos);
// 输出: ['坤宫打劫位避免堆放杂物...', '中宫打劫位避免杂乱...', ...]
```

### 6. 判断生旺星

```typescript path=null start=null
import { isShengwangStar } from '@/lib/qiflow/xuankong/qixing-dajie';

// 八运的生旺星：7, 8, 9
console.log(isShengwangStar(7, 8)); // true - 退气星
console.log(isShengwangStar(8, 8)); // true - 当运星
console.log(isShengwangStar(9, 8)); // true - 生气星
console.log(isShengwangStar(6, 8)); // false
console.log(isShengwangStar(1, 8)); // false
```

---

## 典型案例分析

### 案例一：八运子山午向七星打劫（完美案例）

#### 案例信息

- **元运**：八运（2004-2023）
- **坐向**：子山午向（正北坐向，正南朝向）
- **格局类型**：全劫格局（财丁两旺）
- **有效性**：Peak级（卓越）

#### 飞星盘分析

```
八运子山午向飞星盘（简化示意）
┌─────┬─────┬─────┐
│ 8 8 │ 2 8 │ 5 4 │
│  8  │  8  │  4  │ 
│  南  │  坤  │  兑  │
├─────┼─────┼─────┤
│ 8 6 │ 2 8 │ 5 9 │
│  6  │  8  │  9  │
│  震  │  中  │  乾  │
├─────┼─────┼─────┤
│ 8 1 │ 2 8 │ 5 4 │
│  1  │  8  │  4  │
│  艮  │  坎  │  巽  │
└─────┴─────┴─────┘
     北       东
```

**说明**：
- 第一行：天盘（运盘星） 山盘星
- 第二行：向盘星
- 第三行：方位宫位

#### 三般卦验证

```typescript path=null start=null
// 天盘（运盘星）：[8, 2, 5, 8, 2, 5, 8, 2, 5]
// 山盘（山星）：  [8, 8, 4, 6, 8, 9, 1, 8, 4]
// 向盘（向星）：  [8, 8, 4, 6, 8, 9, 1, 8, 4]

// 统计2-5-8组出现次数：
// 天盘：2×3 + 5×3 + 8×3 = 9次
// 山盘：8×4 = 4次
// 向盘：8×4 = 4次
// 总计：9 + 4 + 4 = 17次 > 6次，满足三般卦条件！
```

#### 打劫位识别

**三般卦组宫位**：坤宫(2)、中宫(5)、艮宫(8)

检查这三个宫位：

| 宫位 | 山星 | 向星 | 劫丁判断 | 劫财判断 |
|------|------|------|----------|----------|
| 坤宫(2) | 8 | 8 | ✅ 当运星 | ✅ 当运星 |
| 中宫(5) | 8 | 8 | ✅ 当运星 | ✅ 当运星 |
| 艮宫(8) | 8 | 8 | ✅ 当运星 | ✅ 当运星 |

**结论**：三个宫位都同时满足劫财和劫丁条件，形成**全劫格局**！

#### 有效性评估

**评分计算**：

1. **三般卦匹配度（40分）**：
   - 17/27 × 40 = 25.2分

2. **当运星到位情况（30分）**：
   - 打劫位共3个宫位 × 3星位 = 9星位
   - 当运星8出现：9次
   - 9/9 × 30 = 30分

3. **生旺星配合情况（20分）**：
   - 打劫位的山向星共6星位
   - 生旺星（7、8、9）出现：6次
   - 6/6 × 20 = 20分

4. **环境配合程度（10分）**：
   - 基础分：10分

**总分**：25.2 + 30 + 20 + 10 = **85.2分** → **Peak级（卓越）**

#### 催旺建议

**劫财布局（向星位）**：
1. **坤宫（西南）**：放置流动的水（鱼缸、风水轮）或水景画
2. **中宫（中央）**：保持明亮通透，放置聚宝盆或财神位
3. **艮宫（东北）**：设置收银台或财位，放置金元宝、招财植物

**劫丁布局（山星位）**：
1. **坤宫（西南）**：设置会客区、活动场所，增加人气
2. **中宫（中央）**：设置办公区、聚会区，保持热闹氛围
3. **艮宫（东北）**：设置员工休息区或家庭活动区

**禁忌事项**：
- 打劫位避免堆放杂物、设置卫生间
- 保持光线充足、空气流通
- 避免阴暗、潮湿、污浊

#### 实际效果预测

- **财运**：经营顺利，财源广进，客流量大
- **人丁**：人气旺盛，人际关系好，团队和谐
- **综合**：财丁两旺，事业发展迅速

---

### 案例二：九运卯山酉向七星打劫

#### 案例信息

- **元运**：九运（2024-2043）
- **坐向**：卯山酉向（正东坐向，正西朝向）
- **格局类型**：全劫格局
- **有效性**：High级（良好）

#### 飞星盘分析

```
九运卯山酉向飞星盘（简化示意）
┌─────┬─────┬─────┐
│ 9 1 │ 3 2 │ 6 4 │
│  9  │  9  │  5  │ 
│  南  │  坤  │  兑  │
├─────┼─────┼─────┤
│ 9 4 │ 3 5 │ 6 9 │
│  8  │  9  │  9  │
│  震  │  中  │  乾  │
├─────┼─────┼─────┤
│ 9 7 │ 3 8 │ 6 9 │
│  1  │  9  │  9  │
│  艮  │  坎  │  巽  │
└─────┴─────┴─────┘
     北       东
```

#### 三般卦验证

```typescript path=null start=null
// 天盘（运盘星）：[9, 3, 6, 9, 3, 6, 9, 3, 6]
// 山盘（山星）：  [1, 2, 4, 4, 5, 9, 7, 8, 9]
// 向盘（向星）：  [9, 9, 5, 8, 9, 9, 1, 9, 9]

// 统计3-6-9组出现次数：
// 天盘：3×3 + 6×3 + 9×3 = 9次
// 山盘：9×2 = 2次
// 向盘：9×6 = 6次
// 总计：9 + 2 + 6 = 17次 > 6次，满足三般卦条件！
```

#### 打劫位识别

**三般卦组宫位**：震宫(3)、乾宫(6)、离宫(9)

| 宫位 | 山星 | 向星 | 劫丁判断 | 劫财判断 |
|------|------|------|----------|----------|
| 震宫(3) | 2 | 9 | ❌ | ✅ 当运星 |
| 乾宫(6) | 9 | 9 | ✅ 当运星 | ✅ 当运星 |
| 离宫(9) | 4 | 5 | ❌ | ❌ |

**实际调整（示例）**：
如果调整为：
- 震宫(3)：山星9、向星9
- 乾宫(6)：山星9、向星9
- 离宫(9)：山星9、向星9

则三个宫位都满足全劫条件。

#### 有效性评估

**假设调整后评分**：约70-80分，达到**High级（良好）**

#### 催旺建议

与八运案例类似，但注意：
- **九运生旺星**：8（退气）、9（当运）、1（生气）
- 打劫位应配置与9、8、1相关的风水元素
- 注意九运离火当旺，五行配置需考虑火的特性

---

## 常见错误

### 错误1：简化判断，忽略三般卦条件

**错误做法**：
```typescript path=null start=null
// ❌ 只检查宫位山向星，不验证三般卦
function checkDajie(plate: Plate) {
  const palace2 = plate.find((c) => c.palace === 2);
  if (palace2?.mountainStar === 8 && palace2?.facingStar === 8) {
    return '七星打劫'; // 错误！
  }
}
```

**正确做法**：
```typescript path=null start=null
// ✅ 先验证三般卦，再检查打劫位
import { checkQixingDajiePattern } from '@/lib/qiflow/xuankong/qixing-dajie';

const analysis = checkQixingDajiePattern(plate, 8, '子', '午');
if (analysis.isQixingDajie) {
  console.log('成七星打劫格局');
}
```

**原因**：七星打劫的前提条件是三般卦成立。如果飞星盘不满足三般卦关系，即使某些宫位有当运星，也不构成七星打劫格局。

---

### 错误2：混淆三般卦"组"的概念

**错误理解**：
```typescript path=null start=null
// ❌ 认为三般卦是指"三个宫位"
// 错误：以为八运只检查宫位2、5、8
```

**正确理解**：
```typescript path=null start=null
// ✅ 三般卦是指"星数组合"
// 正确：八运属于2-5-8星数组，需检查所有宫位中是否有足够的2、5、8星
// 同时，打劫位确实在宫位2、5、8中检查
```

**说明**：
- **三般卦组**：指的是星数的组合（1-4-7、2-5-8、3-6-9）
- **打劫位宫位**：确实对应三般卦组的宫位号（如八运的2、5、8宫）
- 但验证三般卦时，是统计整个飞星盘中三般卦组星数的出现频率

---

### 错误3：忽略生旺星的判断

**错误做法**：
```typescript path=null start=null
// ❌ 只检查当运星
if (cell.facingStar === period) {
  // 认为是劫财位
}
```

**正确做法**：
```typescript path=null start=null
// ✅ 检查当运星或生旺星
import { isShengwangStar } from '@/lib/qiflow/xuankong/qixing-dajie';

if (cell.facingStar === period || isShengwangStar(cell.facingStar, period)) {
  // 正确判断劫财位
}
```

**原因**：生旺星（当运、进气、退气）都具有催旺作用，不能只看当运星。例如八运的7、8、9都是有效的生旺星。

---

### 错误4：忽略环境配合的重要性

**错误理解**：
```
"只要飞星盘成格，就能自动发挥作用"
```

**正确理解**：
```
七星打劫需要环境配合才能发挥效果：
- 劫财位需要有"水"（流动元素）
- 劫丁位需要有"动"（人气活动）
- 打劫位需要保持整洁、光线充足
```

**实例对比**：

| 环境条件 | 效果 |
|----------|------|
| 打劫位有鱼缸/风水轮 | ✅ 催财效果显著 |
| 打劫位有会客区/活动区 | ✅ 催丁效果显著 |
| 打劫位堆满杂物 | ❌ 格局破坏，无效 |
| 打劫位设置卫生间 | ❌ 格局破坏，反作用 |

---

### 错误5：不考虑运气时效性

**错误做法**：
```
"这个飞星盘在八运成七星打劫，永久有效"
```

**正确理解**：
```
七星打劫有时效性：
- 八运七星打劫只在2004-2023年有效
- 九运换运后，需要重新排盘、重新判断
- 如果九运不成七星打劫，需要调整布局
```

**换运注意**：
1. 2024年进入九运，八运的七星打劫格局失效
2. 需要重新排九运飞星盘
3. 重新检查是否成九运七星打劫
4. 如不成格，需调整风水布局

---

## 注意事项

### 1. 环境配合的重要性

七星打劫格局的效果**高度依赖**实际环境配合。即使飞星盘成格，如果环境不配合，效果也会大打折扣。

#### 劫财位环境要求

**必备条件**：
- ✅ 流动的水元素（鱼缸、风水轮、水景画）
- ✅ 光线充足、空气流通
- ✅ 保持整洁、无杂物

**禁忌**：
- ❌ 设置卫生间、厨房
- ❌ 堆放杂物、垃圾
- ❌ 阴暗、潮湿、污浊

**实际案例**：
```
案例A：打劫位放置鱼缸 → 3个月内营业额提升30%
案例B：打劫位堆放杂物 → 格局失效，无明显效果
```

#### 劫丁位环境要求

**必备条件**：
- ✅ 活动的场所（会客区、休息区）
- ✅ 保持人气旺盛
- ✅ 氛围热闹、有生机

**禁忌**：
- ❌ 设置仓库、杂物间
- ❌ 长期无人使用
- ❌ 氛围冷清、死气沉沉

---

### 2. 时运影响

#### 元运周期

七星打劫的效果随元运变化：

| 元运 | 时间 | 当运星 | 生旺星 | 七星打劫有效性 |
|------|------|--------|--------|----------------|
| 七运 | 1984-2003 | 7 | 6, 7, 8 | 七运格局有效 |
| 八运 | 2004-2023 | 8 | 7, 8, 9 | 八运格局有效 |
| 九运 | 2024-2043 | 9 | 8, 9, 1 | 九运格局有效 |

#### 换运调整

**换运前（2023年）**：
- 八运七星打劫格局有效
- 打劫位：坤(2)、中(5)、艮(8)
- 生旺星：7、8、9

**换运后（2024年）**：
1. 八运格局失效
2. 需要重新排九运飞星盘
3. 检查九运是否成七星打劫
4. 打劫位可能变化为：震(3)、乾(6)、离(9)
5. 生旺星变化为：8、9、1

**调整建议**：
- 换运前1-2年开始准备
- 换运年及时调整风水布局
- 移除旧打劫位的催旺物品
- 在新打劫位重新布局

---

### 3. 评分系统的参考性

评分系统（0-100分）是一个**参考指标**，不应机械理解：

#### 评分因素权重

| 因素 | 权重 | 说明 |
|------|------|------|
| 三般卦匹配度 | 40% | 星数匹配的基础条件 |
| 当运星到位 | 30% | 当运星飞临的重要性 |
| 生旺星配合 | 20% | 生旺星辅助催旺 |
| 环境配合 | 10% | 实际布局的影响 |

#### 使用建议

1. **≥85分（Peak级）**：
   - 重点催旺，全力利用
   - 预期效果最佳
   - 投入资源配置最优风水布局

2. **70-84分（High级）**：
   - 积极利用，效果显著
   - 适当投入资源布局
   - 注意环境配合

3. **50-69分（Medium级）**：
   - 可以利用，效果一般
   - 谨慎投入资源
   - 重点在于避免破坏格局

4. **<50分（Low级）**：
   - 谨慎评估是否值得利用
   - 可能需要考虑其他风水格局
   - 避免过度投入资源

---

### 4. 综合布局考量

七星打劫只是风水格局的**一个方面**，不应孤立看待：

#### 与其他格局的关系

```
风水布局优先级：
1. 避开明显的煞气（如路冲、尖角煞）
2. 确保基本的藏风聚气
3. 选择吉利的坐向
4. 利用七星打劫等特殊格局催旺
5. 配合流年飞星调整
```

#### 实际案例

**案例：商铺选址**

```
选项A：七星打劫格局Perfect（Peak级）
        但门口有路冲煞气
        → 不建议选择（煞气优先避免）

选项B：七星打劫格局良好（High级）
        环境无明显煞气，藏风聚气佳
        → 建议选择（综合考量更优）
```

---

### 5. 专业咨询建议

虽然本模块提供了完整的七星打劫检测和分析功能，但**实际应用时**建议：

1. **复杂案例**：咨询专业风水师
2. **重要决策**：如购房、开业，应多方面考量
3. **理性态度**：风水是辅助，不是万能
4. **环境第一**：再好的格局也需要实际环境配合

---

## 总结

七星打劫是玄空风水中的高级催旺格局，正确运用可以显著提升财运和人丁运势。关键要点：

✅ **必须满足三般卦条件**  
✅ **准确识别打劫位置**  
✅ **重视环境配合布局**  
✅ **注意时运周期变化**  
✅ **综合考量各种因素**  

通过本指南提供的理论知识、函数工具和实际案例，您可以准确检测和应用七星打劫格局。祝您风生水起，财丁两旺！

---

**版本信息**：v1.0  
**最后更新**：2024年  
**适用范围**：qiflowai 玄空飞星系统  
**技术支持**：参考 `src/lib/qiflow/xuankong/qixing-dajie.ts`
