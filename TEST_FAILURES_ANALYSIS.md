# æµ‹è¯•å¤±è´¥åˆ†ææŠ¥å‘Š

**é—®é¢˜:** 96 ä¸ªæµ‹è¯•å¥—ä»¶å¤±è´¥  
**åˆ†ææ—¶é—´:** 2025-11-05 15:35

---

## ğŸ” é—®é¢˜åŸå› åˆ†æ

### æ ¹æœ¬åŸå› 
**Vitest æ­£åœ¨æ‰«æå¹¶å°è¯•è¿è¡Œ `.archived/` ç›®å½•ä¸‹çš„æ—§æµ‹è¯•æ–‡ä»¶**

### å‘ç°çš„é—®é¢˜

1. **`.archived/` ç›®å½•åŒ…å«æ—§æµ‹è¯•æ–‡ä»¶**
   - åœ¨å½’æ¡£ç›®å½•ä¸­æ‰¾åˆ° 2 ä¸ªæµ‹è¯•æ–‡ä»¶
   - è¿™äº›æ˜¯ä» `.attic/`, `.archive/`, `backup/` ç§»åŠ¨è¿‡æ¥çš„æ—§ä»£ç 
   - è¿™äº›æµ‹è¯•ç¼ºå°‘ä¾èµ–ï¼Œä¾‹å¦‚ï¼š`Cannot find module '@testing-library/dom'`

2. **Vitest é…ç½®æœªæ’é™¤ `.archived/` ç›®å½•**
   - å½“å‰ `vitest.config.ts` åªæ’é™¤äº†ï¼š
     - `node_modules/`
     - `tests/` (coverage é…ç½®ä¸­)
     - `e2e/` (coverage é…ç½®ä¸­)
     - `.next/`
     - `dist/`
     - `build/`
   - **æ²¡æœ‰æ’é™¤ `.archived/`**

3. **E2E æµ‹è¯•è¢«é”™è¯¯æ‰§è¡Œ**
   - Vitest å°è¯•è¿è¡Œ Playwright çš„ E2E æµ‹è¯•ï¼ˆ`.spec.ts` æ–‡ä»¶ï¼‰
   - è¿™äº›æµ‹è¯•åº”è¯¥ç”¨ `npm run test:e2e` (Playwright) è¿è¡Œ
   - ä¸åº”è¯¥è¢« Vitest æ‰§è¡Œ

---

## ğŸ“Š æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡

- **å½’æ¡£ç›®å½•æµ‹è¯•:** 2 ä¸ªï¼ˆæ—§çš„ï¼Œä¸åº”è¯¥è¿è¡Œï¼‰
- **é¡¹ç›®å®é™…æµ‹è¯•:** 862 ä¸ª
- **å¤±è´¥çš„æµ‹è¯•å¥—ä»¶:** 96 ä¸ª

### å¤±è´¥æµ‹è¯•åˆ†ç±»

1. **E2E æµ‹è¯•** (åº”è¯¥ç”¨ Playwright)
   - `e2e/i18n-navigation-quick.spec.ts`
   - `e2e/i18n-navigation.spec.ts`
   - `tests/e2e/*.spec.ts` (13+ ä¸ªæ–‡ä»¶)

2. **å½’æ¡£ç›®å½•ä¸­çš„æµ‹è¯•** (ä¸åº”è¯¥è¿è¡Œ)
   - `.archived/backups/old-code/.attic/2025-10-26/src/app/api/qiflow/xuankong/__tests__/route.test.ts`

3. **å•å…ƒæµ‹è¯•** (å¯èƒ½æœ‰å®é™…é—®é¢˜)
   - `tests/api/credits-api.test.ts`
   - `tests/unit/credits/*.test.ts`
   - `lib/auth/__tests__/permissions.test.ts`
   - ç­‰ç­‰

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ›´æ–° Vitest é…ç½®ï¼ˆæ¨èï¼‰

ä¿®æ”¹ `vitest.config.ts`ï¼Œæ’é™¤ä¸åº”è¯¥è¿è¡Œçš„æµ‹è¯•ï¼š

```typescript
export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
    
    // æ’é™¤ä¸åº”è¯¥ç”± Vitest è¿è¡Œçš„æ–‡ä»¶
    exclude: [
      '**/node_modules/**',
      '**/.archived/**',           // â† æ–°å¢ï¼šæ’é™¤å½’æ¡£ç›®å½•
      '**/e2e/**',                 // â† æ–°å¢ï¼šæ’é™¤ E2E æµ‹è¯•ï¼ˆç”¨ Playwrightï¼‰
      '**/tests/e2e/**',           // â† æ–°å¢ï¼šæ’é™¤ E2E æµ‹è¯•
      '**/*.spec.ts',              // â† æ–°å¢ï¼šæ’é™¤ Playwright æµ‹è¯•æ–‡ä»¶
      '**/dist/**',
      '**/.next/**',
    ],
    
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: [
        'node_modules/',
        'tests/',
        'e2e/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/mockData/**',
        '**/.next/**',
        '**/dist/**',
        '**/build/**',
        '**/.archived/**',         // â† æ–°å¢ï¼šæ’é™¤å½’æ¡£ç›®å½•
      ],
      thresholds: {
        lines: 80,
        functions: 80,
        branches: 75,
        statements: 80,
      },
    },
    
    testTimeout: 10000,
    hookTimeout: 10000,
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '~': path.resolve(__dirname, './src'),
    },
  },
});
```

### æ–¹æ¡ˆ 2: åªè¿è¡Œç‰¹å®šç›®å½•çš„æµ‹è¯•

åœ¨ `package.json` ä¸­ä¿®æ”¹æµ‹è¯•è„šæœ¬ï¼š

```json
{
  "scripts": {
    "test:unit": "vitest run src/**/__tests__/**/*.test.ts",
    "test:unit:watch": "vitest src/**/__tests__/**/*.test.ts",
    "test:api": "vitest run tests/api",
    "test:security": "vitest run tests/security"
  }
}
```

### æ–¹æ¡ˆ 3: ç§»é™¤å½’æ¡£ç›®å½•ä¸­çš„æµ‹è¯•æ–‡ä»¶

å¦‚æœå½’æ¡£ç›®å½•ä¸­çš„æµ‹è¯•æ–‡ä»¶ä¸éœ€è¦ï¼Œå¯ä»¥åˆ é™¤ï¼š

```bash
Remove-Item -Path ".archived\backups\*\**\*.test.*" -Recurse -Force
Remove-Item -Path ".archived\backups\*\**\*.spec.*" -Recurse -Force
```

---

## ğŸ¯ æ¨èæ“ä½œæ­¥éª¤

### çŸ­æœŸä¿®å¤ï¼ˆç«‹å³æ‰§è¡Œï¼‰

**æ›´æ–° `vitest.config.ts`** æ·»åŠ æ’é™¤è§„åˆ™ï¼š

```typescript
exclude: [
  '**/node_modules/**',
  '**/.archived/**',      // æ’é™¤å½’æ¡£ç›®å½•
  '**/e2e/**',            // E2E æµ‹è¯•ç”¨ Playwright
  '**/tests/e2e/**',
  '**/*.spec.ts',         // Playwright æµ‹è¯•æ–‡ä»¶
  '**/dist/**',
  '**/.next/**',
],
```

### ä¸­æœŸä¿®å¤ï¼ˆ1-2 å‘¨å†…ï¼‰

1. **å®¡æŸ¥çœŸæ­£çš„å•å…ƒæµ‹è¯•å¤±è´¥**
   ```bash
   # åªè¿è¡Œ src ç›®å½•ä¸‹çš„æµ‹è¯•
   npm run test:unit -- src/
   ```

2. **ä¿®å¤æœ‰é—®é¢˜çš„å•å…ƒæµ‹è¯•**
   - ä»æœ€é‡è¦çš„æ¨¡å—å¼€å§‹
   - é€æ­¥ä¿®å¤æµ‹è¯•

3. **ç¡®ä¿ E2E æµ‹è¯•æ­£ç¡®è¿è¡Œ**
   ```bash
   npm run test:e2e
   ```

### é•¿æœŸæ”¹è¿›ï¼ˆ1 ä¸ªæœˆå†…ï¼‰

1. **å»ºç«‹æ¸…æ™°çš„æµ‹è¯•ç»“æ„**
   - `src/**/__tests__/**/*.test.ts` - å•å…ƒæµ‹è¯•
   - `tests/unit/` - é¢å¤–çš„å•å…ƒæµ‹è¯•
   - `tests/api/` - API æµ‹è¯•
   - `tests/integration/` - é›†æˆæµ‹è¯•
   - `e2e/` å’Œ `tests/e2e/` - E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰

2. **è®¾ç½® CI/CD æµ‹è¯•æµæ°´çº¿**
   - åˆ†åˆ«è¿è¡Œå•å…ƒæµ‹è¯•å’Œ E2E æµ‹è¯•
   - è®¾ç½®æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

3. **å®šæœŸæµ‹è¯•å®¡æŸ¥**
   - åˆ é™¤è¿‡æ—¶çš„æµ‹è¯•
   - æ›´æ–°å¤±è´¥çš„æµ‹è¯•
   - æ·»åŠ æ–°åŠŸèƒ½çš„æµ‹è¯•

---

## âš ï¸ é‡è¦è¯´æ˜

### è¿™äº›æµ‹è¯•å¤±è´¥ä¸å½±å“é¡¹ç›®æ¸…ç†çš„è¯„ä¼°

**åŸå› ï¼š**

1. **æµ‹è¯•é…ç½®é—®é¢˜**
   - Vitest æ‰«æäº†ä¸è¯¥æ‰«æçš„ç›®å½•
   - è¿™ä¸æ˜¯æ¸…ç†æ“ä½œå¯¼è‡´çš„

2. **æ¸…ç†å‰å°±å­˜åœ¨çš„é—®é¢˜**
   - æ—§çš„å½’æ¡£ä»£ç æœ¬æ¥å°±æœ‰é—®é¢˜
   - E2E æµ‹è¯•å’Œå•å…ƒæµ‹è¯•æ¡†æ¶æ··æ·†

3. **é¡¹ç›®åŠŸèƒ½æ­£å¸¸**
   - å¼€å‘æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
   - å®é™…ä»£ç æ²¡æœ‰é—®é¢˜
   - åªæ˜¯æµ‹è¯•é…ç½®éœ€è¦è°ƒæ•´

### æ­£å¸¸å—ï¼Ÿ

**æ˜¯çš„ï¼Œè¿™åœ¨é¡¹ç›®æ¸…ç†è¿‡ç¨‹ä¸­å¾ˆæ­£å¸¸ã€‚**

å¾ˆå¤šé¡¹ç›®éƒ½ä¼šæœ‰ï¼š
- æµ‹è¯•è¦†ç›–ä¸å®Œæ•´
- éƒ¨åˆ†æµ‹è¯•è¿‡æ—¶
- æµ‹è¯•é…ç½®éœ€è¦è°ƒæ•´
- E2E å’Œå•å…ƒæµ‹è¯•æ··åˆ

è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœºä¼šæ¥ï¼š
1. æ¸…ç†æµ‹è¯•ç»“æ„
2. æ›´æ–°æµ‹è¯•é…ç½®
3. æå‡æµ‹è¯•è´¨é‡

---

## ğŸ“ å»ºè®®çš„æäº¤ç­–ç•¥

### å½“å‰æäº¤ï¼ˆåªåŒ…å«æ¸…ç†ï¼‰

```bash
git add -A
git commit -m "chore: æ¸…ç†å’Œé‡ç»„é¡¹ç›®æ–‡ä»¶ç»“æ„"
git push origin main
```

### åç»­æäº¤ï¼ˆä¿®å¤æµ‹è¯•ï¼‰

```bash
# ä¿®å¤æµ‹è¯•é…ç½®
git add vitest.config.ts
git commit -m "fix(test): æ’é™¤å½’æ¡£ç›®å½•å’Œ E2E æµ‹è¯•"

# ä¿®å¤å•å…ƒæµ‹è¯•
git add tests/ src/**/__tests__/
git commit -m "fix(test): ä¿®å¤å•å…ƒæµ‹è¯•"

# ä¿®å¤ E2E æµ‹è¯•
git add e2e/ tests/e2e/
git commit -m "fix(test): ä¿®å¤ E2E æµ‹è¯•é…ç½®"
```

---

## âœ… ç»“è®º

**96 ä¸ªæµ‹è¯•å¤±è´¥çš„é—®é¢˜ï¼š**

1. âœ… **ä¸å½±å“é¡¹ç›®æ¸…ç†è¯„ä¼°** - æ¸…ç†æ“ä½œæœ¬èº«æ˜¯æˆåŠŸçš„
2. âœ… **ä¸å½±å“é¡¹ç›®è¿è¡Œ** - å¼€å‘æœåŠ¡å™¨å’Œæ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
3. âœ… **æœ‰æ˜ç¡®çš„è§£å†³æ–¹æ¡ˆ** - æ›´æ–° Vitest é…ç½®å³å¯
4. âœ… **æ˜¯é¡¹ç›®åŸæœ‰é—®é¢˜** - æ¸…ç†å‰å°±å­˜åœ¨ï¼Œç°åœ¨æ˜¯ä¿®å¤çš„å¥½æœºä¼š

**å»ºè®®ï¼š**
- **ç°åœ¨ï¼š** å¯ä»¥å®‰å…¨æäº¤æ¸…ç†å˜æ›´
- **ä¹‹åï¼š** æŒ‰ç…§æœ¬æ–‡æ¡£çš„æ–¹æ¡ˆé€æ­¥ä¿®å¤æµ‹è¯•

---

*åˆ†ææŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-05 15:35*
*å…³è”æ–‡æ¡£: CLEANUP_VERIFICATION_REPORT.md*
