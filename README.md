# MKSaaS QiFlow AI è¿ç§»é¡¹ç›®

**é¡¹ç›®çŠ¶æ€**: âœ… 100% å®Œæˆ  
**è¿ç§»æ—¥æœŸ**: 2025-10-02  
**GitHubä»“åº“**: https://github.com/litom914295/mksaas_qiflowai

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå°† QiFlow AI åŠŸèƒ½å®Œæ•´è¿ç§»åˆ° MKSaaS æ¨¡æ¿ä¸­ï¼Œå®ç°äº†å…«å­—åˆ†æã€ç„ç©ºé£æ°´ã€ç½—ç›˜ç®—æ³•ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶å»ºç«‹äº†å®Œæ•´çš„é™çº§å¤„ç†å’Œå›æ»šæœºåˆ¶ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **å…«å­—åˆ†æ** - åŸºäºç”Ÿè¾°å…«å­—çš„å‘½ç†åˆ†æ
- **ç„ç©ºé£æ°´** - é£æ˜Ÿé£æ°´å¸ƒå±€åˆ†æ  
- **ç½—ç›˜ç®—æ³•** - æ™ºèƒ½ç½—ç›˜è¯»å–å’Œæ ¡å‡†
- **ä¸‰è‰²ç½®ä¿¡åº¦ç³»ç»Ÿ** - çº¢/é»„/ç»¿ç½®ä¿¡åº¦è”åŠ¨UI
- **é™çº§å¤„ç†æœºåˆ¶** - ä½ç½®ä¿¡åº¦è‡ªåŠ¨é™çº§å’Œæ‰‹åŠ¨è¾“å…¥fallback
- **ç§¯åˆ†ç³»ç»Ÿé›†æˆ** - ç»Ÿä¸€çš„ç§¯åˆ†æ‰£å‡å’Œå®šä»·ç®¡ç†
- **åˆè§„æ£€æŸ¥** - å¹´é¾„éªŒè¯ã€å…è´£å£°æ˜ã€æ•æ„Ÿè¯è¿‡æ»¤

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18+
- PostgreSQL æ•°æ®åº“
- npm æˆ– pnpm

### å®‰è£…ä¾èµ–

```bash
npm install
```

### ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š

```bash
cp .env.example .env
```

é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```env
DATABASE_URL="postgresql://username:password@host:port/database"
```

### æ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
npm run db:generate

# æ‰§è¡Œè¿ç§»
npm run db:migrate

# å¯åŠ¨æ•°æ®åº“ç®¡ç†ç•Œé¢
npm run db:studio
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

è®¿é—® http://localhost:3000/zh

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ actions/qiflow/           # Server Actions
â”‚   â”œâ”€â”€ calculate-bazi.ts     # å…«å­—è®¡ç®—
â”‚   â”œâ”€â”€ xuankong-analysis.ts  # ç„ç©ºé£æ°´åˆ†æ
â”‚   â””â”€â”€ compass-reading.ts    # ç½—ç›˜è¯»å–
â”œâ”€â”€ components/qiflow/        # QiFlow UIç»„ä»¶
â”‚   â”œâ”€â”€ confidence-indicator.tsx  # ç½®ä¿¡åº¦æŒ‡ç¤ºå™¨
â”‚   â”œâ”€â”€ manual-input-form.tsx     # æ‰‹åŠ¨è¾“å…¥è¡¨å•
â”‚   â”œâ”€â”€ calibration-guide.tsx     # æ ¡å‡†å¼•å¯¼
â”‚   â””â”€â”€ compliance/               # åˆè§„ç»„ä»¶
â”œâ”€â”€ lib/qiflow/              # æ ¸å¿ƒç®—æ³•åº“
â”‚   â”œâ”€â”€ bazi/                # å…«å­—ç®—æ³•
â”‚   â”œâ”€â”€ xuankong/            # ç„ç©ºé£æ°´ç®—æ³•
â”‚   â”œâ”€â”€ compass/             # ç½—ç›˜ç®—æ³•
â”‚   â””â”€â”€ degradation/         # é™çº§å¤„ç†
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ qiflow-pricing.ts    # å®šä»·é…ç½®
â”‚   â””â”€â”€ qiflow-thresholds.ts # é˜ˆå€¼é…ç½®
â””â”€â”€ app/[locale]/analysis/   # åˆ†æé¡µé¢
    â”œâ”€â”€ bazi/               # å…«å­—åˆ†æé¡µ
    â””â”€â”€ xuankong/           # ç„ç©ºé£æ°´é¡µ
```

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:unit

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm run test:pricing
npm run test:thresholds
```

### E2Eæµ‹è¯•

```bash
# ç”ŸæˆE2Eæµ‹è¯•æŒ‡å—
node scripts/simple-e2e-test.js

# æ‰‹åŠ¨æµ‹è¯•æŒ‡å—
# æŸ¥çœ‹ artifacts/C9/screenshots/manual-e2e-test-guide.json
```

### ç§¯åˆ†ä¸€è‡´æ€§éªŒè¯

```bash
npm run verify:credits
```

---

## ğŸ“Š ä»»åŠ¡å®Œæˆæƒ…å†µ

### âœ… å·²å®Œæˆä»»åŠ¡ (12/12)

| ä»»åŠ¡ | çŠ¶æ€ | æè¿° |
|-----|------|------|
| C0 | âœ… | é¢„æ£€ä¸å»ºåˆ†æ”¯ |
| C1 | âœ… | ç»“æ„ç›˜ç‚¹ä¸æ˜ å°„ |
| C2 | âœ… | ä¾èµ–ä¸é…ç½®å¯¹é½ |
| C3 | âœ… | æ•°æ®åº“æ‰©å±•ï¼ˆDrizzleåˆå¹¶ï¼‰ |
| C4 | âœ… | è®¤è¯/æ”¯ä»˜/i18næ¥å…¥ç‚¹ |
| C5 | âœ… | æ ¸å¿ƒä¸šåŠ¡è¿ç§»ï¼ˆç®—æ³•/Actions/UIï¼‰ |
| C6 | âœ… | ç½—ç›˜ç½®ä¿¡åº¦åˆ†æ |
| C7 | âœ… | è¥é”€/åˆè§„åŸ‹ç‚¹ |
| C8 | âœ… | è§‚æµ‹/é™æµ |
| C9 | âœ… | æµ‹è¯•ä¸å†’çƒŸ |
| C10 | âœ… | æäº¤ä¸å·®å¼‚æŠ¥å‘Š |
| C11 | âœ… | å›æ»šè·¯å¾„ä¸å…œåº•é“¾è·¯éªŒè¯ |

**æ€»è¿›åº¦**: 100% (12/12 tasks, 28/28 subtasks)

---

## ğŸ”„ å›æ»šæœºåˆ¶

### æ•°æ®åº“å›æ»š

```bash
# æ‰§è¡Œå›æ»šè„šæœ¬
psql $DATABASE_URL -f artifacts/C11/rollback-0004.sql
```

### ä»£ç å›æ»š

```bash
# Git revertï¼ˆæ¨èï¼‰
git revert HEAD

# æˆ– Git resetï¼ˆç´§æ€¥æƒ…å†µï¼‰
git reset --hard <commit-before-migration>
```

### åº”æ€¥å“åº”

- **P0/P1é—®é¢˜**: 30åˆ†é’Ÿå†…å®Œæˆå›æ»š
- **è¯¦ç»†æŒ‡å—**: `artifacts/C11/emergency-response-plan.md`
- **å›æ»šè„šæœ¬**: `artifacts/C11/rollback-0004.sql`

---

## ğŸ“š æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£

- [æ•°æ®åº“å›æ»šæŒ‡å—](artifacts/C11/database-rollback-guide.md)
- [Gitå›æ»šæŒ‡å—](artifacts/C11/git-rollback-guide.md)
- [é™çº§æœºåˆ¶éªŒè¯](artifacts/C11/degradation-verification.md)
- [åº”æ€¥å“åº”é¢„æ¡ˆ](artifacts/C11/emergency-response-plan.md)
- [E2Eæµ‹è¯•æŒ‡å—](artifacts/C9/e2e-smoke-test.md)

### ä»»åŠ¡æ–‡æ¡£

- [C0-C11ä»»åŠ¡æ–‡æ¡£](artifacts/)
- [æ€§èƒ½åˆ†ææŠ¥å‘Š](artifacts/C9/performance-analysis.md)
- [å·®å¼‚æŠ¥å‘Š](artifacts/C10/diff.txt)

---

## ğŸ›¡ï¸ å®‰å…¨ä¸åˆè§„

### å·²å®ç°çš„å®‰å…¨æªæ–½

- âœ… **å¹´é¾„éªŒè¯** - 18å²å¼¹çª—ç¡®è®¤
- âœ… **å…è´£å£°æ˜** - é¡¶éƒ¨å›ºå®šå£°æ˜æ 
- âœ… **æ•æ„Ÿè¯è¿‡æ»¤** - è‡ªåŠ¨æ£€æµ‹å’Œæ‹’ç­”
- âœ… **ç§¯åˆ†éªŒè¯** - ä½¿ç”¨å‰æ£€æŸ¥ä½™é¢
- âœ… **è¾“å…¥éªŒè¯** - Zod schemaéªŒè¯
- âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯è¾¹ç•Œ

### é™çº§å¤„ç†

- ğŸ”´ **çº¢è‰²** (< 0.4): æ‹’ç­” + æ‰‹åŠ¨è¾“å…¥
- ğŸŸ¡ **é»„è‰²** (0.4-0.7): è­¦å‘Š + æ ¡å‡†å¼•å¯¼  
- ğŸŸ¢ **ç»¿è‰²** (â‰¥ 0.7): æ­£å¸¸å¤„ç†

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å½“å‰æ€§èƒ½

- **é¡µé¢åŠ è½½**: < 2ç§’
- **ç®—æ³•æ‰§è¡Œ**: < 5ç§’
- **æ•°æ®åº“æŸ¥è¯¢**: < 500ms
- **é”™è¯¯ç‡**: < 1%

### ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜å±‚** - å®æ–½Redisç¼“å­˜
2. **CDN** - é™æ€èµ„æºåŠ é€Ÿ
3. **æ•°æ®åº“ä¼˜åŒ–** - ç´¢å¼•ä¼˜åŒ–
4. **ä»£ç åˆ†å‰²** - æŒ‰éœ€åŠ è½½

---

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç®—æ³•

1. åœ¨ `src/lib/qiflow/` åˆ›å»ºç®—æ³•ç›®å½•
2. å®ç°æ ¸å¿ƒç®—æ³•é€»è¾‘
3. æ·»åŠ ç½®ä¿¡åº¦è®¡ç®—
4. åˆ›å»ºServer Action
5. æ·»åŠ UIç»„ä»¶
6. ç¼–å†™æµ‹è¯•

### ä¿®æ”¹å®šä»·

ç¼–è¾‘ `src/config/qiflow-pricing.ts`:

```typescript
export const QIFLOW_PRICING = {
  aiChat: 5,
  bazi: 10,
  xuankong: 20,
  // ä¿®æ”¹ä»·æ ¼...
} as const
```

### è°ƒæ•´é˜ˆå€¼

ç¼–è¾‘ `src/config/qiflow-thresholds.ts`:

```typescript
export const CONFIDENCE_THRESHOLDS = {
  REJECT: 0.4,    // çº¢è‰²é˜ˆå€¼
  WARNING: 0.7,   // é»„è‰²é˜ˆå€¼
  NORMAL: 0.7,    // ç»¿è‰²é˜ˆå€¼
} as const
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒå˜é‡
   echo $DATABASE_URL
   
   # æµ‹è¯•è¿æ¥
   npm run db:studio
   ```

2. **ä¾èµ–å®‰è£…å¤±è´¥**
   ```bash
   # æ¸…ç†ç¼“å­˜
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **ç¼–è¯‘é”™è¯¯**
   ```bash
   # ç±»å‹æ£€æŸ¥
   npx tsc --noEmit
   
   # æ¸…ç†æ„å»ºç¼“å­˜
   rm -rf .next
   npm run build
   ```

### è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹ [æ•…éšœæ’é™¤æŒ‡å—](artifacts/C11/emergency-response-plan.md)
- ğŸ› æäº¤ [Issue](https://github.com/litom914295/mksaas_qiflowai/issues)
- ğŸ’¬ è”ç³»å¼€å‘å›¢é˜Ÿ

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰å‚ä¸QiFlowè¿ç§»é¡¹ç›®çš„å¼€å‘è€…å’Œè´¡çŒ®è€…ã€‚

---

**é¡¹ç›®çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**æœ€åæ›´æ–°**: 2025-10-02  
**ç»´æŠ¤å›¢é˜Ÿ**: AI Agent & Development Team

---

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ä»“åº“**: https://github.com/litom914295/mksaas_qiflowai
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/litom914295/mksaas_qiflowai/issues)
- **Pull Request**: [GitHub PR](https://github.com/litom914295/mksaas_qiflowai/pulls)

---

**ğŸ‰ QiFlow AI è¿ç§»é¡¹ç›®åœ†æ»¡å®Œæˆï¼**